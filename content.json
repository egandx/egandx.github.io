{"meta":{"title":"Egan's Blog","subtitle":"The winter is coming","description":"You are more than what you have become","author":"Egan Dong","url":"https://blog.eganx.cn","root":"/"},"pages":[{"title":"åˆ†ç±»","date":"2020-12-22T08:07:23.000Z","updated":"2020-12-22T08:08:17.000Z","comments":true,"path":"categories/index.html","permalink":"https://blog.eganx.cn/categories/index.html","excerpt":"","text":""},{"title":"æ ‡ç­¾","date":"2020-12-22T08:06:06.000Z","updated":"2020-12-22T08:07:11.000Z","comments":true,"path":"tags/index.html","permalink":"https://blog.eganx.cn/tags/index.html","excerpt":"","text":""},{"title":"å‹æƒ…é“¾æ¥","date":"2020-12-22T08:08:32.000Z","updated":"2020-12-22T08:09:05.000Z","comments":true,"path":"link/index.html","permalink":"https://blog.eganx.cn/link/index.html","excerpt":"","text":""},{"title":"å…³äº","date":"2020-12-22T08:06:06.000Z","updated":"2022-11-20T02:34:31.036Z","comments":true,"path":"about/index.html","permalink":"https://blog.eganx.cn/about/index.html","excerpt":"","text":"ä¸€ä¸ªå†™C#å®¢æˆ·ç«¯å’ŒGoæœåŠ¡ç«¯çš„å°åƒåœ¾ã€‚æ¯•ä¸šä¸¤å¹´å¤šï¼Œå•¥ä¹Ÿä¸æ˜¯â€¦â€¦ ä¸ªäººè¯´æ˜ï¼š è¯¥ç”¨æˆ·å¾ˆå®… è¯¥ç”¨æˆ·ä¸å¸çƒŸ è¯¥ç”¨æˆ·ä½¿ç”¨Linux è¯¥ç”¨æˆ·æ”¯æŒè¨€è®ºè‡ªç”± è¯¥ç”¨æˆ·è®¤ä¸ºçŸ¥æ˜“è¡Œéš¾ è¯¥ç”¨æˆ·æ—¥å¸¸é å’–å•¡ç»­å‘½ è¯¥ç”¨æˆ·åå¯¹è¯»ä¹¦æ— ç”¨è®º è¯¥ç”¨æˆ·ä¸å–œæ¬¢å¾®ä¿¡å’ŒQQ è¯¥ç”¨æˆ·å¯¹ç”µè„‘ç¨‹åºæ„Ÿå…´è¶£ è¯¥ç”¨æˆ·è°¢ç»ä½¿ç”¨ç™¾åº¦æœç´¢å¼•æ“"}],"posts":[{"title":"Golang GC(Garbage Collection)","slug":"Go_GC","date":"2022-11-16T14:12:29.000Z","updated":"2022-12-28T02:45:00.841Z","comments":true,"path":"2022/11/16/Go_GC/","link":"","permalink":"https://blog.eganx.cn/2022/11/16/Go_GC/","excerpt":"å†…å­˜ç®¡ç†æ˜¯ç¨‹åºå‘˜å¼€å‘åº”ç”¨çš„ä¸€å¤§éš¾é¢˜ã€‚ä¼ ç»Ÿçš„ç³»ç»Ÿçº§ç¼–ç¨‹è¯­è¨€ï¼ˆä¸»è¦æŒ‡C/C++ï¼‰ä¸­ï¼Œç¨‹åºå¼€å‘è€…å¿…é¡»å¯¹å†…å­˜å°å¿ƒçš„è¿›è¡Œç®¡ç†æ“ä½œï¼Œæ§åˆ¶å†…å­˜çš„ç”³è¯·åŠé‡Šæ”¾ã€‚ å› ä¸ºç¨æœ‰ä¸æ…ï¼Œå°±å¯èƒ½äº§ç”Ÿå†…å­˜æ³„éœ²é—®é¢˜ï¼Œè¿™ç§é—®é¢˜ä¸æ˜“å‘ç°å¹¶ä¸”éš¾ä»¥å®šä½ï¼Œä¸€ç›´æˆä¸ºå›°æ‰°ç¨‹åºå¼€å‘è€…çš„å™©æ¢¦ã€‚","text":"å†…å­˜ç®¡ç†æ˜¯ç¨‹åºå‘˜å¼€å‘åº”ç”¨çš„ä¸€å¤§éš¾é¢˜ã€‚ä¼ ç»Ÿçš„ç³»ç»Ÿçº§ç¼–ç¨‹è¯­è¨€ï¼ˆä¸»è¦æŒ‡C/C++ï¼‰ä¸­ï¼Œç¨‹åºå¼€å‘è€…å¿…é¡»å¯¹å†…å­˜å°å¿ƒçš„è¿›è¡Œç®¡ç†æ“ä½œï¼Œæ§åˆ¶å†…å­˜çš„ç”³è¯·åŠé‡Šæ”¾ã€‚ å› ä¸ºç¨æœ‰ä¸æ…ï¼Œå°±å¯èƒ½äº§ç”Ÿå†…å­˜æ³„éœ²é—®é¢˜ï¼Œè¿™ç§é—®é¢˜ä¸æ˜“å‘ç°å¹¶ä¸”éš¾ä»¥å®šä½ï¼Œä¸€ç›´æˆä¸ºå›°æ‰°ç¨‹åºå¼€å‘è€…çš„å™©æ¢¦ã€‚ 0x0.Garbage CollectionGC(Garbage Collection)ï¼Œåƒåœ¾å›æ”¶æ˜¯ä¸€ç§è‡ªåŠ¨å†…å­˜ç®¡ç†æœºåˆ¶ã€‚å½“æŸä¸ªç¨‹åºå ç”¨çš„ä¸€éƒ¨åˆ†å†…å­˜ç©ºé—´ä¸å†è¢«è¿™ä¸ªç¨‹åºè®¿é—®æ—¶ï¼Œè¿™ä¸ªç¨‹åºä¼šå€ŸåŠ©åƒåœ¾å›æ”¶ç®—æ³•å‘æ“ä½œç³»ç»Ÿå½’è¿˜è¿™éƒ¨åˆ†å†…å­˜ç©ºé—´ã€‚åƒåœ¾å›æ”¶å™¨å¯ä»¥å‡è½»ç¨‹åºå‘˜çš„è´Ÿæ‹…ï¼Œä¹Ÿå‡å°‘ç¨‹åºä¸­çš„é”™è¯¯ã€‚åƒåœ¾å›æ”¶æœ€æ—©èµ·æºäºLISPè¯­è¨€ã€‚ åƒåœ¾å›æ”¶å™¨çš„æ‰§è¡Œè¿‡ç¨‹é€šå¸¸è¢«åˆ’åˆ†æˆä¸¤ä¸ªç‹¬ç«‹çš„ç»„ä»¶ï¼š èµ‹å€¼å™¨ï¼šæŒ‡ä»£ç”¨æˆ·æ€çš„ä»£ç ã€‚å¯¹äºåƒåœ¾å›æ”¶å™¨æ¥è¯´ï¼Œç”¨æˆ·æ€çš„ä»£ç åªæ˜¯åœ¨ä¿®æ”¹å¯¹è±¡ä¹‹é—´çš„å¼•ç”¨å…³ç³»ã€‚ å›æ”¶å™¨ï¼šè´Ÿè´£æ‰§è¡Œåƒåœ¾å›æ”¶çš„ä»£ç ã€‚ 0x1.æ ¹å¯¹è±¡æ ¹é›†åˆæ˜¯åƒåœ¾å›æ”¶å™¨åœ¨æ ‡è®°è¿‡ç¨‹ä¸­æœ€å…ˆæ£€æŸ¥çš„å¯¹è±¡ï¼ŒåŒ…æ‹¬ï¼š å…¨å±€å˜é‡ æ‰§è¡Œæ ˆï¼šæ¯ä¸ªgoroutineéƒ½åŒ…å«è‡ªå·±çš„æ‰§è¡Œæ ˆï¼ŒåŒ…å«æ ˆä¸Šçš„å˜é‡ä»¥åŠæŒ‡å‘åˆ†é…çš„å †å†…å­˜åŒºå—çš„æŒ‡é’ˆã€‚ å¯„å­˜å™¨ 0x2.GCå®ç°æ–¹å¼GCçš„å¸¸è§å®ç°æ–¹å¼æœ‰è¿½è¸ªå¼GCå’Œå¼•ç”¨è®¡æ•°å¼GCã€‚ è¿½è¸ªå¼GC ä»æ ¹å¯¹è±¡å‡ºå‘ï¼Œæ ¹æ®å¯¹è±¡ä¹‹é—´çš„å¼•ç”¨ä¿¡æ¯ï¼Œé€æ­¥æ‰«æç›´è‡³æ‰«å®Œæ•´ä¸ªå †å¹¶ç¡®å®šä¿ç•™çš„å¯¹è±¡ï¼Œä»è€Œå›æ”¶æ‰€æœ‰å¯å›æ”¶çš„å¯¹è±¡ã€‚ å¼•ç”¨è®¡æ•°å¼GC æ¯ä¸ªå¯¹è±¡è‡ªèº«åŒ…å«ä¸€ä¸ªè¢«å¼•ç”¨çš„è®¡æ•°å™¨ï¼Œå½“è®¡æ•°å™¨å½’é›¶æ—¶è‡ªåŠ¨å¾—åˆ°å›æ”¶ã€‚ Go çš„ GC ç›®å‰ä½¿ç”¨çš„æ˜¯æ— åˆ†ä»£ï¼ˆå¯¹è±¡æ²¡æœ‰ä»£é™…ä¹‹åˆ†ï¼‰ã€éç§»åŠ¨ï¼ˆå›æ”¶è¿‡ç¨‹ä¸­ä¸å¯¹å¯¹è±¡è¿›è¡Œç§»åŠ¨ä¸æ•´ç†ï¼‰ã€å¹¶å‘ï¼ˆä¸ç”¨æˆ·ä»£ç å¹¶å‘æ‰§è¡Œï¼‰çš„ä¸‰è‰²æ ‡è®°æ¸…æ‰«ç®—æ³•ã€‚å±äºè¿½è¸ªå¼GCçš„ä¸€ç§ã€‚ 0x3.ä¸‰è‰²æ ‡è®°æ³•golangçš„åƒåœ¾å›æ”¶æ˜¯åŸºäºæ ‡è®°æ¸…æ‰«ç®—æ³•ï¼Œè¿™ç§ç®—æ³•éœ€è¦è¿›è¡ŒSTW(stop the world)ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¼šå¯¼è‡´ç¨‹åºå¡é¡¿ï¼Œæ‰€ä»¥é¢‘ç¹çš„GCæ˜¯ä¼šä¸¥é‡å½±å“ç¨‹åºæ€§èƒ½çš„ã€‚golangåœ¨æ­¤åŸºç¡€ä¸Šè¿›è¡Œäº†æ”¹è¿›ï¼Œé€šè¿‡ä¸‰è‰²æ ‡è®°æ¸…æ‰«ç®—æ³•å’Œå†™å±éšœæ¥å‡å°‘STWçš„æ—¶é—´ã€‚ GCçš„å››ä¸ªè¿‡ç¨‹ 1ã€æ ˆæ‰«æï¼ˆå¼€å§‹æ—¶STWï¼‰ï¼Œæ‰€æœ‰å¯¹è±¡å¼€å§‹éƒ½æ˜¯ç™½è‰²ã€‚ 2ã€ä»rootå¼€å§‹æ‰¾åˆ°æ‰€æœ‰å¯è¾¾å¯¹è±¡ï¼ˆæ‰€æœ‰å¯ä»¥æ‰¾åˆ°çš„å¯¹è±¡ï¼‰ï¼Œæ ‡è®°æˆç°è‰²ï¼Œæ”¾å…¥å¾…å¤„ç†é˜Ÿåˆ—ã€‚ 3ã€éå†ç°è‰²å¯¹è±¡é˜Ÿåˆ—ï¼Œå°†å…¶å¼•ç”¨å¯¹è±¡æ ‡è®°æˆç°è‰²æ”¾å…¥å¾…å¤„ç†é˜Ÿåˆ—ï¼Œè‡ªèº«æ ‡è®°ä¸ºé»‘è‰²ã€‚ 4ã€æ¸…é™¤ï¼ˆå¹¶å‘ï¼‰å¾ªç¯æ­¥éª¤3ç›´åˆ°ç°è‰²é˜Ÿåˆ—ä¸ºç©ºã€‚æ­¤æ—¶æ‰€æœ‰çš„å¼•ç”¨å¯¹è±¡éƒ½è¢«æ ‡è®°ä¸ºé»‘è‰²ï¼Œæ‰€æœ‰ä¸å¯è¾¾çš„å¯¹è±¡ä¾ç„¶æ˜¯ç™½è‰²ï¼Œç™½è‰²çš„å°±æ˜¯éœ€è¦è¿›è¡Œå›æ”¶çš„å¯¹è±¡ã€‚ ä¸‰è‰²æ ‡è®°æ³•ç›¸å¯¹äºæ™®é€šçš„æ ‡è®°æ¸…æ‰«ï¼Œå‡å°‘äº†STWçš„æ—¶é—´ï¼Œè¿™ä¸»è¦å¾—ç›Šäºæ ‡è®°è¿‡ç¨‹æ˜¯â€on-the-flyâ€çš„ï¼Œæ ‡è®°è¿‡ç¨‹ä¸­æ˜¯ä¸éœ€è¦STWçš„ï¼Œå®ƒä¸ç¨‹åºæ˜¯å¹¶å‘æ‰§è¡Œçš„ï¼Œå¤§å¤§ç¼©çŸ­äº†STWçš„æ—¶é—´ã€‚Golang gcä¼˜åŒ–çš„æ ¸å¿ƒå°±æ˜¯å°½é‡ä½¿å¾—STWçš„æ—¶é—´è¶Šæ¥è¶ŠçŸ­ã€‚ é˜¶æ®µ è¯´æ˜ èµ‹å€¼å™¨çŠ¶æ€ SweepTermination æ¸…æ‰«ç»ˆæ­¢é˜¶æ®µï¼Œä¸ºä¸‹ä¸€ä¸ªé˜¶æ®µçš„å¹¶å‘æ ‡è®°åšå‡†å¤‡å·¥ä½œï¼Œå¯åŠ¨å†™å±éšœ STW Mark æ‰«ææ ‡è®°é˜¶æ®µï¼Œä¸èµ‹å€¼å™¨å¹¶å‘æ‰§è¡Œï¼Œå†™å±éšœå¼€å¯ å¹¶å‘ MarkTermination æ ‡è®°ç»ˆæ­¢é˜¶æ®µï¼Œä¿è¯ä¸€ä¸ªå‘¨æœŸå†…æ ‡è®°ä»»åŠ¡å®Œæˆï¼Œåœæ­¢å†™å±éšœ STW GCoff å†…å­˜æ¸…æ‰«é˜¶æ®µï¼Œå°†éœ€è¦å›æ”¶çš„å†…å­˜å½’è¿˜åˆ°å †ä¸­ï¼Œå†™å±éšœå…³é—­ å¹¶å‘ GCoff å†…å­˜å½’è¿˜é˜¶æ®µï¼Œå°†è¿‡å¤šçš„å†…å­˜å½’è¿˜ç»™æ“ä½œç³»ç»Ÿï¼Œå†™å±éšœå…³é—­ å¹¶å‘ å†™å±éšœå½“æ ‡è®°çš„ç¨‹åºæ˜¯å¹¶å‘æ‰§è¡Œçš„ï¼Œæœ‰å¯èƒ½åœ¨æ ‡è®°è¿‡ç¨‹ä¸­ï¼Œæœ‰æ–°çš„å¼•ç”¨äº§ç”Ÿï¼Œå¯èƒ½ä¼šå¯¼è‡´è¯¯æ¸…æ‰«ã€‚ æ¸…æ‰«å¼€å§‹å‰ï¼Œæ ‡è®°ä¸ºé»‘è‰²çš„å¯¹è±¡å¼•ç”¨ä¸€ä¸ªæ–°ç”³è¯·çš„å¯¹è±¡ï¼Œæ­¤æ—¶å®ƒè‚¯å®šæ˜¯ç™½è‰²çš„ï¼Œè€Œé»‘è‰²å¯¹è±¡ä¸ä¼šè¢«å†æ¬¡æ‰«æï¼Œé‚£ä¹ˆè¿™ä¸ªç™½è‰²å¯¹è±¡æ— æ³•è¢«æ‰«æå˜æˆç°è‰²ã€é»‘è‰²ï¼Œå®ƒæœ€ç»ˆä¼šè¢«æ¸…æ‰«ï¼Œè€Œå®é™…ä¸Šå®ƒä¸åº”è¯¥è¢«æ¸…æ‰«ã€‚ golangé‡‡å–äº†å†™å±éšœï¼Œå…¶ä½œç”¨å°±æ˜¯ä¸ºäº†é¿å…è¿™ç±»è¯¯æ¸…æ‰«é—®é¢˜ã€‚å†™å±éšœåœ¨å†…å­˜å†™æ“ä½œå‰ï¼Œç»´æŠ¤ä¸€ä¸ªçº¦æŸï¼Œä»è€Œç¡®ä¿æ¸…æ‰«å¼€å§‹å‰ï¼Œé»‘è‰²çš„å¯¹è±¡ä¸èƒ½å¼•ç”¨ç™½è‰²å¯¹è±¡ã€‚ 0x4.è§¦å‘GCçš„æ—¶æœºGo è¯­è¨€ä¸­å¯¹ GC çš„è§¦å‘æ—¶æœºå­˜åœ¨ä¸¤ç§å½¢å¼ï¼š ä¸»åŠ¨è§¦å‘ï¼Œé€šè¿‡è°ƒç”¨ runtime.GC æ¥è§¦å‘ GCï¼Œæ­¤è°ƒç”¨é˜»å¡å¼åœ°ç­‰å¾…å½“å‰ GC è¿è¡Œå®Œæ¯•ã€‚ è¢«åŠ¨è§¦å‘ï¼Œåˆ†ä¸ºä¸¤ç§æ–¹å¼ï¼š ä½¿ç”¨ç³»ç»Ÿç›‘æ§ï¼Œå½“è¶…è¿‡ä¸¤åˆ†é’Ÿæ²¡æœ‰äº§ç”Ÿä»»ä½• GC æ—¶ï¼Œå¼ºåˆ¶è§¦å‘ GCã€‚ ä½¿ç”¨æ­¥è°ƒï¼ˆPacingï¼‰ç®—æ³•ï¼Œå…¶æ ¸å¿ƒæ€æƒ³æ˜¯æ§åˆ¶å†…å­˜å¢é•¿çš„æ¯”ä¾‹ï¼Œå½“å‰å†…å­˜åˆ†é…è¾¾åˆ°ä¸€å®šæ¯”ä¾‹åˆ™è§¦å‘ã€‚","categories":[{"name":"Golang","slug":"Golang","permalink":"https://blog.eganx.cn/categories/Golang/"}],"tags":[{"name":"GC","slug":"GC","permalink":"https://blog.eganx.cn/tags/GC/"},{"name":"go","slug":"go","permalink":"https://blog.eganx.cn/tags/go/"}]},{"title":"Goåå°„(reflect)","slug":"Go_reflect","date":"2022-11-13T11:21:43.000Z","updated":"2022-12-27T09:04:09.169Z","comments":true,"path":"2022/11/13/Go_reflect/","link":"","permalink":"https://blog.eganx.cn/2022/11/13/Go_reflect/","excerpt":"ä¸åŒè¯­è¨€çš„åå°„æ¨¡å‹ä¸å°½ç›¸åŒã€‚é—²æ¥æ— äº‹ï¼Œçœ‹çœ‹Goçš„åå°„æœºåˆ¶ã€‚","text":"ä¸åŒè¯­è¨€çš„åå°„æ¨¡å‹ä¸å°½ç›¸åŒã€‚é—²æ¥æ— äº‹ï¼Œçœ‹çœ‹Goçš„åå°„æœºåˆ¶ã€‚ 0x0.åå°„çš„å®šä¹‰ç»´åŸºç™¾ç§‘ä¸Šåå°„çš„å®šä¹‰ï¼š åœ¨è®¡ç®—æœºç§‘å­¦ä¸­ï¼Œåå°„æ˜¯æŒ‡ç”µè„‘ç¨‹åºåœ¨è¿è¡Œæ—¶ï¼ˆruntimeï¼‰å¯ä»¥è®¿é—®ã€æ£€æµ‹å’Œä¿®æ”¹å®ƒæœ¬èº«çŠ¶æ€æˆ–è¡Œä¸ºçš„ä¸€ç§èƒ½åŠ›ã€‚ç”¨æ¯”å–»æ¥è¯´ï¼Œåå°„å°±æ˜¯ç¨‹åºåœ¨è¿è¡Œçš„æ—¶å€™èƒ½å¤Ÿâ€œè§‚å¯Ÿâ€å¹¶ä¸”ä¿®æ”¹è‡ªå·±çš„è¡Œä¸ºã€‚ Go è¯­è¨€æä¾›äº†ä¸€ç§æœºåˆ¶åœ¨è¿è¡Œæ—¶æ›´æ–°å˜é‡å’Œæ£€æŸ¥å®ƒä»¬çš„å€¼ã€è°ƒç”¨å®ƒä»¬çš„æ–¹æ³•ï¼Œä½†æ˜¯åœ¨ç¼–è¯‘æ—¶å¹¶ä¸çŸ¥é“è¿™äº›å˜é‡çš„å…·ä½“ç±»å‹ï¼Œè¿™ç§°ä¸ºåå°„æœºåˆ¶ã€‚ 0x1.åå°„çš„å®ç°åå°„é€šè¿‡æ¥å£çš„ç±»å‹ä¿¡æ¯å®ç°ã€‚åå°„æ˜¯å»ºç«‹åœ¨ç±»å‹çš„åŸºç¡€ä¸Šã€‚ Goåœ¨reflectåŒ…ä¸­å®šä¹‰äº†å„ç§ç±»å‹ï¼Œå®ç°äº†åå°„çš„å„ç§å‡½æ•°ï¼Œé€šè¿‡å®ƒä»¬å¯ä»¥åœ¨è¿è¡Œæ—¶æ£€æµ‹ç±»å‹çš„ä¿¡æ¯å’Œæ”¹å˜ç±»å‹çš„å€¼ã€‚ 1).åå°„çš„åŸºæœ¬å‡½æ•°reflect åŒ…é‡Œå®šä¹‰äº†ä¸€ä¸ªæ¥å£å’Œä¸€ä¸ªç»“æ„ä½“ï¼Œå³ reflect.Type å’Œ reflect.Valueï¼Œå®ƒä»¬æä¾›å¾ˆå¤šå‡½æ•°æ¥è·å–å­˜å‚¨åœ¨æ¥å£é‡Œçš„ç±»å‹ä¿¡æ¯ã€‚ reflect.Type ä¸»è¦æä¾›å…³äºç±»å‹ç›¸å…³çš„ä¿¡æ¯ï¼Œæ‰€ä»¥å®ƒå’Œ _type å…³è”æ¯”è¾ƒç´§å¯†ï¼›reflect.Value åˆ™ç»“åˆ _type å’Œ data ä¸¤è€…ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥è·å–ç”šè‡³æ”¹å˜ç±»å‹çš„å€¼ã€‚ reflect åŒ…ä¸­æä¾›äº†ä¸¤ä¸ªåŸºç¡€çš„å…³äºåå°„çš„å‡½æ•°æ¥è·å–ä¸Šè¿°çš„æ¥å£å’Œç»“æ„ä½“ï¼š func TypeOf(i interface&#123;&#125;) Type func ValueOf(i interface&#123;&#125;) Value TypeOf å‡½æ•°ç”¨æ¥æå–ä¸€ä¸ªæ¥å£ä¸­å€¼çš„ç±»å‹ä¿¡æ¯ã€‚ç”±äºå®ƒçš„è¾“å…¥å‚æ•°æ˜¯ä¸€ä¸ªç©ºçš„ interface&#123;&#125;ï¼Œè°ƒç”¨æ­¤å‡½æ•°æ—¶ï¼Œå®å‚ä¼šå…ˆè¢«è½¬åŒ–ä¸º interface&#123;&#125;ç±»å‹ã€‚è¿™æ ·ï¼Œå®å‚çš„ç±»å‹ä¿¡æ¯ã€æ–¹æ³•é›†ã€å€¼ä¿¡æ¯éƒ½å­˜å‚¨åˆ° interface&#123;&#125; å˜é‡é‡Œäº†ã€‚ fmt.Printf() å‡½æ•°ï¼Œå¦‚æœä½¿ç”¨ %T æ¥ä½œä¸ºæ ¼å¼å‚æ•°ï¼Œè¾“å‡ºçš„æ˜¯ reflect.TypeOf çš„ç»“æœï¼Œä¹Ÿå°±æ˜¯åŠ¨æ€ç±»å‹ã€‚ TypeOf() å‡½æ•°è¿”å›ä¸€ä¸ªæ¥å£ï¼Œè¿™ä¸ªæ¥å£å®šä¹‰äº†ä¸€ç³»åˆ—æ–¹æ³•ï¼Œåˆ©ç”¨è¿™äº›æ–¹æ³•å¯ä»¥è·å–å…³äºç±»å‹çš„æ‰€æœ‰ä¿¡æ¯ï¼› ValueOf() å‡½æ•°è¿”å›ä¸€ä¸ªç»“æ„ä½“å˜é‡ï¼ŒåŒ…å«ç±»å‹ä¿¡æ¯ä»¥åŠå®é™…å€¼ã€‚ 2).åå°„çš„ä¸‰å¤§å®šå¾‹ Reflection goes from interface value to reflection object. Reflection goes from reflection object to interface value. To modify a reflection object, the value must be settable. æ¥å£å‹å˜é‡ å’Œ åå°„ç±»å‹å¯¹è±¡ å¯ä»¥ç›¸äº’è½¬åŒ–ã€‚å¦‚æœæƒ³è¦æ“ä½œåŸå˜é‡ï¼Œåå°„å˜é‡ Value å¿…é¡»è¦ hold ä½åŸå˜é‡çš„åœ°å€æ‰è¡Œã€‚ 0x2.åå°„çš„ä½¿ç”¨åœºæ™¯ä½¿ç”¨åå°„çš„å¸¸è§åœºæ™¯æœ‰ä»¥ä¸‹ä¸¤ç§ï¼š ä¸èƒ½æ˜ç¡®æ¥å£è°ƒç”¨å“ªä¸ªå‡½æ•°ï¼Œéœ€è¦æ ¹æ®ä¼ å…¥çš„å‚æ•°åœ¨è¿è¡Œæ—¶å†³å®šã€‚ ä¸èƒ½æ˜ç¡®ä¼ å…¥å‡½æ•°çš„å‚æ•°ç±»å‹ï¼Œéœ€è¦åœ¨è¿è¡Œæ—¶å¤„ç†ä»»æ„å¯¹è±¡ã€‚ åå°„å¯¹æ€§èƒ½å½±å“è¿˜æ˜¯æ¯”è¾ƒå¤§çš„ï¼Œæ¯”æ­£å¸¸ä»£ç è¿è¡Œé€Ÿåº¦æ…¢ä¸€åˆ°ä¸¤ä¸ªæ•°é‡çº§ã€‚å…³é”®ä»£ç é¿å…ä½¿ç”¨åå°„ç‰¹æ€§ã€‚","categories":[{"name":"Golang","slug":"Golang","permalink":"https://blog.eganx.cn/categories/Golang/"}],"tags":[{"name":"go","slug":"go","permalink":"https://blog.eganx.cn/tags/go/"},{"name":"reflect","slug":"reflect","permalink":"https://blog.eganx.cn/tags/reflect/"}]},{"title":"Mongo cluster(docker compose)","slug":"Mongo_0","date":"2022-11-10T13:12:34.000Z","updated":"2022-12-26T03:43:15.399Z","comments":true,"path":"2022/11/10/Mongo_0/","link":"","permalink":"https://blog.eganx.cn/2022/11/10/Mongo_0/","excerpt":"åˆæ¬¡ä½¿ç”¨docker composeæ­å»ºmongoé›†ç¾¤ï¼Œè®°å½•ä¸€ä¸‹ã€‚è™½ç„¶é—®é¢˜è¿˜å¾ˆå¤šï¼Œä½†è‡³å°‘è·‘èµ·æ¥äº†ã€‚ã€‚ã€‚","text":"åˆæ¬¡ä½¿ç”¨docker composeæ­å»ºmongoé›†ç¾¤ï¼Œè®°å½•ä¸€ä¸‹ã€‚è™½ç„¶é—®é¢˜è¿˜å¾ˆå¤šï¼Œä½†è‡³å°‘è·‘èµ·æ¥äº†ã€‚ã€‚ã€‚ 0x0.æ–‡ä»¶ç›®å½•ç»“æ„mongodbâ””â”€â”€ mongo â”œâ”€â”€ data â”‚ â”œâ”€â”€ hosts â”‚ â””â”€â”€ mongod.conf â””â”€â”€ docker-compose.yml 0x1.mongod.confsystemLog: destination: file path: &#x2F;data&#x2F;log&#x2F;mongo.log logAppend: truestorage: dbPath: &#x2F;data&#x2F;dbnet: bindIp: 0.0.0.0replication: replSetName: rs0 0x2.hosts127.0.0.1 localhost255.255.255.255 broadcasthost::1 localhost 0x3.docker-compose.ymlversion: &#x27;3&#x27;networks: db:services: mongo1: image: mongo container_name: mongo1 restart: always command: mongod --config /etc/mongod.conf expose: - 27017 volumes: - ./data/mongo1/db:/data/db - ./data/mongo1/configdb:/data/configdb - ./data/mongo1/log:/data/log - ./data/mongod.conf:/etc/mongod.conf - ./data/hosts:/etc/hosts ports: - &quot;27017:27017&quot; networks: - db mongo2: image: mongo container_name: mongo2 restart: always command: mongod --config /etc/mongod.conf expose: - 27017 volumes: - ./data/mongo2/db:/data/db - ./data/mongo2/configdb:/data/configdb - ./data/mongo2/log:/data/log - ./data/mongod.conf:/etc/mongod.conf - ./data/hosts:/etc/hosts ports: - &quot;27018:27017&quot; networks: - db mongo3: image: mongo container_name: mongo3 restart: always command: mongod --config /etc/mongod.conf expose: - 27017 volumes: - ./data/mongo3/db:/data/db - ./data/mongo3/configdb:/data/configdb - ./data/mongo3/log:/data/log - ./data/mongod.conf:/etc/mongod.conf - ./data/hosts:/etc/hosts ports: - &quot;27019:27017&quot; networks: - db 0x4.å¼€å§‹éƒ¨ç½² è¿›å…¥docker-compose.ymlæ–‡ä»¶æ‰€åœ¨ç›®å½• æ‰§è¡Œå‘½ä»¤ï¼šdocker compose -f docker-compose.yml up -d 0x5.å»ºç«‹å‰¯æœ¬é›† è¿›å…¥mongoå®¹å™¨ï¼šdocker exec -it mongo1 bash è¿›å…¥mongoï¼šmongosh ,è€ç‰ˆæœ¬çš„mongoåˆ°æŒ‡ä»¤æ˜¯mongo åˆ‡æ¢ç®¡ç†å‘˜ç”¨æˆ·ï¼šuse admin åˆå§‹åŒ–å‰¯æœ¬é›†ï¼šrs.initiate(),æ— å‚åˆå§‹åŒ–æ—¶ï¼Œä¼šé»˜è®¤å½“å‰èŠ‚ç‚¹PRIMARYèŠ‚ç‚¹ æ·»åŠ å‰¯èŠ‚ç‚¹ï¼šrs.add(&#39;mongo2:27017&#39;) æ·»åŠ ä»²è£èŠ‚ç‚¹ï¼šrs.addArb(&#39;mongo3:27017&#39;) &#x2F;&#x2F; æ·»åŠ ä»²è£èŠ‚ç‚¹è¦æ˜¯æŠ¥é”™ï¼Œå¯ä»¥è¯•è¯•è¿è¡Œä»¥ä¸‹ä»£ç  db.adminCommand(&#123; &quot;setDefaultRWConcern&quot; : 1, &quot;defaultWriteConcern&quot; : &#123; &quot;w&quot; : 2 &#125;&#125;) æŸ¥çœ‹å‰¯æœ¬é›†é…ç½®ä¿¡æ¯ï¼šrs.conf() æŸ¥çœ‹å‰¯æœ¬é›†è¿è¡ŒçŠ¶æ€ï¼šrs.status() è¦æ˜¯éœ€è¦ä¿®æ”¹é…ç½®ï¼Œå¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤æ¥ï¼š cfg = rs.conf() cfg.members[0].xxx = xxx rs.reconfig(cfg) 0x6.éªŒè¯å‰¯æœ¬é›†åˆ‡æ¢èŠ‚ç‚¹æŸ¥çœ‹åŒæ­¥çŠ¶æ€ï¼šrs.printReplicationInfo() ä»…å½“å»ºç«‹äº†é›†åˆåå‰¯èŠ‚ç‚¹æ‰ä¼šè¿›è¡ŒåŒæ­¥ã€‚ 0x7.å¤–éƒ¨è¿æ¥å‡†å¤‡ä½¿ç”¨Robo 3T(ç°åœ¨å˜æˆStudio 3T Free)è¿æ¥æ•°æ®åº“æ—¶ï¼Œä¼šæœ‰è¿æ¥å¤±è´¥çš„å¼‚å¸¸ï¼Œå¯ä»¥å°†WSLçš„IPåœ°å€å†™å…¥ç”µè„‘Cç›˜hostsæ–‡ä»¶é‡Œï¼š 172.23.224.1 mongo1172.23.224.1 mongo2172.23.224.1 mongo3 ç„¶åä½¿ç”¨ä»¥ä¸‹é“¾æ¥æ¥è¿æ¥æ•°æ®åº“ mongo1:27017mongo2:27017mongo3:27017 ä½†æ˜¯å¦‚æœè¿˜æ˜¯è¿æ¥ä¸ä¸Šï¼Œæˆ–è€…é‡å¯åè¿æ¥ä¸ä¸Šï¼Œå¯ä»¥å°†mongoå®¹å™¨çš„IPå†™åˆ°mongo\\data\\hostsæ–‡ä»¶é‡Œï¼Œå®¹å™¨çš„IPå¯ä»¥ä½¿ç”¨docker inspect mongo1æ¥è·å–ã€‚ 172.30.0.2 mongo1172.30.0.3 mongo2172.30.0.4 mongo3","categories":[{"name":"Database","slug":"Database","permalink":"https://blog.eganx.cn/categories/Database/"}],"tags":[{"name":"DB","slug":"DB","permalink":"https://blog.eganx.cn/tags/DB/"},{"name":"mongo","slug":"mongo","permalink":"https://blog.eganx.cn/tags/mongo/"}]},{"title":"Goè¯­è¨€ä¸­newå’Œmakeçš„åŒºåˆ«","slug":"Go_New_and_Make","date":"2022-11-07T01:07:12.000Z","updated":"2022-12-27T09:04:20.424Z","comments":true,"path":"2022/11/07/Go_New_and_Make/","link":"","permalink":"https://blog.eganx.cn/2022/11/07/Go_New_and_Make/","excerpt":"åœ¨Goè¯­è¨€ä¸­ï¼Œmakeå…³é”®å­—åœ¨åˆå§‹åŒ–çš„æ—¶å€™è¢«é¢‘ç¹ä½¿ç”¨ï¼Œä¹‹å‰å†™C# çš„æ—¶å€™éƒ½æ˜¯ä½¿ç”¨newå…³é”®å­—ï¼ŒGoä¸­newå…³é”®å­—ä¹Ÿæ˜¯å­˜åœ¨çš„ã€‚å‡†å¤‡çœ‹çœ‹ä¸¤è€…çš„åŒºåˆ«ã€‚","text":"åœ¨Goè¯­è¨€ä¸­ï¼Œmakeå…³é”®å­—åœ¨åˆå§‹åŒ–çš„æ—¶å€™è¢«é¢‘ç¹ä½¿ç”¨ï¼Œä¹‹å‰å†™C# çš„æ—¶å€™éƒ½æ˜¯ä½¿ç”¨newå…³é”®å­—ï¼ŒGoä¸­newå…³é”®å­—ä¹Ÿæ˜¯å­˜åœ¨çš„ã€‚å‡†å¤‡çœ‹çœ‹ä¸¤è€…çš„åŒºåˆ«ã€‚ 0x0.newnewå¯ä»¥å¯¹ç±»å‹è¿›è¡Œå†…å­˜åˆ›å»ºå’Œåˆå§‹åŒ–ï¼Œå…¶è¿”å›å€¼æ˜¯æ‰€åˆ›å»ºç±»å‹çš„æŒ‡é’ˆå¼•ç”¨ã€‚newä¼šæ ¹æ®å˜é‡ç±»å‹è¿”å›ä¸€ä¸ªæŒ‡å‘è¯¥ç±»å‹çš„æŒ‡é’ˆã€‚ 0x1.makemake å‡½æ•°ä¹Ÿæ˜¯ç”¨äºå†…å­˜åˆ†é…çš„ï¼Œä½†æ˜¯å’Œnewä¸åŒï¼Œä»…æ”¯æŒ sliceã€mapã€channel ä¸‰ç§æ•°æ®ç±»å‹çš„å†…å­˜åˆ›å»ºï¼Œå…¶è¿”å›å€¼æ˜¯æ‰€åˆ›å»ºç±»å‹çš„æœ¬èº«ï¼Œè€Œä¸æ˜¯æ–°çš„æŒ‡é’ˆå¼•ç”¨ã€‚makeä¸ä»…å¯ä»¥å¼€è¾Ÿä¸€ä¸ªå†…å­˜ï¼Œè¿˜èƒ½ç»™è¿™ä¸ªå†…å­˜çš„ç±»å‹åˆå§‹åŒ–å…¶é›¶å€¼ã€‚ 0x2.æ€»ç»“ makeå’Œnewéƒ½æ˜¯golangç”¨æ¥åˆ†é…å†…å­˜çš„å‡½æ•°ï¼Œä¸”åœ¨å †ä¸Šåˆ†é…å†…å­˜ï¼Œmake å³åˆ†é…å†…å­˜ï¼Œä¹Ÿåˆå§‹åŒ–å†…å­˜ã€‚newåªæ˜¯å°†å†…å­˜æ¸…é›¶ï¼Œå¹¶æ²¡æœ‰åˆå§‹åŒ–å†…å­˜ã€‚ makeè¿”å›çš„è¿˜æ˜¯å¼•ç”¨ç±»å‹æœ¬èº«ï¼›è€Œnewè¿”å›çš„æ˜¯æŒ‡å‘ç±»å‹çš„æŒ‡é’ˆã€‚ makeåªèƒ½ç”¨æ¥åˆ†é…åŠåˆå§‹åŒ–ç±»å‹ä¸ºsliceï¼Œmapï¼Œchannelçš„æ•°æ®ï¼›newå¯ä»¥åˆ†é…ä»»æ„ç±»å‹çš„æ•°æ®ã€‚","categories":[{"name":"Golang","slug":"Golang","permalink":"https://blog.eganx.cn/categories/Golang/"}],"tags":[{"name":"make","slug":"make","permalink":"https://blog.eganx.cn/tags/make/"},{"name":"new","slug":"new","permalink":"https://blog.eganx.cn/tags/new/"}]},{"title":"Windows10ä¸‹WSL2å’ŒDockerçš„å®‰è£…å’Œé…ç½®","slug":"Win10_WSL_Docker","date":"2022-11-06T04:12:32.000Z","updated":"2022-12-17T13:27:04.083Z","comments":true,"path":"2022/11/06/Win10_WSL_Docker/","link":"","permalink":"https://blog.eganx.cn/2022/11/06/Win10_WSL_Docker/","excerpt":"æœ€è¿‘éœ€è¦æ­å»ºmongoé›†ç¾¤ï¼Œçœ‹æ•™ç¨‹è¯´ä½¿ç”¨dockeræ¯”è¾ƒå¥½éƒ¨ç½²ï¼Œå‡†å¤‡åœ¨å…¬å¸ç”µè„‘ï¼ˆThinkPadï¼‰ä¸Šå…ˆè¯•ä¸€ä¸‹ï¼Œæ‰€ä»¥éœ€è¦å®‰è£…ä¸€ä¸‹WSLå’Œdockerã€‚è‡ªå·±ä¹Ÿæ²¡æœ‰åœ¨Windowsç¯å¢ƒä¸‹ä½¿ç”¨è¿‡dockerï¼Œæ‰€ä»¥è®°å½•ä¸€ä¸‹ã€‚","text":"æœ€è¿‘éœ€è¦æ­å»ºmongoé›†ç¾¤ï¼Œçœ‹æ•™ç¨‹è¯´ä½¿ç”¨dockeræ¯”è¾ƒå¥½éƒ¨ç½²ï¼Œå‡†å¤‡åœ¨å…¬å¸ç”µè„‘ï¼ˆThinkPadï¼‰ä¸Šå…ˆè¯•ä¸€ä¸‹ï¼Œæ‰€ä»¥éœ€è¦å®‰è£…ä¸€ä¸‹WSLå’Œdockerã€‚è‡ªå·±ä¹Ÿæ²¡æœ‰åœ¨Windowsç¯å¢ƒä¸‹ä½¿ç”¨è¿‡dockerï¼Œæ‰€ä»¥è®°å½•ä¸€ä¸‹ã€‚ 0x0.Windows Terminalç”¨è¿‡ Windows é»˜è®¤ç»ˆç«¯çš„éƒ½çŸ¥é“ï¼ŒçœŸçš„ä¸æ€ä¹ˆç¾è§‚ã€‚ å¾®è½¯ä¹Ÿé€æ¸æ„è¯†åˆ°è¿™ä¸ªé—®é¢˜ï¼Œå¹¶åœ¨ Build2019 å¤§ä¼šä¸Šå‘å¸ƒäº† æ–°ä¸€ä»£ Windows ç»ˆç«¯ç¨‹åºï¼šWindows Terminal ã€‚ Windows Terminal æ˜¯ä¸€æ¬¾æ–°å¼ã€å¿«é€Ÿã€é«˜æ•ˆã€å¼ºå¤§ä¸”é«˜æ•ˆçš„ç»ˆç«¯åº”ç”¨ç¨‹åºï¼Œé€‚ç”¨äºå‘½ä»¤è¡Œå·¥å…·å’Œå‘½ä»¤æç¤ºç¬¦ï¼ŒPowerShellå’Œ WSL ç­‰ Shell ç”¨æˆ·ã€‚ä¸»è¦åŠŸèƒ½åŒ…æ‹¬å¤šä¸ªé€‰é¡¹å¡ã€çª—æ ¼ã€Unicodeã€å’Œ UTF-8 å­—ç¬¦æ”¯æŒï¼ŒGPU åŠ é€Ÿæ–‡æœ¬æ¸²æŸ“å¼•æ“ä»¥åŠè‡ªå®šä¹‰ä¸»é¢˜ã€æ ·å¼å’Œé…ç½®ã€‚ è€Œä¸”è¿™ä¸ªæ˜¯å¼€æºçš„ï¼Œå¦‚æœä¸å–œæ¬¢åœ¨Microsoft Storeé‡Œå®‰è£…è½¯ä»¶ï¼Œå¯ä»¥ç›´æ¥å»GitHubé‡Œä¸‹è½½ï¼Œè¿™é‡Œç»™å‡ºGitHubé¡¹ç›®åœ°å€ï¼šhttps://github.com/microsoft/terminalã€‚ 0x1.Windows WSL21).æ¦‚è¿°WSLæ˜¯windowsæ¨å‡ºçš„å¯è®©å¼€å‘äººå‘˜ä¸éœ€è¦å®‰è£…è™šæ‹Ÿæœºï¼ˆvmwareï¼Œvirtboxï¼‰æˆ–è€…è®¾ç½®åŒç³»ç»Ÿå¯åŠ¨å°±å¯ä»¥åŸç”Ÿæ”¯æŒè¿è¡ŒGNU/Linuxçš„ç³»ç»Ÿç¯å¢ƒï¼Œç®€ç§°WSLå­ç³»ç»Ÿã€‚ç›®å‰æœ€æ–°çš„ç‰ˆæœ¬æ˜¯WSL2ï¼Œåœ¨åŸå…ˆçš„åŸºç¡€ä¸Šæé«˜äº†æ–‡ä»¶ç³»ç»Ÿçš„æ€§èƒ½å¹¶æ·»åŠ äº†å®Œå…¨çš„çš„ç³»ç»Ÿè°ƒç”¨æ”¯æŒã€‚WSL2ä½¿ç”¨å…¨æ–°ä½“ç³»æ¶æ„ä½¿å…¶èƒ½çœŸæ­£çš„è¿è¡Œä¸€ä¸ªLinuxå†…æ ¸ã€‚ 2).å®‰è£… WSL2å¯¹ç³»ç»Ÿç‰ˆæœ¬æœ‰ä¸€å®šçš„è¦æ±‚ï¼šå¿…é¡»è¿è¡Œ Windows 10 ç‰ˆæœ¬ 2004 åŠæ›´é«˜ç‰ˆæœ¬ï¼ˆå†…éƒ¨ç‰ˆæœ¬ 19041 åŠæ›´é«˜ç‰ˆæœ¬ï¼‰æˆ– Windows 11ã€‚ åœ¨ æ§åˆ¶é¢æ¿-ç¨‹åº- å¯ç”¨æˆ–å…³é—­ Windows åŠŸèƒ½ ä¸­å‹¾é€‰ é€‚ç”¨äº Linux çš„ Windows å­ç³»ç»Ÿä»¥åŠ è™šæ‹Ÿæœºå¹³å°(wsl2 éœ€è¦)ã€‚æ­¤æ­¥éª¤å®Œæˆåéœ€è¦é‡å¯ç”µè„‘ã€‚ æ‰“å¼€å¾®è½¯å•†åº—åº”ç”¨ï¼Œåœ¨æœç´¢æ¡†ä¸­è¾“å…¥â€œLinuxâ€æˆ–è€…â€œubuntuâ€ç„¶åæœç´¢ï¼Œä½ å¯ä»¥çœ‹åˆ°æœç´¢ç»“æœä¸­æœ‰å¾ˆå¤šçš„ Linux å‘è¡Œç‰ˆå¯ä»¥é€‰æ‹©ã€‚æˆ‘é€‰Ubuntu22.04 æœ‰å¯èƒ½å¯åŠ¨ubuntuæŠ¥å‘ŠWslRegisterDistribution failed with error: 0x800701bcæ˜¯å› ä¸ºæ²¡æœ‰å‡çº§linuxå†…æ ¸ä½¿ç”¨wsl --updateä¸‹è½½æ›´æ–°å³å¯ã€‚ åœ¨å•†åº—å®‰è£…åå¹¶æ²¡æœ‰å®Œå…¨å®Œæˆå­ç³»ç»Ÿå®‰è£…ï¼Œè¿˜éœ€è¦è¿è¡Œä¸€æ¬¡Ubuntuæ¥å®Œæˆå†…æ ¸ä¸‹è½½ä»¥åŠç”¨æˆ·åå¯†ç çš„è®¾ç½®ã€‚ å¯åŠ¨WSL2 Windows Terminalé‡Œé¢ä½¿ç”¨wsl -lå‘½ä»¤æ¥æŸ¥çœ‹æ‰€æœ‰çš„å­ç³»ç»Ÿã€‚ä½¿ç”¨wsl --set-default-version 2è®¾ç½®ä¸ºæ¯ä¸ªå®‰è£…çš„å‘è¡Œç‰ˆé»˜è®¤WSL2å¯åŠ¨ã€‚ 3).å¯¼å‡ºUbuntu-22.04åˆ°Dç›˜ä¸‹è¿™ä¸€æ­¥å¯ä»¥ç¼“è§£ä¸€ä¸‹Cç›˜çš„å‹åŠ›ï¼ŒCç›˜æ²¡æœ‰å‹åŠ›çš„å°±å½“æ²¡çœ‹è§è¿™ä¸€æ­¥ã€‚ æŸ¥çœ‹å·²å®‰è£…çš„Linuxå‘è¡Œç‰ˆ: wsl -l --all -v å¯¼å‡ºLinuxå‘è¡Œç‰ˆtaræ–‡ä»¶åˆ°æŒ‡å®šæ–‡ä»¶å¤¹: wsl --export Ubuntu-22.04 d:/wsl/ubuntu/wsl-ubuntu-22.04.tar æ³¨é”€Ubuntu-22.04: wsl --unregister Ubuntu-22.04 é‡æ–°å¯¼å…¥å¹¶å®‰è£…WSL2åˆ°Dç›˜: wsl --import Ubuntu-22.04 d:/wsl/ubuntu/ d:/wsl/ubuntu/wsl-ubuntu-22.04.tar --version 2 0x2.Windows Docker Desktopè¿™ä¸ªæ²¡å•¥å¥½è¯´çš„ï¼Œå®˜ç½‘ä¸‹è½½ï¼Œç›´æ¥å®‰è£…å°±å®Œäº†ã€‚å®˜ç½‘åœ°å€ä¼ é€ï¼šhttps://www.docker.com/products/docker-desktop/. å®‰è£…å®Œæˆåï¼Œæ‰“å¼€Docker Desktopçš„è®¾ç½®ï¼Œæ‰¾åˆ°Resources-WSL Integrationï¼Œæ‰“å¼€Enable integration with additional distorsï¼Œå°†è‡ªå·±çš„WSLæ‰“å¼€ã€‚è¿™æ ·dockerå°±ä¼šè·‘åœ¨WSLä¸Šã€‚","categories":[{"name":"Database","slug":"Database","permalink":"https://blog.eganx.cn/categories/Database/"}],"tags":[{"name":"mongo","slug":"mongo","permalink":"https://blog.eganx.cn/tags/mongo/"},{"name":"tool","slug":"tool","permalink":"https://blog.eganx.cn/tags/tool/"}]},{"title":"Studio 3T Freeè·³è¿‡ä¸€ä¸ªæœˆFull productçš„ç™»é™†è¯•ç”¨(Windows)","slug":"Tool_Studio3t","date":"2022-11-05T14:32:12.000Z","updated":"2022-12-16T02:16:06.630Z","comments":true,"path":"2022/11/05/Tool_Studio3t/","link":"","permalink":"https://blog.eganx.cn/2022/11/05/Tool_Studio3t/","excerpt":"å½“Robo 3Tå˜æˆäº†Studio 3T Freeï¼Œä¸æƒ³è¯•ç”¨Studio 3Tçš„Full productã€‚åªæƒ³ä½¿ç”¨Robo 3T Free(Robo 3T)ï¼Œè¯¥å¦‚ä½•è·³è¿‡ä¸€ä¸ªæœˆFull productçš„ç™»é™†è¯•ç”¨å‘¢ï¼Ÿ","text":"å½“Robo 3Tå˜æˆäº†Studio 3T Freeï¼Œä¸æƒ³è¯•ç”¨Studio 3Tçš„Full productã€‚åªæƒ³ä½¿ç”¨Robo 3T Free(Robo 3T)ï¼Œè¯¥å¦‚ä½•è·³è¿‡ä¸€ä¸ªæœˆFull productçš„ç™»é™†è¯•ç”¨å‘¢ï¼Ÿ 0x0.å°Šé‡ä»˜è´¹è½¯ä»¶Robo 3Tä½œä¸ºå¸¸ç”¨çš„MongoDB GUIï¼Œç°åœ¨å˜æˆäº†Studio 3T Freeã€‚ä¾æ—§æ˜¯å…è´¹ï¼Œä½†æ˜¯åœ¨Windowsä¸‹åˆæ¬¡æ‰“å¼€Studio 3Tè½¯ä»¶æ—¶ï¼Œä¼šè¦æ±‚å¿…é¡»ç™»é™†ï¼Œç„¶åå¼€å§‹ä¸€ä¸ªæœˆçš„Full product trialã€‚è¿™ä¸ªå°±å¾ˆçƒ¦ï¼Œæˆ‘å°±åªæƒ³ç”¨å…è´¹ç‰ˆçš„ï¼Œæ¯•ç«Ÿå…è´¹ç‰ˆå°±å¯ä»¥æ»¡è¶³æˆ‘çš„éœ€æ±‚ã€‚ä½“éªŒè¯•ç”¨æ˜¯å¥½äº‹ï¼Œä½†æ˜¯å½“è¿™ä»¶äº‹æˆä¸ºå¿…é€‰é¡¹æ—¶ï¼Œå°±ä¼šè®©äººå¾ˆä¸çˆ½ğŸ˜• æ‰€ä»¥åœ¨ä¸è¿›è¡Œéæ­£è§„æ‰‹æ®µè¿›è¡Œè½¯ä»¶ç ´è§£æ—¶ï¼Œè¯¥å¦‚ä½•è¿›è¡Œè·³è¿‡ç™»é™†æ¿€æ´»è¿›è¡Œå…è´¹ç‰ˆçš„ä½¿ç”¨å‘¢ï¼Ÿ æ‰¾åˆ°ä½äºC:\\Windows\\System32\\drivers\\ectä¸‹çš„hostsæ–‡ä»¶ï¼Œå°†ä¸‹é¢ä¸¤è¡Œæ·»åŠ è¿›å»ã€‚ 127.0.0.1 update.studio3t.com127.0.0.1 license-portal-eb.studio3t.com ç„¶åé‡å¯Studio 3Tæ—¶ï¼ŒProduct activationå¼¹çª—å°±ä¼šè·³è¿‡Login/Registerè¿™ä¸€æ­¥ï¼Œç›´æ¥åˆ°è¾¾Finishã€‚Nice! å¤§åŠŸå‘Šæˆã€‚","categories":[{"name":"Tool","slug":"Tool","permalink":"https://blog.eganx.cn/categories/Tool/"}],"tags":[{"name":"tool","slug":"tool","permalink":"https://blog.eganx.cn/tags/tool/"},{"name":"studio3t","slug":"studio3t","permalink":"https://blog.eganx.cn/tags/studio3t/"}]},{"title":"Go Context","slug":"Go_Context","date":"2022-11-04T03:45:19.000Z","updated":"2022-12-05T10:54:58.287Z","comments":true,"path":"2022/11/04/Go_Context/","link":"","permalink":"https://blog.eganx.cn/2022/11/04/Go_Context/","excerpt":"contextæ˜¯Goçš„ä¸€ä¸ªæ ‡å‡†åº“ï¼Œä¸­æ–‡ä¸€èˆ¬å«åšâ€ä¸Šä¸‹æ–‡â€ã€‚contextä¸»è¦æ˜¯ç”¨æ¥åœ¨goroutineä¹‹é—´ä¼ é€’ä¸Šä¸‹åˆä¿¡æ¯ï¼ŒåŒ…æ‹¬å–æ¶ˆä¿¡å·ã€è¶…æ—¶æ—¶é—´ç­‰ã€‚context.Contextç±»å‹çš„å€¼å¯ä»¥åè°ƒå¤šä¸ªgoroutineä¸­çš„ä»£ç æ‰§è¡Œâ€œå–æ¶ˆâ€æ“ä½œï¼Œå¹¶ä¸”å¯ä»¥å­˜å‚¨é”®å€¼å¯¹ã€‚è€Œä¸”è¿˜æ˜¯å¹¶å‘å®‰å…¨çš„ã€‚ä¸å®ƒåä½œå¯ä»¥åœ¨APIçš„å¤–éƒ¨æ§åˆ¶æ‰§è¡Œâ€œå–æ¶ˆâ€æ“ä½œï¼Œæ¯”å¦‚å–æ¶ˆä¸€ä¸ªHTTPè¯·æ±‚çš„æ‰§è¡Œã€‚","text":"contextæ˜¯Goçš„ä¸€ä¸ªæ ‡å‡†åº“ï¼Œä¸­æ–‡ä¸€èˆ¬å«åšâ€ä¸Šä¸‹æ–‡â€ã€‚contextä¸»è¦æ˜¯ç”¨æ¥åœ¨goroutineä¹‹é—´ä¼ é€’ä¸Šä¸‹åˆä¿¡æ¯ï¼ŒåŒ…æ‹¬å–æ¶ˆä¿¡å·ã€è¶…æ—¶æ—¶é—´ç­‰ã€‚context.Contextç±»å‹çš„å€¼å¯ä»¥åè°ƒå¤šä¸ªgoroutineä¸­çš„ä»£ç æ‰§è¡Œâ€œå–æ¶ˆâ€æ“ä½œï¼Œå¹¶ä¸”å¯ä»¥å­˜å‚¨é”®å€¼å¯¹ã€‚è€Œä¸”è¿˜æ˜¯å¹¶å‘å®‰å…¨çš„ã€‚ä¸å®ƒåä½œå¯ä»¥åœ¨APIçš„å¤–éƒ¨æ§åˆ¶æ‰§è¡Œâ€œå–æ¶ˆâ€æ“ä½œï¼Œæ¯”å¦‚å–æ¶ˆä¸€ä¸ªHTTPè¯·æ±‚çš„æ‰§è¡Œã€‚ 0x0.contextçš„ä½œç”¨åœ¨http serverä¸­ï¼Œä¸€ä¸ªè¯·æ±‚æœ‰å¯èƒ½ä¼šèµ·è‹¥å¹²ä¸ªåç¨‹ï¼Œè¿™äº›goroutineæœ‰æ—¶å€™æ˜¯éœ€è¦å…±äº«è¯·æ±‚çš„åŸºæœ¬æ•°æ®çš„ï¼ŒåŒ…æ‹¬tokenï¼Œè¶…æ—¶æ—¶é—´å’Œå–æ¶ˆä¿¡å·ç­‰ã€‚å½“è¯·æ±‚è¿Ÿè¿Ÿå¾—ä¸åˆ°å›åº”æˆ–è€…æ­¤æ¬¡è¯·æ±‚è¢«å–æ¶ˆï¼Œå¯èƒ½æ˜¯ä½¿ç”¨è€…å…³é—­äº†æµè§ˆå™¨æˆ–å·²ç»è¶…è¿‡äº†è¯·æ±‚æ–¹çš„è¶…æ—¶æ—¶é—´ï¼Œè¯·æ±‚æ–¹ç›´æ¥æ”¾å¼ƒäº†è¿™æ¬¡è¯·æ±‚çš„ç»“æœã€‚è¿™ä¸ªæ—¶å€™ï¼Œæ‰€æœ‰ä¸ºè¿™ä¸ªè¯·æ±‚å·¥ä½œçš„goroutineéœ€è¦å¿«é€Ÿé€€å‡ºï¼Œå› ä¸ºå·¥ä½œæˆæœå˜æˆäº†æ— æ„ä¹‰çš„ã€‚åœ¨ç›¸å…³çš„goroutineé€€å‡ºåï¼Œç³»ç»Ÿå¯ä»¥å›æ”¶ç›¸å…³èµ„æºã€‚ æ­£å¸¸å…³é—­åç¨‹æ˜¯é‡‡ç”¨channel+selectæ–¹å¼æ¥æ§åˆ¶ã€‚ä½†æ˜¯å½“ä¸€ä¸ªè¯·æ±‚ç›¸å…³è”çš„åç¨‹æ•°é‡è¿‡å¤šï¼Œä¸”ç›¸äº’å…³è”ï¼Œèƒ½å¤ŸåŒæ—¶å…³é—­ï¼Œå¯ä»¥ä½¿ç”¨contextæ¥å®ç°ã€‚ contextç”¨æ¥è§£å†³goroutineä¹‹é—´é€€å‡ºé€šçŸ¥ã€å…ƒæ•°æ®ä¼ é€’çš„åŠŸèƒ½ã€‚ contextçš„ä½¿ç”¨å»ºè®®ï¼š ä¸è¦å°† Context å¡åˆ°ç»“æ„ä½“é‡Œã€‚ç›´æ¥å°† Context ç±»å‹ä½œä¸ºå‡½æ•°çš„ç¬¬ä¸€å‚æ•°ï¼Œè€Œä¸”ä¸€èˆ¬éƒ½å‘½åä¸º ctxã€‚ ä¸è¦å‘å‡½æ•°ä¼ å…¥ä¸€ä¸ª nil çš„ contextï¼Œå¦‚æœä½ å®åœ¨ä¸çŸ¥é“ä¼ ä»€ä¹ˆï¼Œæ ‡å‡†åº“ç»™ä½ å‡†å¤‡å¥½äº†ä¸€ä¸ª contextï¼štodoã€‚ ä¸è¦æŠŠæœ¬åº”è¯¥ä½œä¸ºå‡½æ•°å‚æ•°çš„ç±»å‹å¡åˆ° context ä¸­ï¼Œcontext å­˜å‚¨çš„åº”è¯¥æ˜¯ä¸€äº›å…±åŒçš„æ•°æ®ã€‚ä¾‹å¦‚ï¼šç™»é™†çš„ sessionã€cookie ç­‰ã€‚ åŒä¸€ä¸ª context å¯èƒ½ä¼šè¢«ä¼ é€’åˆ°å¤šä¸ª goroutineï¼Œåˆ«æ‹…å¿ƒï¼Œcontext æ˜¯å¹¶å‘å®‰å…¨çš„ã€‚ 1).ä¼ é€’å…±äº«çš„æ•°æ®å¯¹äºwebæœåŠ¡ç«¯å¼€å‘ï¼Œå¾€å¾€å¸Œæœ›å°†ä¸€ä¸ªè¯·æ±‚å¤„ç†çš„æ•´ä¸ªè¿‡ç¨‹ä¸²èµ·æ¥ï¼Œå› æ­¤éœ€è¦åœ¨å‡½æ•°è°ƒç”¨çš„æ—¶å€™ä¼ é€’contextã€‚ contextçš„å¸¸è§åˆ›å»ºå‡½æ•°ï¼š // åˆ›å»ºç©ºç™½çš„æ ¹èŠ‚ç‚¹contextfunc Background() Context // åˆ›å»ºå­èŠ‚ç‚¹contextfunc WithCancel(parent Context) (ctx Context, cancel CancelFunc)func WithDeadline(parent Context, deadline time.Time) (Context, CancelFunc)func WithTimeout(parent Context, timeout time.Duration) (Context, CancelFunc)func WithValue(parent Context, key, val interface&#123;&#125;) Context 2).å–æ¶ˆgoroutinefunc func_eg(ctx context.Context) &#123; for &#123; ... // ä¸šåŠ¡ä»£ç ï¼š1ç§’åˆ·æ–°1æ¬¡ select &#123; case &lt;-ctx.Done(): // è¢«å–æ¶ˆï¼Œç›´æ¥è¿”å› return case &lt;-time.After(time.Second): // block 1 ç§’é’Ÿ &#125; &#125;&#125;// mainctx, cancel := context.WithTimeout(context.Background(), time.Hour)go func_eg(ctx)// å®¢æˆ·ç«¯å–æ¶ˆæ—¶ï¼Œè°ƒç”¨cancelå‡½æ•°cancel() cancel()å‡½æ•°è¿”å›çš„contextå’ŒcancelFunæ˜¯åˆ†å¼€çš„ã€‚contextæœ¬èº«æ˜¯æ²¡æœ‰cancelå‡½æ•°ï¼Œä¿è¯å–æ¶ˆå‡½æ•°åªèƒ½ç”±å¤–éƒ¨è°ƒç”¨ï¼Œé˜²æ­¢å­èŠ‚ç‚¹contextè°ƒç”¨å–æ¶ˆå‡½æ•°ï¼Œä»è€Œä¸¥æ ¼æ§åˆ¶ä¿¡æ¯æµä»çˆ¶èŠ‚ç‚¹contextæµå‘å­èŠ‚ç‚¹contextã€‚ 3).é˜²æ­¢goroutineæ³„éœ²æŸäº›goroutineå¤„äºæ— é™å¾ªç¯çŠ¶æ€ï¼Œè‹¥æ— å¤–éƒ¨å–æ¶ˆå‡½æ•°ï¼Œä¼šé€ æˆç³»ç»Ÿèµ„æºæ³„éœ²ã€‚ 0x1.contextè¯¦ç»†è§£æ ç±»å‹ åç§° ä½œç”¨ Context æ¥å£ å®šä¹‰äº† Context æ¥å£çš„å››ä¸ªæ–¹æ³• emptyCtx ç»“æ„ä½“ å®ç°äº† Context æ¥å£ï¼Œå®ƒå…¶å®æ˜¯ä¸ªç©ºçš„ context CancelFunc å‡½æ•° å–æ¶ˆå‡½æ•° canceler æ¥å£ context å–æ¶ˆæ¥å£ï¼Œå®šä¹‰äº†ä¸¤ä¸ªæ–¹æ³• cancelCtx ç»“æ„ä½“ å¯ä»¥è¢«å–æ¶ˆ timerCtx ç»“æ„ä½“ è¶…æ—¶ä¼šè¢«å–æ¶ˆ valueCtx ç»“æ„ä½“ å¯ä»¥å­˜å‚¨ k-v å¯¹ Background å‡½æ•° è¿”å›ä¸€ä¸ªç©ºçš„ contextï¼Œå¸¸ä½œä¸ºæ ¹ context TODO å‡½æ•° è¿”å›ä¸€ä¸ªç©ºçš„ contextï¼Œå¸¸ç”¨äºé‡æ„æ—¶æœŸï¼Œæ²¡æœ‰åˆé€‚çš„ context å¯ç”¨ WithCancel å‡½æ•° åŸºäºçˆ¶ contextï¼Œç”Ÿæˆä¸€ä¸ªå¯ä»¥å–æ¶ˆçš„ context newCancelCtx å‡½æ•° åˆ›å»ºä¸€ä¸ªå¯å–æ¶ˆçš„ context propagateCancel å‡½æ•° å‘ä¸‹ä¼ é€’ context èŠ‚ç‚¹é—´çš„å–æ¶ˆå…³ç³» parentCancelCtx å‡½æ•° æ‰¾åˆ°ç¬¬ä¸€ä¸ªå¯å–æ¶ˆçš„çˆ¶èŠ‚ç‚¹ removeChild å‡½æ•° å»æ‰çˆ¶èŠ‚ç‚¹çš„å­©å­èŠ‚ç‚¹ init å‡½æ•° åŒ…åˆå§‹åŒ– WithDeadline å‡½æ•° åˆ›å»ºä¸€ä¸ªæœ‰ deadline çš„ context WithTimeout å‡½æ•° åˆ›å»ºä¸€ä¸ªæœ‰ timeout çš„ context WithValue å‡½æ•° åˆ›å»ºä¸€ä¸ªå­˜å‚¨ k-v å¯¹çš„ context","categories":[{"name":"Golang","slug":"Golang","permalink":"https://blog.eganx.cn/categories/Golang/"}],"tags":[{"name":"go","slug":"go","permalink":"https://blog.eganx.cn/tags/go/"},{"name":"context","slug":"context","permalink":"https://blog.eganx.cn/tags/context/"}]},{"title":"Go Channelå…³é—­æ–¹å¼","slug":"Go_Channel_Close","date":"2022-11-02T15:56:54.000Z","updated":"2022-11-24T07:06:51.771Z","comments":true,"path":"2022/11/02/Go_Channel_Close/","link":"","permalink":"https://blog.eganx.cn/2022/11/02/Go_Channel_Close/","excerpt":"channelçš„å…³é—­æ˜¯æ¯”è¾ƒå¤´ç–¼çš„ï¼Œæä¸å¥½å°±panicã€‚ç›´æ¥panic-recoverè¦è¢«å–·è½å¤«ï¼Œä¸ä¼˜é›…ã€‚æ‰€ä»¥æ‰¾äº†å¾ˆå¤šèµ„æ–™ï¼Œæ€»ç»“ä¸€ä¸‹channelçš„å…³é—­è¿‡ç¨‹ï¼Œå¸¸è§çš„å…³é—­æ–¹å¼å’Œä¼˜é›…çš„å…³é—­æ–¹å¼ï¼ˆæ²¡æœ‰äººä¼šæ¯”ç¦æ°ä¸€å®¶è¿˜è¦ä¼˜é›…ï¼‰","text":"channelçš„å…³é—­æ˜¯æ¯”è¾ƒå¤´ç–¼çš„ï¼Œæä¸å¥½å°±panicã€‚ç›´æ¥panic-recoverè¦è¢«å–·è½å¤«ï¼Œä¸ä¼˜é›…ã€‚æ‰€ä»¥æ‰¾äº†å¾ˆå¤šèµ„æ–™ï¼Œæ€»ç»“ä¸€ä¸‹channelçš„å…³é—­è¿‡ç¨‹ï¼Œå¸¸è§çš„å…³é—­æ–¹å¼å’Œä¼˜é›…çš„å…³é—­æ–¹å¼ï¼ˆæ²¡æœ‰äººä¼šæ¯”ç¦æ°ä¸€å®¶è¿˜è¦ä¼˜é›…ï¼‰ 0x0.å…³é—­chanè¿‡ç¨‹å…³é—­channelçš„æ‰§è¡Œå‡½æ•°æ˜¯closechanï¼Œæºç å¦‚ä¸‹ // go version: go1.18.2func closechan(c *hchan) &#123; // å…³é—­ä¸€ä¸ªnil channelï¼Œç›´æ¥panicã€‚ if c == nil &#123; panic(plainError(&quot;close of nil channel&quot;)) &#125; // é” lock(&amp;c.lock) // channelå·²ç»å…³é—­ if c.closed != 0 &#123; // è§£é”ï¼Œç„¶åpanic unlock(&amp;c.lock) panic(plainError(&quot;close of closed channel&quot;)) &#125; if raceenabled &#123; callerpc := getcallerpc() racewritepc(c.raceaddr(), callerpc, abi.FuncPCABIInternal(closechan)) racerelease(c.raceaddr()) &#125; // è®¾ç½®chanå·²å…³é—­ c.closed = 1 var glist gList // é‡Šæ”¾channelé‡Œæ‰€æœ‰ç­‰å¾…æ¥æ”¶é˜Ÿåˆ—é‡Œçš„sudog // release all readers for &#123; sg := c.recvq.dequeue() if sg == nil &#123; break &#125; // elemä¸ä¸ºç©ºï¼Œè¿˜æƒ³è¦æ¥æ”¶æ•°æ®ï¼Œç»™ä¸ªç›¸å¯¹åº”ç±»å‹çš„é›¶å€¼ã€‚ if sg.elem != nil &#123; typedmemclr(c.elemtype, sg.elem) sg.elem = nil &#125; if sg.releasetime != 0 &#123; sg.releasetime = cputicks() &#125; // å–å‡ºgoroutine gp := sg.g gp.param = unsafe.Pointer(sg) sg.success = false if raceenabled &#123; raceacquireg(gp, c.raceaddr()) &#125; glist.push(gp) &#125; // é‡Šæ”¾channelé‡Œæ‰€æœ‰ç­‰å¾…å‘é€é˜Ÿåˆ—é‡Œçš„sudogï¼ŒåŒæ—¶è¿™äº›goroutineå°†ä¼španicã€‚ // release all writers (they will panic) for &#123; sg := c.sendq.dequeue() if sg == nil &#123; break &#125; sg.elem = nil if sg.releasetime != 0 &#123; sg.releasetime = cputicks() &#125; gp := sg.g gp.param = unsafe.Pointer(sg) sg.success = false if raceenabled &#123; raceacquireg(gp, c.raceaddr()) &#125; glist.push(gp) &#125; unlock(&amp;c.lock) // Ready all Gs now that we&#x27;ve dropped the channel lock. // éå†glistï¼Œå”¤é†’goroutine for !glist.empty() &#123; gp := glist.pop() gp.schedlink = 0 goready(gp, 3) &#125;&#125; å°†recvqå’Œsendqä¸¤ä¸ªé˜Ÿåˆ—ä¸­çš„GoroutineåŠ å…¥åˆ°gListä¸­ï¼Œå¹¶æ¸…é™¤æ‰æ‰€æœ‰sudogä¸Šæœªè¢«å¤„ç†æ‰å…ƒç´ ã€‚æœ€åå°†glistä¸­æ‰€æœ‰çš„goroutineåŠ åˆ°è°ƒåº¦é˜Ÿåˆ—ï¼Œç­‰å¾…è¢«å”¤é†’ã€‚ å‘é€è€…åœ¨è¢«å”¤é†’ä¹‹åä¼španicã€‚ æ€»ç»“ä¸€ä¸‹: æ“ä½œ closed channel å…³é—­(close) panic å‘é€(c&lt;-) panic æ¥æ”¶(&lt;-c) æ°¸è¿œä¸é˜»å¡ 0x1.å…³é—­channelçš„å¸¸è§æ–¹å¼channelçš„å…³é—­ä¸å¦éƒ½æœ‰å¯èƒ½é€ æˆpanicã€‚å¦‚ä½•è·å–channelæ˜¯å¦å…³é—­å’Œå¦‚ä½•ç¨³å¦¥çš„å…³é—­channelæ˜¯éå¸¸é‡è¦çš„äº‹æƒ…â€¼ï¸ åœ¨ä¸æ”¹å˜channelè‡ªèº«çŠ¶æ€çš„æƒ…å†µä¸‹ï¼Œæ— æ³•è·çŸ¥ä¸€ä¸ªchannelæ˜¯å¦å…³é—­ã€‚ å…³é—­ä¸€ä¸ªclosed channelä¼šå¯¼è‡´panicã€‚æ‰€ä»¥åœ¨å…³é—­channelçš„æ—¶å€™ï¼Œå…³é—­çš„ä¸€æ–¹åœ¨ä¸æ¸…æ¥šå½“å‰channelæ˜¯å¦å…³é—­çš„æƒ…å†µä¸‹å»å…³é—­channelæ˜¯å¾ˆå±é™©çš„âš ï¸ã€‚ å‘ä¸€ä¸ªclosed channelå‘é€æ•°æ®ä¼šå¯¼è‡´panicã€‚åŒä¸Šï¼Œåœ¨å‘é€æ–¹ä¸çŸ¥é“channelæ˜¯å¦å…³é—­çš„æƒ…å†µä¸‹å‘channelå‘é€æ•°æ®ï¼Œä¹Ÿæ˜¯å¾ˆå±é™©çš„âš ï¸ å…³é—­channelåŸåˆ™ï¼š ä¸€èˆ¬åŸåˆ™ä¸Šä½¿ç”¨channelæ˜¯ä¸å…è®¸æ¥æ”¶æ–¹å…³é—­channelå’Œ ä¸èƒ½å…³é—­ä¸€ä¸ªæœ‰å¤šä¸ªå¹¶å‘å‘é€è€…çš„channelã€‚ æ¢è€Œè¨€ä¹‹ï¼Œ ä½ åªèƒ½åœ¨å‘é€æ–¹çš„ goroutine ä¸­å…³é—­åªæœ‰è¯¥å‘é€æ–¹çš„channelã€‚ 1).defer-recoverç²—æš´å…³é—­channelä½¿ç”¨defer-recoveræœºåˆ¶æ¥ç¡®ä¿ç¨‹åºä¸ä¼šå› panicè€Œå´©æºƒï¼Œç„¶åç›´æ¥å…³é—­chanã€‚ func SafeClose(ch chan T) (justClosed bool) &#123; defer func() &#123; if recover() != nil &#123; // è¿”å›å€¼å¯ä»¥è¢«ä¿®æ”¹ // åœ¨ä¸€ä¸ªå»¶æ—¶å‡½æ•°çš„è°ƒç”¨ä¸­ã€‚ justClosed = false &#125; &#125;() // å‡è®¾è¿™é‡Œ ch != nil ã€‚ close(ch) // å¦‚æœ ch å·²ç»è¢«å…³é—­å°†ä¼šå¼•å‘ panic return true // &lt;=&gt; justClosed = true; return&#125; åŒæ ·çš„æ€æƒ³ä¹Ÿå¯ä»¥ç”¨åœ¨å‘é€æ–¹ï¼Œç¡®ä¿å‘closed channelå‘é€æ•°æ®ä¸ä¼šé€ æˆç¨‹åºå´©äº†ã€‚ func SafeSend(ch chan T, value T) (closed bool) &#123; defer func() &#123; if recover() != nil &#123; closed = true &#125; &#125;() ch &lt;- value // å¦‚æœ ch å·²ç»è¢«å…³é—­å°†ä¼šå¼•å‘ panic return false // &lt;=&gt; closed = false; return&#125; ä¸Šé¢çš„æ–¹æ³•è™½ç„¶å¤„ç†äº†panicï¼Œä½†æ˜¯å¹¶æ²¡æœ‰é¿å…panicçš„å‘ç”Ÿã€‚ 2).ä½¿ç”¨sync.Onceå…³é—­channeltype MyChannel struct &#123; C chan T once sync.Once&#125;func NewMyChannel() *MyChannel &#123; return &amp;MyChannel&#123;C: make(chan T)&#125;&#125;func (mc *MyChannel) SafeClose() &#123; mc.once.Do(func() &#123; close(mc.C) &#125;)&#125; 3).ä½¿ç”¨sync.Mutexé¿å…å¤šæ¬¡å…³é—­åŒä¸€ä¸ªchanneltype MyChannel struct &#123; C chan T closed bool mutex sync.Mutex&#125;func NewMyChannel() *MyChannel &#123; return &amp;MyChannel&#123;C: make(chan T)&#125;&#125;func (mc *MyChannel) SafeClose() &#123; mc.mutex.Lock() defer mc.mutex.Unlock() if !mc.closed &#123; close(mc.C) mc.closed = true &#125;&#125;func (mc *MyChannel) IsClosed() bool &#123; mc.mutex.Lock() defer mc.mutex.Unlock() return mc.closed&#125; 0x2.ä¼˜é›…çš„å…³é—­channelä¸Šé¢çš„å‡ ç§å…³é—­channelçš„æ–¹å¼ï¼Œç”¨çš„äººåº”è¯¥ä¸å°‘(è¯´å®è¯ï¼Œæˆ‘ä¹Ÿå¾ˆå–œæ¬¢ä½¿ç”¨sync.Onceçš„æ–¹å¼å»å…³é—­channel)ã€‚ä½†æ˜¯ï¼Œæœ‰è®¸å¤šäººè®¤ä¸ºä»£ç åœ¨è€ƒè™‘ä¸šåŠ¡å®ç°çš„åŒæ—¶ï¼Œåº”è¯¥ä¼˜é›…ä¼˜é›…å†ä¼˜é›…ï¼ï¼ˆèˆç›‘è¡¨ç¤ºå¾ˆå¼€å¿ƒï¼é˜¿å°¼äºšè¡¨ç¤ºå¾ˆéš¾å—ï¼ï¼‰ é‚£ä¹ˆå¦‚ä½•ä¼˜é›…çš„å…³é—­channelï¼ŸæŒ‰ç…§å‘é€è€…å’Œæ¥æ”¶è€…çš„æ•°é‡å¯ä»¥åˆ†ä¸ºä»¥ä¸‹å››ç§ï¼š 1. ä¸€ä¸ª senderï¼Œä¸€ä¸ª receiver2. ä¸€ä¸ª senderï¼Œ Nä¸ª receiver3. Mä¸ª senderï¼Œ ä¸€ä¸ª receiver4. Mä¸ª senderï¼Œ Nä¸ª receiver 1).åªæœ‰ä¸€ä¸ªå‘é€è€…ï¼Œå…³é—­å”¯ä¸€çš„å‘é€è€…ç¬¬ä¸€ç§å’Œç¬¬äºŒç§æƒ…å†µæ¯”è¾ƒå¥½å¤„ç†ï¼Œå› ä¸ºåªæœ‰ä¸€ä¸ªå‘é€è€…ï¼Œåªéœ€è¦å…³é—­å”¯ä¸€çš„å‘é€è€…å°±å¯ä»¥ã€‚sync.WaitGroup ä¼šè¢«ç”¨äºå®Œæˆä¾‹å­ã€‚ å®ƒåœ¨å®è·µä¸­å¹¶ä¸æ˜¯å¿…è¦çš„ã€‚ package mainimport ( &quot;time&quot; &quot;math/rand&quot; &quot;sync&quot; &quot;log&quot;)func main() &#123; rand.Seed(time.Now().UnixNano()) log.SetFlags(0) const MaxRandomNumber = 100000 const NumReceivers = 100 wgReceivers := sync.WaitGroup&#123;&#125; wgReceivers.Add(NumReceivers) dataCh := make(chan int, 100) // å‘é€è€… go func() &#123; for &#123; if value := rand.Intn(MaxRandomNumber); value == 0 &#123; // å”¯ä¸€çš„å‘é€è€…å¯ä»¥å®‰å…¨åœ°å…³é—­é€šé“ã€‚ close(dataCh) return &#125; else &#123; dataCh &lt;- value &#125; &#125; &#125;() // æ¥æ”¶è€… for i := 0; i &lt; NumReceivers; i++ &#123; go func() &#123; defer wgReceivers.Done() // æ¥æ”¶æ•°æ®ç›´åˆ° dataCh è¢«å…³é—­æˆ–è€… // dataCh çš„æ•°æ®ç¼“å­˜é˜Ÿåˆ—æ˜¯ç©ºçš„ã€‚ for value := range dataCh &#123; log.Println(value) &#125; &#125;() &#125; wgReceivers.Wait()&#125; 2).å¤šä¸ªå‘é€è€…ï¼Œä¸€ä¸ªæ¥æ”¶è€…ã€‚æ¥æ”¶è€…é€šè¿‡å…³é—­ä¸€ä¸ªchannelï¼Œå‘Šè¯‰å‘é€è€…ä¸è¦å†å‘äº†ã€‚ package mainimport ( &quot;time&quot; &quot;math/rand&quot; &quot;sync&quot; &quot;log&quot;)func main() &#123; rand.Seed(time.Now().UnixNano()) log.SetFlags(0) // ... const MaxRandomNumber = 100000 const NumSenders = 1000 wgReceivers := sync.WaitGroup&#123;&#125; wgReceivers.Add(1) // ... dataCh := make(chan int, 100) stopCh := make(chan struct&#123;&#125;) // stopCh æ˜¯ä¸€ä¸ªä¿¡å·é€šé“ã€‚ // å®ƒçš„å‘é€è€…æ˜¯ dataCh çš„æ¥æ”¶è€…ã€‚ // å®ƒçš„æ¥æ”¶è€…æ˜¯ dataCh çš„å‘é€è€…ã€‚ // å‘é€è€… for i := 0; i &lt; NumSenders; i++ &#123; go func() &#123; for &#123; select &#123; case &lt;- stopCh: return case dataCh &lt;- rand.Intn(MaxRandomNumber): &#125; &#125; &#125;() &#125; // æ¥æ”¶è€… go func() &#123; defer wgReceivers.Done() for value := range dataCh &#123; if value == MaxRandomNumber-1 &#123; // dataCh é€šé“çš„æ¥æ”¶è€…ä¹Ÿæ˜¯ stopCh é€šé“çš„å‘é€è€…ã€‚ // åœ¨è¿™é‡Œå…³é—­åœæ­¢é€šé“æ˜¯å®‰å…¨çš„ã€‚. close(stopCh) return &#125; log.Println(value) &#125; &#125;() // ... wgReceivers.Wait()&#125; 3).å¤šä¸ªå‘é€è€…ï¼Œå¤šä¸ªæ¥æ”¶è€…ã€‚å½“å‘é€è€…å’Œæ¥æ”¶è€…éƒ½æ˜¯å¤šä¸ªçš„æ—¶å€™ï¼Œæ²¡åŠæ³•é€šè¿‡ä»»ä½•ä¸€æ–¹å»ç»ˆæ­¢è¿™åœºæ¸¸æˆã€‚å› æ­¤éœ€è¦å¢åŠ ä¸€ä¸ªä¸­é—´äººçš„è§’è‰²æ¥å¤„ç†ã€‚ package mainimport ( &quot;time&quot; &quot;math/rand&quot; &quot;sync&quot; &quot;log&quot; &quot;strconv&quot;)func main() &#123; rand.Seed(time.Now().UnixNano()) log.SetFlags(0) // ... const MaxRandomNumber = 100000 const NumReceivers = 100 const NumSenders = 1000 wgReceivers := sync.WaitGroup&#123;&#125; wgReceivers.Add(NumReceivers) // ... dataCh := make(chan int, 100) stopCh := make(chan struct&#123;&#125;) // stopCh æ˜¯ä¸€ä¸ªä¿¡å·é€šé“ã€‚ // å®ƒçš„å‘é€è€…æ˜¯ä¸‹é¢çš„ä¸»æŒäºº goroutineã€‚ // å®ƒçš„æ¥æ”¶è€…æ˜¯ dataChçš„æ‰€æœ‰å‘é€è€…å’Œæ¥æ”¶è€…ã€‚ toStop := make(chan string, 1) // toStop é€šé“é€šå¸¸ç”¨æ¥é€šçŸ¥ä¸»æŒäººå»å…³é—­ä¿¡å·é€šé“( stopCh )ã€‚ // å®ƒçš„å‘é€è€…æ˜¯ dataChçš„ä»»æ„å‘é€è€…å’Œæ¥æ”¶è€…ã€‚ // å®ƒçš„æ¥æ”¶è€…æ˜¯ä¸‹é¢çš„ä¸»æŒäºº goroutine var stoppedBy string // ä¸»æŒäºº go func() &#123; stoppedBy = &lt;-toStop close(stopCh) &#125;() // å‘é€è€… for i := 0; i &lt; NumSenders; i++ &#123; go func(id string) &#123; for &#123; value := rand.Intn(MaxRandomNumber) if value == 0 &#123; // ç”¨äºé€šçŸ¥ä¸»æŒäººå…³é—­ä¿¡å·é€šé“ã€‚ select &#123; case toStop &lt;- &quot;sender#&quot; + id: default: &#125; return &#125; select &#123; case &lt;- stopCh: return case dataCh &lt;- value: &#125; &#125; &#125;(strconv.Itoa(i)) &#125; // æ¥æ”¶è€… for i := 0; i &lt; NumReceivers; i++ &#123; go func(id string) &#123; defer wgReceivers.Done() for &#123; select &#123; case &lt;- stopCh: return case value := &lt;-dataCh: if value == MaxRandomNumber-1 &#123; // åŒæ ·ç”¨äºé€šçŸ¥ä¸»æŒäººå»å…³é—­ä¿¡å·é€šé“ã€‚ select &#123; case toStop &lt;- &quot;receiver#&quot; + id: default: &#125; return &#125; log.Println(value) &#125; &#125; &#125;(strconv.Itoa(i)) &#125; // ... wgReceivers.Wait() log.Println(&quot;stopped by&quot;, stoppedBy)&#125; æ­¤æ—¶toStopé€šé“çš„ç¼“å­˜å¤§å°æ˜¯1ã€‚ä¸ä½¿ç”¨éç¼“å†²å‹channelæ˜¯ä¸ºäº†é¿å…ç¬¬ä¸€ä¸ªå…³é—­ä¿¡å·åœ¨ä¸»æŒäººå‡†å¤‡å¥½ä»toStopæ¥æ”¶æ•°æ®ä¹‹å‰å‘é€ï¼Œé€ æˆä¸¢å¤±ã€‚ ä¹Ÿå¯ä»¥è®¾ç½®toStopé€šé“çš„bufä¸ºå‘é€è€…å’Œæ¥æ”¶è€…æ•°é‡ä¹‹å’Œã€‚toStopçš„å®¹é‡è¶³å¤Ÿçš„æ—¶å€™ï¼Œå°±ä¸ç”¨æ‹…å¿ƒé˜»å¡äº†ã€‚ä¹Ÿå°±ä¸éœ€è¦å€ŸåŠ©selectè¯­å¥äº†ã€‚ ...toStop := make(chan string, NumReceivers + NumSenders)... value := rand.Intn(MaxRandomNumber) if value == 0 &#123; toStop &lt;- &quot;sender#&quot; + id return &#125;... if value == MaxRandomNumber-1 &#123; toStop &lt;- &quot;receiver#&quot; + id return &#125;... Q&amp;A: å…³é—­çš„channelè¿˜èƒ½è¯»å—ï¼Ÿ å¯ä»¥ã€‚ä»ä¸€ä¸ªå¸¦ç¼“å†²çš„chané‡Œè¯»å–æ•°æ®æ—¶ï¼Œå½“channelè¢«å…³é—­ï¼Œæ˜¯å¯ä»¥è¯»åˆ°æœ‰æ•ˆå€¼çš„ã€‚å¯ä»¥æ˜¯comma-okçš„æ–¹å¼è¯»å–chanæ•°æ®ï¼Œå½“okå€¼ä¸ºfalseæ—¶ï¼Œè¯´æ˜channelå·²ç»å…³é—­ä¸”é€šé“æ— æ•°æ®ï¼Œè¯»å‡ºçš„æ•°æ®å¼€å§‹æ— æ•ˆã€‚ func main() &#123; ch := make(chan int, 3) ch &lt;- 0 ch &lt;- 1 close(ch) x, ok := &lt;-ch if ok &#123; fmt.Println(&quot;received: &quot;, x) &#125; y, ok := &lt;-ch if ok &#123; fmt.Println(&quot;received: &quot;, y) &#125; z, ok := &lt;-ch if !ok &#123; fmt.Println(&quot;received false &quot;, z) &#125;&#125; è¿è¡Œç»“æœï¼šreceived: 0received: 1received false: 0","categories":[{"name":"Golang","slug":"Golang","permalink":"https://blog.eganx.cn/categories/Golang/"}],"tags":[{"name":"go","slug":"go","permalink":"https://blog.eganx.cn/tags/go/"},{"name":"channel","slug":"channel","permalink":"https://blog.eganx.cn/tags/channel/"}]},{"title":"Go Channelæ•°æ®ç»“æ„å’Œåˆ›å»º","slug":"Go_Channel_DS","date":"2022-11-01T13:09:13.000Z","updated":"2022-11-24T06:59:34.802Z","comments":true,"path":"2022/11/01/Go_Channel_DS/","link":"","permalink":"https://blog.eganx.cn/2022/11/01/Go_Channel_DS/","excerpt":"Goè¯­è¨€çš„å¹¶å‘æ˜¯æœ€å¥½ç”¨çš„ï¼Œè€Œchannelä¹Ÿç®—æ˜¯Goè¯­è¨€å¹¶å‘æœºåˆ¶çš„åŠå£æ±Ÿå±±äº†ã€‚","text":"Goè¯­è¨€çš„å¹¶å‘æ˜¯æœ€å¥½ç”¨çš„ï¼Œè€Œchannelä¹Ÿç®—æ˜¯Goè¯­è¨€å¹¶å‘æœºåˆ¶çš„åŠå£æ±Ÿå±±äº†ã€‚ 0x0.CSPCSPå…¨ç§°â€œCommunicating Sequential Processesâ€ï¼Œä¸­æ–‡å¯ä»¥å«åšé€šä¿¡é¡ºåºè¿›ç¨‹ã€‚goçš„å¹¶å‘æ˜¯åŸºäºchannelå®ç°ï¼Œä¾èµ–çš„å°±æ˜¯CSPæ¨¡å‹ã€‚CSPæè¿°äº†å¹¶å‘ç³»ç»Ÿä¸­çš„äº’åŠ¨æ¨¡å¼ï¼Œå®é™…ä¸ŠGoåªæ˜¯ç”¨åˆ°äº†CSPç†è®ºä¸­ä¸€éƒ¨åˆ†ï¼Œå³ç†è®ºä¸­çš„Process/Channelï¼Œåœ¨Goä¸­å¯¹åº”goroutine/channelã€‚è¿™ä¸¤ä¸ªå¹¶å‘åŸè¯­ä¹‹é—´æ²¡æœ‰ä»å±å…³ç³»ï¼Œ Process å¯ä»¥è®¢é˜…ä»»æ„ä¸ª Channelï¼ŒChannel ä¹Ÿå¹¶ä¸å…³å¿ƒæ˜¯å“ªä¸ª Process åœ¨åˆ©ç”¨å®ƒè¿›è¡Œé€šä¿¡ï¼›Process å›´ç»• Channel è¿›è¡Œè¯»å†™ï¼Œå½¢æˆä¸€å¥—æœ‰åºé˜»å¡å’Œå¯é¢„æµ‹çš„å¹¶å‘æ¨¡å‹ã€‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ â”‚ â”‚ â”‚ â”‚ â”‚â”‚ Goroutine â”œâ”€â”€â”€â”€â–ºâ”‚ Channel â”œâ”€â”€â”€â”€â”€â–ºâ”‚ Goroutine â”‚â”‚ â”‚ â”‚ â”‚ â”‚ â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ Goroutine + channelæ”¯æ’‘èµ·äº†Goè¯­è¨€çš„å¹¶å‘æœºåˆ¶ã€‚ 0x1.channelæ•°æ®ç»“æ„type hchan struct &#123; qcount uint // total data in the queue //å¾ªç¯é˜Ÿåˆ—å…ƒç´ ä¸ªæ•° dataqsiz uint // size of the circular queue //å¾ªç¯é˜Ÿåˆ—å¤§å° buf unsafe.Pointer // points to an array of dataqsiz elements //å¾ªç¯é˜Ÿåˆ—æŒ‡é’ˆ elemsize uint16 //chanå…ƒç´ å¤§å° closed uint32 //æ˜¯å¦å·²ç»å…³é—­ elemtype *_type // element type //chanå…ƒç´ ç±»å‹ sendx uint // send index //chanå‘é€æ“ä½œå¤„ç†åˆ°çš„ä½ç½® recvx uint // receive index //chanæ¥æ”¶æ“ä½œå¤„ç†åˆ°çš„ä½ç½® recvq waitq // list of recv waiters //ç­‰å¾…æ¥æ”¶æ•°æ®çš„goroutineåˆ—è¡¨ sendq waitq // list of send waiters //ç­‰å¾…å‘é€æ•°æ®çš„goroutineåˆ—è¡¨ // lock protects all fields in hchan, as well as several // fields in sudogs blocked on this channel. // // Do not change another G&#x27;s status while holding this lock // (in particular, do not ready a G), as this can deadlock // with stack shrinking. lock mutex&#125; å…¶ä¸­bufå­—æ®µåªæœ‰åœ¨ç¼“å†²å‹çš„channelæ‰æœ‰ï¼ŒæŒ‡å‘åº•å±‚çš„å¾ªç¯æ•°ç»„ã€‚ sendxå’Œrecvxåˆ†åˆ«è¡¨ç¤ºå·²å‘é€å’Œå·²æ¥æ”¶çš„å…ƒç´ åœ¨å¾ªç¯æ•°ç»„ä¸­çš„ç´¢å¼•ã€‚ sendqå’Œrecvqåˆ†åˆ«è¡¨ç¤ºç­‰å¾…æ¥æ”¶å’Œç­‰å¾…å‘é€çš„goroutineé˜Ÿåˆ—ã€‚è¿™äº›goroutineç”±äºå°è¯•è¯»å–channelæˆ–è€…å‘channelå‘é€æ•°æ®è€Œè¢«é˜»å¡ã€‚ lockç”¨æ¥ä¿æŠ¤hchanä¸­æ‰€æœ‰çš„å­—æ®µã€‚ä¿è¯æ¯ä¸ªchannelçš„è¯»å†™éƒ½æ˜¯åŸå­çš„ã€‚ // sudog åŒå‘åˆ—è¡¨ï¼Œsudogå®é™…ä¸Šæ˜¯å¯¹goroutineçš„ä¸€ä¸ªå°è£…ã€‚type waitq struct &#123; first *sudog last *sudog&#125; â”Œâ”€â”€â”€â”€â”€â” â”‚hchanâ”‚ â”œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”5â”‚ qcount uint â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤8â”‚ dataqsiz uint â”‚ 0 1 2 3 4 5 6 7 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â” â”‚buf unsafe.Pointerâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ a â”‚ b â”‚ c â”‚ d â”‚ e â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜ â”‚ elemsize uint16 â”‚ â–² â–² â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ â”‚ â”‚ closed uint32 â”‚ â”‚ â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ â”‚ â”‚ elemtype *_type â”‚ â”‚ â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ â”‚0â”‚ sendx uint â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚5â”‚ recvx uint â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ recvq waitq â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ â”‚ â”‚ sendq waitq â”œâ”€â”€â”€â”€â”€â” â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ â””â”€â”€â–ºâ”‚ sudog â”‚â—„â”€â”€â”€â–ºâ”‚ sudog â”‚â—„â”€â”€â”€â–ºâ”‚ sudog â”‚â—„â”€â”€â”˜ â”‚ lock mutex â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”‚ â”Œâ”€â”€â–ºâ”‚ sudog â”‚â—„â”€â”€â”€â–ºâ”‚ sudog â”‚â—„â”€â”€â”€â–ºâ”‚ sudog â”‚â—„â”€â”€â” â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚ â”‚ â””â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ 0x2.åˆ›å»ºchannelåˆ›å»ºchanä¸€èˆ¬ä½¿ç”¨makeå…³é”®å­—ã€‚å…¶ä¸­chançš„ç±»å‹åˆ†ä¸ºæœ‰æ— ç¼“å†²ä¸¤ç§æ¨¡å¼ã€‚ ch := make(chan int) //æ— ç¼“å†²ch := make(chan int, 2) //æœ‰ç¼“å†² ç¿»ç¿»æºç ï¼Œæœ‰äº›çœ‹ä¸å¤ªæ˜ç™½ï¼Œåªèƒ½æ˜¯èƒ½çœ‹å¤šå°‘çœ‹å¤šå°‘äº†ğŸ˜­ã€‚åœ¨runtime/chan.goä¸­éƒ½æ˜¯ä½¿ç”¨makechanæ¥åˆ›å»ºchanã€‚ä¸­æ–‡æ˜¯ä¸ªäººæ³¨é‡Šï¼Œè‹±æ–‡æ˜¯å®˜æ–¹æ³¨é‡Šã€‚ const ( maxAlign = 8 hchanSize = unsafe.Sizeof(hchan&#123;&#125;) + uintptr(-int(unsafe.Sizeof(hchan&#123;&#125;))&amp;(maxAlign-1)) //hchanç»“æ„ä½“å¤§å° debugChan = false)func makechan64(t *chantype, size int64) *hchan &#123; if int64(int(size)) != size &#123; panic(plainError(&quot;makechan: size out of range&quot;)) &#125; return makechan(t, int(size))&#125;func makechan(t *chantype, size int) *hchan &#123; elem := t.elem // æ£€æŸ¥channel sizeå’Œalign // compiler checks this but be safe. if elem.size &gt;= 1&lt;&lt;16 &#123; throw(&quot;makechan: invalid channel element type&quot;) &#125; if hchanSize%maxAlign != 0 || elem.align &gt; maxAlign &#123; throw(&quot;makechan: bad alignment&quot;) &#125; // å…ƒç´ å¤§å°*ä¸ªæ•°ï¼Œè®¡ç®—buféœ€è¦çš„å†…å­˜å¤§å° mem, overflow := math.MulUintptr(elem.size, uintptr(size)) if overflow || mem &gt; maxAlloc-hchanSize || size &lt; 0 &#123; panic(plainError(&quot;makechan: size out of range&quot;)) &#125; // Hchan does not contain pointers interesting for GC when elements stored in buf do not contain pointers. // buf points into the same allocation, elemtype is persistent. // SudoG&#x27;s are referenced from their owning thread so they can&#x27;t be collected. // TODO(dvyukov,rlh): Rethink when collector can move allocated objects. var c *hchan switch &#123; // è¡¨ç¤ºå…ƒç´ å¤§å°ä¸ºé›¶æˆ–è€…ç¼“å†²åŒºå¤§å°ä¸º0ï¼ˆæ— ç¼“å†²ç±»å‹ï¼‰ï¼Œä¸éœ€è¦åˆ›å»ºbufã€‚åªè¿›è¡Œä¸€æ¬¡å†…å­˜åˆ†é…ã€‚åˆ†é…å†…å­˜çš„å¤§å°å°±æ˜¯hchanç»“æ„ä½“å¤§å°ã€‚ case mem == 0: // Queue or element size is zero. c = (*hchan)(mallocgc(hchanSize, nil, true)) // Race detector uses this location for synchronization. c.buf = c.raceaddr() // å…ƒç´ ç±»å‹ä¸å«æŒ‡é’ˆï¼Œè¿›è¡Œä¸€æ¬¡å†…å­˜åˆ†é…ï¼Œåˆ†é…ä¸€å—è¿ç»­çš„å†…å­˜ï¼Œå¤§å°æ˜¯â€œhchanç»“æ„ä½“å¤§å°+ä¸ªæ•°*å…ƒç´ å¤§å°â€ã€‚ // åŒæ—¶å…ƒç´ å¤§å°ä¸ç­‰äº0ä¸”æ˜¯ç¼“å†²åŒºå¤§å°ä¸ä¸º0 case elem.ptrdata == 0: // Elements do not contain pointers. // Allocate hchan and buf in one call. c = (*hchan)(mallocgc(hchanSize+mem, nil, true)) c.buf = add(unsafe.Pointer(c), hchanSize) // å…ƒç´ åŒ…å«æŒ‡é’ˆï¼Œç¼“å†²åŒºå¤§å°ä¸ä¸º0ï¼Œè¿›è¡Œä¸¤æ¬¡å†…å­˜åˆ†é…ï¼Œå•ç‹¬ä¸ºhchanå’Œbufåˆ†é…å†…å­˜ã€‚ default: // Elements contain pointers. c = new(hchan) c.buf = mallocgc(mem, elem, true) &#125; c.elemsize = uint16(elem.size) c.elemtype = elem c.dataqsiz = uint(size) lockInit(&amp;c.lock, lockRankHchan) if debugChan &#123; print(&quot;makechan: chan=&quot;, c, &quot;; elemsize=&quot;, elem.size, &quot;; dataqsiz=&quot;, size, &quot;\\n&quot;) &#125; return c&#125; æ ¹æ®channelä¸­æ”¶å‘çš„å…ƒç´ ç±»å‹å’Œç¼“å†²åŒºçš„å¤§å°ï¼Œåˆå§‹åŒ–hchanæ—¶æœ‰ä»¥ä¸‹ä¸‰ç§æƒ…å†µï¼š å…ƒç´ å¤§å°ä¸ºé›¶æˆ–è€…ç¼“å†²åŒºå¤§å°ä¸º0ï¼ˆæ— ç¼“å†²ç±»å‹ï¼‰ï¼Œä¸éœ€è¦åˆ›å»ºbufã€‚è¿›è¡Œä¸€æ¬¡å†…å­˜åˆ†é…ã€‚åˆ†é…å†…å­˜çš„å¤§å°å°±æ˜¯hchanç»“æ„ä½“å¤§å°ã€‚ å…ƒç´ å¤§å°å’Œç¼“å†²åŒºå¤§å°å‡ä¸ä¸º0ï¼Œä¸”å…ƒç´ ç±»å‹ä¸å«æŒ‡é’ˆã€‚è¿›è¡Œä¸€æ¬¡å†…å­˜åˆ†é…ï¼Œåˆ†é…ä¸€å—è¿ç»­çš„å†…å­˜ï¼Œå¤§å°æ˜¯â€œhchanç»“æ„ä½“å¤§å°+ä¸ªæ•°*å…ƒç´ å¤§å°â€ã€‚ å…ƒç´ åŒ…å«æŒ‡é’ˆï¼Œç¼“å†²åŒºå¤§å°ä¸ä¸º0ã€‚è¿›è¡Œä¸¤æ¬¡å†…å­˜åˆ†é…ï¼Œå•ç‹¬ä¸ºhchanå’Œbufåˆ†é…å†…å­˜ã€‚ 0x3.channelçš„åŸºæœ¬åº”ç”¨1).è¶…æ—¶å¤„ç†res := &lt;- c1 ç­‰å¾…ç»“æœï¼Œ&lt;-time.After ç­‰å¾…è¶…æ—¶ï¼ˆ1ç§’é’Ÿï¼‰ä»¥åå‘é€çš„å€¼ã€‚ ç”±äº select é»˜è®¤å¤„ç†ç¬¬ä¸€ä¸ªå·²å‡†å¤‡å¥½çš„æ¥æ”¶æ“ä½œï¼Œ å› æ­¤å¦‚æœæ“ä½œè€—æ—¶è¶…è¿‡äº†å…è®¸çš„ 1 ç§’çš„è¯ï¼Œå°†ä¼šæ‰§è¡Œè¶…æ—¶ caseã€‚ package mainimport ( &quot;fmt&quot; &quot;time&quot;)func main() &#123; c1 := make(chan string, 1) go func() &#123; time.Sleep(2 * time.Second) c1 &lt;- &quot;result 1&quot; &#125;() select &#123; case res := &lt;-c1: fmt.Println(res) case &lt;-time.After(1 * time.Second): fmt.Println(&quot;timeout 1&quot;) &#125; c2 := make(chan string, 1) go func() &#123; time.Sleep(2 * time.Second) c2 &lt;- &quot;result 2&quot; &#125;() select &#123; case res := &lt;-c2: fmt.Println(res) case &lt;-time.After(3 * time.Second): fmt.Println(&quot;timeout 2&quot;) &#125;&#125; è¿è¡Œç»“æœï¼š timeout 1result 2 2).æ§åˆ¶å¹¶å‘æ„å»ºä¸€ä¸ªç¼“å†²å‹çš„ channelï¼Œå®¹é‡ä¸º 3ã€‚æ¥ç€éå†ä»»åŠ¡åˆ—è¡¨ï¼Œæ¯ä¸ªä»»åŠ¡å¯åŠ¨ä¸€ä¸ª goroutine å»å®Œæˆã€‚çœŸæ­£æ‰§è¡Œä»»åŠ¡ï¼Œè®¿é—®ç¬¬ä¸‰æ–¹çš„åŠ¨ä½œåœ¨ w() ä¸­å®Œæˆï¼Œåœ¨æ‰§è¡Œ w() ä¹‹å‰ï¼Œå…ˆè¦ä» limit ä¸­æ‹¿â€œè®¸å¯è¯â€ï¼Œæ‹¿åˆ°è®¸å¯è¯ä¹‹åï¼Œæ‰èƒ½æ‰§è¡Œ w()ï¼Œå¹¶ä¸”åœ¨æ‰§è¡Œå®Œä»»åŠ¡ï¼Œè¦å°†â€œè®¸å¯è¯â€å½’è¿˜ã€‚è¿™æ ·å°±å¯ä»¥æ§åˆ¶åŒæ—¶è¿è¡Œçš„ goroutine æ•°ã€‚å¦‚æœ w() å‘ç”Ÿ panicï¼Œé‚£â€œè®¸å¯è¯â€å¯èƒ½å°±è¿˜ä¸å›å»äº†ï¼Œå› æ­¤éœ€è¦ä½¿ç”¨ defer æ¥ä¿è¯ã€‚ var limit = make(chan int, 3)func main() &#123; // ...... for _, w := range work &#123; go func() &#123; limit &lt;- 1 w() &lt;-limit &#125;() &#125; // ......&#125; 3).ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹å¹¶å‘ç¼–ç¨‹ä¸­æœ€å¸¸è§çš„ä¾‹å­å°±æ˜¯ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å¼ï¼Œè¯¥æ¨¡å¼ä¸»è¦é€šè¿‡å¹³è¡¡ç”Ÿäº§çº¿ç¨‹å’Œæ¶ˆè´¹çº¿ç¨‹çš„å·¥ä½œèƒ½åŠ›æ¥æé«˜ç¨‹åºçš„æ•´ä½“å¤„ç†æ•°æ®çš„é€Ÿåº¦ã€‚ç®€å•åœ°è¯´ï¼Œå°±æ˜¯ç”Ÿäº§è€…ç”Ÿäº§ä¸€äº›æ•°æ®ï¼Œç„¶åæ”¾åˆ°æˆæœé˜Ÿåˆ—ä¸­ï¼ŒåŒæ—¶æ¶ˆè´¹è€…ä»æˆæœé˜Ÿåˆ—ä¸­æ¥å–è¿™äº›æ•°æ®ã€‚è¿™æ ·å°±è®©ç”Ÿäº§æ¶ˆè´¹å˜æˆäº†å¼‚æ­¥çš„ä¸¤ä¸ªè¿‡ç¨‹ã€‚å½“æˆæœé˜Ÿåˆ—ä¸­æ²¡æœ‰æ•°æ®æ—¶ï¼Œæ¶ˆè´¹è€…å°±è¿›å…¥é¥¥é¥¿çš„ç­‰å¾…ä¸­ï¼›è€Œå½“æˆæœé˜Ÿåˆ—ä¸­æ•°æ®å·²æ»¡æ—¶ï¼Œç”Ÿäº§è€…åˆ™é¢ä¸´å› äº§å“æŒ¤å‹å¯¼è‡´ CPU è¢«å‰¥å¤ºçš„ä¸‹å²—é—®é¢˜ã€‚ // ç”Ÿäº§è€…: ç”Ÿæˆ factor æ•´æ•°å€çš„åºåˆ—func Producer(factor int, out chan&lt;- int) &#123; for i := 0; ; i++ &#123; out &lt;- i*factor &#125;&#125;// æ¶ˆè´¹è€…func Consumer(in &lt;-chan int) &#123; for v := range in &#123; fmt.Println(v) &#125;&#125;func main() &#123; ch := make(chan int, 64) // æˆæœé˜Ÿåˆ— go Producer(3, ch) // ç”Ÿæˆ 3 çš„å€æ•°çš„åºåˆ— go Producer(5, ch) // ç”Ÿæˆ 5 çš„å€æ•°çš„åºåˆ— go Consumer(ch) // æ¶ˆè´¹ç”Ÿæˆçš„é˜Ÿåˆ— // Ctrl+C é€€å‡º sig := make(chan os.Signal, 1) signal.Notify(sig, syscall.SIGINT, syscall.SIGTERM) fmt.Printf(&quot;quit (%v)\\n&quot;, &lt;-sig)&#125;","categories":[{"name":"Golang","slug":"Golang","permalink":"https://blog.eganx.cn/categories/Golang/"}],"tags":[{"name":"go","slug":"go","permalink":"https://blog.eganx.cn/tags/go/"},{"name":"channel","slug":"channel","permalink":"https://blog.eganx.cn/tags/channel/"}]},{"title":"Go Interfaceç†è§£(2)","slug":"Go_Interface_2","date":"2022-10-30T13:45:56.000Z","updated":"2022-11-22T06:15:48.152Z","comments":true,"path":"2022/10/30/Go_Interface_2/","link":"","permalink":"https://blog.eganx.cn/2022/10/30/Go_Interface_2/","excerpt":"æ¥å£æœ‰åŠ¨æ€å€¼å’ŒåŠ¨æ€ç±»å‹ï¼Œåªæœ‰å½“ä¸¤è€…éƒ½æ˜¯nilçš„æ—¶å€™ï¼Œæ‰æœ‰æ¥å£å€¼==nilã€‚è¿™å¾ˆé‡è¦â€¼ï¸ æ¥å£å˜é‡æ—¶å¸¸éœ€è¦è¿›è¡Œç±»å‹æ–­è¨€ï¼Œæ‰¾åˆ°çœŸå®ç±»å‹ã€‚è¿™ä¹Ÿå¾ˆé‡è¦â€¼ï¸","text":"æ¥å£æœ‰åŠ¨æ€å€¼å’ŒåŠ¨æ€ç±»å‹ï¼Œåªæœ‰å½“ä¸¤è€…éƒ½æ˜¯nilçš„æ—¶å€™ï¼Œæ‰æœ‰æ¥å£å€¼==nilã€‚è¿™å¾ˆé‡è¦â€¼ï¸ æ¥å£å˜é‡æ—¶å¸¸éœ€è¦è¿›è¡Œç±»å‹æ–­è¨€ï¼Œæ‰¾åˆ°çœŸå®ç±»å‹ã€‚è¿™ä¹Ÿå¾ˆé‡è¦â€¼ï¸ 0x0.ç©ºæ¥å£&amp;nilä¸Šæ¥ä¸€ä¸ªç»å…¸é—®é¢˜ï¼šä¸€ä¸ªåŒ…å«nilæŒ‡é’ˆçš„æ¥å£æ˜¯ä¸æ˜¯nilæ¥å£ï¼Ÿè¿™ä¸ªæ˜¯çœŸå‘ï¼Œåœ¨åˆ¤ç©ºçš„æ—¶å€™ï¼Œæœ‰å¯èƒ½å°±ä¸­æ‹›äº†ã€‚ ç©ºæ¥å£(interface&#123;&#125;)ä¸åŒ…å«ä»»ä½•çš„æ–¹æ³•ï¼Œä½†ä¸æ­¤åŒæ—¶ï¼Œæ‰€æœ‰çš„ç±»å‹éƒ½å®ç°äº†interface&#123;&#125;ã€‚åœ¨å­˜å‚¨ä»»æ„ç±»å‹çš„æ—¶å€™ï¼Œinterface&#123;&#125;ç›¸å½“çš„æœ‰ç”¨ã€‚ nil ä¸æ˜¯å…³é”®å­—ï¼Œæ˜¯ä¸€ä¸ªé¢„å…ˆå£°æ˜çš„æ ‡è¯†ç¬¦ï¼ŒæŒ‡é’ˆã€é€šé“ã€å‡½æ•°ã€æ¥å£ã€mapã€åˆ‡ç‰‡çš„é›¶å€¼å°±æ˜¯nilï¼Œnil æ˜¯æ²¡æœ‰é»˜è®¤ç±»å‹çš„ï¼Œä»–çš„ç±»å‹å…·æœ‰ä¸ç¡®å®šæ€§ï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨å®ƒæ—¶å¿…é¡»è¦æä¾›è¶³å¤Ÿçš„ä¿¡æ¯èƒ½å¤Ÿè®©ç¼–è¯‘å™¨ æ¨æ–­nilæœŸæœ›çš„ç±»å‹; ä¸¤ä¸ªnilä¸èƒ½è¿›è¡Œæ¯”è¾ƒï¼Œå› ä¸ºnilæ˜¯æ— ç±»å‹çš„; å£°æ˜ä¸€ä¸ªnilçš„mapï¼Œmapå¯ä»¥è¯»æ•°æ®ï¼Œä½†æ˜¯ä¸èƒ½å†™æ•°æ® å…³é—­ä¸€ä¸ªnilçš„channelä¼šå¼•å‘panic nilåˆ‡ç‰‡ä¸èƒ½è¿›è¡Œç´¢å¼•è®¿é—®ï¼Œä¼šå¼•å‘panic æ–¹æ³•æ¥æ”¶è€…ä¸ºnilæ—¶ï¼Œå¦‚æœåœ¨æ–¹æ³•å†…ä½¿ç”¨åˆ°äº†ä¼šå¼•å‘panic ç©ºæŒ‡é’ˆä¸€ä¸ªæ²¡æœ‰ä»»ä½•å€¼çš„æŒ‡é’ˆ æ¥å£çš„åº•å±‚ç»“æ„ä½“æœ‰ifaceã€efaceä¸¤ç§ä¸åŒçš„è¡¨ç¤ºã€‚å‰è€…æ˜¯æœ‰æ–¹æ³•çš„æ¥å£ï¼Œåè€…æ˜¯æ— ä»»ä½•æ–¹æ³•çš„ç©ºæ¥å£ï¼šinterface&#123;&#125;ã€‚ //src/runtime/runtime2.gotype iface struct &#123; tab *itab data unsafe.Pointer&#125;type eface struct &#123; _type *_type data unsafe.Pointer&#125;type itab struct &#123; inter *interfacetype _type *_type hash uint32 // copy of _type.hash. Used for type switches. _ [4]byte fun [1]uintptr // variable sized. fun[0]==0 means _type does not implement inter.&#125; iface å†…éƒ¨ç»´æŠ¤ä¸¤ä¸ªæŒ‡é’ˆï¼Œtab æŒ‡å‘ä¸€ä¸ª itab å®ä½“ï¼Œ å®ƒè¡¨ç¤ºæ¥å£çš„ç±»å‹ä»¥åŠèµ‹ç»™è¿™ä¸ªæ¥å£çš„å®ä½“ç±»å‹ã€‚data åˆ™æŒ‡å‘æ¥å£å…·ä½“çš„å€¼ï¼Œä¸€èˆ¬è€Œè¨€æ˜¯ä¸€ä¸ªæŒ‡å‘å †å†…å­˜çš„æŒ‡é’ˆã€‚tabå’Œdataä¹Ÿåˆ†åˆ«è¢«ç§°ä¸ºåŠ¨æ€ç±»å‹å’ŒåŠ¨æ€å€¼ï¼Œæ¥å£å€¼åŒ…æ‹¬åŠ¨æ€ç±»å‹å’ŒåŠ¨æ€å€¼ã€‚åªæœ‰å½“æ¥å£çš„åŠ¨æ€ç±»å‹å’ŒåŠ¨æ€å€¼éƒ½ä¸ºnilçš„æ—¶å€™ï¼Œæ‰æœ‰æ¥å£å€¼==nilã€‚ 0x1.æ¥å£ç±»å‹æ–­è¨€éšå£«ç±»å‹è½¬æ¢åœ¨Goä¸­æ˜¯ä¸å…è®¸çš„ï¼Œè¿™ä¸ªæ—¶å€™ç±»å‹å°±éœ€è¦è¿›è¡Œè½¬æ¢æˆå¦ä¸€ä¸ªç±»å‹ã€‚æœ‰ä¸¤ç§æ–¹å¼å®ç°ï¼šç±»å‹è½¬æ¢ï¼Œç±»å‹æ–­è¨€ã€‚ä¸¤è€…çš„ä¸åŒä¹‹å¤„åœ¨äºç±»å‹æ–­è¨€æ˜¯é’ˆå¯¹æ¥å£å˜é‡ã€‚ 1).ç±»å‹è½¬æ¢&lt;ç»“æœ&gt; := &lt;ç›®æ ‡ç±»å‹&gt;(&lt;è¡¨è¾¾å¼&gt;) f = 10.101i := int(f)fmt.Printf(&quot;%T, %v\\n&quot;, i, i) //output: int, 10 ç±»å‹è½¬æ¢å‰åçš„ä¸¤ä¸ªç±»å‹éœ€è¦ç›¸äº’å…¼å®¹æ‰å¯ä»¥ï¼Œä¸ç„¶ç¼–è¯‘å™¨ä¼šæŠ¥é”™ã€‚ 2).ç±»å‹æ–­è¨€å› ä¸ºç©ºæ¥å£ interface&#123;&#125; æ²¡æœ‰å®šä¹‰ä»»ä½•å‡½æ•°ï¼Œå› æ­¤ Go ä¸­æ‰€æœ‰ç±»å‹éƒ½å®ç°äº†ç©ºæ¥å£ã€‚å½“ä¸€ä¸ªå‡½æ•°çš„å½¢å‚æ˜¯ interface&#123;&#125;ï¼Œé‚£ä¹ˆåœ¨å‡½æ•°ä¸­ï¼Œéœ€è¦å¯¹å½¢å‚è¿›è¡Œæ–­è¨€ï¼Œä»è€Œå¾—åˆ°å®ƒçš„çœŸå®ç±»å‹ã€‚ &lt;ç›®æ ‡ç±»å‹çš„å€¼&gt; :&#x3D; &lt;è¡¨è¾¾å¼&gt;.( ç›®æ ‡ç±»å‹ ) &#x2F;&#x2F;éå®‰å…¨ç±»å‹æ–­è¨€ type Duck struct &#123; age int&#125;func main() &#123; var d interface&#123;&#125; = new(Duck) s := d.(Duck) fmt.Println(s)&#125;//run main.go//panic: &quot;interface conversion: interface &#123;&#125; is *main.Duck, not main.Duck&quot; &lt;ç›®æ ‡ç±»å‹çš„å€¼&gt;ï¼Œ&lt;å¸ƒå°”å‚æ•°&gt; :&#x3D; &lt;è¡¨è¾¾å¼&gt;.( ç›®æ ‡ç±»å‹ ) &#x2F;&#x2F; comma-okæ–­è¨€,å®‰å…¨ç±»å‹æ–­è¨€ type Duck struct &#123; age int&#125;func main() &#123; var d interface&#123;&#125; = new(Duck) s, ok := d.(Duck) if ok &#123; fmt.Println(s) &#125; fmt.Printf(&quot;d type is %T&quot;, d)&#125;//run main.go//d type is *main.Duck å°½é‡ä½¿ç”¨comma-okæ–­è¨€ï¼Œå³ä½¿æ–­è¨€å¤±è´¥ä¹Ÿä¸ä¼španicã€‚ æ–­è¨€å…¶å®ä¹Ÿå¯ä»¥ä½¿ç”¨ switch è¯­å¥åˆ¤æ–­æ¥å£çš„ç±»å‹ï¼Œæ¯ä¸€ä¸ª case ä¼šè¢«é¡ºåºåœ°è€ƒè™‘ã€‚å½“å‘½ä¸­ä¸€ä¸ª case æ—¶ï¼Œå°±ä¼šæ‰§è¡Œ case ä¸­çš„è¯­å¥ï¼Œå› æ­¤ case è¯­å¥çš„é¡ºåºæ˜¯å¾ˆé‡è¦çš„ï¼Œå› ä¸ºå¾ˆæœ‰å¯èƒ½ä¼šæœ‰å¤šä¸ª case åŒ¹é…çš„æƒ…å†µã€‚ switch m := m.(type) &#123; case nil: case Duck: case *Duck: default:&#125;","categories":[{"name":"Golang","slug":"Golang","permalink":"https://blog.eganx.cn/categories/Golang/"}],"tags":[{"name":"go","slug":"go","permalink":"https://blog.eganx.cn/tags/go/"},{"name":"interface","slug":"interface","permalink":"https://blog.eganx.cn/tags/interface/"}]},{"title":"Go Interfaceç†è§£(1)","slug":"Go_Interface_1","date":"2022-10-29T11:23:19.000Z","updated":"2022-11-22T06:10:18.113Z","comments":true,"path":"2022/10/29/Go_Interface_1/","link":"","permalink":"https://blog.eganx.cn/2022/10/29/Go_Interface_1/","excerpt":"Goè¯­è¨€ä¸­ï¼Œæ¥å£æ˜¯ä¸éœ€è¦åƒä¼ ç»Ÿçš„é™æ€ç¼–ç¨‹è¯­è¨€ä¸€æ ·è¿›è¡Œå£°æ˜åæ‰èƒ½ä½¿ç”¨ã€‚å®ƒå¼•ç”¨äº†åŠ¨æ€è¯­è¨€çš„æ¥å£ä½¿ç”¨æ–¹å¼ï¼Œåªéœ€è¦å®ç°æ¥å£è¦æ±‚çš„ç›¸å…³æ–¹æ³•å°±è¡Œï¼ŒåŒæ—¶è¿˜ä¼šåœ¨ç¼–è¯‘é˜¶æ®µè¿›è¡Œç±»å‹åŒ¹é…ï¼Œä¸ªäººè§‰å¾—éå¸¸å¥½ç”¨ã€‚","text":"Goè¯­è¨€ä¸­ï¼Œæ¥å£æ˜¯ä¸éœ€è¦åƒä¼ ç»Ÿçš„é™æ€ç¼–ç¨‹è¯­è¨€ä¸€æ ·è¿›è¡Œå£°æ˜åæ‰èƒ½ä½¿ç”¨ã€‚å®ƒå¼•ç”¨äº†åŠ¨æ€è¯­è¨€çš„æ¥å£ä½¿ç”¨æ–¹å¼ï¼Œåªéœ€è¦å®ç°æ¥å£è¦æ±‚çš„ç›¸å…³æ–¹æ³•å°±è¡Œï¼ŒåŒæ—¶è¿˜ä¼šåœ¨ç¼–è¯‘é˜¶æ®µè¿›è¡Œç±»å‹åŒ¹é…ï¼Œä¸ªäººè§‰å¾—éå¸¸å¥½ç”¨ã€‚ 0x0.Interface &amp; Duck Typingæ‰€è°“Goè¯­è¨€å¼çš„æ¥å£ï¼Œå°±æ˜¯ä¸ç”¨æ˜¾ç¤ºå£°æ˜ç±»å‹Tå®ç°äº†æ¥å£Iï¼Œåªè¦ç±»å‹Tçš„å…¬å¼€æ–¹æ³•å®Œå…¨æ»¡è¶³æ¥å£Içš„è¦æ±‚ï¼Œå°±å¯ä»¥æŠŠç±»å‹Tçš„å¯¹è±¡ç”¨åœ¨éœ€è¦æ¥å£Içš„åœ°æ–¹ã€‚è¿™ç§åšæ³•çš„å­¦åå«åšStructural Typingï¼Œä¹Ÿæœ‰äººç§°å®ƒä¸ºä¸€ç§é™æ€çš„Duck Typingã€‚ Duck Typingä¸€èˆ¬å¸¸è§äºåŠ¨æ€è¯­è¨€ä¸­ï¼ˆæ¯”å¦‚pythonï¼‰ï¼Œä½†æ˜¯åŠ¨æ€è¯­è¨€ä¸ä¼šåœ¨ç¼–è¯‘é˜¶æ®µå»è¿›è¡Œç±»å‹åŒ¹é…ï¼Œåªæœ‰åœ¨è¿è¡Œåˆ°å½“å‰è¡Œä»£ç çš„æ—¶å€™æ‰ä¼šæŠ¥é”™ã€‚è€Œä¼ ç»Ÿçš„é™æ€è¯­è¨€ï¼ˆæ¯”å¦‚Javaï¼‰ï¼Œå¿…é¡»æ˜¾ç¤ºåœ°å»å£°æ˜å®ç°äº†æŸä¸ªæ¥å£ï¼Œç„¶åæ‰å¯ä»¥å»ä½¿ç”¨ã€‚è¿™è·ŸåŠ¨æ€è¯­è¨€é™æ€è¯­è¨€çš„è®¨è®ºç±»ä¼¼ï¼Œå¯ä»¥è®¨è®ºä¼˜ç¼ºç‚¹ï¼Œä½†æ˜¯ä¸èƒ½ä»¥å¥½åå»ä¸‹ç»“è®ºã€‚ Goè¯­è¨€æœ¬èº«ä½œä¸ºä¸€ç§é™æ€è¯­è¨€ï¼Œé™æ€è¯­è¨€çš„ç±»å‹æ£€æŸ¥æ˜¯è‚¯å®šæœ‰çš„ã€‚ä½†æ˜¯åœ¨æ¥å£çš„ä½¿ç”¨ä¸Šï¼Œå¼•ç”¨äº†åŠ¨æ€è¯­è¨€çš„æ¥å£ä½¿ç”¨æ–¹å¼ã€‚å³ä¸è¦æ±‚ç±»å‹æ˜¾ç¤ºåœ°å»å£°æ˜å®ç°äº†æŸä¸ªæ¥å£ï¼Œåªéœ€è¦å®ç°æ¥å£è¦æ±‚çš„ç›¸å…³æ–¹æ³•å°±è¡Œï¼Œç¼–è¯‘é˜¶æ®µä¼šå»è¿›è¡Œç±»å‹æ£€æŸ¥ã€‚å¦‚æœæ²¡æœ‰å®ç°ç›¸å…³æ–¹æ³•ï¼Œç¼–è¯‘æ˜¯ä¼šæŠ¥é”™çš„ã€‚ ä¸¾ä¸ªğŸŒ°ï¼š type IDuck interface &#123; gaga() swimming()&#125;type Duck struct&#123;&#125;func (d Duck) gaga() &#123; fmt.Println(&quot;Duck gaga&quot;)&#125;func (d *Duck) swimming() &#123; fmt.Println(&quot;Duck swimming&quot;)&#125;func main() &#123; var _ IDuck = (*Duck)(nil)&#125; var _ IDuck = (*Duck)(nil) //è¿™ä¸ªå¾ˆå®ç”¨ï¼Œç¼–è¯‘å™¨ä¼šç”±æ­¤æ£€æŸ¥ *Duckç±»å‹æ˜¯å¦å®ç°äº† IDuck æ¥å£ã€‚ ä»¥ä¸Šçš„ä»£ç ç¼–è¯‘å¯ä»¥é€šè¿‡ï¼Œè¡¨ç¤ºAå®ç°äº†Duckæ¥å£ï¼Œé‚£ä¹ˆAå°±æ˜¯ä¸€åªé¸­å­ğŸ¦†ã€‚ ä½†æ˜¯å½“æ³¨é‡Šäº†Açš„æ¸¸æ³³æ–¹æ³•æ—¶ï¼Œå°±ä¼šå‡ºç°ç¼–è¯‘å™¨ä¼šç›´æ¥çˆ†å‡ºä»¥ä¸‹é”™è¯¯ï¼Œè¡¨ç¤ºAå¹¶æ²¡æœ‰å®Œå…¨å®ç°Duckæ¥å£ï¼ŒAä¸æ˜¯ä¸€åªé¸­å­ğŸ¦†ã€‚ // func (d *Duck) swimming() &#123;// fmt.Println(&quot;Duck swimming&quot;)// &#125;func main() &#123; var _ IDuck = (*Duck)(nil) //ç¼–è¯‘æŠ¥é”™ï¼šcannot use (*A)(nil) (value of type *A) as Duck value in variable declaration: *A does not implement Duck (missing method swimming) compiler(InvalidIfaceAssign)&#125; 0x1.æ–¹æ³•æ¥å£æ–¹æ³•æ–¹ä¾¿æ¥å£æ·»åŠ æ–°çš„è¡Œä¸ºã€‚æ–¹æ³•æœ‰æ¥æ”¶è€…ï¼Œå½“æ²¡æœ‰äº†æ¥æ”¶è€…ï¼Œæ–¹æ³•å°±å˜æˆäº†å‡½æ•°ã€‚æ¥æ”¶è€…æœ‰ä¸¤ç§ç±»å‹ï¼Œä¸€ç§æ˜¯å€¼æ¥æ”¶è€…ï¼Œå¦ä¸€ç§æ˜¯æŒ‡é’ˆæ¥æ”¶è€…ã€‚ æ–¹æ³•çš„è°ƒç”¨è€…ä¸å¿…æ»¡è¶³æ¥æ”¶è€…ç±»å‹ã€‚æ¢å¥è¯è¯´ï¼Œæ— è®ºæ–¹æ³•çš„æ¥æ”¶è€…æ˜¯ä»€ä¹ˆç±»å‹ï¼Œè¯¥ç±»å‹çš„å€¼å’ŒæŒ‡é’ˆéƒ½å¯ä»¥è°ƒç”¨ã€‚ func main() &#123; var _ IDuck = (*Duck)(nil) d := Duck&#123;&#125; //d := &amp;Duck&#123;&#125; ä¹Ÿæ˜¯å¯ä»¥çš„ d.gaga() d.swimming()&#125; å½“æ–¹æ³•çš„æ¥æ”¶è€…æ˜¯å€¼ç±»å‹çš„æ—¶å€™ï¼Œæ— è®ºè°ƒç”¨è€…æ˜¯å€¼ç±»å‹è¿˜æ˜¯æŒ‡é’ˆç±»å‹ï¼Œè¯¥æ–¹æ³•æ“ä½œçš„éƒ½æ˜¯å¯¹åº”æ¥æ”¶è€…çš„å€¼çš„å‰¯æœ¬ã€‚å³ä½¿ä½ ç”¨æŒ‡é’ˆç±»å‹å»è°ƒç”¨ï¼Œæ–¹æ³•å†…éƒ¨æ“ä½œè¿˜æ˜¯å¯¹å‰¯æœ¬çš„æ“ä½œï¼Œè€Œä¸æ˜¯æŒ‡é’ˆæ“ä½œã€‚åŒç†ï¼Œå½“æ¥æ”¶è€…æ˜¯æŒ‡é’ˆæ—¶ï¼Œå³ä½¿ç”¨å€¼ç±»å‹è°ƒç”¨ï¼Œæ–¹æ³•å†…éƒ¨ä¹Ÿæ˜¯å¯¹æŒ‡é’ˆçš„æ“ä½œï¼Œä¿®æ”¹çš„æ˜¯å€¼æŒ‡é’ˆæŒ‡å‘çš„å€¼æœ¬èº«ã€‚ 0x2.æ¥å£å®ç°type IDuck interface &#123; gaga() swimming()&#125;type Duck struct&#123;&#125;func (d Duck) gaga() &#123; fmt.Println(&quot;A gaga&quot;)&#125;func (d *Duck) swimming() &#123; fmt.Println(&quot;A swimming&quot;)&#125;func main() &#123; d := &amp;Duck&#123;&#125; dd := Duck&#123;&#125; var _ IDuck = (*Duck)(d) //OK var _ IDuck = (Duck)(dd) //ç¼–è¯‘æŠ¥é”™ï¼šcannot use (Duck)(dd) (value of type Duck) as IDuck value in variable declaration: Duck does not implement IDuck (method swimming has pointer receiver)compilerInvalidIfaceAssign&#125; ç¼–è¯‘å™¨ä¸è€ƒè™‘æˆ‘ä»¬çš„å€¼æ˜¯å®ç°è¯¥æ¥å£çš„ç±»å‹ï¼Œæ¥å£çš„è°ƒç”¨è§„åˆ™æ˜¯å»ºç«‹åœ¨è¿™äº›æ–¹æ³•çš„æ¥å—è€…å’Œæ¥å£å¦‚ä½•è¢«è°ƒç”¨çš„åŸºç¡€ä¸Šã€‚ä¸‹é¢çš„æ˜¯è¯­è¨€è§„èŒƒé‡Œå®šä¹‰çš„è§„åˆ™ï¼Œè¿™äº›è§„åˆ™ç”¨æ¥è¯´æ˜æ˜¯å¦æˆ‘ä»¬ä¸€ä¸ªç±»å‹çš„å€¼æˆ–è€…æŒ‡é’ˆè¯¥æ¥å£ï¼š æ¥æ”¶è€…æ˜¯æŒ‡é’ˆ *T æ—¶ï¼Œæ¥å£çš„å®ä¾‹å¿…é¡»æ˜¯æŒ‡é’ˆ æ¥æ”¶è€…æ˜¯å€¼ T æ—¶ï¼Œæ¥å£çš„å®ä¾‹å¯ä»¥æ˜¯æŒ‡é’ˆä¹Ÿå¯ä»¥æ˜¯å€¼ ä¹Ÿå°±æ˜¯è¯´ï¼šå®ç°äº†æ¥æ”¶è€…æ˜¯å€¼ç±»å‹çš„æ–¹æ³•ï¼Œç›¸å½“äºè‡ªåŠ¨å®ç°äº†æ¥æ”¶è€…æ˜¯æŒ‡é’ˆç±»å‹çš„æ–¹æ³•ï¼›è€Œå®ç°äº†æ¥æ”¶è€…æ˜¯æŒ‡é’ˆç±»å‹çš„æ–¹æ³•ï¼Œä¸ä¼šè‡ªåŠ¨ç”Ÿæˆå¯¹åº”æ¥æ”¶è€…æ˜¯å€¼ç±»å‹çš„æ–¹æ³•ã€‚ Q&amp;Aï¼šæ—¢ç„¶å®ç°æ¥æ”¶è€…æ˜¯å€¼ç±»å‹çš„æ–¹æ³•æ—¶ï¼Œä¼šè‡ªåŠ¨å®ç°æ¥æ”¶è€…æ˜¯æŒ‡é’ˆç±»å‹çš„æ–¹æ³•ï¼Œé‚£ä¹ˆä¸ºå•¥è¦ç”¨æŒ‡é’ˆç±»å‹å»åšæ¥æ”¶è€…ï¼Ÿä»€ä¹ˆæ—¶å€™ä¼šå»ä½¿ç”¨æŒ‡é’ˆä½œä¸ºæ–¹æ³•çš„æ¥æ”¶è€…ï¼Ÿ æ–¹æ³•çš„æ¥æ”¶è€…æ˜¯å€¼ç±»å‹çš„æ—¶å€™ï¼Œä¿®æ”¹çš„æ°¸è¿œæ˜¯å¯¹è±¡çš„å‰¯æœ¬ï¼Œä¸ä¼šå¯¹è°ƒç”¨è€…æœ‰å½±å“ã€‚ä½†æ˜¯æ¥æ”¶è€…æ˜¯æŒ‡é’ˆçš„æ—¶å€™ï¼Œåœ¨æ–¹æ³•é‡Œä¿®æ”¹ï¼Œå°±æ˜¯ä¿®æ”¹äº†æŒ‡é’ˆæŒ‡å‘çš„å¯¹è±¡æœ¬èº«ã€‚å½“ç±»å‹æ˜¯å¤§å‹çš„ç»“æ„ä½“æˆ–è€…ä¸èƒ½è¢«å®‰å…¨çš„å¤åˆ¶æ—¶ï¼Œå°±å®šä¹‰æŒ‡é’ˆæ¥æ”¶è€…æ–¹æ³•ï¼Œä¾‹å¦‚æ–‡ä»¶ç»“æ„ä½“ï¼ˆstruct Fileï¼‰ã€‚","categories":[{"name":"Golang","slug":"Golang","permalink":"https://blog.eganx.cn/categories/Golang/"}],"tags":[{"name":"go","slug":"go","permalink":"https://blog.eganx.cn/tags/go/"},{"name":"interface","slug":"interface","permalink":"https://blog.eganx.cn/tags/interface/"}]},{"title":"Go Mapçš„éå†","slug":"Go_Map_Range","date":"2022-10-26T13:33:01.000Z","updated":"2022-11-20T04:33:57.713Z","comments":true,"path":"2022/10/26/Go_Map_Range/","link":"","permalink":"https://blog.eganx.cn/2022/10/26/Go_Map_Range/","excerpt":"Mapçš„éå†è¿‡ç¨‹æ˜¯ä¾¿åˆ©æ‰€æœ‰çš„bucket(ä¸€èˆ¬ç§°ä¹‹ä¸ºæ¡¶)ä»¥åŠæŒ‚è½½çš„overflow bucketï¼Œç„¶åé€ä¸€éå†bucketçš„æ‰€æœ‰cellï¼Œä»æœ‰keyçš„cellä¸­å–å‡ºkeyå’Œvalueï¼Œéå†å®Œæˆã€‚å®é™…åœ¨éå†çš„æ—¶å€™ï¼Œæœ‰å¯èƒ½mapå¤„äºæ‰©å®¹è¿‡ç¨‹ä¸­,è¿™æ—¶å€™mapçš„çŠ¶æ€å°±ç›¸å½“äºæ˜¯å¤„äºä¸€ä¸ªä¸­é—´æ€ï¼Œå³æœ‰äº›bucketå·²ç»è¿ç§»ï¼Œæœ‰äº›bucketè¿˜åœ¨åŸæ¥çš„ä½ç½®ã€‚ä¹Ÿå°±æ˜¯è¯´éå†å¦‚æœå‘ç”Ÿåœ¨æ‰©å®¹çš„è¿‡ç¨‹ä¸­ï¼Œå°±ä¼šæ¶‰åŠåˆ°éå†æ–°è€ bucket çš„è¿‡ç¨‹ï¼Œå°±æ¯”è¾ƒéº»çƒ¦ã€‚","text":"Mapçš„éå†è¿‡ç¨‹æ˜¯ä¾¿åˆ©æ‰€æœ‰çš„bucket(ä¸€èˆ¬ç§°ä¹‹ä¸ºæ¡¶)ä»¥åŠæŒ‚è½½çš„overflow bucketï¼Œç„¶åé€ä¸€éå†bucketçš„æ‰€æœ‰cellï¼Œä»æœ‰keyçš„cellä¸­å–å‡ºkeyå’Œvalueï¼Œéå†å®Œæˆã€‚å®é™…åœ¨éå†çš„æ—¶å€™ï¼Œæœ‰å¯èƒ½mapå¤„äºæ‰©å®¹è¿‡ç¨‹ä¸­,è¿™æ—¶å€™mapçš„çŠ¶æ€å°±ç›¸å½“äºæ˜¯å¤„äºä¸€ä¸ªä¸­é—´æ€ï¼Œå³æœ‰äº›bucketå·²ç»è¿ç§»ï¼Œæœ‰äº›bucketè¿˜åœ¨åŸæ¥çš„ä½ç½®ã€‚ä¹Ÿå°±æ˜¯è¯´éå†å¦‚æœå‘ç”Ÿåœ¨æ‰©å®¹çš„è¿‡ç¨‹ä¸­ï¼Œå°±ä¼šæ¶‰åŠåˆ°éå†æ–°è€ bucket çš„è¿‡ç¨‹ï¼Œå°±æ¯”è¾ƒéº»çƒ¦ã€‚ 0x0.Mapéå†æ˜¯æ— åºçš„åœ¨éå†mapçš„æ—¶å€™ï¼Œå¯ä»¥å‘ç°keyæ˜¯æ— åºçš„ã€‚æ­£å¸¸æ¥è¯´ä»ä¸€ä¸ªå›ºå®šMapçš„ç¬¬ä¸€ä¸ªbucketçš„ç¬¬ä¸€ä¸ªcellé€æ­¥éå†å–å‡ºkeyçš„è¯ï¼Œkeyåº”è¯¥æ˜¯æœ‰åºçš„ã€‚å› ä¸ºæ‰©å®¹ä¼šå¸¦æ¥æŸäº›keyçš„bucketæˆ–è€…cellå‘ç”Ÿå˜åŒ–ï¼ŒGoä¸ºäº†é¿å…æˆ‘ä»¬è¯¯è®¤ä¸ºéå†mapä¼šå¾—åˆ°æœ‰åºkeyï¼Œåœ¨éå†å¼€å§‹çš„æ—¶å€™ï¼Œä¸æ˜¯ä»0å·bucketå¼€å§‹ï¼Œè€Œæ˜¯ä¼šç»™ä¸€ä¸ªéšæœºæ•°ï¼Œä»ä¸€ä¸ªéšæœºçš„bucketå¼€å§‹ï¼Œæ›´ç»çš„æ˜¯åœ¨å¼€å§‹bucketä¸­çš„å¼€å§‹cellä¹Ÿæ˜¯éšæœºé€‰æ‹©çš„ã€‚è¿™æ ·çš„è¯ï¼Œå°±ç®—æ˜¯ä¸€ä¸ªå†™æ­»çš„mapåœ¨éå†çš„æ—¶å€™ä¾æ—§ä¸ä¼šè¿”å›ä¸€ä¸ªå›ºå®šåºåˆ—çš„keyé›†åˆã€‚ // decide where to start r := uintptr(fastrand()) if h.B &gt; 31-bucketCntBits &#123; r += uintptr(fastrand()) &lt;&lt; 31 &#125; // start bucket it.startBucket = r &amp; bucketMask(h.B) // start cell it.offset = uint8(r &gt;&gt; h.B &amp; (bucketCnt - 1)) 0x1.éå†è¿‡ç¨‹å‡å¦‚æœ‰ä¸€ä¸ªèµ·å§‹B=1çš„mapï¼ˆæœ‰0å·å’Œ1å·ä¸¤ä¸ªbucketï¼‰ï¼Œç°åœ¨è§¦å‘æ‰©å®¹ï¼ŒBå˜æˆäº†2ï¼ˆæœ‰0-3å·4ä¸ªbucketï¼‰ã€‚å‡è®¾ç°åœ¨è€0å·bucketå·²ç»è¿ç§»åˆ°æ–°0å·å’Œæ–°2å·bucketä¸­ï¼Œè€1å·ä¸­çš„bucketå°šæœªå¼€å§‹è¿ç§»ã€‚æ­¤æ—¶å¼€å§‹å¯¹mapçš„éå†ï¼Œå‡è®¾startBucket = 2,offset = 4ï¼Œéå†çš„èµ·ç‚¹å°±æ˜¯2å·bucketä¸­ç¬¬4ä¸ªcellã€‚bucketçš„éå†é¡ºåºå°±æ˜¯ï¼š2-&gt;3-&gt;0-&gt;1ã€‚ 2å·bucketå¯¹åº”çš„æ˜¯è€0å·bucketï¼Œæ£€æŸ¥è€0å·bucketçš„è¿ç§»çŠ¶æ€ï¼Œå‘ç°å®Œæˆå·²ç»å®Œæˆè¿ç§»ï¼Œä»4å·cellä¾æ¬¡éå†2å·bucketä¸­æ‰€æœ‰cellã€‚å¦‚æœ2å·bucketè¿”å›çš„keyæ˜¯éç©ºçš„ï¼Œå°±ä¼šç»§ç»­éå†2å·bucketçš„overflow bucketã€‚ å®Œæˆ2å·bucketçš„éå†åï¼Œå¼€å§‹3å·bucketçš„éå†ï¼Œæ£€æŸ¥åå‘ç°3å·bucketå¯¹åº”çš„è€1å·bucketå¹¶æ²¡æœ‰è¿ç§»ï¼Œè¿™ä¸ªæ—¶å€™å°±ä¼šå»éå†è€1å·bucketã€‚ä½†æ˜¯å¹¶ä¸ä¼šå–å‡ºè€1å·bucketçš„å…¨éƒ¨keyï¼Œåªä¼šå–å‡ºhashå€¼åä¸¤ä½ä¸º11çš„keyï¼Œå› ä¸ºè¿™äº›keyæœ€ç»ˆä¼šè¿ç§»è¿›æ–°3å·bucketã€‚ å®Œæˆ3å·bucketçš„éå†ï¼Œç»§ç»­0å·bucketçš„éå†ï¼Œå·²è¿ç§»ï¼Œå–å‡ºæ–°0å·bucketä¸­çš„keyã€‚ ç»§ç»­1å·bucketçš„éå†ï¼Œæœªè¿ç§»ï¼Œéå†è€1å·bucketï¼Œå–å‡ºhashå€¼åä¸¤ä½ä¸º01çš„keyã€‚ å†æ¬¡åˆ°2å·bucketçš„æ—¶å€™ï¼Œè¡¨ç¤ºæ‰€æœ‰bucketéå†å®Œæˆï¼Œmapçš„éå†ä¹Ÿå°±ç»“æŸäº†ã€‚","categories":[{"name":"Golang","slug":"Golang","permalink":"https://blog.eganx.cn/categories/Golang/"}],"tags":[{"name":"go","slug":"go","permalink":"https://blog.eganx.cn/tags/go/"},{"name":"map","slug":"map","permalink":"https://blog.eganx.cn/tags/map/"}]},{"title":"Go Mapçš„æ‰©å®¹","slug":"Go_Map_Grow","date":"2022-10-24T07:53:19.000Z","updated":"2022-11-20T04:33:16.832Z","comments":true,"path":"2022/10/24/Go_Map_Grow/","link":"","permalink":"https://blog.eganx.cn/2022/10/24/Go_Map_Grow/","excerpt":"åœ¨ä½¿ç”¨sliceçš„æ—¶å€™ï¼Œå¦‚æœå‘sliceä¸­è¿½åŠ å…ƒç´ çš„æ—¶å€™ï¼Œå¯¼è‡´å…ƒç´ æ•°é‡å¤§äºcapï¼Œè¿™æ—¶å€™å°±ä¼šå‘ç”Ÿsliceçš„æ‰©å®¹ã€‚é‚£ä¹ˆåœ¨goè¯­è¨€ä¸­ï¼Œä»€ä¹ˆæ—¶å€™mapä¼šå‘ç”Ÿæ‰©å®¹å‘¢ï¼Ÿæ‰©å®¹çš„ç­–ç•¥æœ‰å“ªäº›å‘¢ï¼Ÿæ‰©å®¹çš„è¿‡ç¨‹æ˜¯æ€æ ·çš„å‘¢ï¼Ÿå¾ˆæ˜¯å¥½å¥‡ï¼Œå¿ƒåŠ¨ä¸å¦‚è¡ŒåŠ¨ã€‚å¼€å§‹å­¦ä¹ ï¼Œåˆæ˜¯æ”¶è·æ»¡æ»¡çš„ä¸€å¤©ã€‚","text":"åœ¨ä½¿ç”¨sliceçš„æ—¶å€™ï¼Œå¦‚æœå‘sliceä¸­è¿½åŠ å…ƒç´ çš„æ—¶å€™ï¼Œå¯¼è‡´å…ƒç´ æ•°é‡å¤§äºcapï¼Œè¿™æ—¶å€™å°±ä¼šå‘ç”Ÿsliceçš„æ‰©å®¹ã€‚é‚£ä¹ˆåœ¨goè¯­è¨€ä¸­ï¼Œä»€ä¹ˆæ—¶å€™mapä¼šå‘ç”Ÿæ‰©å®¹å‘¢ï¼Ÿæ‰©å®¹çš„ç­–ç•¥æœ‰å“ªäº›å‘¢ï¼Ÿæ‰©å®¹çš„è¿‡ç¨‹æ˜¯æ€æ ·çš„å‘¢ï¼Ÿå¾ˆæ˜¯å¥½å¥‡ï¼Œå¿ƒåŠ¨ä¸å¦‚è¡ŒåŠ¨ã€‚å¼€å§‹å­¦ä¹ ï¼Œåˆæ˜¯æ”¶è·æ»¡æ»¡çš„ä¸€å¤©ã€‚ 0x0.è§¦å‘æ‰©å®¹çš„æ¡ä»¶ä¼—æ‰€å‘¨çŸ¥ï¼Œmapæ˜¯ä½¿ç”¨hashè¡¨çš„ã€‚ä½¿ç”¨hashè¡¨çš„ç›®çš„å°±æ˜¯è¿½æ±‚æ›´åŠ å¿«é€Ÿçš„æ‰¾åˆ°keyï¼Œä½†æ˜¯å½“mapä¸­keyçš„æ•°é‡é€æ¸å¢åŠ ï¼Œé€æ¸ç¦»è°±çš„æ—¶å€™ï¼Œé‚£ä¹ˆç¢°æ’çš„å‡ ç‡å°±è¶Šæ¥è¶Šå¤§ï¼Œæ•ˆç‡ä¹Ÿå°±éšä¹‹ä¸‹é™äº†ã€‚æœ€ç¦»è°±çš„æ—¶å€™å°±æ˜¯æ‰€æœ‰çš„keyéƒ½åœ¨ä¸€ä¸ªbucketé‡Œé¢ (è¿™æ˜¯ç¢³åŸºç”Ÿç‰©èƒ½å¹²å‡ºæ¥çš„äº‹?è¿™å’Œé“¾è¡¨æœ‰ä¸ªé”¤å­çš„åŒºåˆ«å—ï¼Ÿ)ï¼Œæœ€å¥½å°±æ˜¯ä¸€ä¸ªbucketé‡Œé¢å°±ä¸€ä¸ªkeyï¼Œæ‰¾åˆ°äº†bucketå°±æ‰¾åˆ°äº†keyï¼Œæ•ˆç‡è´¼é«˜ï¼Œç›´æ¥æ‹‰åˆ°o(1)ã€‚ä½†æ˜¯ç©ºé—´ä¸å…è®¸å•Šï¼Œä¸ºäº†æ•ˆç‡ç”¨ç©ºé—´æ¢æ—¶é—´ä¸å¯’ç¢œï¼Ÿ(å¾ˆå¯’ç¢œï¼Œè´¼TMå¯’ç¢œ)ã€‚ æœ€å¥½æœ€åéƒ½å±äºæç«¯ï¼Œå…¶å®éƒ½å¾ˆéš¾é‡åˆ°ï¼Œåªæ˜¯åœ¨ä¸¾ğŸŒ°çš„æ—¶å€™å¤¸å¼ è¡¨è¿°æ‰ä¼šç”¨åˆ°ã€‚åœ¨goè¯­è¨€ä¸­ï¼Œæœ‰ä¸€ä¸ªloadFactoræŒ‡æ ‡æ¥å¯¹ä¸Šé¢çš„ä¸¤ç§æƒ…å†µè¿›è¡Œè¡¡é‡ã€‚åºŸè¯ä¸å¤šè¯´ï¼Œç›´æ¥ä¸Šæºç (/go1.18.2/src/runtime/map.go) // åˆ¤æ–­æ¡ä»¶åœ¨mapassignå‡½æ•°ä¸­ã€‚// If we hit the max load factor or we have too many overflow buckets,// and we&#x27;re not already in the middle of growing, start growing.if !h.growing() &amp;&amp; (overLoadFactor(h.count+1, h.B) || tooManyOverflowBuckets(h.noverflow, h.B)) &#123; hashGrow(t, h) goto again // Growing the table invalidates everything, so try again&#125; ä»ä¸Šé¢çš„æ¡ä»¶å¯ä»¥çœ‹å‡ºï¼Œmapæ‰©å®¹ä¸€ä¸ªæ˜¯åœ¨overLoadFactorçš„æ—¶å€™ï¼Œä¸€ä¸ªæ˜¯åœ¨tooManyOverflowBucketsã€‚ä¸‹é¢æ˜¯è¿™ä¸¤ä¸ªå‡½æ•°æ‰€ç”¨åˆ°çš„å¸¸é‡ä»¥åŠä¸»è¦çš„å¼•ç”¨å‡½æ•°ã€‚ const (// Maximum number of key/elem pairs a bucket can hold. bucketCntBits = 3 bucketCnt = 1 &lt;&lt; bucketCntBits //8 // Maximum average load of a bucket that triggers growth is 6.5. // Represent as loadFactorNum/loadFactorDen, to allow integer math. loadFactorNum = 13 loadFactorDen = 2)// PtrSize is the size of a pointer in bytes - unsafe.Sizeof(uintptr(0)) but as an ideal constant.// It is also the size of the machine&#x27;s native word size (that is, 4 on 32-bit systems, 8 on 64-bit).const PtrSize = 4 &lt;&lt; (^uintptr(0) &gt;&gt; 63)// bucketShift returns 1&lt;&lt;b, optimized for code generation.func bucketShift(b uint8) uintptr &#123; // Masking the shift amount allows overflow checks to be elided. return uintptr(1) &lt;&lt; (b &amp; (goarch.PtrSize*8 - 1))&#125;// overLoadFactor reports whether count items placed in 1&lt;&lt;B buckets is over loadFactor.func overLoadFactor(count int, B uint8) bool &#123; return count &gt; bucketCnt &amp;&amp; uintptr(count) &gt; loadFactorNum*(bucketShift(B)/loadFactorDen)&#125;// tooManyOverflowBuckets reports whether noverflow buckets is too many for a map with 1&lt;&lt;B buckets.// Note that most of these overflow buckets must be in sparse use;// if use was dense, then we&#x27;d have already triggered regular map growth.func tooManyOverflowBuckets(noverflow uint16, B uint8) bool &#123; // If the threshold is too low, we do extraneous work. // If the threshold is too high, maps that grow and shrink can hold on to lots of unused memory. // &quot;too many&quot; means (approximately) as many overflow buckets as regular buckets. // See incrnoverflow for more details. if B &gt; 15 &#123; B = 15 &#125; // The compiler doesn&#x27;t see here that B &lt; 16; mask B to generate shorter shift code. return noverflow &gt;= uint16(1)&lt;&lt;(B&amp;15)&#125; 1ï¼‰ç¬¬ä¸€ç§æƒ…å†µ// overLoadFactor reports whether count items placed in 1&lt;&lt;B buckets is over loadFactor.func overLoadFactor(count int, B uint8) bool &#123; // æ¢ç®—ä¸€ä¸‹ä¸‹: count &gt; 8 &amp;&amp; count &gt; 13*((2^B)/2) // loadFactor = count/(2^B) &gt; 6.5 return count &gt; bucketCnt &amp;&amp; uintptr(count) &gt; loadFactorNum*(bucketShift(B)/loadFactorDen)&#125; å…¶ä¸­countæ˜¯mapçš„å…ƒç´ ä¸ªæ•°ï¼Œ1&lt;&lt;Bè¡¨ç¤ºbucketæ•°ç»„é•¿åº¦ã€‚ä¹Ÿå°±æ˜¯è¯´åœ¨loadFactor := count/(2^B)è¶…è¿‡6.5çš„æ—¶å€™ï¼Œä¼šè§¦å‘mapçš„æ‰©å®¹ã€‚æŒ‰ç…§loadFactorçš„è®¡ç®—æ–¹å¼ï¼Œå½“æ‰€æœ‰bucketéƒ½æ»¡çš„æ—¶å€™æ˜¯8ã€‚è¾¾åˆ°6.5çš„æ—¶å€™ä¹Ÿå°±å·®ä¸å¤šç®—æ˜¯æ»¡äº†å¤§åŠäº†ï¼Œæ— è®ºæŸ¥æ‰¾è¿˜æ˜¯æ’å…¥ï¼Œè¿™ä¸ªæ—¶å€™ç¢°æ’çš„å‡ ç‡å¾ˆé«˜ï¼Œæ•ˆç‡ä¹Ÿä¼šä¸‹é™çš„å‰å®³ï¼Œæ‰€ä»¥è¿™æ˜¯è§¦å‘æ‰©å®¹çš„æ—¶æœºã€‚ å¦‚æœä¸åœçš„æ’å…¥å…ƒç´ ã€åˆ é™¤å…ƒç´ ï¼Œç„¶ååœ¨æ’å…¥å…ƒç´ ã€‚åˆšå¼€å§‹æ’å…¥å…ƒç´ çš„æ—¶å€™ä¼šåˆ›å»ºå¤§é‡bucketã€‚ä½†æ˜¯åªè¦æ²¡æœ‰è¾¾åˆ°ç¬¬ä¸€ç§æ‰©å®¹æƒ…å†µï¼Œä¹Ÿå°±æ˜¯è¯´loadFactorçš„å€¼ä½äº6.5ã€‚è¿™ä¸ªæ—¶å€™è¿›è¡Œåˆ é™¤å…ƒç´ çš„æ“ä½œï¼Œé™ä½loadFactorçš„åˆ†å­ã€‚ç„¶åé‡å¤æ“ä½œï¼Œå°±ä¼šäº§ç”Ÿå¤§é‡overflow bucketã€‚è¿™ä¸ªæ—¶å€™keyå°±ä¼šè¿‡äºåˆ†æ•£ï¼Œå¯¼è‡´æŸ¥æ‰¾å’Œæ’å…¥çš„æ•ˆç‡è¿‡ä½ã€‚ä¸ºäº†é¿å…è¿™ç§æƒ…å†µçš„å‘ç”Ÿï¼Œå°±æœ‰äº†ä¸‹é¢ç¬¬äºŒç§è§¦å‘æ‰©å®¹çš„æ¡ä»¶ã€‚ 2) ç¬¬äºŒç§æƒ…å†µ// tooManyOverflowBuckets reports whether noverflow buckets is too many for a map with 1&lt;&lt;B buckets.// Note that most of these overflow buckets must be in sparse use;// if use was dense, then we&#x27;d have already triggered regular map growth.func tooManyOverflowBuckets(noverflow uint16, B uint8) bool &#123; // If the threshold is too low, we do extraneous work. // If the threshold is too high, maps that grow and shrink can hold on to lots of unused memory. // &quot;too many&quot; means (approximately) as many overflow buckets as regular buckets. // See incrnoverflow for more details. if B &gt; 15 &#123; B = 15 &#125; // The compiler doesn&#x27;t see here that B &lt; 16; mask B to generate shorter shift code. return noverflow &gt;= uint16(1)&lt;&lt;(B&amp;15)&#125; ç¿»è¯‘æˆäººè¯ï¼šoverflowçš„bucketæ•°é‡å¤ªå¤šäº†ã€‚å½“B &gt;= 15çš„æ—¶å€™ï¼Œå¦‚æœoverflowçš„bucketæ•°é‡è¶…è¿‡2^15å°±è§¦å‘æ‰©å®¹ï¼›å½“B &lt; 15çš„æ—¶å€™ï¼Œå¦‚æœoverflowçš„bucketæ•°é‡è¶…è¿‡2^Bå°±è§¦å‘æ‰©å®¹ã€‚ç¬¬äºŒç§çš„è¿™ä¸ªæƒ…å†µä¸»è¦æ˜¯ä¸ºäº†é¿å…loadFactorçš„åˆ†å­å°çš„æ—¶å€™ï¼Œå´æœ‰å¤§é‡çš„bucket(åŒ…æ‹¬å¤§é‡çš„overflow bucket)ã€‚ 0x1.æ‰©å®¹ç­–ç•¥é’ˆå¯¹ä¸¤ç§ä¸åŒçš„è§¦å‘æ‰©å®¹çš„æ¡ä»¶ï¼Œè¿›è¡Œæ‰©å®¹çš„ç­–ç•¥ä¹Ÿæœ‰æ‰€ä¸åŒã€‚ ç¬¬ä¸€ç§æƒ…å†µæ˜¯ç”±äºå…ƒç´ æ•°é‡è¿‡å¤šï¼Œå¯¼è‡´äº†bucketæ•°ç»„å¿«æ»¡äº†ã€‚è¿™ä¸ªæ—¶å€™é‡‡ç”¨çš„æ‰©å®¹ç­–ç•¥å°±æ˜¯B+1ï¼Œbucketçš„æ•°ç»„é•¿åº¦å˜æˆä¹‹å‰çš„2å€ï¼ˆ2å€æ‰©å®¹ï¼‰ ç¬¬äºŒç§æƒ…å†µæ˜¯ç”±äºflowbucketçš„è¿‡å¤šé€ æˆï¼Œå…ƒç´ æ²¡æœ‰é‚£ä¹ˆå¤šï¼Œä¸»è¦æ˜¯ä½ç½®åˆ†æ•£ï¼Œé€ æˆæŸ¥æ‰¾å’Œæ’å…¥çš„æ•ˆç‡è¾ƒä½ã€‚é‡‡ç”¨ç¬¬ä¸€ç§çš„æ‰©å®¹ç­–ç•¥è‚¯å®šæ˜¯ä¸è¡Œçš„ï¼Œè§£å†³çš„åŠæ³•æ˜¯é‡‡ç”¨ç­‰é‡æ‰©å®¹ï¼Œåˆ›å»ºä¸€ä¸ªå’Œè€bucketsæ•°ç»„ç›¸åŒé•¿åº¦çš„æ–°bucketsæ•°ç»„ã€‚å°†è€bucketsä¸­å¤„äºåŒä¸€ä¸ªbucketçš„å…ƒç´ è¿›è¡Œç´§å¯†æ’åˆ—ï¼Œå°½å¯èƒ½çš„æ¶ˆé™¤overflow bucketï¼ŒèŠ‚çœç©ºé—´ï¼Œæé«˜æ•ˆç‡ã€‚ mapçš„æ‰©å®¹ä¸æ˜¯åŸå­æ“ä½œï¼Œä¸ä¼šä¸€æ­¥åˆ°ä½ã€‚æ‰©å®¹éœ€è¦å°†åŸæœ¬çš„é”®å€¼å¯¹è¿ç§»åˆ°æ–°bucketå¾—å†…å­˜åœ°å€ä¸­ï¼Œå¤§é‡é”®å€¼å¯¹åŒæ—¶è¿ç§»ä¼šå½±å“æ€§èƒ½ï¼Œæ‰€ä»¥Go mapçš„æ‰©å®¹æ˜¯é‡‡ç”¨â€œæ¸è¿›å¼â€æ–¹å¼ã€‚æ¯æ¬¡æœ€å¤šåªä¼šè¿ç§»2ä¸ªbucketã€‚ 0x2.è¿ç§»è¿‡ç¨‹ç¬¬ä¸€ç§æ‰©å®¹ç­–ç•¥ï¼Œå› ä¸ºB+1ä¼šå¯¼è‡´keyçš„hashå€¼éœ€è¦é‡æ–°è®¡ç®—ï¼Œæ‰èƒ½ç¡®å®šå®ƒä¼šè½å…¥é‚£ä¸ªbucketä¸­ï¼Œæ¯•ç«Ÿç¡®å®šbucketä½ç½®çš„æ˜¯æ ¹æ®hashå€¼çš„åBä½ã€‚è¿™æ ·çš„è¯å°±ä¼šå¯¼è‡´æŸäº›keyåœ¨è¿ç§»å‰åçš„bucketåºå·æ˜¯ä¸ä¸€æ ·çš„ã€‚ ä¸¾ä¸ªğŸŒ°ï¼šåˆå§‹çŠ¶æ€ä¸‹B=2ï¼Œ3å·bucketé‡Œæœ‰ä¸¤ä¸ªkeyçš„hashå€¼å3ä½å€¼011,111ï¼Œç»è¿‡B+1æ‰©å®¹ä¹‹åï¼Œè¿™ä¸¤ä¸ªåŸæœ¬å¤„äº3å·bucketçš„keyä¼šåˆ†åˆ«è½å…¥3å·å’Œ7å·bucketã€‚keyåœ¨è¿ç§»å‰åæ˜¯å¦è¿˜æ˜¯å¤„äºåŸæœ¬çš„bucketå–å†³äºå€’æ•°ç¬¬3ä½æ˜¯0è¿˜æ˜¯1ã€‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚â”Œâ”€â”€â”´â”€â”€â”¬â”€â”€â”´â”€â”€â”¬â”€â”€â”´â”€â”€â”¬â”€â”€â”´â”€â”€â” â”‚ â”‚ â”‚ â”‚â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚â”‚ 0 â”‚ 1 â”‚ 2 â”‚ 3 â”‚ â”‚ â”‚ â”‚ â”‚â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚â””â”€â”€â”¬â”€â”€â”´â”€â”€â”¬â”€â”€â”´â”€â”€â”¬â”€â”€â”´â”€â”€â”¬â”€â”€â”˜ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â–¼ â–¼ â–¼ â–¼ â–¼ â–¼ â–¼ â–¼â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚â”‚ 0 â”‚ 1 â”‚ 2 â”‚ 3 â”‚ 4 â”‚ 5 â”‚ 6 â”‚ 7 â”‚â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”˜ ç¬¬äºŒç§æ‰©å®¹ç­–ç•¥ï¼Œç­‰é‡æ‰©å®¹å› ä¸ºBæ˜¯ä¸å˜çš„ï¼Œæ‰€ä»¥keyè¿˜æ˜¯åœ¨åŸæ¥çš„bucketã€‚ä¸»è¦æ˜¯ä¸ºäº†æ”¶æ‹¢è¿‡äºåˆ†æ•£çš„key(å¤§å¤šæ•°éƒ½åˆ†æ•£åœ¨overflow bucketä¸­)ã€‚ä¸‹é¢çš„å›¾æ˜¯è¿ç§»å®Œæˆçš„æƒ…å†µã€‚ buckets B&#x3D;2 buckets B&#x3D;2â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚â”‚ 0 â”‚ 1 â”‚ 2 â”‚ 3 â”‚ â”‚ 0 â”‚ 1 â”‚ 2 â”‚ 3 â”‚â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”¬â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”¬â”€â”€â”˜ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”Œâ”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â–¼ â–¼â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”â”‚bmapâ”‚ â”Œâ”€â–ºâ”‚bmapâ”‚ â”Œâ”€â–ºâ”‚bmapâ”‚ â”‚bmapâ”‚â”œâ”€â”€â”€â”€â”´â” â”‚ â”œâ”€â”€â”€â”€â”´â” â”‚ â”œâ”€â”€â”€â”€â”´â” â”œâ”€â”€â”€â”€â”´â”â”‚key:aâ”‚ â”‚ â”‚ â”‚ â”‚ â”‚key:fâ”‚ â”‚key:aâ”‚â”‚ 111 â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ 111 â”‚ â”‚ 111 â”‚â”œâ”€â”€â”€â”€â”€â”¤ â”‚ â”œâ”€â”€â”€â”€â”€â”¤ â”‚ â”œâ”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”¤â”‚key:bâ”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚key:bâ”‚â”‚ 011 â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ 011 â”‚â”œâ”€â”€â”€â”€â”€â”¤ â”‚ â”œâ”€â”€â”€â”€â”€â”¤ â”‚ â”œâ”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”¤â”‚ â”‚ â”‚ â”‚key:dâ”‚ â”‚ â”‚ â”‚ â”‚key:câ”‚â”‚ â”‚ â”‚ â”‚ 111 â”‚ â”‚ â”‚ â”‚ â”‚ 011 â”‚â”œâ”€â”€â”€â”€â”€â”¤ â”‚ â”œâ”€â”€â”€â”€â”€â”¤ â”‚ â”œâ”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”¤â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚key:dâ”‚â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ 111 â”‚â”œâ”€â”€â”€â”€â”€â”¤ â”‚ â”œâ”€â”€â”€â”€â”€â”¤ â”‚ â”œâ”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”¤â”‚key:câ”‚ â”‚ â”‚key:eâ”‚ â”‚ â”‚ â”‚ â”‚key:eâ”‚â”‚ 011 â”‚ â”‚ â”‚ 111 â”‚ â”‚ â”‚ â”‚ â”‚ 111 â”‚â”œâ”€â”€â”€â”€â”€â”¤ â”‚ â”œâ”€â”€â”€â”€â”€â”¤ â”‚ â”œâ”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”¤â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚key:gâ”‚ â”‚key:fâ”‚â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ 011 â”‚ â”‚ 111 â”‚â”œâ”€â”€â”€â”€â”€â”¤ â”‚ â”œâ”€â”€â”€â”€â”€â”¤ â”‚ â”œâ”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”¤â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚key:gâ”‚â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ 011 â”‚â”œâ”€â”€â”€â”€â”€â”¤ â”‚ â”œâ”€â”€â”€â”€â”€â”¤ â”‚ â”œâ”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”¤â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚â”œâ”€â”€â”€â”€â”€â”¤ â”‚ â”œâ”€â”€â”€â”€â”€â”¤ â”‚ â”œâ”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”¤â”‚*overâ”‚ â”‚ â”‚*overâ”‚ â”‚ â”‚*overâ”‚ â”‚*overâ”‚â”‚flow â”œâ”€â”€â”˜ â”‚flow â”œâ”€â”˜ â”‚flow â”‚ â”‚flow â”‚â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜","categories":[{"name":"Golang","slug":"Golang","permalink":"https://blog.eganx.cn/categories/Golang/"}],"tags":[{"name":"go","slug":"go","permalink":"https://blog.eganx.cn/tags/go/"},{"name":"map","slug":"map","permalink":"https://blog.eganx.cn/tags/map/"}]},{"title":"Go Mapçš„åŸºæœ¬ä»‹ç»","slug":"Go_Map","date":"2022-10-22T06:53:19.000Z","updated":"2022-11-20T04:33:23.564Z","comments":true,"path":"2022/10/22/Go_Map/","link":"","permalink":"https://blog.eganx.cn/2022/10/22/Go_Map/","excerpt":"mapç”±key-valueå¯¹ç»„æˆï¼Œå¹¶ä¸”ä¸€ä¸ªkeyåªä¼šå‡ºç°ä¸€æ¬¡ã€‚å¯¹mapå¯ä»¥è¿›è¡Œå¢åˆ æ”¹æŸ¥ä¸€ç³»åˆ—æ“ä½œã€‚åœ¨Goè¯­è¨€ï¼Œmapé‡‡ç”¨çš„æ˜¯å“ˆå¸ŒæŸ¥æ‰¾è¡¨å®ç°ï¼Œè§£å†³å“ˆå¸Œå†²çªçš„æ–¹å¼æ˜¯é“¾è¡¨æ³•ã€‚è®°å½•ä¸€ä¸‹å­¦ä¹ è¿‡ç¨‹ä¸­äº†è§£åˆ°çš„mapåŸºæœ¬ç»“æ„å’Œkeyçš„å®šä½è¿‡ç¨‹ã€‚","text":"mapç”±key-valueå¯¹ç»„æˆï¼Œå¹¶ä¸”ä¸€ä¸ªkeyåªä¼šå‡ºç°ä¸€æ¬¡ã€‚å¯¹mapå¯ä»¥è¿›è¡Œå¢åˆ æ”¹æŸ¥ä¸€ç³»åˆ—æ“ä½œã€‚åœ¨Goè¯­è¨€ï¼Œmapé‡‡ç”¨çš„æ˜¯å“ˆå¸ŒæŸ¥æ‰¾è¡¨å®ç°ï¼Œè§£å†³å“ˆå¸Œå†²çªçš„æ–¹å¼æ˜¯é“¾è¡¨æ³•ã€‚è®°å½•ä¸€ä¸‹å­¦ä¹ è¿‡ç¨‹ä¸­äº†è§£åˆ°çš„mapåŸºæœ¬ç»“æ„å’Œkeyçš„å®šä½è¿‡ç¨‹ã€‚ 0x0.mapçš„åŸºæœ¬ç»“æ„é™„ä¸Šæºç (go1.18.2/src/runtime/map.go) // A header for a Go map.type hmap struct &#123; // Note: the format of the hmap is also encoded in // cmd/compile/internal/reflectdata/reflect.go. // Make sure this stays in sync with the compiler&#x27;s definition. count int // # live cells == size of map. Must be first (used by len() builtin) flags uint8 B uint8 // log_2 of # of buckets (can hold up to loadFactor * 2^B items) noverflow uint16 // approximate number of overflow buckets; see incrnoverflow for details hash0 uint32 // hash seed buckets unsafe.Pointer // array of 2^B Buckets. may be nil if count==0. oldbuckets unsafe.Pointer // previous bucket array of half the size, non-nil only when growing nevacuate uintptr // progress counter for evacuation (buckets less than this have been evacuated) extra *mapextra // optional fields&#125; â”Œâ”€â”€â”€â”€â”€â”€â”â”‚ hmap â”‚â”œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”â”‚ count int â”‚ â”‚ â”‚â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ â–¼â”‚ flags uint8 â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ â”‚[]bmapâ”‚ â”Œâ–ºâ”‚ bmap â”‚â”‚ B uint8 â”‚ â”‚ â”œâ”€â”€â”€â”€â”€â”€â”´â”€â” â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ â”‚ 0 â”œâ”€â”€â”˜ â”‚ tophash [bucketCnt]uint8 â”‚â”‚ noverflow uint16 â”‚ â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ â”‚ 1 â”‚ â”‚ key â”‚ â”‚â”‚ hash0 uint32 â”‚ â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”¬â”€â”€â”€â”¼â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¤â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ â”‚ 2 â”‚ â”‚ 0 â”‚ 1 â”‚ 2 â”‚ 3 â”‚ 4 â”‚ 5 â”‚ 6 â”‚ 7 â”‚â”‚ buckets unsafe.Pointer â”œâ”€â”˜ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”´â”€â”€â”€â”¼â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”¤â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ 3 â”‚ â”‚ valuesâ”‚ â”‚â”‚ oldbuckets unsafe.Pointer â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”¬â”€â”€â”€â”¼â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¤â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ ... â”‚ â”‚ 0 â”‚ 1 â”‚ 2 â”‚ 3 â”‚ 4 â”‚ 5 â”‚ 6 â”‚ 7 â”‚â”‚ nevacuates uintptr â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”¤â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ 62 â”‚ â”‚ overflow *bmap â”‚â”‚ extra *mapextra â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¤ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ 63 â”œâ”€â” â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â” â–¼ size&#x3D;2^B â”‚ â””â”€â”€â”€â”€â”€â–ºâ”‚ bmap â”‚â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ mapextra â”‚ â”‚ â”‚ tophash [bucketCnt]uint8 â”‚â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚ overflow *[]*bmap â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â” â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ key â”‚ â”‚â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ bmap â”‚ â”œâ”€â”€â”€â”¬â”€â”€â”€â”¼â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¤â”‚oldoverflow *[]*bmapâ”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ 0 â”‚ 1 â”‚ 2 â”‚ 3 â”‚ 4 â”‚ 5 â”‚ 6 â”‚ 7 â”‚â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ tophash [bucketCnt]uint8 â”‚ â”œâ”€â”€â”€â”´â”€â”€â”€â”¼â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”¤â”‚ nextoverflow *bmap â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ valuesâ”‚ â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ key â”‚ â”‚ â”œâ”€â”€â”€â”¬â”€â”€â”€â”¼â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¤ â”œâ”€â”€â”€â”¬â”€â”€â”€â”¼â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¤ â”‚ 0 â”‚ 1 â”‚ 2 â”‚ 3 â”‚ 4 â”‚ 5 â”‚ 6 â”‚ 7 â”‚ â”‚ 0 â”‚ 1 â”‚ 2 â”‚ 3 â”‚ 4 â”‚ 5 â”‚ 6 â”‚ 7 â”‚ â”œâ”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”¤ â”œâ”€â”€â”€â”´â”€â”€â”€â”¼â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”¤ â”‚ overflow *bmap â”‚ â”‚ valuesâ”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”œâ”€â”€â”€â”¬â”€â”€â”€â”¼â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¤ â”‚ 0 â”‚ 1 â”‚ 2 â”‚ 3 â”‚ 4 â”‚ 5 â”‚ 6 â”‚ 7 â”‚ â”œâ”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”¤ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ overflow *bmap â”œâ”€â”€â”€â”€â”€â”€â–ºâ”‚ nil â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ å…¶ä¸­Bæ˜¯bucketæ•°ç»„é•¿åº¦çš„å¯¹æ•°ï¼Œbucketé‡Œé¢å­˜å‚¨äº†keyå’Œvalueã€‚å¯ä»¥çœ‹è§ä¸€ä¸ªbucketé‡Œé¢æœ€å¤šèƒ½è£…8ä¸ªkeyï¼Œè¿™8ä¸ªkeyåœ¨bucketé‡Œé¢çš„ä½ç½®æ ¹æ®hashå€¼çš„é«˜8ä½å†³å®šã€‚nevacuateè¡¨ç¤ºæ‰©å®¹è¿›åº¦ï¼Œå°äºæ­¤åœ°å€çš„ buckets è¿ç§»å®Œæˆã€‚Asciié£æ ¼çš„mapå†…å­˜æ¨¡å‹å›¾æ˜¯å‚è€ƒæ›¹å¤§githubé‡Œçš„ï¼Œæ›¹å¤§yydsã€‚ å…¶ä¸­bucketæŒ‡é’ˆæŒ‡å‘çš„ç»“æ„ä½“å¦‚ä¸‹ï¼š // A bucket for a Go map.type bmap struct &#123; // tophash generally contains the top byte of the hash value // for each key in this bucket. If tophash[0] &lt; minTopHash, // tophash[0] is a bucket evacuation state instead. tophash [bucketCnt]uint8 // Followed by bucketCnt keys and then bucketCnt elems. // NOTE: packing all the keys together and then all the elems together makes the // code a bit more complicated than alternating key/elem/key/elem/... but it allows // us to eliminate padding which would be needed for, e.g., map[int64]int8. // Followed by an overflow pointer.&#125; â”Œâ”€â”€â”€â”€â”€â”€â”€â”â”‚ bmap â”‚â”œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ tophash [bucketCnt]uint8 â”‚â”œâ”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚ key â”‚ â”‚â”œâ”€â”€â”€â”¬â”€â”€â”€â”¼â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¤â”‚ 0 â”‚ 1 â”‚ 2 â”‚ 3 â”‚ 4 â”‚ 5 â”‚ 6 â”‚ 7 â”‚â”œâ”€â”€â”€â”´â”€â”€â”€â”¼â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”¤â”‚ valuesâ”‚ â”‚â”œâ”€â”€â”€â”¬â”€â”€â”€â”¼â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¤â”‚ 0 â”‚ 1 â”‚ 2 â”‚ 3 â”‚ 4 â”‚ 5 â”‚ 6 â”‚ 7 â”‚â”œâ”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”¤â”‚ overflow *bmap â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ å…¶ä¸­keyå’Œvalueæ˜¯å„è‡ªå­˜æ”¾åœ¨ä¸€èµ·çš„ï¼Œä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšå‘¢ï¼Œä»¥ä¸‹æ˜¯åœ¨æ³¨é‡Šä¸­çš„å®˜æ–¹è§£é‡Šã€‚ NOTE: packing all the keys together and then all the elems together makes the code a bit more complicated than alternating key/elem/key/elem/... but it allows us to eliminate padding which would be needed for, e.g., map[int64]int8. ä¸»è¦æ˜¯ä¸ºäº†å‡å°‘å†…å­˜å¯¹é½å¸¦æ¥çš„paddingã€‚æ³¨é‡Šä¸­ç»™äº†ä¸€ä¸ªä¾‹å­map[int64]int8ï¼Œå¦‚æœæ˜¯æŒ‰ç…§key/elem/key/elem/è¿™ç§æ–¹å¼å­˜å‚¨ï¼Œç›¸å½“äºæ¯ä¸€ä¸ªkey/eleméƒ½éœ€è¦padding7ä¸ªå­—èŠ‚ã€‚64ä½çš„æœºå™¨ä¸Šï¼Œé»˜è®¤çš„å¯¹é½ç³»æ•°æ˜¯8ï¼ŒåŒæ—¶int8çš„å¯¹é½ç³»æ•°æ˜¯1ï¼Œint64çš„å¯¹é½ç³»æ•°æ˜¯8ã€‚ä»¥ä¸‹æ˜¯key/elemæ–¹å¼äº§ç”Ÿpaddingçš„è¿‡ç¨‹ï¼š ç¬¬ä¸€ä¸ªkeyï¼Œkey1(int64)çš„å¤§å°å’Œå¯¹é½å€¼æ˜¯8ï¼Œå æ®8ä½ã€‚æš‚ä¸”å†™åšï¼škkkkkkkk ç¬¬ä¸€ä¸ªvalueï¼Œvalue1(int8)çš„å¤§å°å’Œå¯¹é½å€¼æ˜¯1ï¼Œå æ®1ä½ã€‚å†™åšï¼škkkkkkkkï½œv ç¬¬äºŒä¸ªkeyï¼Œkey2(int64)çš„å¤§å°å’Œå¯¹é½å€¼æ˜¯8ï¼Œåç§»é‡å¿…é¡»æ˜¯8çš„å€æ•°ã€‚ä¹Ÿå°±äº§ç”Ÿäº†paddingã€‚ä¸èƒ½ç›´æ¥æ¥ç€value1åé¢å†™äº†ï¼Œå†™ä½œï¼škkkkkkkkï½œvxxxxxxxï½œkkkkkkkkã€‚å…¶ä¸­xè¡¨ç¤ºpaddingã€‚åé¢ä¹Ÿå°±æ˜¯ä¾æ¬¡ç±»æ¨äº†ã€‚ å¦‚æœæ˜¯æŒ‰ç…§key/key/key/.../key/elem/elem/.../elemæ¥è¿›è¡Œå­˜å‚¨çš„è¯ï¼Œåªéœ€è¦åœ¨æœ€åé¢æ·»åŠ paddingå°±è¡Œã€‚å†…å­˜å¯¹é½ä¸€èˆ¬å¥½åƒä¸æ€ä¹ˆä¼šè€ƒè™‘ï¼Œä½†æ˜¯äº†è§£è¿˜æ˜¯éœ€è¦äº†è§£çš„ï¼ŒTODO Listå†åŠ ä¸€é¡¹ã€‚ 0x1.mapä¸­keyçš„ä½ç½®åœ¨64ä½çš„æœºå™¨ä¸Šé¢ï¼Œkeyç»è¿‡hashè®¡ç®—åä¼šå¾—åˆ°ä¸€ä¸ª64bitçš„å“ˆå¸Œå€¼ã€‚åœ¨keyçš„å®šä½è¿‡ç¨‹ä¸­ä¼šç”¨åˆ°å“ˆå¸Œå€¼çš„é«˜8ä½å’ŒåBä½ã€‚Bå°±æ˜¯hmapä¸­çš„Bï¼Œå¦‚æœB=6ï¼Œbucketsæ•°ç»„çš„é•¿åº¦å°±æ˜¯2^6=64ã€‚ ä¸¾ä¸ªğŸŒ°,ç°åœ¨æœ‰ä¸€ä¸ªkeyçš„å“ˆå¸Œå€¼å¦‚ä¸‹ï¼š 00000111 | 00001111111011001111111111101010001000000001010000 | 000010 keyâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ 00000111 | 00001111111011001111111111101010001000000001010000 | 000010 â”‚â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚ â–¼ â”‚ B&#x3D;6 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ bucketMask&#x3D;111111 â”‚ 000010&amp;111111 â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”˜ â”‚ tophash â”‚ â”‚ â–¼ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤000010&#x3D;2â”‚ â–¼ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” buckets â–¼â”‚ 00000111&#x3D;7 â”‚ â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â”‚ 0 â”‚ 1 â”‚ 2 â”‚ 3 â”‚ ... â”‚ 61 â”‚ 62 â”‚ 63 â”‚ â”‚ â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”¬â”€â”´â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â–¼ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚bucketâ”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”‚ â”œâ”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ bmap â”‚ â–¼ â”‚ â”‚ â”œâ”€â”€â”€â”¬â”€â”€â”€â”¼â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â” â”‚ â”‚ â”‚111â”‚ 9 â”‚ 3 â”‚ 5 â”‚ 6 â”‚ 7 â”‚ 0 â”‚ 0 â”‚ â”‚ â”‚ â”œâ”€â”€â”€â”´â”€â”€â”€â”¼â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”¤ â”‚ â”‚ â”‚ key â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€â”€â”¬â”€â”€â”€â”¼â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¤ â”‚ â”‚ â”‚ 5 â”‚ 2 â”‚ 1 â”‚ 4 â”‚ 3 â”‚ 9 â”‚ 0 â”‚ 0 â”‚ â”‚ â”‚ â”œâ”€â”€â”€â”´â”€â”€â”€â”¼â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”¤ â”‚ â”‚ â”‚ valuesâ”‚ â”‚ â”‚ â”‚ â”œâ”€â”€â”€â”¬â”€â”€â”€â”¼â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¤ â”‚ â”‚ â”‚ 3 â”‚ 5 â”‚ 4 â”‚ 7 â”‚ 9 â”‚ 6 â”‚ 0 â”‚ 0 â”‚ â”‚ â”‚ â”œâ”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”¤ â”‚ â”‚ â”‚ overflow *bmap â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ å¦‚æœåœ¨ bucket ä¸­æ²¡æ‰¾åˆ°ï¼Œå¹¶ä¸” overflow ä¸ä¸ºç©ºï¼Œè¿˜è¦ç»§ç»­å» overflow bucket ä¸­å¯»æ‰¾ï¼Œç›´åˆ°æ‰¾åˆ°æˆ–æ˜¯æ‰€æœ‰çš„ key æ§½ä½éƒ½æ‰¾éäº†ï¼ŒåŒ…æ‹¬æ‰€æœ‰çš„ overflow bucketã€‚ å®ç°ä¸Šæœ‰ mapaccess1ï¼Œmapaccess2ï¼ŒmapaccessK å‡ ä¸ªæ–¹æ³•ï¼Œä¸»è¦åŒºåˆ«æ˜¯åœ¨è¿”å›å†…å®¹ä¸Šã€‚å½“è¦æŸ¥è¯¢çš„ key ä¸åœ¨ map é‡Œï¼Œmapaccess2çš„ç”¨æ³•ä¼šè¿”å›ä¸€ä¸ª bool å‹å˜é‡æç¤º key æ˜¯å¦åœ¨ map ä¸­ï¼›è€Œmapaccess1 çš„è¯­å¥åˆ™ä¼šè¿”å›ä¸€ä¸ª key å¯¹åº” value ç±»å‹çš„é›¶å€¼ã€‚å¦‚æœ value æ˜¯ int å‹å°±ä¼šè¿”å› 0ï¼Œå¦‚æœ value æ˜¯ string ç±»å‹ï¼Œå°±ä¼šè¿”å›ç©ºå­—ç¬¦ä¸²ã€‚mapaccess2å°±æ˜¯æ—¥å¸¸ä»£ç ä¸­v, ok := map[k]çš„åº•å±‚å‡½æ•°ã€‚ 0x2.Go Mapæ˜¯çº¿ç¨‹å®‰å…¨çš„å—ï¼Ÿmapä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚åœ¨å¯¹mapè¿›è¡Œè¯»å†™æ“ä½œçš„æ—¶å€™éƒ½ä¼šå…ˆæ£€æµ‹å†™æ ‡å¿—ï¼Œå‘ç°å†™æ ‡å¿—ä½ç½®1ï¼Œä¼španicã€‚æ‰€ä»¥ä¸èƒ½ä¸€è¾¹å†™å…¥ä¸€è¾¹éå†ã€‚ ä¸€ä¸ªåç¨‹å†…ä¸€è¾¹åˆ é™¤ä¸€è¾¹éå†çš„æ“ä½œæ˜¯å…è®¸çš„ï¼Œä½†æ˜¯çœŸçš„è¿™ä¹ˆå¹²äº†ï¼Œå¤§æ¦‚ç‡ä¼šè¢«æ‰“ã€‚æ¯•ç«Ÿéå†å‡ºæ¥çš„ç»“æœæœ‰å¯èƒ½ä¼šåŒ…å«å·²ç»åˆ é™¤çš„å…ƒç´ ã€‚ ä¸Šé¢çš„ä¸¤ç§æƒ…å†µçœ‹çœ‹å°±è¡Œï¼ŒçœŸè¦å†™çš„æ—¶å€™ä¸€èˆ¬éƒ½ä¼šåŠ è¯»å†™é”ï¼šsync.RWMutexã€‚ mapä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä½†æ˜¯sync.Mapæ˜¯çº¿ç¨‹å®‰å…¨ã€‚ 0x3.å¦‚ä½•åˆ¤æ–­ä¸¤ä¸ªmapæ˜¯å¦ç›¸ç­‰ä¸¤ä¸ªmapæ˜¯å¦ç›¸ç­‰ä¸èƒ½ç›´æ¥é€šè¿‡==åˆ¤æ–­ï¼Œç¼–è¯‘æŠ¥é”™ã€‚ å¼•ç”¨ä¹¦é‡Œçš„mapæ·±åº¦ç›¸ç­‰çš„æ¡ä»¶ï¼š 1ã€éƒ½ä¸ºnil 2ã€éç©ºï¼Œé•¿åº¦ç›¸ç­‰ï¼ŒæŒ‡å‘åŒä¸€ä¸ªmapå®ä½“ 3ã€ç›¸åŒçš„keyæŒ‡å‘çš„valueâ€œæ·±åº¦â€ç›¸ç­‰ var m map[int]intvar n map[int]intfmt.Println(m == nil) //OKfmt.Println(n == nil) //OKfmt.Println(m == n) //ç¼–è¯‘æŠ¥é”™ å› æ­¤åªèƒ½æ˜¯éå†map çš„æ¯ä¸ªå…ƒç´ ï¼Œæ¯”è¾ƒå…ƒç´ æ˜¯å¦éƒ½æ˜¯æ·±åº¦ç›¸ç­‰ã€‚","categories":[{"name":"Golang","slug":"Golang","permalink":"https://blog.eganx.cn/categories/Golang/"}],"tags":[{"name":"go","slug":"go","permalink":"https://blog.eganx.cn/tags/go/"},{"name":"map","slug":"map","permalink":"https://blog.eganx.cn/tags/map/"}]},{"title":"Go Sliceçš„æ‰©å®¹ç­–ç•¥","slug":"Go_Slice_growup","date":"2022-10-15T04:56:11.000Z","updated":"2022-11-20T04:33:01.426Z","comments":true,"path":"2022/10/15/Go_Slice_growup/","link":"","permalink":"https://blog.eganx.cn/2022/10/15/Go_Slice_growup/","excerpt":"åœ¨å†™Goçš„æ—¶å€™ï¼Œå¯¹Sliceçš„æ“ä½œå°±å¾ˆå±é™©ï¼Œç‰¹åˆ«æ˜¯å‡½æ•°å‚æ•°ä¼ çš„æ˜¯SliceæŒ‡é’ˆï¼Œä¸€ä¸å°å¿ƒå°±æ”¹äº†ã€‚åˆ‡ç‰‡æ”¯æŒå­åˆ‡ç‰‡ å’ŒåŸæœ¬åˆ‡ç‰‡å…±äº«åº•å±‚æ•°ç»„ï¼Œé‚£å­åˆ‡ç‰‡å’Œåˆ‡ç‰‡ç©¶ç«Ÿä¼šä¸ä¼šç›¸äº’å½±å“ï¼Ÿ å°±çœ‹ä»–ä»¬æ˜¯ä¸æ˜¯è¿˜å…±äº«åº•å±‚æ•°ç»„ã€‚å¦‚æœä»–ä»¬çš„ç»“æ„æ²¡æœ‰å˜åŒ–ï¼Œè‚¯å®šæ˜¯å…±äº«çš„ã€‚ç»“æ„å‘ç”Ÿå˜åŒ–(æ‰©å®¹)ï¼Œå°±å¯èƒ½ä¸å…±äº«äº†ã€‚ å¯¹å­åˆ‡ç‰‡çš„ä½¿ç”¨å»ºè®®ï¼šåªè¯»ä¸æ”¹","text":"åœ¨å†™Goçš„æ—¶å€™ï¼Œå¯¹Sliceçš„æ“ä½œå°±å¾ˆå±é™©ï¼Œç‰¹åˆ«æ˜¯å‡½æ•°å‚æ•°ä¼ çš„æ˜¯SliceæŒ‡é’ˆï¼Œä¸€ä¸å°å¿ƒå°±æ”¹äº†ã€‚åˆ‡ç‰‡æ”¯æŒå­åˆ‡ç‰‡ å’ŒåŸæœ¬åˆ‡ç‰‡å…±äº«åº•å±‚æ•°ç»„ï¼Œé‚£å­åˆ‡ç‰‡å’Œåˆ‡ç‰‡ç©¶ç«Ÿä¼šä¸ä¼šç›¸äº’å½±å“ï¼Ÿ å°±çœ‹ä»–ä»¬æ˜¯ä¸æ˜¯è¿˜å…±äº«åº•å±‚æ•°ç»„ã€‚å¦‚æœä»–ä»¬çš„ç»“æ„æ²¡æœ‰å˜åŒ–ï¼Œè‚¯å®šæ˜¯å…±äº«çš„ã€‚ç»“æ„å‘ç”Ÿå˜åŒ–(æ‰©å®¹)ï¼Œå°±å¯èƒ½ä¸å…±äº«äº†ã€‚ å¯¹å­åˆ‡ç‰‡çš„ä½¿ç”¨å»ºè®®ï¼šåªè¯»ä¸æ”¹ 0x0.Sliceå’ŒArrayçš„è”ç³»slice çš„åº•å±‚æ•°æ®æ˜¯æ•°ç»„ï¼Œslice æ˜¯å¯¹æ•°ç»„çš„å°è£…ã€‚ä¸¤è€…éƒ½å¯ä»¥é€šè¿‡ä¸‹æ ‡æ¥è®¿é—®å•ä¸ªå…ƒç´ ã€‚ æ•°ç»„å°±æ˜¯ä¸€ç‰‡è¿ç»­çš„å†…å­˜ï¼Œæ˜¯å®šé•¿çš„ï¼Œå…¶é•¿åº¦æ˜¯ç±»å‹çš„ä¸€éƒ¨åˆ†ï¼Œæ¯”å¦‚ [3]int å’Œ [4]int å°±æ˜¯ä¸åŒçš„ç±»å‹ã€‚ sliceå¯ä»¥åŠ¨æ€åœ°æ‰©å®¹ï¼Œåˆ‡ç‰‡çš„ç±»å‹å’Œé•¿åº¦æ— å…³ã€‚ slice æ˜¯ä¸€ä¸ªç»“æ„ä½“ï¼ŒåŒ…å«ä¸‰ä¸ªå­—æ®µï¼šé•¿åº¦ã€å®¹é‡ã€åº•å±‚æ•°ç»„ã€‚ type slice struct &#123; array unsafe.Pointer &#x2F;&#x2F; å…ƒç´ æŒ‡é’ˆ len int &#x2F;&#x2F; é•¿åº¦ cap int &#x2F;&#x2F; å®¹é‡&#125; ä¸æ˜¯æ¯ä¸€ä¸ªSliceéƒ½æœ‰è‡ªå·±ä¸“å±çš„åº•å±‚æ•°ç»„ï¼Œåº•å±‚æ•°ç»„æ˜¯å¯ä»¥è¢«å¤šä¸ªSliceåŒæ—¶æŒ‡å‘çš„ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨ä¿®æ”¹SliceAçš„æ•°æ®æ—¶ï¼Œæœ‰å¯èƒ½SliceBçš„æ•°æ®ä¹Ÿä¼šå‘ç”Ÿæ”¹å˜ã€‚ 0x1.Sliceæ‰©å®¹ç­–ç•¥åœ¨golang1.18ç‰ˆæœ¬ä¹‹å‰ï¼ŒSliceçš„æ‰©å®¹ç­–ç•¥æ˜¯å½“åŸ slice å®¹é‡å°äº 1024 çš„æ—¶å€™ï¼Œæ–° slice å®¹é‡å˜æˆåŸæ¥çš„ 2 å€ï¼›åŸ slice å®¹é‡è¶…è¿‡ 1024ï¼Œæ–° slice å®¹é‡å˜æˆåŸæ¥çš„1.25å€ã€‚ åœ¨golang1.18ç‰ˆæœ¬ä¹‹åï¼Œæ–°çš„Sliceæ‰©å®¹ç­–ç•¥æ˜¯å½“åŸsliceå®¹é‡(oldcap)å°äº256çš„æ—¶å€™ï¼Œæ–°slice(newcap)å®¹é‡ä¸ºåŸæ¥çš„2å€ï¼›åŸsliceå®¹é‡è¶…è¿‡256ï¼Œæ–°sliceå®¹é‡newcap = oldcap+(oldcap+3*256)/4 åœ¨å®é™…çš„æ‰©å®¹è¿‡ç¨‹ä¸­ï¼Œè¿˜éœ€è¦è€ƒè™‘å†…å­˜å¯¹é½äº§ç”Ÿçš„å½±å“ï¼Œè¿™ä¸ªå’Œå†…å­˜åˆ†é…ç­–ç•¥ç›¸å…³ã€‚è¿›è¡Œå†…å­˜å¯¹é½ä¹‹åï¼Œæ–° slice çš„å®¹é‡æ˜¯è¦ å¤§äºç­‰äº ç†è®ºçš„æ‰©å®¹é‡ã€‚ ç»å…¸ä¾‹é¢˜ï¼Œæ¥è‡ªgolang Sliceçš„æ‰©å®¹è§„åˆ™ package mainimport &quot;fmt&quot;func main() &#123; s := []int&#123;1,2&#125; s = append(s,4,5,6) fmt.Printf(&quot;len=%d, cap=%d&quot;,len(s),cap(s))&#125; è¿è¡Œç»“æœï¼š len&#x3D;5, cap&#x3D;6","categories":[{"name":"Golang","slug":"Golang","permalink":"https://blog.eganx.cn/categories/Golang/"}],"tags":[{"name":"go","slug":"go","permalink":"https://blog.eganx.cn/tags/go/"},{"name":"slice","slug":"slice","permalink":"https://blog.eganx.cn/tags/slice/"}]},{"title":"C# GCæœºåˆ¶(Garbage Collector)","slug":"CSharp_GC_mechanism","date":"2022-02-08T13:31:19.000Z","updated":"2022-11-20T02:42:11.675Z","comments":true,"path":"2022/02/08/CSharp_GC_mechanism/","link":"","permalink":"https://blog.eganx.cn/2022/02/08/CSharp_GC_mechanism/","excerpt":"è®°å½•ä¸€ä¸‹C#ä¸­GCçš„ç›¸å…³çŸ¥è¯†ã€‚ä¸è®°ä¸‹æ¥ï¼Œä¸‹æ¬¡åˆæ‰¾ä¸åˆ°ï¼Œå°±å¾ˆçƒ¦ã€‚ ä¸»è¦é’ˆå¯¹çš„æ˜¯C#ä¸­å¦‚ä½•åˆ¤å®šGarbageå’ŒGCçš„è¿ä½œæ–¹å¼ã€‚","text":"è®°å½•ä¸€ä¸‹C#ä¸­GCçš„ç›¸å…³çŸ¥è¯†ã€‚ä¸è®°ä¸‹æ¥ï¼Œä¸‹æ¬¡åˆæ‰¾ä¸åˆ°ï¼Œå°±å¾ˆçƒ¦ã€‚ ä¸»è¦é’ˆå¯¹çš„æ˜¯C#ä¸­å¦‚ä½•åˆ¤å®šGarbageå’ŒGCçš„è¿ä½œæ–¹å¼ã€‚ 0x0.èµ„æºæ¦‚å¿µæ‰€è°“çš„èµ„æºå…¶å®å°±æ˜¯ç¨‹åºä¸­å¯ä»¥åˆ©ç”¨çš„æ•°æ®ã€‚æ¯”å¦‚å­—ç¬¦ä¸²ã€å›¾ç‰‡å’Œä»»ä½•çš„äºŒè¿›åˆ¶æ•°æ®ã€‚ æ‰˜ç®¡èµ„æºï¼Œéæ‰˜ç®¡èµ„æºï¼šæ‰˜ç®¡èµ„æºæ˜¯ç”±CLRå…¨æƒè´Ÿè´£çš„èµ„æºï¼ŒCLRä¸è´Ÿè´£çš„èµ„æºä½éæ‰˜ç®¡èµ„æºã€‚å¯¹äºæ‰˜ç®¡èµ„æºé€šè¿‡GCè‡ªåŠ¨æ¸…ç†å›æ”¶ã€‚å¯¹äºéæ‰˜ç®¡çš„èµ„æºï¼Œä¸€èˆ¬å°±æ˜¯Streamï¼Œæ•°æ®åº“çš„è¿æ¥ï¼Œç½‘ç»œè¿æ¥ï¼ŒGDI+çš„ç›¸å…³å¯¹è±¡ï¼Œè¿˜æœ‰Comå¯¹è±¡ç­‰ç­‰è¿™äº›æ“ä½œç³»ç»Ÿèµ„æºï¼Œéœ€è¦æˆ‘ä»¬æ‰‹åŠ¨å»é‡Šæ”¾ï¼Œå†ç”±GCå›æ”¶ã€‚ 0x1.Garbageçš„åˆ¤å®š.Netç±»å‹åˆ†ä¸ºä¸¤å¤§ç±»ï¼Œä¸€ä¸ªå°±æ˜¯å€¼ç±»å‹ï¼Œå¦ä¸€ä¸ªå°±æ˜¯å¼•ç”¨ç±»å‹ã€‚å‰è€…æ˜¯åœ¨å †æ ˆä¸­åˆ†é…å†…å­˜ï¼Œå®ƒä»¬æœ‰è‡ªèº«çš„ç”Ÿå‘½å‘¨æœŸï¼Œæ‰€ä»¥ä¸ç”¨å¯¹å®ƒä»¬è¿›è¡Œç®¡ç†ï¼Œä¼šè‡ªåŠ¨åˆ†é…å’Œé‡Šæ”¾ã€‚åè€…æ˜¯åœ¨å †ä¸­åˆ†é…å†…å­˜çš„ã€‚æ‰€ä»¥å®ƒçš„åˆ†é…å’Œé‡Šæ”¾å°±éœ€è¦åƒå›æ”¶æœºåˆ¶æ¥ç®¡ç†ã€‚ GCçš„å…¨ç§°ä¸ºâ€œGarbage Collectorâ€,é¡¾åæ€ä¹‰å°±æ˜¯åƒåœ¾å›æ”¶å™¨ï¼Œé‚£ä¹ˆåªæœ‰è¢«ç§°ä¸ºåƒåœ¾çš„å¯¹è±¡æ‰èƒ½è¢«GCå›æ”¶ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ ä¸€ä¸ªå¼•ç”¨ç±»å‹å¯¹è±¡æ‰€å ç”¨çš„å†…å­˜éœ€è¦è¢«GCå›æ”¶ï¼Œéœ€è¦å…ˆæˆä¸ºåƒåœ¾ã€‚ .Netåˆ¤å®šä¸€ä¸ªå¼•ç”¨ç±»å‹å¯¹è±¡æ˜¯åƒåœ¾ï¼Œåªéœ€è¦åˆ¤å®šæ­¤å¯¹è±¡æˆ–è€…å…¶åŒ…å«çš„å­å¯¹è±¡æ²¡æœ‰ä»»ä½•å¼•ç”¨æ˜¯æœ‰æ•ˆçš„ï¼Œé‚£ä¹ˆç³»ç»Ÿå°±è®¤ä¸ºå®ƒæ˜¯åƒåœ¾ã€‚ 0x2.éæ‰˜ç®¡èµ„æºçš„é‡Šæ”¾æ–¹å¼1).Close()å…³é—­å¯¹è±¡èµ„æºï¼Œåœ¨æ˜¾ç¤ºè°ƒç”¨æ—¶è¢«è°ƒç”¨ã€‚ 2).Dispose()ç»§æ‰¿IDisposableæ¥å£ï¼Œå®ç°Disposeæ–¹æ³•ï¼›ä»‹ç»ï¼šè°ƒç”¨Disposeæ–¹æ³•ï¼Œé”€æ¯å¯¹è±¡ï¼Œéœ€è¦æ˜¾ç¤ºè°ƒç”¨æˆ–è€…é€šè¿‡usingè¯­å¥ï¼Œåœ¨æ˜¾ç¤ºè°ƒç”¨æˆ–è€…ç¦»å¼€usingç¨‹åºå—æ—¶è¢«è°ƒç”¨ã€‚Disposeæ–¹æ³•ç”¨äºæ¸…ç†å¯¹è±¡å°è£…çš„éæ‰˜ç®¡èµ„æºï¼Œè€Œä¸æ˜¯é‡Šæ”¾å¯¹è±¡çš„å†…å­˜ï¼Œå¯¹è±¡çš„å†…å­˜ä¾ç„¶ç”±åƒåœ¾å›æ”¶å™¨æ§åˆ¶ã€‚Disposeæ–¹æ³•è°ƒç”¨ï¼Œä¸ä½†é‡Šæ”¾è¯¥ç±»çš„éæ‰˜ç®¡èµ„æºï¼Œè¿˜é‡Šæ”¾äº†å¼•ç”¨çš„ç±»çš„éæ‰˜ç®¡èµ„æºã€‚Disposeæ¨¡å¼å°±æ˜¯ä¸€ç§å¼ºåˆ¶èµ„æºæ¸…ç†æ‰€è¦éµå®ˆçš„çº¦å®šï¼›Disposeæ¨¡å¼å®ç°IDisposableæ¥å£ï¼Œä»è€Œä½¿å¾—è¯¥ç±»å‹æä¾›ä¸€ä¸ªå…¬æœ‰çš„Disposeæ–¹æ³•ã€‚ è€ŒCloseä¸Disposeè¿™ä¸¤ç§æ–¹æ³•çš„åŒºåˆ«åœ¨äºï¼Œè°ƒç”¨å®Œäº†å¯¹è±¡çš„Closeæ–¹æ³•åï¼Œæ­¤å¯¹è±¡æœ‰å¯èƒ½è¢«é‡æ–°è¿›è¡Œä½¿ç”¨ï¼›è€ŒDisposeæ–¹æ³•æ¥è¯´ï¼Œæ­¤å¯¹è±¡æ‰€å æœ‰çš„èµ„æºéœ€è¦è¢«æ ‡è®°ä¸ºæ— ç”¨äº†ï¼Œä¹Ÿå°±æ˜¯æ­¤å¯¹è±¡è¢«é”€æ¯äº†ï¼Œä¸èƒ½å†è¢«ä½¿ç”¨ã€‚ 3).ææ„å‡½æ•°/Finalize()å¸¦æœ‰ææ„å‡½æ•°çš„ç±»ï¼Œç”Ÿå‘½å‘¨æœŸä¼šå˜é•¿ã€‚å†…å­˜ç©ºé—´éœ€è¦ä¸¤æ¬¡åƒåœ¾å›æ”¶æ‰ä¼šè¢«é‡Šæ”¾ï¼Œå¯¼è‡´æ€§èƒ½ä¸‹é™ã€‚ ä¸€ä¸ªæ­£å¸¸æƒ…å†µçš„ç±»æ˜¯ä¸ä¼šå†™ææ„å‡½æ•°çš„ï¼Œè€Œä¸€æ—¦ä¸€ä¸ªç±»å†™äº†ææ„å‡½æ•°ï¼Œå°±æ„å‘³ç€GCä¼šåœ¨ä¸ç¡®å®šçš„æ—¶é—´è°ƒç”¨è¯¥ç±»çš„ææ„å‡½æ•°ï¼Œåˆ¤æ–­è¯¥ç±»çš„èµ„æºæ˜¯å¦éœ€è¦é‡Šæ”¾ï¼Œç„¶åè°ƒç”¨Finalizeæ–¹æ³•ï¼Œå¦‚æœé‡å†™äº†Finalizeæ–¹æ³•åˆ™è°ƒç”¨é‡å†™çš„Finalizeæ–¹æ³•ã€‚Finalizeæ–¹æ³•çš„ä½œç”¨æ˜¯ä¿è¯.NETå¯¹è±¡èƒ½åœ¨åƒåœ¾å›æ”¶æ—¶æ¸…é™¤éæ‰˜ç®¡èµ„æºã€‚åœ¨.NETä¸­ï¼ŒObject.Finalize()æ–¹æ³•æ˜¯æ— æ³•é‡è½½çš„ï¼Œç¼–è¯‘å™¨æ˜¯æ ¹æ®ç±»çš„ææ„å‡½æ•°æ¥è‡ªåŠ¨ç”ŸæˆObject.Finalize()æ–¹æ³•çš„Finalizeç”±åƒåœ¾å›æ”¶å™¨è°ƒç”¨ï¼›disposeç”±å¯¹è±¡è°ƒç”¨ã€‚Finalizeæ— éœ€æ‹…å¿ƒå› ä¸ºæ²¡æœ‰è°ƒç”¨Finalizeè€Œä½¿éæ‰˜ç®¡èµ„æºå¾—ä¸åˆ°é‡Šæ”¾ï¼Œå› ä¸ºGCä¼šåœ¨ä¸ç¡®å®šæ—¶é—´è°ƒç”¨ï¼Œå½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥æ‰‹åŠ¨è°ƒç”¨Finalizeæ–¹æ³•ï¼Œè€Œdisposeå¿…é¡»æ‰‹åŠ¨è°ƒç”¨ã€‚Finalizeè™½ç„¶æ— éœ€æ‹…å¿ƒå› ä¸ºæ²¡æœ‰è°ƒç”¨Finalizeè€Œä½¿éæ‰˜ç®¡èµ„æºå¾—ä¸åˆ°é‡Šæ”¾ï¼Œä½†å› ä¸ºç”±åƒåœ¾å›æ”¶å™¨ç®¡ç†ï¼Œä¸èƒ½ä¿è¯ç«‹å³é‡Šæ”¾éæ‰˜ç®¡èµ„æºï¼›è€Œdisposeä¸€è°ƒç”¨ä¾¿é‡Šæ”¾éæ‰˜ç®¡èµ„æºã€‚åªæœ‰ç±»ç±»å‹æ‰èƒ½é‡å†™Finalizeï¼Œè€Œç»“æ„ä¸èƒ½ï¼›ç±»å’Œç»“æ„éƒ½èƒ½å®ç°IDispose é‡Šæ”¾æ¨¡å¼ï¼šæ˜¯ä¸€ç§å¾®è½¯å»ºè®®çš„å†™æ³•ï¼Œå…ˆæ‰‹åŠ¨æ˜¾ç¤ºå»é‡Šæ”¾èµ„æºï¼Œå¦‚æœå¿˜è®°äº†ï¼Œå†è®©finalizeé‡Šæ”¾èµ„æºã€‚æ‰€ä»¥å¦‚æœå·²ç»å®Œæˆäº†ææ„å‡½æ•°è¯¥å¹²çš„äº‹æƒ…(ä¾‹å¦‚é‡Šæ”¾éæ‰˜ç®¡èµ„æº)ï¼Œå°±åº”å½“ä½¿ç”¨SuppressFinalizeæ–¹æ³•å‘Šè¯‰GCä¸éœ€è¦å†æ‰§è¡ŒæŸä¸ªå¯¹è±¡çš„ææ„å‡½æ•°ã€‚ 0x3.GCçš„è¿ä½œæ–¹å¼å†…å­˜çš„é‡Šæ”¾å’Œå›æ”¶éœ€è¦ä¼´éšç€ç¨‹åºçš„è¿è¡Œï¼Œå› æ­¤ç³»ç»Ÿä¸ºGCå®‰æ’äº†ç‹¬ç«‹çš„çº¿ç¨‹ã€‚é‚£ä¹ˆGCçš„å·¥ä½œå¤§è‡´æ˜¯ï¼ŒæŸ¥è¯¢å†…å­˜ä¸­å¯¹è±¡æ˜¯å¦æˆä¸ºåƒåœ¾ï¼Œç„¶åå¯¹åƒåœ¾è¿›è¡Œé‡Šæ”¾å’Œå›æ”¶ã€‚é‚£ä¹ˆå¯¹äºGCå¯¹äºå†…å­˜å›æ”¶é‡‡å–äº†ä¸€å®šçš„ä¼˜å…ˆç®—æ³•è¿›è¡Œè½®å¾ªå›æ”¶å†…å­˜èµ„æºã€‚ å…¶æ¬¡ï¼Œå¯¹äºå†…å­˜ä¸­çš„åƒåœ¾åˆ†ä¸ºä¸¤ç§ï¼Œä¸€ç§æ˜¯éœ€è¦è°ƒç”¨å¯¹è±¡çš„ææ„å‡½æ•°ï¼Œå¦ä¸€ç§æ˜¯ä¸éœ€è¦è°ƒç”¨çš„ã€‚GCå¯¹äºå‰è€…çš„å›æ”¶éœ€è¦é€šè¿‡ä¸¤æ­¥å®Œæˆï¼Œç¬¬ä¸€æ­¥æ˜¯è°ƒç”¨å¯¹è±¡çš„ææ„å‡½æ•°ï¼Œç¬¬äºŒæ­¥æ˜¯å›æ”¶å†…å­˜ï¼Œä½†æ˜¯è¦æ³¨æ„è¿™ä¸¤æ­¥ä¸æ˜¯åœ¨GCä¸€æ¬¡è½®å¾ªå®Œæˆï¼Œå³éœ€è¦ä¸¤æ¬¡è½®å¾ªï¼›ç›¸å¯¹äºåè€…ï¼Œåˆ™åªæ˜¯å›æ”¶å†…å­˜è€Œå·²ã€‚ C#ä¸­çš„GCä½¿ç”¨äº†Generationçš„æ¦‚å¿µï¼Œå®ƒå°†åˆ†é…çš„å¯¹è±¡åˆ†ä¸º3ä»£(å¯ç”¨GC.GetGenerationæ–¹æ³•è¿”å›ä»»æ„ä½œä¸ºå‚æ•°çš„å¯¹è±¡å½“å‰æ‰€å¤„çš„ä»£)ã€‚ æœ€è¿‘è¢«åˆ†é…å†…å­˜çš„å¯¹è±¡è¢«æ”¾ç½®äºç¬¬0ä»£ï¼Œå› ä¸ºç¬¬0ä»£å¾ˆå°ï¼Œå°åˆ°è¶³ä»¥æ”¾è¿›å¤„ç†å™¨çš„äºŒçº§ï¼ˆL2)ç¼“å­˜ï¼Œæ‰€ä»¥å®ƒèƒ½å¤Ÿæä¾›å¯¹å¯¹è±¡çš„å¿«é€Ÿå­˜å–ã€‚ç»è¿‡ä¸€è½®åƒåœ¾å›æ”¶åï¼Œä»ç„¶ä¿ç•™åœ¨ç¬¬0ä»£ä¸­çš„å¯¹è±¡è¢«ç§»è¿›ç¬¬1ä»£ä¸­ï¼Œå†ç»è¿‡ä¸€è½®åƒåœ¾å†…å­˜å›æ”¶åï¼Œä»ç„¶ä¿ç•™åœ¨ç¬¬1ä»£ä¸­çš„å¯¹è±¡åˆ™è¢«ç§»è¿›ç¬¬2ä»£ä¸­ï¼Œç¬¬2ä»£ä¸­åŒ…å«äº†ç”Ÿå­˜æœŸè¾ƒé•¿çš„å¯¹è±¡ã€‚ å½“ç¬¬0ä»£ä¸­æ²¡æœ‰å¯ä»¥åˆ†é…çš„æœ‰æ•ˆå†…å­˜æ—¶ï¼Œå°±è§¦å‘äº†ç¬¬0ä»£ä¸­çš„ä¸€è½®åƒåœ¾å›æ”¶ï¼Œå®ƒå°†åˆ é™¤é‚£äº›ä¸å†è¢«å¼•ç”¨çš„å¯¹è±¡ï¼Œå¹¶å°†å½“å‰æ­£åœ¨ä½¿ç”¨çš„å¯¹è±¡ç§»è‡³ç¬¬1ä»£ã€‚è€Œå½“ç¬¬0ä»£åƒåœ¾å›æ”¶åä¾ç„¶ä¸èƒ½è¯·æ±‚åˆ°å……è¶³çš„å†…å­˜æ—¶ï¼Œå°±å¯åŠ¨ç¬¬1ä»£åƒåœ¾å›æ”¶ã€‚å¦‚æœå¯¹å„ä»£éƒ½è¿›è¡Œäº†åƒåœ¾å›æ”¶åä»æ²¡æœ‰å¯ç”¨çš„å†…å­˜å°±ä¼šå¼•å‘ä¸€ä¸ªOutOfMemoryExceptionå¼‚å¸¸ã€‚ Close Dispose ææ„å‡½æ•° å…³é—­å¯¹è±¡èµ„æº é”€æ¯å¯¹è±¡ é”€æ¯å¯¹è±¡ è°ƒç”¨æ–¹å¼ éœ€è¦æ˜¾ç¤ºè°ƒç”¨ éœ€è¦æ˜¾ç¤ºè°ƒç”¨æˆ–è€…é€šè¿‡usingè¯­å¥ ä¸èƒ½è¢«æ˜¾ç¤ºè°ƒç”¨ï¼Œä¼šè¢«GCè°ƒç”¨ è°ƒç”¨æ—¶æœº åœ¨æ˜¾ç¤ºè°ƒç”¨æ—¶ åœ¨æ˜¾ç¤ºè°ƒç”¨æˆ–è€…ç¦»å¼€usingç¨‹åºå— ä¸ç¡®å®š","categories":[{"name":"Work","slug":"Work","permalink":"https://blog.eganx.cn/categories/Work/"},{"name":"C#","slug":"Work/C","permalink":"https://blog.eganx.cn/categories/Work/C/"}],"tags":[{"name":"C#","slug":"C","permalink":"https://blog.eganx.cn/tags/C/"},{"name":"GC","slug":"GC","permalink":"https://blog.eganx.cn/tags/GC/"}]},{"title":"Goç‰ˆæœ¬åˆ‡æ¢","slug":"Go_Version_switching","date":"2022-01-05T13:06:11.000Z","updated":"2022-11-15T09:02:25.162Z","comments":true,"path":"2022/01/05/Go_Version_switching/","link":"","permalink":"https://blog.eganx.cn/2022/01/05/Go_Version_switching/","excerpt":"çº¿ä¸Šçš„ç¨‹åºç”¨çš„æ˜¯è€ç‰ˆæœ¬çš„Go(æ¯•ç«Ÿæ¯”è¾ƒç¨³)ï¼Œè‡ªå·±åˆæƒ³å°è¯•æ–°çš„ç‰ˆæœ¬ç‰¹æ€§ã€‚ä¹…è€Œä¹…ä¹‹ï¼Œç”µè„‘é‡Œé¢SDKçš„ç‰ˆæœ¬å°±è¶Šæ¥è¶Šå¤šäº†ï¼Œæ¯æ¬¡åˆ‡æ¢èµ·æ¥å°±å¾ˆéº»çƒ¦ã€‚æ‰€ä»¥ç‰¹æ­¤è®°å½•ä¸€ä¸‹ã€‚","text":"çº¿ä¸Šçš„ç¨‹åºç”¨çš„æ˜¯è€ç‰ˆæœ¬çš„Go(æ¯•ç«Ÿæ¯”è¾ƒç¨³)ï¼Œè‡ªå·±åˆæƒ³å°è¯•æ–°çš„ç‰ˆæœ¬ç‰¹æ€§ã€‚ä¹…è€Œä¹…ä¹‹ï¼Œç”µè„‘é‡Œé¢SDKçš„ç‰ˆæœ¬å°±è¶Šæ¥è¶Šå¤šäº†ï¼Œæ¯æ¬¡åˆ‡æ¢èµ·æ¥å°±å¾ˆéº»çƒ¦ã€‚æ‰€ä»¥ç‰¹æ­¤è®°å½•ä¸€ä¸‹ã€‚ 0x0.æ‰‹åŠ¨ç®¡ç†(ç›®å‰ä½¿ç”¨çš„åˆ‡æ¢æ–¹å¼)å®˜ç½‘ä¸‹è½½æœ€æ–°ç‰ˆArchiveæ–‡ä»¶go1.18beta1.darwin-amd64.tar.gz è§£å‹ç¼©é‡å‘½ågo1.18.beta1,æ‹·è´ä¸€ä»½æ”¾åˆ°é»˜è®¤å®‰è£…è·¯å¾„/usr/local/go1.18beta1 sudo cp -R /User/egan/Sdks/go1.18beta1 /usr/local/go1.18beta1 è¿›å…¥é»˜è®¤å®‰è£…è·¯å¾„ï¼Œåˆ›å»ºè½¯é“¾ cd /usr/local/sudo ln -s go1.18beta1 go 0x1.ç‰ˆæœ¬åˆ‡æ¢å·¥å…·1).gGitHub: https:&#x2F;&#x2F;github.com&#x2F;voidint&#x2F;g 2).goupGithub: https:&#x2F;&#x2F;github.com&#x2F;owenthereal&#x2F;goup","categories":[{"name":"Golang","slug":"Golang","permalink":"https://blog.eganx.cn/categories/Golang/"}],"tags":[{"name":"go","slug":"go","permalink":"https://blog.eganx.cn/tags/go/"},{"name":"ç‰ˆæœ¬åˆ‡æ¢","slug":"ç‰ˆæœ¬åˆ‡æ¢","permalink":"https://blog.eganx.cn/tags/%E7%89%88%E6%9C%AC%E5%88%87%E6%8D%A2/"}]},{"title":"C#å†…å­˜æ³„éœ²","slug":"CSharp_OOM","date":"2022-01-03T04:31:19.000Z","updated":"2022-11-20T02:42:25.089Z","comments":true,"path":"2022/01/03/CSharp_OOM/","link":"","permalink":"https://blog.eganx.cn/2022/01/03/CSharp_OOM/","excerpt":"è®°å½•è‡ªå·±å¹²çš„è ¢äº‹ï¼Œè¿™ä¹Ÿæ˜¯è‡ªå·±ç¬¬ä¸€æ¬¡åœ¨å·¥ä½œä¸­å†™å‡ºæ¥å†…å­˜æ³„æ¼ã€‚å¹¸äºç¨‹åºæ²¡æœ‰ç›´æ¥ä¸Šçº¿ï¼Œä»¥åè¿˜æ˜¯è¦å¤šæµ‹è¯•æµ‹è¯•è‡ªå·±çš„ä»£ç ã€‚","text":"è®°å½•è‡ªå·±å¹²çš„è ¢äº‹ï¼Œè¿™ä¹Ÿæ˜¯è‡ªå·±ç¬¬ä¸€æ¬¡åœ¨å·¥ä½œä¸­å†™å‡ºæ¥å†…å­˜æ³„æ¼ã€‚å¹¸äºç¨‹åºæ²¡æœ‰ç›´æ¥ä¸Šçº¿ï¼Œä»¥åè¿˜æ˜¯è¦å¤šæµ‹è¯•æµ‹è¯•è‡ªå·±çš„ä»£ç ã€‚ 0x0.é—®é¢˜äº§ç”ŸåŸå› åœ¨button1.Click += Button1_Clickä¸­ï¼Œ(+=) æ¥ä¸ºäº‹ä»¶é™„åŠ äº‹ä»¶å¤„ç†ç¨‹åº public Form1()&#123; InitializeComponent(); button1.Click += Button1_Click;&#125;private void Button1_Click(object sender, EventArgs e) &#123; System.Diagnostics.Debug.Print(&quot;x&quot;); &#125; public event EventHandler Click;public delegate void EventHandler(object sender, EventArgs e); ç»™button1_Clickçš„é™„åŠ äº‹ä»¶å¤„ç†ç¨‹åºæ”¾åœ¨äº†å¿ƒè·³é‡Œé¢ï¼› æ­¤æ¬¡æº¢å‡ºæ˜¯å› ä¸ºæ¯æ¬¡å¿ƒè·³ï¼Œåˆè¿›è¡Œäº†ä¸€æ¬¡äº‹ä»¶å¤„ç†ç¨‹åºçš„é™„åŠ ï¼Œé€ æˆä¸æ–­é™„ä»¶äº‹ä»¶å¤„ç†ç¨‹åºã€‚ ç›´è‡³æœ€åï¼Œç‚¹å‡»ä¸€æ¬¡ï¼Œè¦è¿è¡Œ2K+æ¬¡çš„äº‹ä»¶å¤„ç†ç¨‹åºã€‚ è€Œäº‹ä»¶å¤„ç†ç¨‹åºçš„ä»£ç é‡Œé¢ä¼šä½¿ç”¨åˆ›å»ºæ–°çš„çº¿ç¨‹ï¼Œè¿è¡Œä¸€æ¬¡ï¼Œåˆ›å»ºå¤§é‡çš„æ–°çº¿ç¨‹ï¼Œçº¿ç¨‹æ•°ç›´æ¥é£™å‡ï¼Œå†…å­˜å´©æ‰ã€‚ 0x1.å®šä½å†…å­˜æ³„éœ²å‘ç”Ÿçš„åœ°æ–¹ï¼šC#çš„ä»£ç å¯ä»¥ä½¿ç”¨å†…å­˜åˆ†æå·¥å…·dotMemoryã€‚dotMemoryå…è®¸ä½ åˆ†æå„ç§.NETå’Œ.NET Coreåº”ç”¨ç¨‹åºçš„å†…å­˜ä½¿ç”¨æƒ…å†µï¼›æ¯”å¦‚æ¡Œé¢åº”ç”¨ç¨‹åºã€WindowsæœåŠ¡ã€ASP.NET Webåº”ç”¨ç¨‹åºã€IISã€IIS Expressã€ä»»æ„.NETè¿›ç¨‹ç­‰ã€‚ä¸è¿‡ä¸´æ—¶ç”¨ä¸€ä¸‹å¯ä»¥ï¼Œæœ‰30å¤©çš„è¯•ç”¨æœŸï¼Œè¿˜æ˜¯æ¯”è¾ƒå¥½ç”¨çš„ã€‚ æº¢å‡ºç‰ˆæœ¬æºç ç¤ºä¾‹: namespace WindowsFormsApp1&#123; public partial class Form1 : Form &#123; private static int i = 0; public Form1() &#123; InitializeComponent(); button1.Click += Button1_Click; &#125; private void Cycle() &#123; button1.Click += Button1_Click; &#125; private void Button1_Click(object sender, EventArgs e) &#123; i += 1; System.Diagnostics.Debug.Print(&quot;x:&#123;0&#125;&quot;,i); Cycle(); &#125; &#125;&#125; æ­£å¸¸ç‰ˆæœ¬æºç ç¤ºä¾‹ï¼š namespace WindowsFormsApp1&#123; public partial class Form1 : Form &#123; private static int i = 0; public Form1() &#123; InitializeComponent(); button1.Click += Button1_Click; &#125; private void Button1_Click(object sender, EventArgs e) &#123; i += 1; System.Diagnostics.Debug.Print(&quot;x:&#123;0&#125;&quot;,i); &#125; &#125;&#125;","categories":[{"name":"Work","slug":"Work","permalink":"https://blog.eganx.cn/categories/Work/"},{"name":"C#","slug":"Work/C","permalink":"https://blog.eganx.cn/categories/Work/C/"}],"tags":[{"name":"C#","slug":"C","permalink":"https://blog.eganx.cn/tags/C/"},{"name":"OOM","slug":"OOM","permalink":"https://blog.eganx.cn/tags/OOM/"}]},{"title":"C#ä¸²å£è¯»å†™è¿ç»­æ€§é—®é¢˜","slug":"CSharp_Serial_port_readwrite_continuity_problem","date":"2022-01-01T03:31:19.000Z","updated":"2022-11-20T02:42:29.078Z","comments":true,"path":"2022/01/01/CSharp_Serial_port_readwrite_continuity_problem/","link":"","permalink":"https://blog.eganx.cn/2022/01/01/CSharp_Serial_port_readwrite_continuity_problem/","excerpt":"åœ¨ä½¿ç”¨ä¸²å£åè®®è¿›è¡Œè‡ªå®šä¹‰åè®®è¯»å†™çš„æ—¶å€™ï¼Œä¸€èˆ¬ä½¿ç”¨Asciiç¼–ç ã€‚ä½†æ˜¯ä¸²å£ä¸­è¯»å–åˆ°çš„æ•°æ®å¹¶ä¸èƒ½ä¿è¯å…¶å®Œæ•´æ€§ã€‚ä¸€æ¡æŒ‡ä»¤æœ‰å¯èƒ½ä¼šè¢«æ‹†åˆ†æˆå¤šæ¡æ•°æ®å‘é€ï¼Œè¯»å–åˆ°çš„å­—ç¬¦ä¸²æœ‰å¯èƒ½åªæ˜¯å…¶ä¸­çš„ä¸€éƒ¨åˆ†ã€‚ä¸€èˆ¬ä¸€æ¡æŒ‡ä»¤çš„æœ«å°¾éƒ½ä¼šåŠ ä¸Š\\n\\rä½œä¸ºç»“æŸç¬¦ã€‚","text":"åœ¨ä½¿ç”¨ä¸²å£åè®®è¿›è¡Œè‡ªå®šä¹‰åè®®è¯»å†™çš„æ—¶å€™ï¼Œä¸€èˆ¬ä½¿ç”¨Asciiç¼–ç ã€‚ä½†æ˜¯ä¸²å£ä¸­è¯»å–åˆ°çš„æ•°æ®å¹¶ä¸èƒ½ä¿è¯å…¶å®Œæ•´æ€§ã€‚ä¸€æ¡æŒ‡ä»¤æœ‰å¯èƒ½ä¼šè¢«æ‹†åˆ†æˆå¤šæ¡æ•°æ®å‘é€ï¼Œè¯»å–åˆ°çš„å­—ç¬¦ä¸²æœ‰å¯èƒ½åªæ˜¯å…¶ä¸­çš„ä¸€éƒ¨åˆ†ã€‚ä¸€èˆ¬ä¸€æ¡æŒ‡ä»¤çš„æœ«å°¾éƒ½ä¼šåŠ ä¸Š\\n\\rä½œä¸ºç»“æŸç¬¦ã€‚ 0x0.åˆ›å»ºè¿æ¥ä¸²å£ä½¿ç”¨System.IO.Ports.SerialPortæ¥åˆ›å»ºè¿æ¥ //// æ‘˜è¦:// ä½¿ç”¨æŒ‡å®šçš„ç«¯å£åã€æ³¢ç‰¹ç‡ã€å¥‡å¶æ ¡éªŒä½ã€æ•°æ®ä½å’Œåœæ­¢ä½åˆå§‹åŒ– System.IO.Ports.SerialPort ç±»çš„æ–°å®ä¾‹ã€‚//// å‚æ•°:// portName:// è¦ä½¿ç”¨çš„ç«¯å£ï¼ˆä¾‹å¦‚ COM1ï¼‰ã€‚//// baudRate:// æ³¢ç‰¹ç‡ã€‚//// parity:// System.IO.Ports.SerialPort.Parity å€¼ä¹‹ä¸€ã€‚//// dataBits:// æ•°æ®ä½å€¼ã€‚//// stopBits:// System.IO.Ports.SerialPort.StopBits å€¼ä¹‹ä¸€ã€‚//// å¼‚å¸¸:// T:System.IO.IOException:// æœªèƒ½æ‰¾åˆ°æˆ–æ‰“å¼€æŒ‡å®šçš„ç«¯å£ã€‚public SerialPort(string portName, int baudRate, Parity parity, int dataBits, StopBits stopBits); å…¶ä¸­Parityå’ŒStopBitsçš„æšä¸¾åˆ†åˆ«ä¸ºï¼š //// æ‘˜è¦:// æŒ‡å®š System.IO.Ports.SerialPort å¯¹è±¡çš„å¥‡å¶æ ¡éªŒä½ã€‚public enum Parity&#123; // // æ‘˜è¦: // ä¸å‘ç”Ÿå¥‡å¶æ ¡éªŒæ£€æŸ¥ã€‚ None = 0, // // æ‘˜è¦: // è®¾ç½®å¥‡å¶æ ¡éªŒä½ï¼Œä½¿ä½æ•°ç­‰äºå¥‡æ•°ã€‚ Odd = 1, // // æ‘˜è¦: // è®¾ç½®å¥‡å¶æ ¡éªŒä½ï¼Œä½¿ä½æ•°ç­‰äºå¶æ•°ã€‚ Even = 2, // // æ‘˜è¦: // å°†å¥‡å¶æ ¡éªŒä½ä¿ç•™ä¸º 1ã€‚ Mark = 3, // // æ‘˜è¦: // å°†å¥‡å¶æ ¡éªŒä½ä¿ç•™ä¸º 0ã€‚ Space = 4&#125; //// æ‘˜è¦:// æŒ‡å®šåœ¨ System.IO.Ports.SerialPort å¯¹è±¡ä¸Šä½¿ç”¨çš„åœæ­¢ä½çš„æ•°ç›®ã€‚public enum StopBits&#123; // // æ‘˜è¦: // ä¸ä½¿ç”¨åœæ­¢ä½ã€‚ System.IO.Ports.SerialPort.StopBits å±æ€§ä¸æ”¯æŒæ­¤å€¼ã€‚ None = 0, // // æ‘˜è¦: // ä½¿ç”¨ä¸€ä¸ªåœæ­¢ä½ã€‚ One = 1, // // æ‘˜è¦: // ä½¿ç”¨ä¸¤ä¸ªåœæ­¢ä½ã€‚ Two = 2, // // æ‘˜è¦: // ä½¿ç”¨ 1.5 ä¸ªåœæ­¢ä½ã€‚ OnePointFive = 3&#125; è¿æ¥å®Œæˆåéœ€è¦ä¿è¯ç«¯å£çš„å¼€å¯ï¼Œå¯ä½¿ç”¨IsOpenå‚æ•°è¿›è¡Œåˆ¤å®šã€‚ if (!Conn.IsOpen)&#123; Conn.Open();&#125; 0x1.æ•°æ®çš„è¯»å†™éƒ¨åˆ†ä½•æ—¶åœæ­¢è¯»å†™ï¼Œå¯ä»¥æ ¹æ®NewLineçš„å€¼è¿›è¡Œåˆ¤å®šã€‚NewLineçš„é»˜è®¤å€¼æ˜¯â€\\nâ€æ¢è¡Œç¬¦ï¼Œå¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚è¿›è¡Œæ›´æ”¹ã€‚â€\\r\\nâ€ä¹Ÿæ˜¯æ¯”è¾ƒå¸¸ç”¨çš„NewLineã€‚ //// æ‘˜è¦:// è·å–æˆ–è®¾ç½®ç”¨äºè§£é‡Š System.IO.Ports.SerialPort.ReadLine å’Œ System.IO.Ports.SerialPort.WriteLine(System.String)// æ–¹æ³•è°ƒç”¨ç»“æŸçš„å€¼ã€‚//// è¿”å›ç»“æœ:// è¡¨ç¤ºè¡Œå°¾çš„å€¼ã€‚ é»˜è®¤å€¼ä¸ºæ¢è¡Œç¬¦ï¼ŒSystem.Environment.NewLineã€‚//// å¼‚å¸¸:// T:System.ArgumentException:// å±æ€§å€¼ä¸ºç©ºã€‚//// T:System.ArgumentNullException:// å±æ€§å€¼ä¸º nullã€‚[Browsable(false)][DefaultValue(&quot;\\n&quot;)][MonitoringDescription(&quot;NewLine&quot;)]public string NewLine &#123; get; set; &#125; å¦‚æœä¸æƒ³ç›´æ¥è®¾ç½®NewLineï¼Œä¹Ÿå¯ä»¥åœ¨è¯»å–ä¸²å£æ•°æ®æ—¶ï¼Œæ ¹æ®è‡ªå®šä¹‰å­—ç¬¦è¿›è¡Œè¯»å–åˆ’åˆ†ã€‚ //// æ‘˜è¦:// ä¸€ç›´è¯»å–åˆ°è¾“å…¥ç¼“å†²åŒºä¸­çš„æŒ‡å®š value çš„å­—ç¬¦ä¸²ã€‚//// å‚æ•°:// value:// æŒ‡ç¤ºè¯»å–æ“ä½œåœæ­¢ä½ç½®çš„å€¼ã€‚//// è¿”å›ç»“æœ:// è¾“å…¥ç¼“å†²åŒºä¸­ç›´åˆ°æŒ‡å®š value çš„å†…å®¹ã€‚//// å¼‚å¸¸:// T:System.ArgumentException:// value å‚æ•°çš„é•¿åº¦ä¸º 0ã€‚//// T:System.ArgumentNullException:// value å‚æ•°ä¸º nullã€‚//// T:System.InvalidOperationException:// æŒ‡å®šçš„ç«¯å£æœªæ‰“å¼€ã€‚//// T:System.TimeoutException:// è¯¥æ“ä½œæœªåœ¨è¶…æ—¶æ—¶é—´åˆ°æœŸä¹‹å‰å®Œæˆã€‚public string ReadTo(string value); string reqStr = Conn.ReadTo(&quot;\\r\\n&quot;); è¿™æ ·è¯»å–å‡ºæ¥çš„æ•°æ®å°±å¯ä»¥æ—¶ä¸€æ¡æ¡å®Œæ•´çš„æŒ‡ä»¤ï¼Œè€Œä¸ä¼šå‡ºç°è¢«åˆ†éš”çš„æŒ‡ä»¤ç‰‡æ®µã€‚","categories":[{"name":"Work","slug":"Work","permalink":"https://blog.eganx.cn/categories/Work/"},{"name":"C#","slug":"Work/C","permalink":"https://blog.eganx.cn/categories/Work/C/"}],"tags":[{"name":"C#","slug":"C","permalink":"https://blog.eganx.cn/tags/C/"},{"name":"Serial","slug":"Serial","permalink":"https://blog.eganx.cn/tags/Serial/"}]},{"title":"åä¸ºODç¬”è¯•","slug":"Huawei_OD_exam","date":"2021-03-09T03:30:12.000Z","updated":"2022-11-20T02:40:46.138Z","comments":true,"path":"2021/03/09/Huawei_OD_exam/","link":"","permalink":"https://blog.eganx.cn/2021/03/09/Huawei_OD_exam/","excerpt":"ç¬¬ä¸€æ¬¡å‚åŠ åä¸ºODçš„ç¬”è¯•ï¼Œä½œä¸ºå‚åŠ è¿‡ç²¾è‹±ç¬”è¯•çš„ä¼˜ç§€é’å¹´ã€‚æˆ‘è¿˜æ˜¯æƒ³è®°å½•ä¸€ä¸‹çš„ã€‚è¯´å®è¯é¢˜ç›®è¿˜è¡Œï¼Œä½†æ˜¯è£¸è€ƒè¿˜æ˜¯æœ‰ç‚¹éš¾åº¦çš„(ä¸ªäººè§‚ç‚¹ï¼Œæˆ–è®¸æ˜¯æˆ‘èœçš„è¿‡åˆ†äº†)ã€‚","text":"ç¬¬ä¸€æ¬¡å‚åŠ åä¸ºODçš„ç¬”è¯•ï¼Œä½œä¸ºå‚åŠ è¿‡ç²¾è‹±ç¬”è¯•çš„ä¼˜ç§€é’å¹´ã€‚æˆ‘è¿˜æ˜¯æƒ³è®°å½•ä¸€ä¸‹çš„ã€‚è¯´å®è¯é¢˜ç›®è¿˜è¡Œï¼Œä½†æ˜¯è£¸è€ƒè¿˜æ˜¯æœ‰ç‚¹éš¾åº¦çš„(ä¸ªäººè§‚ç‚¹ï¼Œæˆ–è®¸æ˜¯æˆ‘èœçš„è¿‡åˆ†äº†)ã€‚ 0x0.ç¬¬ä¸€é¢˜ç”¨ä¸€ä¸ªæ•°ç»„Aï¼Œä»£è¡¨ç¨‹åºå‘˜çš„å·¥ä½œèƒ½åŠ›ã€‚å…¬å¸æƒ³é€šè¿‡ç»“å¯¹ç¼–ç¨‹çš„æ¨¡å¼æ¥æé«˜å‘˜å·¥çš„å·¥ä½œèƒ½åŠ›ï¼Œå‡è®¾æˆå¯¹åçš„èƒ½åŠ›æ˜¯ä¸¤ä¸ªå‘˜å·¥çš„èƒ½åŠ›ä¹‹å’Œï¼Œæ±‚ä¸€å…±æœ‰å¤šå°‘ç§ç»“å¯¹æ–¹å¼ï¼Œä½¿ç»“å¯¹åçš„èƒ½åŠ›ä¸ºNã€‚ æç¤ºï¼š 1. ç¬¬ä¸€è¡Œä»£è¡¨å‘˜å·¥ä¸ªæ•°2. ç¬¬äºŒè¡Œä»£è¡¨å„ä¸ªå‘˜å·¥çš„èƒ½åŠ›å€¼3. ç¬¬ä¸‰è¡Œä»£è¡¨ç»“å¯¹åçš„èƒ½åŠ›å€¼N4. è¾“å‡ºä¸ºç»“å¯¹çš„ç»„åˆæ–¹å¼çš„å€¼ ç¤ºä¾‹ï¼š è¾“å…¥ï¼š51 2 2 2 34è¾“å‡ºï¼š4 1).è§£é¢˜æ€è·¯è¯´å®è¯è¿™é¢˜æ”¾åœ¨åä¸ºODçš„ç¬”è¯•é‡Œé¢ï¼Œåº”è¯¥æ˜¯å±äºé€åˆ†é¢˜ï¼Œä¸€ä¸ªè¾“å…¥æ•°ç»„åŠ ä¸¤å±‚forå¾ªç¯ç›´æ¥è§£å°±è¡Œï¼Œç›´æ¥é™„ä¸Šä»£ç å°±ç®—äº†ã€‚ 2).ä»£ç å®ç°//// main.cpp// Demo//// Created by Egan.// #include &lt;iostream&gt;#include &lt;algorithm&gt;#include &lt;stack&gt;#include &lt;vector&gt;#include &lt;numeric&gt;#include &lt;cctype&gt;using namespace std; int main() &#123; int n,N; int arr[1001]; int count =0; cin &gt;&gt; n; for(int i = 0; i &lt; n; i++)&#123; cin &gt;&gt; arr[i]; &#125; cin &gt;&gt; N; for(int x =0; x &lt; n; x++ )&#123; for(int y= x+1; y &lt;n; y++ )&#123; if(arr[x]+arr[y] == N) count += 1; &#125; &#125; cout &lt;&lt; count &lt;&lt;endl;&#125; 0x1.é”™è¯¯çš„é‡Œç¨‹è¡¨ä¸€ä¸ªæ±½è½¦é‡Œç¨‹è¡¨ï¼Œå®ƒä»¥æ•´æ•°å½¢å¼æ˜¾ç¤ºè¡Œé©¶çš„è‹±é‡Œæ•°ã€‚ç„¶è€Œï¼Œé‡Œç¨‹è¡¨æœ‰ä¸€ä¸ªç¼ºé™·:å®ƒä»æ•°å­—3è½¬åˆ°æ•°å­—5ï¼Œæ€»æ˜¯è·³è¿‡æ•°å­—4ã€‚è¿™ä¸ªç¼ºé™·å‡ºç°åœ¨æ‰€æœ‰çš„ä½ç½®(1,10,100ï¼Œç­‰ç­‰)ã€‚ä¾‹å¦‚ï¼Œå¦‚æœé‡Œç¨‹è¡¨æ˜¾ç¤ºä¸º15339ï¼Œè€Œæ±½è½¦è¡Œé©¶äº†1è‹±é‡Œï¼Œé‡Œç¨‹è¡¨çš„è¯»æ•°å°†æ›´æ”¹ä¸º15350(è€Œä¸æ˜¯15340)ã€‚ æç¤ºï¼š 1. è¾“å…¥ä¸ºé‡Œç¨‹è¡¨ä¸Šçš„æ•°å€¼2. è¾“å‡ºä¸ºå®é™…è½¦å­è¡Œé©¶çš„æ•°å€¼ ç¤ºä¾‹ï¼š è¾“å…¥1ï¼š5è¾“å‡º1ï¼š3è¾“å…¥2ï¼š17è¾“å‡º2ï¼š15è¾“å…¥3ï¼š100è¾“å‡º3ï¼š81 1).è§£é¢˜æ€è·¯é‡åˆ°4åˆ™ç›´æ¥ä»3è¿›ä½åˆ°5ï¼Œæ‰€ä»¥è¿™æ˜¯ä¸€é“å…¸å‹çš„è¿›åˆ¶è½¬åŒ–é—®é¢˜ï¼Œéå†è¯¥æ•°å­—çš„æ¯ä¸€ä½ï¼ˆå¦‚æœè¿™ä¸€ä½çš„æ•°å­—æ¯”4å¤§ï¼Œå°±è¦å‡å»1ï¼Œå› ä¸ºè¿™ä¸ªä½è·³è¿‡äº†ä¸€ä¸ª4ï¼‰ï¼Œç„¶åå†éå†è¯¥æ•°å­—çš„æ¯ä¸€ä½ï¼Œå°†å…¶è½¬åŒ–ä¸º10è¿›åˆ¶ã€‚ 2).ä»£ç å®ç°//// main.cpp// Demo//// Created by Egan.//#include &lt;iostream&gt;#include &lt;string&gt;#include &lt;cstdio&gt;using namespace std;int main()&#123; string n; for (int i = 0;; i++) &#123; cin &gt;&gt; n; if(n[0] == &#x27;0&#x27;)&#123; break; &#125; int j = n.size; long long num = 0; ans = 1; for (int m = j-1; m &gt;= 0; m--) &#123; if((n[m]-&#x27;0&#x27;)&gt;4)&#123; num += ((n[m]-&#x27;0&#x27;)-1) * ans; &#125; else&#123; num += (n[m]-&#x27;0&#x27;) * ans; &#125; ans = ans * 9; &#125; cout &lt;&lt; n &lt;&lt; &quot;:&quot;&lt;&lt;num&lt;&lt;endl; &#125;&#125; 0x2.è´ªåƒè›‡ç®—æ³•é¢˜ç›®å¤ªé•¿ï¼Œå…·ä½“çš„è®°ä¸æ¸…æ¥šäº†ï¼Œåªèƒ½å¤§è‡´çš„æè¿°ä¸€ä¸‹ã€‚ã€‚ã€‚ã€‚ è¾“å…¥ä¸€ä¸ªå­—ç¬¦çŸ©é˜µï¼Œå…¶ä¸­å­—ç¬¦Eæ˜¯é£Ÿç‰©(è›‡åƒäº†é•¿åº¦+1çš„é‚£ç§)ï¼ŒFæ˜¯ç©ºç™½ï¼ŒHæ˜¯è›‡çš„ä½ç½®(åˆå§‹åªå ä¸€ä¸ªä½ç½®) ç§»åŠ¨æŒ‡ä»¤æœ‰5ç§ï¼Œåˆ†åˆ«è®©è´ªåƒè›‡ç§»åŠ¨ä»¥åŠè½¬å‘ï¼šGå‰è¿›ã€Uå¾€ä¸Šè½¬ã€Då¾€ä¸‹è½¬ã€Lå¾€å·¦è½¬ã€Rå¾€å³è½¬ï¼ˆåˆå§‹æ–¹å‘ä¸ºå·¦ï¼‰ ç»“æŸæ¡ä»¶æ˜¯ç¢°å£æˆ–è€…ç¢°åˆ°è‡ªå·±å°±ç®—æ­»äº†ã€‚ æ±‚æŒ‰è¾“å…¥çš„æŒ‡ä»¤æ‰§è¡Œä¹‹åçš„è›‡çš„é•¿åº¦ã€‚ è¾“å…¥è¾“å‡ºç¤ºä¾‹ï¼š è¾“å…¥ï¼šD G G3F E FE E HF F Fè¾“å‡ºï¼š1","categories":[{"name":"Work","slug":"Work","permalink":"https://blog.eganx.cn/categories/Work/"}],"tags":[{"name":"C++","slug":"C","permalink":"https://blog.eganx.cn/tags/C/"},{"name":"åä¸ºOD","slug":"åä¸ºOD","permalink":"https://blog.eganx.cn/tags/%E5%8D%8E%E4%B8%BAOD/"},{"name":"ç¬”è¯•","slug":"ç¬”è¯•","permalink":"https://blog.eganx.cn/tags/%E7%AC%94%E8%AF%95/"}]},{"title":"åŸºç¡€è®¡ç®—å™¨II (Basic calculator II)","slug":"Basic_calculator_II","date":"2021-03-02T02:22:11.000Z","updated":"2022-11-20T02:41:25.456Z","comments":true,"path":"2021/03/02/Basic_calculator_II/","link":"","permalink":"https://blog.eganx.cn/2021/03/02/Basic_calculator_II/","excerpt":"æ ˆçš„ç»å…¸åº”ç”¨ï¼š ç»™ä¸€ä¸ªå­—ç¬¦ä¸²è¡¨è¾¾å¼ s ï¼Œå®ç°ä¸€ä¸ªåŸºæœ¬è®¡ç®—å™¨æ¥è®¡ç®—å¹¶è¿”å›å®ƒçš„å€¼ã€‚(æ•´æ•°é™¤æ³•ä»…ä¿ç•™æ•´æ•°éƒ¨åˆ†)","text":"æ ˆçš„ç»å…¸åº”ç”¨ï¼š ç»™ä¸€ä¸ªå­—ç¬¦ä¸²è¡¨è¾¾å¼ s ï¼Œå®ç°ä¸€ä¸ªåŸºæœ¬è®¡ç®—å™¨æ¥è®¡ç®—å¹¶è¿”å›å®ƒçš„å€¼ã€‚(æ•´æ•°é™¤æ³•ä»…ä¿ç•™æ•´æ•°éƒ¨åˆ†) æç¤ºï¼š 1. 1 &lt;&#x3D; s.length &lt;&#x3D; 3 * 10^52. s ç”±æ•´æ•°å’Œç®—ç¬¦(&#39;+&#39;, &#39;-&#39;, &#39;*&#39;, &#39;&#x2F;&#39;)ç»„æˆ,ä¸­é—´ç”±ä¸€äº›ç©ºæ ¼éš”å¼€3. s è¡¨ç¤ºä¸€ä¸ªæœ‰æ•ˆè¡¨è¾¾å¼4. è¡¨è¾¾å¼ä¸­çš„æ‰€æœ‰æ•´æ•°éƒ½æ˜¯éè´Ÿæ•´æ•°,ä¸”åœ¨èŒƒå›´[0, 231 - 1]å†…5. é¢˜ç›®æ•°æ®ä¿è¯ç­”æ¡ˆæ˜¯ä¸€ä¸ª32-bitæ•´æ•° ç¤ºä¾‹ï¼š è¾“å…¥ï¼šs &#x3D; &quot;3+2*2&quot;è¾“å‡ºï¼š7 0x0.è§£é¢˜æ€è·¯æ ˆçš„ç»å…¸åº”ç”¨ï¼Œæ­¤é¢˜æ²¡æœ‰æ‹¬å·ï¼Œä¸éœ€è¦è¿›è¡Œæ‹¬å·åŒ¹é…ï¼Œç›¸å¯¹æ¥è¯´ç®€å•ä¸€ç‚¹ï¼Œå¯ä»¥ç›´æ¥è¿›è¡Œæš´åŠ›æ±‚è§£ã€‚ éœ€è¦è€ƒè™‘è¿ç®—ç¬¦çš„ä¼˜å…ˆçº§é—®é¢˜ã€‚ä¹˜é™¤çš„ä¼˜å…ˆçº§å¤§äºåŠ å‡ï¼Œå¯ä»¥å…ˆè¿›è¡Œä¹˜é™¤è¿ç®—ï¼Œç”¨ä¸€ä¸ªæ ˆï¼Œä¿å­˜è¿›è¡Œä¹˜é™¤è¿ç®—åçš„æ•´æ•°çš„å€¼ã€‚å¯¹äºåŠ å‡å·åçš„æ•°å­—ï¼Œå°†å…¶ç›´æ¥å‹å…¥æ ˆä¸­ï¼›å¯¹äºä¹˜é™¤å·åçš„æ•°å­—ï¼Œç›´æ¥ä¸æ ˆé¡¶å…ƒç´ è®¡ç®—ï¼Œå¹¶æ›¿æ¢æ ˆé¡¶å…ƒç´ ä¸ºè®¡ç®—åçš„ç»“æœã€‚ éå†å­—ç¬¦ä¸² sï¼Œå¹¶ç”¨å˜é‡preSignè®°å½•æ¯ä¸ªæ•°å­—ä¹‹å‰çš„è¿ç®—ç¬¦ï¼Œå¯¹äºç¬¬ä¸€ä¸ªæ•°å­—ï¼Œå…¶ä¹‹å‰çš„è¿ç®—ç¬¦è§†ä¸ºåŠ å·ã€‚éå†åˆ°è¿ç®—ç¬¦æˆ–è€…å­—ç¬¦ä¸²æœ€åä¸€ä½æ—¶ï¼Œæ ¹æ®preSignæ¥å†³å®šè®¡ç®—æ–¹å¼: åŠ å·ï¼šæ•°å­—ç›´æ¥å…¥æ ˆï¼› å‡å·ï¼šnumå˜(-num)å…¥æ ˆï¼› ä¹˜é™¤ï¼šnum ( * or / ) stack.back()ï¼Œå¹¶å°†æ ˆé¡¶å…ƒç´ æ›¿æ¢ä¸ºè¿ç®—ç»“æœã€‚ 0x1.å¤æ‚åº¦åˆ†æ æ—¶é—´å¤æ‚åº¦ï¼šO(n)ï¼Œå…¶ä¸­nä¸ºå­—ç¬¦ä¸²sçš„é•¿åº¦ã€‚éœ€è¦éå†å­—ç¬¦ä¸²sä¸€æ¬¡ï¼Œè®¡ç®—è¡¨è¾¾å¼çš„å€¼ã€‚ ç©ºé—´å¤æ‚åº¦ï¼šO(n)ï¼Œå…¶ä¸­nä¸ºå­—ç¬¦ä¸²sçš„é•¿åº¦ã€‚ç©ºé—´å¤æ‚åº¦ä¸»è¦å–å†³äºæ ˆçš„ç©ºé—´ï¼Œæ ˆçš„å…ƒç´ ä¸ªæ•°ä¸è¶…è¿‡nã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ åœ¨è¿ç®—çš„æ—¶å€™ï¼Œåˆ¤æ–­å­—ç¬¦æ˜¯æ•°å­—è¿˜æ˜¯è¿ç®—ç¬¦çš„æ—¶å€™ï¼Œéœ€è¦ä½¿ç”¨isdigit()å‡½æ•°ï¼Œæ­¤å‡½æ•°åŒ…å«åœ¨å¤´æ–‡ä»¶#include &lt;cctype&gt;ä¸­ã€‚ è¿ç®—çš„æ—¶å€™ï¼Œå¦‚æœé‡åˆ°çš„æ•°æ˜¯å¤§æ•°(ä¸¤ä½æ•°åŠä»¥ä¸Šçš„)ï¼Œéœ€è¦è¿›è¡Œå¤„ç†ã€‚å¤§æ•°åœ¨å­—ç¬¦ä¸²ä¸­æ˜¯ä¸¤ä¸ªå­—ç¬¦ï¼Œéœ€è¦åœ¨éå†å­—ç¬¦ä¸²æ—¶ï¼Œä½¿ç”¨num = num * 10 + int (s[i] - &#39;0&#39;);å¯¹å¤§æ•°è¿›è¡Œå¤„ç†ã€‚ åœ¨ä¹˜é™¤è¿ç®—çš„ç»“æœéƒ½æ¨¡æ‹Ÿå…¥æ ˆä¹‹åï¼Œä½¿ç”¨ç´¯åŠ å‡½æ•°accumulate(st.begin(), st.end(), 0);å¯¹æ•°ç»„è¿›è¡Œç´¯åŠ å¤„ç†ï¼Œaccumulate()å‡½æ•°åŒ…å«åœ¨å¤´æ–‡ä»¶#include &lt;numeric&gt;ä¸­ï¼Œç´¯åŠ è¿‡ç¨‹ä¸­ï¼Œæ­£è´Ÿæ•°éƒ½å¯ä»¥å¤„ç†ã€‚ 0x2.ä»£ç å®ç°//// main.cpp// Demo//// Created by Egan.// #include &lt;iostream&gt;#include &lt;algorithm&gt;#include &lt;stack&gt;#include &lt;vector&gt;#include &lt;numeric&gt;#include &lt;cctype&gt;using namespace std; int main() &#123; class Solution &#123; public: int calculate(string s) &#123; vector&lt;int&gt; st; //digits char ps = &#x27;+&#x27;; //presign int num = 0; for(int i = 0; i &lt; s.length(); i++)&#123; if (isdigit(s[i]))&#123; //#include &lt;cctype&gt; num = num * 10 + int (s[i] - &#x27;0&#x27;); &#125; if (!isdigit(s[i]) &amp;&amp; s[i] != &#x27; &#x27; || i == s.length()-1)&#123; switch(ps)&#123; case &#x27;+&#x27; : st.push_back(num); break; case &#x27;-&#x27; : st.push_back(-num); break; case &#x27;*&#x27; : st.back() *= num; break; case &#x27;/&#x27; : st.back() /= num; break; &#125; ps = s[i]; num = 0; &#125; &#125; return accumulate(st.begin(), st.end(), 0); //#include&lt;numeric&gt; &#125;&#125;;&#125;","categories":[{"name":"Leetcode","slug":"Leetcode","permalink":"https://blog.eganx.cn/categories/Leetcode/"}],"tags":[{"name":"C++","slug":"C","permalink":"https://blog.eganx.cn/tags/C/"},{"name":"æ ˆ","slug":"æ ˆ","permalink":"https://blog.eganx.cn/tags/%E6%A0%88/"}]},{"title":"é€†æ³¢å…°è¡¨ç¤ºæ³•(Reverse Polish notation)","slug":"Reverse Polish notation","date":"2021-03-01T08:12:14.000Z","updated":"2022-11-20T02:41:34.945Z","comments":true,"path":"2021/03/01/Reverse Polish notation/","link":"","permalink":"https://blog.eganx.cn/2021/03/01/Reverse%20Polish%20notation/","excerpt":"æ ¹æ®é€†æ³¢å…°è¡¨ç¤ºæ³•ï¼Œæ±‚è¡¨è¾¾å¼çš„å€¼ã€‚ æœ‰æ•ˆçš„è¿ç®—ç¬¦åŒ…æ‹¬ +, -, *, / ã€‚æ¯ä¸ªè¿ç®—å¯¹è±¡å¯ä»¥æ˜¯æ•´æ•°ï¼Œä¹Ÿå¯ä»¥æ˜¯å¦ä¸€ä¸ªé€†æ³¢å…°è¡¨è¾¾å¼ã€‚","text":"æ ¹æ®é€†æ³¢å…°è¡¨ç¤ºæ³•ï¼Œæ±‚è¡¨è¾¾å¼çš„å€¼ã€‚ æœ‰æ•ˆçš„è¿ç®—ç¬¦åŒ…æ‹¬ +, -, *, / ã€‚æ¯ä¸ªè¿ç®—å¯¹è±¡å¯ä»¥æ˜¯æ•´æ•°ï¼Œä¹Ÿå¯ä»¥æ˜¯å¦ä¸€ä¸ªé€†æ³¢å…°è¡¨è¾¾å¼ã€‚ 0x0.è§£é¢˜æ€è·¯é€†æ³¢å…°è¡¨è¾¾å¼æ˜¯ä¸€ç§åç¼€è¡¨è¾¾å¼ï¼Œæ‰€è°“åç¼€å°±æ˜¯æŒ‡ç®—ç¬¦å†™åœ¨åé¢ã€‚ é€†æ³¢å…°è¡¨è¾¾å¼ä¸»è¦æœ‰ä»¥ä¸‹ä¸¤ä¸ªä¼˜ç‚¹ï¼š å»æ‰æ‹¬å·åè¡¨è¾¾å¼æ— æ­§ä¹‰ï¼Œ( 1 + 2 ) * ( 3 + 4 )å³ä¾¿å†™æˆ 1 2 + 3 4 + * ä¹Ÿå¯ä»¥ä¾æ®æ¬¡åºè®¡ç®—å‡ºæ­£ç¡®ç»“æœã€‚ é€‚åˆç”¨æ ˆæ“ä½œè¿ç®— é€†æ³¢å…°è¡¨è¾¾å¼çš„æ±‚è§£æ˜¯æ ˆçš„ç»å…¸åº”ç”¨ã€‚æ‰€ä»¥æ­¤é¢˜é‡‡ç”¨æ ˆæ¥è§£å†³ï¼Œé‡åˆ°æ•°å­—åˆ™å…¥æ ˆï¼Œé‡åˆ°è¿ç®—ç¬¦åˆ™å–å‡ºæ ˆé¡¶ä¸¤ä¸ªæ•°å­—è¿›è¡Œè¿ç®—ï¼Œå¹¶å°†ç»“æœå‹å…¥æ ˆä¸­ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ åœ¨è¿ç®—çš„æ—¶å€™ï¼Œéœ€è¦åå–å‡ºçš„æ•°å­—åœ¨å‰ï¼Œå…ˆå–å‡ºçš„æ•°å­—åœ¨åï¼Œå³num2åœ¨å‰ã€‚ stoiè¡¨ç¤ºstring to intï¼Œå³å­—ç¬¦ä¸²è½¬æ•´æ•° 0x1.ä»£ç å®ç°//// main.cpp// Demo//// Created by Egan.// #include &lt;iostream&gt;#include &lt;algorithm&gt;#include &lt;stack&gt;#include &lt;cstring&gt;using namespace std; int main() &#123; class Solution &#123; public: int evalRPN(vector&lt;string&gt;&amp; tokens) &#123; stack&lt;int&gt; s; for(int i=0; i&lt;tokens.size(); i++)&#123; if(tokens[i] == &quot;+&quot;||tokens[i] == &quot;-&quot;||tokens[i] == &quot;*&quot;||tokens[i] == &quot;/&quot;)&#123; int num1 = s.top(); s.pop(); int num2 = s.top(); s.pop(); if(tokens[i] == &quot;+&quot;) s.push(num2 + num1); if(tokens[i] == &quot;-&quot;) s.push(num2 - num1); if(tokens[i] == &quot;*&quot;) s.push(num2 * num1); if(tokens[i] == &quot;/&quot;) s.push(num2 / num1); &#125; else &#123; s.push(stoi(tokens[i])); &#125; &#125; int result = s.top(); return result; &#125;&#125;;&#125;","categories":[{"name":"Leetcode","slug":"Leetcode","permalink":"https://blog.eganx.cn/categories/Leetcode/"}],"tags":[{"name":"C++","slug":"C","permalink":"https://blog.eganx.cn/tags/C/"},{"name":"æ ˆ","slug":"æ ˆ","permalink":"https://blog.eganx.cn/tags/%E6%A0%88/"}]},{"title":"æ˜æ˜çš„éšæœºæ•°(Ming's random numbers)","slug":"Ming's_random_numbers","date":"2021-02-22T05:46:57.000Z","updated":"2022-11-20T02:41:39.367Z","comments":true,"path":"2021/02/22/Ming's_random_numbers/","link":"","permalink":"https://blog.eganx.cn/2021/02/22/Ming's_random_numbers/","excerpt":"æ˜æ˜æƒ³åœ¨å­¦æ ¡ä¸­è¯·ä¸€äº›åŒå­¦ä¸€èµ·åšä¸€é¡¹é—®å·è°ƒæŸ¥ï¼Œä¸ºäº†å®éªŒçš„å®¢è§‚æ€§ï¼Œä»–å…ˆç”¨è®¡ç®—æœºç”Ÿæˆäº†Nä¸ª1åˆ°1000ä¹‹é—´çš„éšæœºæ•´æ•°ï¼ˆNâ‰¤1000ï¼‰ï¼Œå¯¹äºå…¶ä¸­é‡å¤çš„æ•°å­—ï¼Œåªä¿ç•™ä¸€ä¸ªï¼ŒæŠŠå…¶ä½™ç›¸åŒçš„æ•°å»æ‰ï¼Œä¸åŒçš„æ•°å¯¹åº”ç€ä¸åŒçš„å­¦ç”Ÿçš„å­¦å·ã€‚ç„¶åå†æŠŠè¿™äº›æ•°ä»å°åˆ°å¤§æ’åºï¼ŒæŒ‰ç…§æ’å¥½çš„é¡ºåºå»æ‰¾åŒå­¦åšè°ƒæŸ¥ã€‚è¯·ä½ ååŠ©æ˜æ˜å®Œæˆâ€œå»é‡â€ä¸â€œæ’åºâ€çš„å·¥ä½œ(åŒä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹é‡Œå¯èƒ½ä¼šæœ‰å¤šç»„æ•°æ®(ç”¨äºä¸åŒçš„è°ƒæŸ¥)ï¼Œå¸Œæœ›å¤§å®¶èƒ½æ­£ç¡®å¤„ç†)","text":"æ˜æ˜æƒ³åœ¨å­¦æ ¡ä¸­è¯·ä¸€äº›åŒå­¦ä¸€èµ·åšä¸€é¡¹é—®å·è°ƒæŸ¥ï¼Œä¸ºäº†å®éªŒçš„å®¢è§‚æ€§ï¼Œä»–å…ˆç”¨è®¡ç®—æœºç”Ÿæˆäº†Nä¸ª1åˆ°1000ä¹‹é—´çš„éšæœºæ•´æ•°ï¼ˆNâ‰¤1000ï¼‰ï¼Œå¯¹äºå…¶ä¸­é‡å¤çš„æ•°å­—ï¼Œåªä¿ç•™ä¸€ä¸ªï¼ŒæŠŠå…¶ä½™ç›¸åŒçš„æ•°å»æ‰ï¼Œä¸åŒçš„æ•°å¯¹åº”ç€ä¸åŒçš„å­¦ç”Ÿçš„å­¦å·ã€‚ç„¶åå†æŠŠè¿™äº›æ•°ä»å°åˆ°å¤§æ’åºï¼ŒæŒ‰ç…§æ’å¥½çš„é¡ºåºå»æ‰¾åŒå­¦åšè°ƒæŸ¥ã€‚è¯·ä½ ååŠ©æ˜æ˜å®Œæˆâ€œå»é‡â€ä¸â€œæ’åºâ€çš„å·¥ä½œ(åŒä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹é‡Œå¯èƒ½ä¼šæœ‰å¤šç»„æ•°æ®(ç”¨äºä¸åŒçš„è°ƒæŸ¥)ï¼Œå¸Œæœ›å¤§å®¶èƒ½æ­£ç¡®å¤„ç†) 0x0.è§£é¢˜æ€è·¯è¿™æ˜¯åä¸ºçš„ä¸€é“é¢è¯•é¢˜ã€‚åœ¨åŸæ–‡ä¸­å·²ç»æ˜ç¡®ç‚¹å‡ºäº†æ‰€éœ€çš„ä¸€äº›å‡½æ•°ï¼Œåˆ†åˆ«æ˜¯æ’åºå’Œå»é‡ã€‚C++æœ‰ç°æˆçš„æ’åºå‡½æ•°sort()ï¼Œä»¥åŠå»é‡å‡½æ•°unique()ã€‚å…¶ä¸­unique(),sort()éƒ½æ˜¯å±äºå¤´æ–‡ä»¶#include &lt;algorithm&gt; auto end_un = unique(vec.begin(),vec.end()); è¿™é‡Œçš„unique()è¿”å›çš„å€¼æ˜¯æœ€åä¸€ä¸ªä¸é‡å¤æ•°å­—çš„ä¸‹æ ‡ã€‚ sortå‡½æ•°æœ‰ä¸‰ä¸ªå‚æ•°ï¼š ç¬¬ä¸€ä¸ªæ˜¯è¦æ’åºçš„æ•°ç»„çš„èµ·å§‹åœ°å€ ç¬¬äºŒä¸ªæ˜¯ç»“æŸçš„åœ°å€ï¼ˆæœ€åä¸€ä½è¦æ’åºçš„åœ°å€) ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯æ’åºçš„æ–¹æ³•ï¼Œå¯ä»¥æ˜¯å‡åºä¹Ÿå¯æ˜¯é™åºã€‚å¦‚æœä¸å†™ç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œåˆ™é»˜è®¤çš„æ’åºæ–¹æ³•æ˜¯å‡åºæ’åˆ— //å‡åºsort( a, b, less&lt;int&gt;() ); //é™åºsort( a, b, greater&lt;int&gt;() ); å¦‚æœå…ˆå»é‡å†æ’åºï¼Œé‚£ä¹ˆå»é‡å°±æœ‰å¯èƒ½ä¸ä¼šå‘æŒ¥ä½œç”¨ã€‚å› ä¸ºå»é‡å†æ’åºæ’åºæ—¶ä¼šæŠŠé‡å¤çš„æ•°å­—åˆæ”¾åœ¨äº†ä¸€èµ·ï¼Œæ‰€ä»¥è¦å…ˆæ’åºå†å»é‡ã€‚ 0x1.ä»£ç å®ç°//// main.cpp// Demo//// Created by Egan.// #include &lt;iostream&gt;#include &lt;algorithm&gt;#include &lt;vector&gt;using namespace std; int main() &#123; int n= 0,num = 0; while (cin &gt;&gt; n) &#123; vector&lt;int&gt; vec; //input for (int i = 0; i &lt; n; i++) &#123; cin &gt;&gt; num; vec.push_back(num); &#125; //sort sort(vec.begin(), vec.end()); //unique auto end_un = unique(vec.begin(),vec.end()); vec.erase(end_un, vec.end()); for (auto m = vec.begin(); m != vec.end(); m ++) &#123; cout &lt;&lt; *m &lt;&lt; endl; &#125; &#125; return 0;&#125;","categories":[{"name":"Leetcode","slug":"Leetcode","permalink":"https://blog.eganx.cn/categories/Leetcode/"}],"tags":[{"name":"C++","slug":"C","permalink":"https://blog.eganx.cn/tags/C/"},{"name":"sort","slug":"sort","permalink":"https://blog.eganx.cn/tags/sort/"},{"name":"unique","slug":"unique","permalink":"https://blog.eganx.cn/tags/unique/"}]},{"title":"æ¯•ä¸šåŠå¹´çš„è‡ªå·±","slug":"Six_months_after_graduation","date":"2020-12-22T05:46:57.000Z","updated":"2022-11-20T02:40:30.506Z","comments":true,"path":"2020/12/22/Six_months_after_graduation/","link":"","permalink":"https://blog.eganx.cn/2020/12/22/Six_months_after_graduation/","excerpt":"","text":"0x0.åŠå¹´ä¹‹å&emsp;æˆ‘ä»¬è¿™å±Šçš„æ¯•ä¸šç”Ÿï¼Œå¤§å­¦åªä¸Šäº†ä¸‰å¹´åŠï¼Œæœ€ååŠå¹´çš„æ—¶å…‰éƒ½æ˜¯åœ¨å®¶é‡Œæ¸¡è¿‡ã€‚æ‹¿æ¯•ä¸šè¯å­¦ä½è¯ã€æ‹æ¯•ä¸šç…§ä»¥åŠæ”¶æ‹¾è¡Œæï¼ŒåŠ èµ·æ¥ä¸è¿‡ä¸¤å¤©æ—¶é—´ã€‚ä¸€åˆ‡éƒ½æ˜¯åŒ†åŒ†å¿™å¿™ï¼ŒåŒ†å¿™åˆ°è¿ä¸€é¡¿æ•£ä¼™é¥­éƒ½æ²¡æ³•è¿›è¡Œã€‚&emsp;è¿˜å·®å‡ æ—¥ï¼Œè‡ªå·±ä¹Ÿå°±æ¯•ä¸šåŠå¹´äº†ï¼Œä¹Ÿç®—æ˜¯æœ‰äº†åŠå¹´çš„å·¥ä½œç»éªŒ(åˆ’æ°´ç»éªŒ)ï¼Œå­¦è½¯ä»¶çš„æˆ‘ï¼Œæ¯•ä¸šä¹‹åè¿›äº†ä¸€å®¶åè‡ªåŠ¨åŒ–çš„å…¬å¸ï¼Œå·¥ä¸š4.0æ—¶ä»£å˜›ï¼Œå¤©å¤©ä»£ç å€’æ˜¯ä¸å¤šï¼Œæ„Ÿè§‰è¿˜ä¸é”™ã€‚","categories":[{"name":"å·¥ä½œ","slug":"å·¥ä½œ","permalink":"https://blog.eganx.cn/categories/%E5%B7%A5%E4%BD%9C/"}],"tags":[{"name":"æ—¥å¸¸","slug":"æ—¥å¸¸","permalink":"https://blog.eganx.cn/tags/%E6%97%A5%E5%B8%B8/"},{"name":"æ‚è®°","slug":"æ‚è®°","permalink":"https://blog.eganx.cn/tags/%E6%9D%82%E8%AE%B0/"}]},{"title":"Test","slug":"firstPage","date":"2020-10-22T03:10:47.000Z","updated":"2022-01-20T11:36:20.632Z","comments":true,"path":"2020/10/22/firstPage/","link":"","permalink":"https://blog.eganx.cn/2020/10/22/firstPage/","excerpt":"","text":"æµ‹è¯•æ–‡æ¡£ ä»è¿™ä¸€ç¯‡æµ‹è¯•æ–‡æ¡£å¼€å§‹ï¼Œå¸Œæœ›è‡ªå·±èƒ½å¤Ÿæ”¶èµ·æ‡’æƒ°ï¼Œé‡æ‹¾æ¿€æƒ…","categories":[],"tags":[{"name":"Test","slug":"Test","permalink":"https://blog.eganx.cn/tags/Test/"}]}],"categories":[{"name":"Golang","slug":"Golang","permalink":"https://blog.eganx.cn/categories/Golang/"},{"name":"Database","slug":"Database","permalink":"https://blog.eganx.cn/categories/Database/"},{"name":"Tool","slug":"Tool","permalink":"https://blog.eganx.cn/categories/Tool/"},{"name":"Work","slug":"Work","permalink":"https://blog.eganx.cn/categories/Work/"},{"name":"C#","slug":"Work/C","permalink":"https://blog.eganx.cn/categories/Work/C/"},{"name":"Leetcode","slug":"Leetcode","permalink":"https://blog.eganx.cn/categories/Leetcode/"},{"name":"å·¥ä½œ","slug":"å·¥ä½œ","permalink":"https://blog.eganx.cn/categories/%E5%B7%A5%E4%BD%9C/"}],"tags":[{"name":"GC","slug":"GC","permalink":"https://blog.eganx.cn/tags/GC/"},{"name":"go","slug":"go","permalink":"https://blog.eganx.cn/tags/go/"},{"name":"reflect","slug":"reflect","permalink":"https://blog.eganx.cn/tags/reflect/"},{"name":"DB","slug":"DB","permalink":"https://blog.eganx.cn/tags/DB/"},{"name":"mongo","slug":"mongo","permalink":"https://blog.eganx.cn/tags/mongo/"},{"name":"make","slug":"make","permalink":"https://blog.eganx.cn/tags/make/"},{"name":"new","slug":"new","permalink":"https://blog.eganx.cn/tags/new/"},{"name":"tool","slug":"tool","permalink":"https://blog.eganx.cn/tags/tool/"},{"name":"studio3t","slug":"studio3t","permalink":"https://blog.eganx.cn/tags/studio3t/"},{"name":"context","slug":"context","permalink":"https://blog.eganx.cn/tags/context/"},{"name":"channel","slug":"channel","permalink":"https://blog.eganx.cn/tags/channel/"},{"name":"interface","slug":"interface","permalink":"https://blog.eganx.cn/tags/interface/"},{"name":"map","slug":"map","permalink":"https://blog.eganx.cn/tags/map/"},{"name":"slice","slug":"slice","permalink":"https://blog.eganx.cn/tags/slice/"},{"name":"C#","slug":"C","permalink":"https://blog.eganx.cn/tags/C/"},{"name":"ç‰ˆæœ¬åˆ‡æ¢","slug":"ç‰ˆæœ¬åˆ‡æ¢","permalink":"https://blog.eganx.cn/tags/%E7%89%88%E6%9C%AC%E5%88%87%E6%8D%A2/"},{"name":"OOM","slug":"OOM","permalink":"https://blog.eganx.cn/tags/OOM/"},{"name":"Serial","slug":"Serial","permalink":"https://blog.eganx.cn/tags/Serial/"},{"name":"C++","slug":"C","permalink":"https://blog.eganx.cn/tags/C/"},{"name":"åä¸ºOD","slug":"åä¸ºOD","permalink":"https://blog.eganx.cn/tags/%E5%8D%8E%E4%B8%BAOD/"},{"name":"ç¬”è¯•","slug":"ç¬”è¯•","permalink":"https://blog.eganx.cn/tags/%E7%AC%94%E8%AF%95/"},{"name":"æ ˆ","slug":"æ ˆ","permalink":"https://blog.eganx.cn/tags/%E6%A0%88/"},{"name":"sort","slug":"sort","permalink":"https://blog.eganx.cn/tags/sort/"},{"name":"unique","slug":"unique","permalink":"https://blog.eganx.cn/tags/unique/"},{"name":"æ—¥å¸¸","slug":"æ—¥å¸¸","permalink":"https://blog.eganx.cn/tags/%E6%97%A5%E5%B8%B8/"},{"name":"æ‚è®°","slug":"æ‚è®°","permalink":"https://blog.eganx.cn/tags/%E6%9D%82%E8%AE%B0/"},{"name":"Test","slug":"Test","permalink":"https://blog.eganx.cn/tags/Test/"}]}