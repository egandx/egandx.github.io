<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Egan&#39;s Blog</title>
  
  <subtitle>The winter is coming</subtitle>
  <link href="https://blog.eganx.cn/atom.xml" rel="self"/>
  
  <link href="https://blog.eganx.cn/"/>
  <updated>2022-12-26T03:43:15.399Z</updated>
  <id>https://blog.eganx.cn/</id>
  
  <author>
    <name>Egan Dong</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Mongo cluster(docker compose)</title>
    <link href="https://blog.eganx.cn/2022/11/10/Mongo_0/"/>
    <id>https://blog.eganx.cn/2022/11/10/Mongo_0/</id>
    <published>2022-11-10T13:12:34.000Z</published>
    <updated>2022-12-26T03:43:15.399Z</updated>
    
    <content type="html"><![CDATA[<p>åˆæ¬¡ä½¿ç”¨docker composeæ­å»ºmongoé›†ç¾¤ï¼Œè®°å½•ä¸€ä¸‹ã€‚è™½ç„¶é—®é¢˜è¿˜å¾ˆå¤šï¼Œä½†è‡³å°‘è·‘èµ·æ¥äº†ã€‚ã€‚ã€‚</p><span id="more"></span><h2 id="0x0-æ–‡ä»¶ç›®å½•ç»“æ„"><a href="#0x0-æ–‡ä»¶ç›®å½•ç»“æ„" class="headerlink" title="0x0.æ–‡ä»¶ç›®å½•ç»“æ„"></a>0x0.æ–‡ä»¶ç›®å½•ç»“æ„</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mongodb</span><br><span class="line">â””â”€â”€ mongo</span><br><span class="line">    â”œâ”€â”€ data</span><br><span class="line">    â”‚Â Â  â”œâ”€â”€ hosts</span><br><span class="line">    â”‚Â Â  â””â”€â”€ mongod.conf</span><br><span class="line">    â””â”€â”€ docker-compose.yml</span><br></pre></td></tr></table></figure><h2 id="0x1-mongod-conf"><a href="#0x1-mongod-conf" class="headerlink" title="0x1.mongod.conf"></a>0x1.mongod.conf</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">systemLog:</span><br><span class="line">  destination: file</span><br><span class="line">  path: &#x2F;data&#x2F;log&#x2F;mongo.log</span><br><span class="line">  logAppend: true</span><br><span class="line">storage:</span><br><span class="line">  dbPath: &#x2F;data&#x2F;db</span><br><span class="line">net:</span><br><span class="line">  bindIp: 0.0.0.0</span><br><span class="line">replication:</span><br><span class="line">  replSetName: rs0</span><br></pre></td></tr></table></figure><h2 id="0x2-hosts"><a href="#0x2-hosts" class="headerlink" title="0x2.hosts"></a>0x2.hosts</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">127.0.0.1localhost</span><br><span class="line">255.255.255.255broadcasthost</span><br><span class="line">::1                     localhost</span><br></pre></td></tr></table></figure><h2 id="0x3-docker-compose-yml"><a href="#0x3-docker-compose-yml" class="headerlink" title="0x3.docker-compose.yml"></a>0x3.docker-compose.yml</h2><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3&#x27;</span></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">db:</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">mongo1:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">mongo</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">mongo1</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">mongod</span> <span class="string">--config</span> <span class="string">/etc/mongod.conf</span></span><br><span class="line">    <span class="attr">expose:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">27017</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./data/mongo1/db:/data/db</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./data/mongo1/configdb:/data/configdb</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./data/mongo1/log:/data/log</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./data/mongod.conf:/etc/mongod.conf</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./data/hosts:/etc/hosts</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;27017:27017&quot;</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">db</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">mongo2:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">mongo</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">mongo2</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">mongod</span> <span class="string">--config</span> <span class="string">/etc/mongod.conf</span></span><br><span class="line">    <span class="attr">expose:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">27017</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./data/mongo2/db:/data/db</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./data/mongo2/configdb:/data/configdb</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./data/mongo2/log:/data/log</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./data/mongod.conf:/etc/mongod.conf</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./data/hosts:/etc/hosts</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;27018:27017&quot;</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">db</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">mongo3:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">mongo</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">mongo3</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">mongod</span> <span class="string">--config</span> <span class="string">/etc/mongod.conf</span></span><br><span class="line">    <span class="attr">expose:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">27017</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./data/mongo3/db:/data/db</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./data/mongo3/configdb:/data/configdb</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./data/mongo3/log:/data/log</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./data/mongod.conf:/etc/mongod.conf</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./data/hosts:/etc/hosts</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;27019:27017&quot;</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">db</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="0x4-å¼€å§‹éƒ¨ç½²"><a href="#0x4-å¼€å§‹éƒ¨ç½²" class="headerlink" title="0x4.å¼€å§‹éƒ¨ç½²"></a>0x4.å¼€å§‹éƒ¨ç½²</h2><ul><li>è¿›å…¥docker-compose.ymlæ–‡ä»¶æ‰€åœ¨ç›®å½•</li><li>æ‰§è¡Œå‘½ä»¤ï¼š<code>docker compose -f docker-compose.yml up -d</code></li></ul><h2 id="0x5-å»ºç«‹å‰¯æœ¬é›†"><a href="#0x5-å»ºç«‹å‰¯æœ¬é›†" class="headerlink" title="0x5.å»ºç«‹å‰¯æœ¬é›†"></a>0x5.å»ºç«‹å‰¯æœ¬é›†</h2><ul><li><p>è¿›å…¥mongoå®¹å™¨ï¼š<code>docker exec -it mongo1 bash</code></p></li><li><p>è¿›å…¥mongoï¼š<code>mongosh</code> ,è€ç‰ˆæœ¬çš„mongoåˆ°æŒ‡ä»¤æ˜¯<code>mongo</code></p></li><li><p>åˆ‡æ¢ç®¡ç†å‘˜ç”¨æˆ·ï¼š<code>use admin</code></p></li><li><p>åˆå§‹åŒ–å‰¯æœ¬é›†ï¼š<code>rs.initiate()</code>,æ— å‚åˆå§‹åŒ–æ—¶ï¼Œä¼šé»˜è®¤å½“å‰èŠ‚ç‚¹PRIMARYèŠ‚ç‚¹</p></li><li><p>æ·»åŠ å‰¯èŠ‚ç‚¹ï¼š<code>rs.add(&#39;mongo2:27017&#39;)</code></p></li><li><p>æ·»åŠ ä»²è£èŠ‚ç‚¹ï¼š<code>rs.addArb(&#39;mongo3:27017&#39;)</code></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F; æ·»åŠ ä»²è£èŠ‚ç‚¹è¦æ˜¯æŠ¥é”™ï¼Œå¯ä»¥è¯•è¯•è¿è¡Œä»¥ä¸‹ä»£ç </span><br><span class="line"> db.adminCommand(&#123;</span><br><span class="line">  &quot;setDefaultRWConcern&quot; : 1,</span><br><span class="line">  &quot;defaultWriteConcern&quot; : &#123;</span><br><span class="line">    &quot;w&quot; : 2</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹å‰¯æœ¬é›†é…ç½®ä¿¡æ¯ï¼š<code>rs.conf()</code></p></li><li><p>æŸ¥çœ‹å‰¯æœ¬é›†è¿è¡ŒçŠ¶æ€ï¼š<code>rs.status()</code></p></li></ul><p>è¦æ˜¯éœ€è¦ä¿®æ”¹é…ç½®ï¼Œå¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤æ¥ï¼š</p><ul><li><code>cfg = rs.conf()</code></li><li><code>cfg.members[0].xxx = xxx</code></li><li><code>rs.reconfig(cfg)</code></li></ul><h2 id="0x6-éªŒè¯å‰¯æœ¬é›†"><a href="#0x6-éªŒè¯å‰¯æœ¬é›†" class="headerlink" title="0x6.éªŒè¯å‰¯æœ¬é›†"></a>0x6.éªŒè¯å‰¯æœ¬é›†</h2><p>åˆ‡æ¢èŠ‚ç‚¹æŸ¥çœ‹åŒæ­¥çŠ¶æ€ï¼š<code>rs.printReplicationInfo()</code></p><p>ä»…å½“å»ºç«‹äº†é›†åˆåå‰¯èŠ‚ç‚¹æ‰ä¼šè¿›è¡ŒåŒæ­¥ã€‚</p><h2 id="0x7-å¤–éƒ¨è¿æ¥"><a href="#0x7-å¤–éƒ¨è¿æ¥" class="headerlink" title="0x7.å¤–éƒ¨è¿æ¥"></a>0x7.å¤–éƒ¨è¿æ¥</h2><p>å‡†å¤‡ä½¿ç”¨Robo 3T(ç°åœ¨å˜æˆStudio 3T Free)è¿æ¥æ•°æ®åº“æ—¶ï¼Œä¼šæœ‰è¿æ¥å¤±è´¥çš„å¼‚å¸¸ï¼Œå¯ä»¥å°†WSLçš„IPåœ°å€å†™å…¥ç”µè„‘Cç›˜hostsæ–‡ä»¶é‡Œï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">172.23.224.1mongo1</span><br><span class="line">172.23.224.1mongo2</span><br><span class="line">172.23.224.1mongo3</span><br></pre></td></tr></table></figure><p>ç„¶åä½¿ç”¨ä»¥ä¸‹é“¾æ¥æ¥è¿æ¥æ•°æ®åº“</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mongo1:27017</span><br><span class="line">mongo2:27017</span><br><span class="line">mongo3:27017</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯å¦‚æœè¿˜æ˜¯è¿æ¥ä¸ä¸Šï¼Œæˆ–è€…é‡å¯åè¿æ¥ä¸ä¸Šï¼Œå¯ä»¥å°†<code>mongo</code>å®¹å™¨çš„IPå†™åˆ°<code>mongo\data\hosts</code>æ–‡ä»¶é‡Œï¼Œå®¹å™¨çš„IPå¯ä»¥ä½¿ç”¨<code>docker inspect mongo1</code>æ¥è·å–ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">172.30.0.2 mongo1</span><br><span class="line">172.30.0.3 mongo2</span><br><span class="line">172.30.0.4 mongo3</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;åˆæ¬¡ä½¿ç”¨docker composeæ­å»ºmongoé›†ç¾¤ï¼Œè®°å½•ä¸€ä¸‹ã€‚è™½ç„¶é—®é¢˜è¿˜å¾ˆå¤šï¼Œä½†è‡³å°‘è·‘èµ·æ¥äº†ã€‚ã€‚ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="Database" scheme="https://blog.eganx.cn/categories/Database/"/>
    
    
    <category term="DB" scheme="https://blog.eganx.cn/tags/DB/"/>
    
    <category term="mongo" scheme="https://blog.eganx.cn/tags/mongo/"/>
    
  </entry>
  
  <entry>
    <title>Goè¯­è¨€ä¸­newå’Œmakeçš„åŒºåˆ«</title>
    <link href="https://blog.eganx.cn/2022/11/07/Go_New_and_Make/"/>
    <id>https://blog.eganx.cn/2022/11/07/Go_New_and_Make/</id>
    <published>2022-11-07T01:07:12.000Z</published>
    <updated>2022-12-26T03:44:33.213Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨Goè¯­è¨€ä¸­ï¼Œmakeå…³é”®å­—åœ¨åˆå§‹åŒ–çš„æ—¶å€™è¢«é¢‘ç¹ä½¿ç”¨ï¼Œä¹‹å‰å†™C# çš„æ—¶å€™éƒ½æ˜¯ä½¿ç”¨newå…³é”®å­—ï¼ŒGoä¸­newå…³é”®å­—ä¹Ÿæ˜¯å­˜åœ¨çš„ã€‚å‡†å¤‡çœ‹çœ‹ä¸¤è€…çš„åŒºåˆ«ã€‚</p><span id="more"></span><h2 id="0x0-new"><a href="#0x0-new" class="headerlink" title="0x0.new"></a>0x0.new</h2><p><code>new</code>å¯ä»¥å¯¹ç±»å‹è¿›è¡Œå†…å­˜åˆ›å»ºå’Œåˆå§‹åŒ–ï¼Œ<strong>å…¶è¿”å›å€¼æ˜¯æ‰€åˆ›å»ºç±»å‹çš„æŒ‡é’ˆå¼•ç”¨</strong>ã€‚<code>new</code>ä¼šæ ¹æ®å˜é‡ç±»å‹è¿”å›ä¸€ä¸ªæŒ‡å‘è¯¥ç±»å‹çš„æŒ‡é’ˆã€‚</p><h2 id="0x1-make"><a href="#0x1-make" class="headerlink" title="0x1.make"></a>0x1.make</h2><p><code>make</code> å‡½æ•°ä¹Ÿæ˜¯ç”¨äºå†…å­˜åˆ†é…çš„ï¼Œä½†æ˜¯å’Œ<code>new</code>ä¸åŒï¼Œä»…æ”¯æŒ <code>slice</code>ã€<code>map</code>ã€<code>channel</code> ä¸‰ç§æ•°æ®ç±»å‹çš„å†…å­˜åˆ›å»ºï¼Œå…¶è¿”å›å€¼æ˜¯æ‰€åˆ›å»ºç±»å‹çš„æœ¬èº«ï¼Œè€Œä¸æ˜¯æ–°çš„æŒ‡é’ˆå¼•ç”¨ã€‚<code>make</code>ä¸ä»…å¯ä»¥å¼€è¾Ÿä¸€ä¸ªå†…å­˜ï¼Œè¿˜èƒ½ç»™è¿™ä¸ªå†…å­˜çš„ç±»å‹åˆå§‹åŒ–å…¶é›¶å€¼ã€‚</p><h2 id="0x2-æ€»ç»“"><a href="#0x2-æ€»ç»“" class="headerlink" title="0x2.æ€»ç»“"></a>0x2.æ€»ç»“</h2><ul><li>makeå’Œnewéƒ½æ˜¯golangç”¨æ¥åˆ†é…å†…å­˜çš„å‡½æ•°ï¼Œä¸”åœ¨å †ä¸Šåˆ†é…å†…å­˜ï¼Œmake å³åˆ†é…å†…å­˜ï¼Œä¹Ÿåˆå§‹åŒ–å†…å­˜ã€‚newåªæ˜¯å°†å†…å­˜æ¸…é›¶ï¼Œå¹¶æ²¡æœ‰åˆå§‹åŒ–å†…å­˜ã€‚</li><li>makeè¿”å›çš„è¿˜æ˜¯å¼•ç”¨ç±»å‹æœ¬èº«ï¼›è€Œnewè¿”å›çš„æ˜¯æŒ‡å‘ç±»å‹çš„æŒ‡é’ˆã€‚</li><li>makeåªèƒ½ç”¨æ¥åˆ†é…åŠåˆå§‹åŒ–ç±»å‹ä¸ºsliceï¼Œmapï¼Œchannelçš„æ•°æ®ï¼›newå¯ä»¥åˆ†é…ä»»æ„ç±»å‹çš„æ•°æ®ã€‚</li></ul>]]></content>
    
    
    <summary type="html">&lt;p&gt;åœ¨Goè¯­è¨€ä¸­ï¼Œmakeå…³é”®å­—åœ¨åˆå§‹åŒ–çš„æ—¶å€™è¢«é¢‘ç¹ä½¿ç”¨ï¼Œä¹‹å‰å†™C# çš„æ—¶å€™éƒ½æ˜¯ä½¿ç”¨newå…³é”®å­—ï¼ŒGoä¸­newå…³é”®å­—ä¹Ÿæ˜¯å­˜åœ¨çš„ã€‚å‡†å¤‡çœ‹çœ‹ä¸¤è€…çš„åŒºåˆ«ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="Go" scheme="https://blog.eganx.cn/categories/Go/"/>
    
    
    <category term="make" scheme="https://blog.eganx.cn/tags/make/"/>
    
    <category term="new" scheme="https://blog.eganx.cn/tags/new/"/>
    
  </entry>
  
  <entry>
    <title>Windows10ä¸‹WSL2å’ŒDockerçš„å®‰è£…å’Œé…ç½®</title>
    <link href="https://blog.eganx.cn/2022/11/06/Win10_WSL_Docker/"/>
    <id>https://blog.eganx.cn/2022/11/06/Win10_WSL_Docker/</id>
    <published>2022-11-06T04:12:32.000Z</published>
    <updated>2022-12-17T13:27:04.083Z</updated>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘éœ€è¦æ­å»ºmongoé›†ç¾¤ï¼Œçœ‹æ•™ç¨‹è¯´ä½¿ç”¨dockeræ¯”è¾ƒå¥½éƒ¨ç½²ï¼Œå‡†å¤‡åœ¨å…¬å¸ç”µè„‘ï¼ˆThinkPadï¼‰ä¸Šå…ˆè¯•ä¸€ä¸‹ï¼Œæ‰€ä»¥éœ€è¦å®‰è£…ä¸€ä¸‹WSLå’Œdockerã€‚è‡ªå·±ä¹Ÿæ²¡æœ‰åœ¨Windowsç¯å¢ƒä¸‹ä½¿ç”¨è¿‡dockerï¼Œæ‰€ä»¥è®°å½•ä¸€ä¸‹ã€‚</p><span id="more"></span><h2 id="0x0-Windows-Terminal"><a href="#0x0-Windows-Terminal" class="headerlink" title="0x0.Windows Terminal"></a>0x0.Windows Terminal</h2><p>ç”¨è¿‡ <code>Windows</code> é»˜è®¤ç»ˆç«¯çš„éƒ½çŸ¥é“ï¼ŒçœŸçš„ä¸æ€ä¹ˆç¾è§‚ã€‚ å¾®è½¯ä¹Ÿé€æ¸æ„è¯†åˆ°è¿™ä¸ªé—®é¢˜ï¼Œå¹¶åœ¨ <code>Build2019</code> å¤§ä¼šä¸Šå‘å¸ƒäº† æ–°ä¸€ä»£ <code>Windows</code> ç»ˆç«¯ç¨‹åºï¼š<code>Windows Terminal</code> ã€‚</p><p><code>Windows Terminal</code> æ˜¯ä¸€æ¬¾æ–°å¼ã€å¿«é€Ÿã€é«˜æ•ˆã€å¼ºå¤§ä¸”é«˜æ•ˆçš„ç»ˆç«¯åº”ç”¨ç¨‹åºï¼Œé€‚ç”¨äºå‘½ä»¤è¡Œå·¥å…·å’Œå‘½ä»¤æç¤ºç¬¦ï¼ŒPowerShellå’Œ WSL ç­‰ Shell ç”¨æˆ·ã€‚ä¸»è¦åŠŸèƒ½åŒ…æ‹¬å¤šä¸ªé€‰é¡¹å¡ã€çª—æ ¼ã€Unicodeã€å’Œ UTF-8 å­—ç¬¦æ”¯æŒï¼ŒGPU åŠ é€Ÿæ–‡æœ¬æ¸²æŸ“å¼•æ“ä»¥åŠè‡ªå®šä¹‰ä¸»é¢˜ã€æ ·å¼å’Œé…ç½®ã€‚</p><p>è€Œä¸”è¿™ä¸ªæ˜¯å¼€æºçš„ï¼Œå¦‚æœä¸å–œæ¬¢åœ¨Microsoft Storeé‡Œå®‰è£…è½¯ä»¶ï¼Œå¯ä»¥ç›´æ¥å»GitHubé‡Œä¸‹è½½ï¼Œè¿™é‡Œç»™å‡ºGitHubé¡¹ç›®åœ°å€ï¼š<code>https://github.com/microsoft/terminal</code>ã€‚</p><h2 id="0x1-Windows-WSL2"><a href="#0x1-Windows-WSL2" class="headerlink" title="0x1.Windows WSL2"></a>0x1.Windows WSL2</h2><h3 id="1-æ¦‚è¿°"><a href="#1-æ¦‚è¿°" class="headerlink" title="1).æ¦‚è¿°"></a>1).æ¦‚è¿°</h3><p>WSLæ˜¯windowsæ¨å‡ºçš„å¯è®©å¼€å‘äººå‘˜ä¸éœ€è¦å®‰è£…è™šæ‹Ÿæœºï¼ˆvmwareï¼Œvirtboxï¼‰æˆ–è€…è®¾ç½®åŒç³»ç»Ÿå¯åŠ¨å°±å¯ä»¥åŸç”Ÿæ”¯æŒè¿è¡ŒGNU/Linuxçš„ç³»ç»Ÿç¯å¢ƒï¼Œç®€ç§°WSLå­ç³»ç»Ÿã€‚ç›®å‰æœ€æ–°çš„ç‰ˆæœ¬æ˜¯WSL2ï¼Œåœ¨åŸå…ˆçš„åŸºç¡€ä¸Šæé«˜äº†æ–‡ä»¶ç³»ç»Ÿçš„æ€§èƒ½å¹¶æ·»åŠ äº†å®Œå…¨çš„çš„ç³»ç»Ÿè°ƒç”¨æ”¯æŒã€‚WSL2ä½¿ç”¨å…¨æ–°ä½“ç³»æ¶æ„ä½¿å…¶èƒ½çœŸæ­£çš„è¿è¡Œä¸€ä¸ªLinuxå†…æ ¸ã€‚</p><h3 id="2-å®‰è£…"><a href="#2-å®‰è£…" class="headerlink" title="2).å®‰è£…"></a>2).å®‰è£…</h3><ul><li>WSL2å¯¹ç³»ç»Ÿç‰ˆæœ¬æœ‰ä¸€å®šçš„è¦æ±‚ï¼šå¿…é¡»è¿è¡Œ Windows 10 ç‰ˆæœ¬ 2004 åŠæ›´é«˜ç‰ˆæœ¬ï¼ˆå†…éƒ¨ç‰ˆæœ¬ 19041 åŠæ›´é«˜ç‰ˆæœ¬ï¼‰æˆ– Windows 11ã€‚</li><li>åœ¨ <code>æ§åˆ¶é¢æ¿</code>-<code>ç¨‹åº</code>- <code>å¯ç”¨æˆ–å…³é—­ Windows åŠŸèƒ½</code> ä¸­å‹¾é€‰ <code>é€‚ç”¨äº Linux çš„ Windows å­ç³»ç»Ÿ</code>ä»¥åŠ <code>è™šæ‹Ÿæœºå¹³å°</code>(wsl2 éœ€è¦)ã€‚<font color=red>æ­¤æ­¥éª¤å®Œæˆåéœ€è¦é‡å¯ç”µè„‘ã€‚</font></li><li>æ‰“å¼€å¾®è½¯å•†åº—åº”ç”¨ï¼Œåœ¨æœç´¢æ¡†ä¸­è¾“å…¥â€œLinuxâ€æˆ–è€…â€œubuntuâ€ç„¶åæœç´¢ï¼Œä½ å¯ä»¥çœ‹åˆ°æœç´¢ç»“æœä¸­æœ‰å¾ˆå¤šçš„ Linux å‘è¡Œç‰ˆå¯ä»¥é€‰æ‹©ã€‚æˆ‘é€‰Ubuntu22.04<ul><li>æœ‰å¯èƒ½å¯åŠ¨ubuntuæŠ¥å‘Š<code>WslRegisterDistribution failed with error: 0x800701bc</code>æ˜¯å› ä¸ºæ²¡æœ‰å‡çº§linuxå†…æ ¸ä½¿ç”¨<code>wsl --update</code>ä¸‹è½½æ›´æ–°å³å¯ã€‚</li><li>åœ¨å•†åº—å®‰è£…åå¹¶æ²¡æœ‰å®Œå…¨å®Œæˆå­ç³»ç»Ÿå®‰è£…ï¼Œè¿˜éœ€è¦è¿è¡Œä¸€æ¬¡Ubuntuæ¥å®Œæˆå†…æ ¸ä¸‹è½½ä»¥åŠç”¨æˆ·åå¯†ç çš„è®¾ç½®ã€‚</li></ul></li><li>å¯åŠ¨WSL2<ul><li><code>Windows Terminal</code>é‡Œé¢ä½¿ç”¨<code>wsl -l</code>å‘½ä»¤æ¥æŸ¥çœ‹æ‰€æœ‰çš„å­ç³»ç»Ÿã€‚ä½¿ç”¨<code>wsl --set-default-version 2</code>è®¾ç½®ä¸ºæ¯ä¸ªå®‰è£…çš„å‘è¡Œç‰ˆé»˜è®¤WSL2å¯åŠ¨ã€‚</li></ul></li></ul><h3 id="3-å¯¼å‡ºUbuntu-22-04åˆ°Dç›˜ä¸‹"><a href="#3-å¯¼å‡ºUbuntu-22-04åˆ°Dç›˜ä¸‹" class="headerlink" title="3).å¯¼å‡ºUbuntu-22.04åˆ°Dç›˜ä¸‹"></a>3).å¯¼å‡ºUbuntu-22.04åˆ°Dç›˜ä¸‹</h3><p>è¿™ä¸€æ­¥å¯ä»¥ç¼“è§£ä¸€ä¸‹Cç›˜çš„å‹åŠ›ï¼ŒCç›˜æ²¡æœ‰å‹åŠ›çš„å°±å½“æ²¡çœ‹è§è¿™ä¸€æ­¥ã€‚</p><ul><li>æŸ¥çœ‹å·²å®‰è£…çš„Linuxå‘è¡Œç‰ˆ: <code>wsl -l --all -v</code></li><li>å¯¼å‡ºLinuxå‘è¡Œç‰ˆtaræ–‡ä»¶åˆ°æŒ‡å®šæ–‡ä»¶å¤¹: <code>wsl --export Ubuntu-22.04 d:/wsl/ubuntu/wsl-ubuntu-22.04.tar</code></li><li>æ³¨é”€Ubuntu-22.04: <code>wsl --unregister Ubuntu-22.04</code></li><li>é‡æ–°å¯¼å…¥å¹¶å®‰è£…WSL2åˆ°Dç›˜: <code>wsl --import Ubuntu-22.04 d:/wsl/ubuntu/ d:/wsl/ubuntu/wsl-ubuntu-22.04.tar --version 2</code></li></ul><h2 id="0x2-Windows-Docker-Desktop"><a href="#0x2-Windows-Docker-Desktop" class="headerlink" title="0x2.Windows Docker Desktop"></a>0x2.Windows Docker Desktop</h2><p>è¿™ä¸ªæ²¡å•¥å¥½è¯´çš„ï¼Œå®˜ç½‘ä¸‹è½½ï¼Œç›´æ¥å®‰è£…å°±å®Œäº†ã€‚å®˜ç½‘åœ°å€ä¼ é€ï¼š<code>https://www.docker.com/products/docker-desktop/</code>.</p><p>å®‰è£…å®Œæˆåï¼Œæ‰“å¼€Docker Desktopçš„è®¾ç½®ï¼Œæ‰¾åˆ°<code>Resources-WSL Integration</code>ï¼Œæ‰“å¼€Enable integration with additional distorsï¼Œå°†è‡ªå·±çš„WSLæ‰“å¼€ã€‚è¿™æ ·dockerå°±ä¼šè·‘åœ¨WSLä¸Šã€‚</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;æœ€è¿‘éœ€è¦æ­å»ºmongoé›†ç¾¤ï¼Œçœ‹æ•™ç¨‹è¯´ä½¿ç”¨dockeræ¯”è¾ƒå¥½éƒ¨ç½²ï¼Œå‡†å¤‡åœ¨å…¬å¸ç”µè„‘ï¼ˆThinkPadï¼‰ä¸Šå…ˆè¯•ä¸€ä¸‹ï¼Œæ‰€ä»¥éœ€è¦å®‰è£…ä¸€ä¸‹WSLå’Œdockerã€‚è‡ªå·±ä¹Ÿæ²¡æœ‰åœ¨Windowsç¯å¢ƒä¸‹ä½¿ç”¨è¿‡dockerï¼Œæ‰€ä»¥è®°å½•ä¸€ä¸‹ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="Database" scheme="https://blog.eganx.cn/categories/Database/"/>
    
    
    <category term="mongo" scheme="https://blog.eganx.cn/tags/mongo/"/>
    
    <category term="tool" scheme="https://blog.eganx.cn/tags/tool/"/>
    
  </entry>
  
  <entry>
    <title>Studio 3T Freeè·³è¿‡ä¸€ä¸ªæœˆFull productçš„ç™»é™†è¯•ç”¨(Windows)</title>
    <link href="https://blog.eganx.cn/2022/11/05/Tool_Studio3t/"/>
    <id>https://blog.eganx.cn/2022/11/05/Tool_Studio3t/</id>
    <published>2022-11-05T14:32:12.000Z</published>
    <updated>2022-12-16T02:16:06.630Z</updated>
    
    <content type="html"><![CDATA[<p>å½“Robo 3Tå˜æˆäº†Studio 3T Freeï¼Œä¸æƒ³è¯•ç”¨Studio 3Tçš„Full productã€‚åªæƒ³ä½¿ç”¨Robo 3T Free(Robo 3T)ï¼Œè¯¥å¦‚ä½•è·³è¿‡ä¸€ä¸ªæœˆFull productçš„ç™»é™†è¯•ç”¨å‘¢ï¼Ÿ</p><span id="more"></span><h2 id="0x0-å°Šé‡ä»˜è´¹è½¯ä»¶"><a href="#0x0-å°Šé‡ä»˜è´¹è½¯ä»¶" class="headerlink" title="0x0.å°Šé‡ä»˜è´¹è½¯ä»¶"></a>0x0.å°Šé‡ä»˜è´¹è½¯ä»¶</h2><p>Robo 3Tä½œä¸ºå¸¸ç”¨çš„MongoDB GUIï¼Œç°åœ¨å˜æˆäº†Studio 3T Freeã€‚ä¾æ—§æ˜¯å…è´¹ï¼Œä½†æ˜¯åœ¨Windowsä¸‹åˆæ¬¡æ‰“å¼€Studio 3Tè½¯ä»¶æ—¶ï¼Œä¼šè¦æ±‚å¿…é¡»ç™»é™†ï¼Œç„¶åå¼€å§‹ä¸€ä¸ªæœˆçš„Full product trialã€‚è¿™ä¸ªå°±å¾ˆçƒ¦ï¼Œæˆ‘å°±åªæƒ³ç”¨å…è´¹ç‰ˆçš„ï¼Œæ¯•ç«Ÿå…è´¹ç‰ˆå°±å¯ä»¥æ»¡è¶³æˆ‘çš„éœ€æ±‚ã€‚ä½“éªŒè¯•ç”¨æ˜¯å¥½äº‹ï¼Œä½†æ˜¯å½“è¿™ä»¶äº‹æˆä¸ºå¿…é€‰é¡¹æ—¶ï¼Œå°±ä¼šè®©äººå¾ˆä¸çˆ½ğŸ˜•</p><p>æ‰€ä»¥åœ¨ä¸è¿›è¡Œéæ­£è§„æ‰‹æ®µè¿›è¡Œè½¯ä»¶ç ´è§£æ—¶ï¼Œè¯¥å¦‚ä½•è¿›è¡Œè·³è¿‡ç™»é™†æ¿€æ´»è¿›è¡Œå…è´¹ç‰ˆçš„ä½¿ç”¨å‘¢ï¼Ÿ</p><p>æ‰¾åˆ°ä½äº<code>C:\Windows\System32\drivers\ect</code>ä¸‹çš„<code>hosts</code>æ–‡ä»¶ï¼Œå°†ä¸‹é¢ä¸¤è¡Œæ·»åŠ è¿›å»ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">127.0.0.1        update.studio3t.com</span><br><span class="line">127.0.0.1        license-portal-eb.studio3t.com</span><br></pre></td></tr></table></figure><p>ç„¶åé‡å¯Studio 3Tæ—¶ï¼ŒProduct activationå¼¹çª—å°±ä¼šè·³è¿‡<code>Login/Register</code>è¿™ä¸€æ­¥ï¼Œç›´æ¥åˆ°è¾¾<code>Finish</code>ã€‚Nice! å¤§åŠŸå‘Šæˆã€‚</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;å½“Robo 3Tå˜æˆäº†Studio 3T Freeï¼Œä¸æƒ³è¯•ç”¨Studio 3Tçš„Full productã€‚åªæƒ³ä½¿ç”¨Robo 3T Free(Robo 3T)ï¼Œè¯¥å¦‚ä½•è·³è¿‡ä¸€ä¸ªæœˆFull productçš„ç™»é™†è¯•ç”¨å‘¢ï¼Ÿ&lt;/p&gt;</summary>
    
    
    
    <category term="Tool" scheme="https://blog.eganx.cn/categories/Tool/"/>
    
    
    <category term="tool" scheme="https://blog.eganx.cn/tags/tool/"/>
    
    <category term="studio3t" scheme="https://blog.eganx.cn/tags/studio3t/"/>
    
  </entry>
  
  <entry>
    <title>Go Context</title>
    <link href="https://blog.eganx.cn/2022/11/04/Go_Context/"/>
    <id>https://blog.eganx.cn/2022/11/04/Go_Context/</id>
    <published>2022-11-04T03:45:19.000Z</published>
    <updated>2022-12-05T10:54:58.287Z</updated>
    
    <content type="html"><![CDATA[<p>contextæ˜¯Goçš„ä¸€ä¸ªæ ‡å‡†åº“ï¼Œä¸­æ–‡ä¸€èˆ¬å«åšâ€ä¸Šä¸‹æ–‡â€ã€‚contextä¸»è¦æ˜¯ç”¨æ¥åœ¨goroutineä¹‹é—´ä¼ é€’ä¸Šä¸‹åˆä¿¡æ¯ï¼ŒåŒ…æ‹¬å–æ¶ˆä¿¡å·ã€è¶…æ—¶æ—¶é—´ç­‰ã€‚context.Contextç±»å‹çš„å€¼å¯ä»¥åè°ƒå¤šä¸ªgoroutineä¸­çš„ä»£ç æ‰§è¡Œâ€œå–æ¶ˆâ€æ“ä½œï¼Œå¹¶ä¸”å¯ä»¥å­˜å‚¨é”®å€¼å¯¹ã€‚è€Œä¸”è¿˜æ˜¯å¹¶å‘å®‰å…¨çš„ã€‚ä¸å®ƒåä½œå¯ä»¥åœ¨APIçš„å¤–éƒ¨æ§åˆ¶æ‰§è¡Œâ€œå–æ¶ˆâ€æ“ä½œï¼Œæ¯”å¦‚å–æ¶ˆä¸€ä¸ªHTTPè¯·æ±‚çš„æ‰§è¡Œã€‚</p><span id="more"></span><h2 id="0x0-contextçš„ä½œç”¨"><a href="#0x0-contextçš„ä½œç”¨" class="headerlink" title="0x0.contextçš„ä½œç”¨"></a>0x0.contextçš„ä½œç”¨</h2><p>åœ¨http serverä¸­ï¼Œä¸€ä¸ªè¯·æ±‚æœ‰å¯èƒ½ä¼šèµ·è‹¥å¹²ä¸ªåç¨‹ï¼Œè¿™äº›goroutineæœ‰æ—¶å€™æ˜¯éœ€è¦å…±äº«è¯·æ±‚çš„åŸºæœ¬æ•°æ®çš„ï¼ŒåŒ…æ‹¬tokenï¼Œè¶…æ—¶æ—¶é—´å’Œå–æ¶ˆä¿¡å·ç­‰ã€‚å½“è¯·æ±‚è¿Ÿè¿Ÿå¾—ä¸åˆ°å›åº”æˆ–è€…æ­¤æ¬¡è¯·æ±‚è¢«å–æ¶ˆï¼Œå¯èƒ½æ˜¯ä½¿ç”¨è€…å…³é—­äº†æµè§ˆå™¨æˆ–å·²ç»è¶…è¿‡äº†è¯·æ±‚æ–¹çš„è¶…æ—¶æ—¶é—´ï¼Œè¯·æ±‚æ–¹ç›´æ¥æ”¾å¼ƒäº†è¿™æ¬¡è¯·æ±‚çš„ç»“æœã€‚è¿™ä¸ªæ—¶å€™ï¼Œæ‰€æœ‰ä¸ºè¿™ä¸ªè¯·æ±‚å·¥ä½œçš„goroutineéœ€è¦å¿«é€Ÿé€€å‡ºï¼Œå› ä¸ºå·¥ä½œæˆæœå˜æˆäº†æ— æ„ä¹‰çš„ã€‚åœ¨ç›¸å…³çš„goroutineé€€å‡ºåï¼Œç³»ç»Ÿå¯ä»¥å›æ”¶ç›¸å…³èµ„æºã€‚</p><p>æ­£å¸¸å…³é—­åç¨‹æ˜¯é‡‡ç”¨<code>channel+select</code>æ–¹å¼æ¥æ§åˆ¶ã€‚ä½†æ˜¯å½“ä¸€ä¸ªè¯·æ±‚ç›¸å…³è”çš„åç¨‹æ•°é‡è¿‡å¤šï¼Œä¸”ç›¸äº’å…³è”ï¼Œèƒ½å¤ŸåŒæ—¶å…³é—­ï¼Œå¯ä»¥ä½¿ç”¨contextæ¥å®ç°ã€‚</p><blockquote><p><font color=ligblue>contextç”¨æ¥è§£å†³goroutineä¹‹é—´é€€å‡ºé€šçŸ¥ã€å…ƒæ•°æ®ä¼ é€’çš„åŠŸèƒ½ã€‚    </font></p></blockquote><p>contextçš„ä½¿ç”¨å»ºè®®ï¼š</p><ul><li><p>ä¸è¦å°† Context å¡åˆ°ç»“æ„ä½“é‡Œã€‚ç›´æ¥å°† Context ç±»å‹ä½œä¸ºå‡½æ•°çš„ç¬¬ä¸€å‚æ•°ï¼Œè€Œä¸”ä¸€èˆ¬éƒ½å‘½åä¸º ctxã€‚</p></li><li><p>ä¸è¦å‘å‡½æ•°ä¼ å…¥ä¸€ä¸ª nil çš„ contextï¼Œå¦‚æœä½ å®åœ¨ä¸çŸ¥é“ä¼ ä»€ä¹ˆï¼Œæ ‡å‡†åº“ç»™ä½ å‡†å¤‡å¥½äº†ä¸€ä¸ª contextï¼štodoã€‚</p></li><li><p>ä¸è¦æŠŠæœ¬åº”è¯¥ä½œä¸ºå‡½æ•°å‚æ•°çš„ç±»å‹å¡åˆ° context ä¸­ï¼Œcontext å­˜å‚¨çš„åº”è¯¥æ˜¯ä¸€äº›å…±åŒçš„æ•°æ®ã€‚ä¾‹å¦‚ï¼šç™»é™†çš„ sessionã€cookie ç­‰ã€‚</p></li><li><p>åŒä¸€ä¸ª context å¯èƒ½ä¼šè¢«ä¼ é€’åˆ°å¤šä¸ª goroutineï¼Œåˆ«æ‹…å¿ƒï¼Œcontext æ˜¯å¹¶å‘å®‰å…¨çš„ã€‚</p></li></ul><h3 id="1-ä¼ é€’å…±äº«çš„æ•°æ®"><a href="#1-ä¼ é€’å…±äº«çš„æ•°æ®" class="headerlink" title="1).ä¼ é€’å…±äº«çš„æ•°æ®"></a>1).ä¼ é€’å…±äº«çš„æ•°æ®</h3><p>å¯¹äºwebæœåŠ¡ç«¯å¼€å‘ï¼Œå¾€å¾€å¸Œæœ›å°†ä¸€ä¸ªè¯·æ±‚å¤„ç†çš„æ•´ä¸ªè¿‡ç¨‹ä¸²èµ·æ¥ï¼Œå› æ­¤éœ€è¦åœ¨å‡½æ•°è°ƒç”¨çš„æ—¶å€™ä¼ é€’contextã€‚</p><p>contextçš„å¸¸è§åˆ›å»ºå‡½æ•°ï¼š</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»ºç©ºç™½çš„æ ¹èŠ‚ç‚¹context</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Background</span><span class="params">()</span> <span class="title">Context</span></span> </span><br><span class="line"><span class="comment">// åˆ›å»ºå­èŠ‚ç‚¹context</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">WithCancel</span><span class="params">(parent Context)</span> <span class="params">(ctx Context, cancel CancelFunc)</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">WithDeadline</span><span class="params">(parent Context, deadline time.Time)</span> <span class="params">(Context, CancelFunc)</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">WithTimeout</span><span class="params">(parent Context, timeout time.Duration)</span> <span class="params">(Context, CancelFunc)</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">WithValue</span><span class="params">(parent Context, key, val <span class="keyword">interface</span>&#123;&#125;)</span> <span class="title">Context</span></span></span><br></pre></td></tr></table></figure><h3 id="2-å–æ¶ˆgoroutine"><a href="#2-å–æ¶ˆgoroutine" class="headerlink" title="2).å–æ¶ˆgoroutine"></a>2).å–æ¶ˆgoroutine</h3><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">func_eg</span><span class="params">(ctx context.Context)</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> &#123;</span><br><span class="line">        ... <span class="comment">// ä¸šåŠ¡ä»£ç ï¼š1ç§’åˆ·æ–°1æ¬¡</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">select</span> &#123;</span><br><span class="line">        <span class="keyword">case</span> &lt;-ctx.Done():</span><br><span class="line">            <span class="comment">// è¢«å–æ¶ˆï¼Œç›´æ¥è¿”å›</span></span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">case</span> &lt;-time.After(time.Second):</span><br><span class="line">            <span class="comment">// block 1 ç§’é’Ÿ </span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// main</span></span><br><span class="line">ctx, cancel := context.WithTimeout(context.Background(), time.Hour)</span><br><span class="line"><span class="keyword">go</span> func_eg(ctx)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®¢æˆ·ç«¯å–æ¶ˆæ—¶ï¼Œè°ƒç”¨cancelå‡½æ•°</span></span><br><span class="line">cancel()</span><br></pre></td></tr></table></figure><p><code>cancel()</code>å‡½æ•°è¿”å›çš„contextå’ŒcancelFunæ˜¯åˆ†å¼€çš„ã€‚contextæœ¬èº«æ˜¯æ²¡æœ‰cancelå‡½æ•°ï¼Œä¿è¯å–æ¶ˆå‡½æ•°åªèƒ½ç”±å¤–éƒ¨è°ƒç”¨ï¼Œé˜²æ­¢å­èŠ‚ç‚¹contextè°ƒç”¨å–æ¶ˆå‡½æ•°ï¼Œä»è€Œä¸¥æ ¼æ§åˆ¶ä¿¡æ¯æµä»çˆ¶èŠ‚ç‚¹contextæµå‘å­èŠ‚ç‚¹contextã€‚</p><h3 id="3-é˜²æ­¢goroutineæ³„éœ²"><a href="#3-é˜²æ­¢goroutineæ³„éœ²" class="headerlink" title="3).é˜²æ­¢goroutineæ³„éœ²"></a>3).é˜²æ­¢goroutineæ³„éœ²</h3><p>æŸäº›goroutineå¤„äºæ— é™å¾ªç¯çŠ¶æ€ï¼Œè‹¥æ— å¤–éƒ¨å–æ¶ˆå‡½æ•°ï¼Œä¼šé€ æˆç³»ç»Ÿèµ„æºæ³„éœ²ã€‚</p><h2 id="0x1-contextè¯¦ç»†è§£æ"><a href="#0x1-contextè¯¦ç»†è§£æ" class="headerlink" title="0x1.contextè¯¦ç»†è§£æ"></a>0x1.contextè¯¦ç»†è§£æ</h2><table><thead><tr><th>ç±»å‹</th><th>åç§°</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>Context</td><td>æ¥å£</td><td>å®šä¹‰äº† Context æ¥å£çš„å››ä¸ªæ–¹æ³•</td></tr><tr><td>emptyCtx</td><td>ç»“æ„ä½“</td><td>å®ç°äº† Context æ¥å£ï¼Œå®ƒå…¶å®æ˜¯ä¸ªç©ºçš„ context</td></tr><tr><td>CancelFunc</td><td>å‡½æ•°</td><td>å–æ¶ˆå‡½æ•°</td></tr><tr><td>canceler</td><td>æ¥å£</td><td>context å–æ¶ˆæ¥å£ï¼Œå®šä¹‰äº†ä¸¤ä¸ªæ–¹æ³•</td></tr><tr><td>cancelCtx</td><td>ç»“æ„ä½“</td><td>å¯ä»¥è¢«å–æ¶ˆ</td></tr><tr><td>timerCtx</td><td>ç»“æ„ä½“</td><td>è¶…æ—¶ä¼šè¢«å–æ¶ˆ</td></tr><tr><td>valueCtx</td><td>ç»“æ„ä½“</td><td>å¯ä»¥å­˜å‚¨ k-v å¯¹</td></tr><tr><td>Background</td><td>å‡½æ•°</td><td>è¿”å›ä¸€ä¸ªç©ºçš„ contextï¼Œå¸¸ä½œä¸ºæ ¹ context</td></tr><tr><td>TODO</td><td>å‡½æ•°</td><td>è¿”å›ä¸€ä¸ªç©ºçš„ contextï¼Œå¸¸ç”¨äºé‡æ„æ—¶æœŸï¼Œæ²¡æœ‰åˆé€‚çš„ context å¯ç”¨</td></tr><tr><td>WithCancel</td><td>å‡½æ•°</td><td>åŸºäºçˆ¶ contextï¼Œç”Ÿæˆä¸€ä¸ªå¯ä»¥å–æ¶ˆçš„ context</td></tr><tr><td>newCancelCtx</td><td>å‡½æ•°</td><td>åˆ›å»ºä¸€ä¸ªå¯å–æ¶ˆçš„ context</td></tr><tr><td>propagateCancel</td><td>å‡½æ•°</td><td>å‘ä¸‹ä¼ é€’ context èŠ‚ç‚¹é—´çš„å–æ¶ˆå…³ç³»</td></tr><tr><td>parentCancelCtx</td><td>å‡½æ•°</td><td>æ‰¾åˆ°ç¬¬ä¸€ä¸ªå¯å–æ¶ˆçš„çˆ¶èŠ‚ç‚¹</td></tr><tr><td>removeChild</td><td>å‡½æ•°</td><td>å»æ‰çˆ¶èŠ‚ç‚¹çš„å­©å­èŠ‚ç‚¹</td></tr><tr><td>init</td><td>å‡½æ•°</td><td>åŒ…åˆå§‹åŒ–</td></tr><tr><td>WithDeadline</td><td>å‡½æ•°</td><td>åˆ›å»ºä¸€ä¸ªæœ‰ deadline çš„ context</td></tr><tr><td>WithTimeout</td><td>å‡½æ•°</td><td>åˆ›å»ºä¸€ä¸ªæœ‰ timeout çš„ context</td></tr><tr><td>WithValue</td><td>å‡½æ•°</td><td>åˆ›å»ºä¸€ä¸ªå­˜å‚¨ k-v å¯¹çš„ context</td></tr></tbody></table>]]></content>
    
    
    <summary type="html">&lt;p&gt;contextæ˜¯Goçš„ä¸€ä¸ªæ ‡å‡†åº“ï¼Œä¸­æ–‡ä¸€èˆ¬å«åšâ€ä¸Šä¸‹æ–‡â€ã€‚contextä¸»è¦æ˜¯ç”¨æ¥åœ¨goroutineä¹‹é—´ä¼ é€’ä¸Šä¸‹åˆä¿¡æ¯ï¼ŒåŒ…æ‹¬å–æ¶ˆä¿¡å·ã€è¶…æ—¶æ—¶é—´ç­‰ã€‚context.Contextç±»å‹çš„å€¼å¯ä»¥åè°ƒå¤šä¸ªgoroutineä¸­çš„ä»£ç æ‰§è¡Œâ€œå–æ¶ˆâ€æ“ä½œï¼Œå¹¶ä¸”å¯ä»¥å­˜å‚¨é”®å€¼å¯¹ã€‚è€Œä¸”è¿˜æ˜¯å¹¶å‘å®‰å…¨çš„ã€‚ä¸å®ƒåä½œå¯ä»¥åœ¨APIçš„å¤–éƒ¨æ§åˆ¶æ‰§è¡Œâ€œå–æ¶ˆâ€æ“ä½œï¼Œæ¯”å¦‚å–æ¶ˆä¸€ä¸ªHTTPè¯·æ±‚çš„æ‰§è¡Œã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="Golang" scheme="https://blog.eganx.cn/categories/Golang/"/>
    
    
    <category term="go" scheme="https://blog.eganx.cn/tags/go/"/>
    
    <category term="context" scheme="https://blog.eganx.cn/tags/context/"/>
    
  </entry>
  
  <entry>
    <title>Go Channelå…³é—­æ–¹å¼</title>
    <link href="https://blog.eganx.cn/2022/11/02/Go_Channel_Close/"/>
    <id>https://blog.eganx.cn/2022/11/02/Go_Channel_Close/</id>
    <published>2022-11-02T15:56:54.000Z</published>
    <updated>2022-11-24T07:06:51.771Z</updated>
    
    <content type="html"><![CDATA[<p>channelçš„å…³é—­æ˜¯æ¯”è¾ƒå¤´ç–¼çš„ï¼Œæä¸å¥½å°±panicã€‚ç›´æ¥panic-recoverè¦è¢«å–·è½å¤«ï¼Œä¸ä¼˜é›…ã€‚æ‰€ä»¥æ‰¾äº†å¾ˆå¤šèµ„æ–™ï¼Œæ€»ç»“ä¸€ä¸‹channelçš„å…³é—­è¿‡ç¨‹ï¼Œå¸¸è§çš„å…³é—­æ–¹å¼å’Œä¼˜é›…çš„å…³é—­æ–¹å¼ï¼ˆ<strong>æ²¡æœ‰äººä¼šæ¯”ç¦æ°ä¸€å®¶è¿˜è¦ä¼˜é›…</strong>ï¼‰</p><span id="more"></span><h2 id="0x0-å…³é—­chanè¿‡ç¨‹"><a href="#0x0-å…³é—­chanè¿‡ç¨‹" class="headerlink" title="0x0.å…³é—­chanè¿‡ç¨‹"></a>0x0.å…³é—­chanè¿‡ç¨‹</h2><p>å…³é—­channelçš„æ‰§è¡Œå‡½æ•°æ˜¯<code>closechan</code>ï¼Œæºç å¦‚ä¸‹</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// go version: go1.18.2</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">closechan</span><span class="params">(c *hchan)</span></span> &#123;</span><br><span class="line"><span class="comment">// å…³é—­ä¸€ä¸ªnil channelï¼Œç›´æ¥panicã€‚</span></span><br><span class="line">  <span class="keyword">if</span> c == <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="built_in">panic</span>(plainError(<span class="string">&quot;close of nil channel&quot;</span>))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// é”</span></span><br><span class="line">lock(&amp;c.lock)</span><br><span class="line">  <span class="comment">// channelå·²ç»å…³é—­</span></span><br><span class="line"><span class="keyword">if</span> c.closed != <span class="number">0</span> &#123;</span><br><span class="line"><span class="comment">// è§£é”ï¼Œç„¶åpanic</span></span><br><span class="line">    unlock(&amp;c.lock)</span><br><span class="line"><span class="built_in">panic</span>(plainError(<span class="string">&quot;close of closed channel&quot;</span>))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> raceenabled &#123;</span><br><span class="line">callerpc := getcallerpc()</span><br><span class="line">racewritepc(c.raceaddr(), callerpc, abi.FuncPCABIInternal(closechan))</span><br><span class="line">racerelease(c.raceaddr())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è®¾ç½®chanå·²å…³é—­</span></span><br><span class="line">c.closed = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> glist gList</span><br><span class="line"></span><br><span class="line">  <span class="comment">// é‡Šæ”¾channelé‡Œæ‰€æœ‰ç­‰å¾…æ¥æ”¶é˜Ÿåˆ—é‡Œçš„sudog</span></span><br><span class="line"><span class="comment">// release all readers</span></span><br><span class="line"><span class="keyword">for</span> &#123;</span><br><span class="line">sg := c.recvq.dequeue()</span><br><span class="line"><span class="keyword">if</span> sg == <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line">&#125;</span><br><span class="line">    <span class="comment">// elemä¸ä¸ºç©ºï¼Œè¿˜æƒ³è¦æ¥æ”¶æ•°æ®ï¼Œç»™ä¸ªç›¸å¯¹åº”ç±»å‹çš„é›¶å€¼ã€‚</span></span><br><span class="line"><span class="keyword">if</span> sg.elem != <span class="literal">nil</span> &#123;</span><br><span class="line">typedmemclr(c.elemtype, sg.elem)</span><br><span class="line">sg.elem = <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> sg.releasetime != <span class="number">0</span> &#123;</span><br><span class="line">sg.releasetime = cputicks()</span><br><span class="line">&#125;</span><br><span class="line">    <span class="comment">// å–å‡ºgoroutine</span></span><br><span class="line">gp := sg.g</span><br><span class="line">gp.param = unsafe.Pointer(sg)</span><br><span class="line">sg.success = <span class="literal">false</span></span><br><span class="line"><span class="keyword">if</span> raceenabled &#123;</span><br><span class="line">raceacquireg(gp, c.raceaddr())</span><br><span class="line">&#125;</span><br><span class="line">glist.push(gp)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// é‡Šæ”¾channelé‡Œæ‰€æœ‰ç­‰å¾…å‘é€é˜Ÿåˆ—é‡Œçš„sudogï¼ŒåŒæ—¶è¿™äº›goroutineå°†ä¼španicã€‚</span></span><br><span class="line"><span class="comment">// release all writers (they will panic)</span></span><br><span class="line"><span class="keyword">for</span> &#123;</span><br><span class="line">sg := c.sendq.dequeue()</span><br><span class="line"><span class="keyword">if</span> sg == <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line">&#125;</span><br><span class="line">sg.elem = <span class="literal">nil</span></span><br><span class="line"><span class="keyword">if</span> sg.releasetime != <span class="number">0</span> &#123;</span><br><span class="line">sg.releasetime = cputicks()</span><br><span class="line">&#125;</span><br><span class="line">gp := sg.g</span><br><span class="line">gp.param = unsafe.Pointer(sg)</span><br><span class="line">sg.success = <span class="literal">false</span></span><br><span class="line"><span class="keyword">if</span> raceenabled &#123;</span><br><span class="line">raceacquireg(gp, c.raceaddr())</span><br><span class="line">&#125;</span><br><span class="line">glist.push(gp)</span><br><span class="line">&#125;</span><br><span class="line">unlock(&amp;c.lock)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Ready all Gs now that we&#x27;ve dropped the channel lock.</span></span><br><span class="line">  <span class="comment">// éå†glistï¼Œå”¤é†’goroutine</span></span><br><span class="line"><span class="keyword">for</span> !glist.empty() &#123;</span><br><span class="line">gp := glist.pop()</span><br><span class="line">gp.schedlink = <span class="number">0</span></span><br><span class="line">goready(gp, <span class="number">3</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å°†<code>recvq</code>å’Œ<code>sendq</code>ä¸¤ä¸ªé˜Ÿåˆ—ä¸­çš„GoroutineåŠ å…¥åˆ°gListä¸­ï¼Œå¹¶æ¸…é™¤æ‰æ‰€æœ‰sudogä¸Šæœªè¢«å¤„ç†æ‰å…ƒç´ ã€‚æœ€åå°†glistä¸­æ‰€æœ‰çš„goroutineåŠ åˆ°è°ƒåº¦é˜Ÿåˆ—ï¼Œç­‰å¾…è¢«å”¤é†’ã€‚</p><blockquote><p><font color=red>å‘é€è€…åœ¨è¢«å”¤é†’ä¹‹åä¼španicã€‚</font></p></blockquote><p>æ€»ç»“ä¸€ä¸‹:</p><table><thead><tr><th align="center">æ“ä½œ</th><th align="center">closed channel</th></tr></thead><tbody><tr><td align="center">å…³é—­(close)</td><td align="center">panic</td></tr><tr><td align="center">å‘é€(c&lt;-)</td><td align="center">panic</td></tr><tr><td align="center">æ¥æ”¶(&lt;-c)</td><td align="center">æ°¸è¿œä¸é˜»å¡</td></tr></tbody></table><h2 id="0x1-å…³é—­channelçš„å¸¸è§æ–¹å¼"><a href="#0x1-å…³é—­channelçš„å¸¸è§æ–¹å¼" class="headerlink" title="0x1.å…³é—­channelçš„å¸¸è§æ–¹å¼"></a>0x1.å…³é—­channelçš„å¸¸è§æ–¹å¼</h2><p>channelçš„å…³é—­ä¸å¦éƒ½æœ‰å¯èƒ½é€ æˆpanicã€‚å¦‚ä½•è·å–channelæ˜¯å¦å…³é—­å’Œå¦‚ä½•ç¨³å¦¥çš„å…³é—­channelæ˜¯éå¸¸é‡è¦çš„äº‹æƒ…â€¼ï¸</p><ul><li>åœ¨ä¸æ”¹å˜channelè‡ªèº«çŠ¶æ€çš„æƒ…å†µä¸‹ï¼Œæ— æ³•è·çŸ¥ä¸€ä¸ªchannelæ˜¯å¦å…³é—­ã€‚</li><li>å…³é—­ä¸€ä¸ªclosed channelä¼šå¯¼è‡´panicã€‚æ‰€ä»¥åœ¨å…³é—­channelçš„æ—¶å€™ï¼Œå…³é—­çš„ä¸€æ–¹åœ¨ä¸æ¸…æ¥šå½“å‰channelæ˜¯å¦å…³é—­çš„æƒ…å†µä¸‹å»å…³é—­channelæ˜¯å¾ˆå±é™©çš„âš ï¸ã€‚</li><li>å‘ä¸€ä¸ªclosed channelå‘é€æ•°æ®ä¼šå¯¼è‡´panicã€‚åŒä¸Šï¼Œåœ¨å‘é€æ–¹ä¸çŸ¥é“channelæ˜¯å¦å…³é—­çš„æƒ…å†µä¸‹å‘channelå‘é€æ•°æ®ï¼Œä¹Ÿæ˜¯å¾ˆå±é™©çš„âš ï¸</li></ul><p>å…³é—­channelåŸåˆ™ï¼š</p><blockquote><p>ä¸€èˆ¬åŸåˆ™ä¸Šä½¿ç”¨channelæ˜¯ä¸å…è®¸æ¥æ”¶æ–¹å…³é—­channelå’Œ <strong>ä¸èƒ½å…³é—­ä¸€ä¸ªæœ‰å¤šä¸ªå¹¶å‘å‘é€è€…çš„channel</strong>ã€‚ æ¢è€Œè¨€ä¹‹ï¼Œ ä½ åªèƒ½åœ¨å‘é€æ–¹çš„ goroutine ä¸­å…³é—­åªæœ‰è¯¥å‘é€æ–¹çš„channelã€‚</p></blockquote><h3 id="1-defer-recoverç²—æš´å…³é—­channel"><a href="#1-defer-recoverç²—æš´å…³é—­channel" class="headerlink" title="1).defer-recoverç²—æš´å…³é—­channel"></a>1).<strong>defer-recoverç²—æš´å…³é—­channel</strong></h3><p>ä½¿ç”¨defer-recoveræœºåˆ¶æ¥ç¡®ä¿ç¨‹åºä¸ä¼šå› panicè€Œå´©æºƒï¼Œç„¶åç›´æ¥å…³é—­chanã€‚</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">SafeClose</span><span class="params">(ch <span class="keyword">chan</span> T)</span> <span class="params">(justClosed <span class="keyword">bool</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">recover</span>() != <span class="literal">nil</span> &#123;</span><br><span class="line">            <span class="comment">// è¿”å›å€¼å¯ä»¥è¢«ä¿®æ”¹</span></span><br><span class="line">            <span class="comment">// åœ¨ä¸€ä¸ªå»¶æ—¶å‡½æ•°çš„è°ƒç”¨ä¸­ã€‚</span></span><br><span class="line">            justClosed = <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å‡è®¾è¿™é‡Œ ch != nil ã€‚</span></span><br><span class="line">    <span class="built_in">close</span>(ch)   <span class="comment">// å¦‚æœ ch å·²ç»è¢«å…³é—­å°†ä¼šå¼•å‘ panic</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span> <span class="comment">// &lt;=&gt; justClosed = true; return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŒæ ·çš„æ€æƒ³ä¹Ÿå¯ä»¥ç”¨åœ¨å‘é€æ–¹ï¼Œç¡®ä¿å‘closed channelå‘é€æ•°æ®ä¸ä¼šé€ æˆç¨‹åºå´©äº†ã€‚</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">SafeSend</span><span class="params">(ch <span class="keyword">chan</span> T, value T)</span> <span class="params">(closed <span class="keyword">bool</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">recover</span>() != <span class="literal">nil</span> &#123;</span><br><span class="line">            closed = <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;()</span><br><span class="line"></span><br><span class="line">    ch &lt;- value  <span class="comment">// å¦‚æœ ch å·²ç»è¢«å…³é—­å°†ä¼šå¼•å‘ panic</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span> <span class="comment">// &lt;=&gt; closed = false; return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„æ–¹æ³•è™½ç„¶å¤„ç†äº†panicï¼Œä½†æ˜¯å¹¶æ²¡æœ‰é¿å…panicçš„å‘ç”Ÿã€‚</p><h3 id="2-ä½¿ç”¨sync-Onceå…³é—­channel"><a href="#2-ä½¿ç”¨sync-Onceå…³é—­channel" class="headerlink" title="2).ä½¿ç”¨sync.Onceå…³é—­channel"></a>2).<strong>ä½¿ç”¨sync.Onceå…³é—­channel</strong></h3><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> MyChannel <span class="keyword">struct</span> &#123;</span><br><span class="line">    C    <span class="keyword">chan</span> T</span><br><span class="line">    once sync.Once</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewMyChannel</span><span class="params">()</span> *<span class="title">MyChannel</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &amp;MyChannel&#123;C: <span class="built_in">make</span>(<span class="keyword">chan</span> T)&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(mc *MyChannel)</span> <span class="title">SafeClose</span><span class="params">()</span></span> &#123;</span><br><span class="line">    mc.once.Do(<span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="built_in">close</span>(mc.C)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-ä½¿ç”¨sync-Mutexé¿å…å¤šæ¬¡å…³é—­åŒä¸€ä¸ªchannel"><a href="#3-ä½¿ç”¨sync-Mutexé¿å…å¤šæ¬¡å…³é—­åŒä¸€ä¸ªchannel" class="headerlink" title="3).ä½¿ç”¨sync.Mutexé¿å…å¤šæ¬¡å…³é—­åŒä¸€ä¸ªchannel"></a>3).<strong>ä½¿ç”¨sync.Mutexé¿å…å¤šæ¬¡å…³é—­åŒä¸€ä¸ªchannel</strong></h3><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> MyChannel <span class="keyword">struct</span> &#123;</span><br><span class="line">    C      <span class="keyword">chan</span> T</span><br><span class="line">    closed <span class="keyword">bool</span></span><br><span class="line">    mutex  sync.Mutex</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewMyChannel</span><span class="params">()</span> *<span class="title">MyChannel</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &amp;MyChannel&#123;C: <span class="built_in">make</span>(<span class="keyword">chan</span> T)&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(mc *MyChannel)</span> <span class="title">SafeClose</span><span class="params">()</span></span> &#123;</span><br><span class="line">    mc.mutex.Lock()</span><br><span class="line">    <span class="keyword">defer</span> mc.mutex.Unlock()</span><br><span class="line">    <span class="keyword">if</span> !mc.closed &#123;</span><br><span class="line">        <span class="built_in">close</span>(mc.C)</span><br><span class="line">        mc.closed = <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(mc *MyChannel)</span> <span class="title">IsClosed</span><span class="params">()</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">    mc.mutex.Lock()</span><br><span class="line">    <span class="keyword">defer</span> mc.mutex.Unlock()</span><br><span class="line">    <span class="keyword">return</span> mc.closed</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="0x2-ä¼˜é›…çš„å…³é—­channel"><a href="#0x2-ä¼˜é›…çš„å…³é—­channel" class="headerlink" title="0x2.ä¼˜é›…çš„å…³é—­channel"></a>0x2.ä¼˜é›…çš„å…³é—­channel</h2><p>ä¸Šé¢çš„å‡ ç§å…³é—­channelçš„æ–¹å¼ï¼Œç”¨çš„äººåº”è¯¥ä¸å°‘(è¯´å®è¯ï¼Œæˆ‘ä¹Ÿå¾ˆå–œæ¬¢ä½¿ç”¨<code>sync.Once</code>çš„æ–¹å¼å»å…³é—­channel)ã€‚ä½†æ˜¯ï¼Œæœ‰è®¸å¤šäººè®¤ä¸ºä»£ç åœ¨è€ƒè™‘ä¸šåŠ¡å®ç°çš„åŒæ—¶ï¼Œåº”è¯¥ä¼˜é›…ä¼˜é›…å†ä¼˜é›…ï¼ï¼ˆèˆç›‘è¡¨ç¤ºå¾ˆå¼€å¿ƒï¼é˜¿å°¼äºšè¡¨ç¤ºå¾ˆéš¾å—ï¼ï¼‰</p><p>é‚£ä¹ˆå¦‚ä½•ä¼˜é›…çš„å…³é—­channelï¼ŸæŒ‰ç…§å‘é€è€…å’Œæ¥æ”¶è€…çš„æ•°é‡å¯ä»¥åˆ†ä¸ºä»¥ä¸‹å››ç§ï¼š</p><blockquote><p><font color = ligblue>1. ä¸€ä¸ª senderï¼Œä¸€ä¸ª receiver</font><br><font color = ligblue>2. ä¸€ä¸ª senderï¼Œ Nä¸ª receiver</font><br><font color = ligblue>3. Mä¸ª senderï¼Œ ä¸€ä¸ª receiver</font><br><font color = ligblue>4. Mä¸ª senderï¼Œ Nä¸ª receiver</font></p></blockquote><h3 id="1-åªæœ‰ä¸€ä¸ªå‘é€è€…ï¼Œå…³é—­å”¯ä¸€çš„å‘é€è€…"><a href="#1-åªæœ‰ä¸€ä¸ªå‘é€è€…ï¼Œå…³é—­å”¯ä¸€çš„å‘é€è€…" class="headerlink" title="1).åªæœ‰ä¸€ä¸ªå‘é€è€…ï¼Œå…³é—­å”¯ä¸€çš„å‘é€è€…"></a>1).åªæœ‰ä¸€ä¸ªå‘é€è€…ï¼Œå…³é—­å”¯ä¸€çš„å‘é€è€…</h3><p>ç¬¬ä¸€ç§å’Œç¬¬äºŒç§æƒ…å†µæ¯”è¾ƒå¥½å¤„ç†ï¼Œå› ä¸ºåªæœ‰ä¸€ä¸ªå‘é€è€…ï¼Œåªéœ€è¦å…³é—­å”¯ä¸€çš„å‘é€è€…å°±å¯ä»¥ã€‚<code>sync.WaitGroup</code> ä¼šè¢«ç”¨äºå®Œæˆä¾‹å­ã€‚ å®ƒåœ¨å®è·µä¸­å¹¶ä¸æ˜¯å¿…è¦çš„ã€‚</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;time&quot;</span></span><br><span class="line">    <span class="string">&quot;math/rand&quot;</span></span><br><span class="line">    <span class="string">&quot;sync&quot;</span></span><br><span class="line">    <span class="string">&quot;log&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    rand.Seed(time.Now().UnixNano())</span><br><span class="line">    log.SetFlags(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> MaxRandomNumber = <span class="number">100000</span></span><br><span class="line">    <span class="keyword">const</span> NumReceivers = <span class="number">100</span></span><br><span class="line"></span><br><span class="line">    wgReceivers := sync.WaitGroup&#123;&#125;</span><br><span class="line">    wgReceivers.Add(NumReceivers)</span><br><span class="line"></span><br><span class="line">    dataCh := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>, <span class="number">100</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å‘é€è€…</span></span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">for</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> value := rand.Intn(MaxRandomNumber); value == <span class="number">0</span> &#123;</span><br><span class="line">                <span class="comment">// å”¯ä¸€çš„å‘é€è€…å¯ä»¥å®‰å…¨åœ°å…³é—­é€šé“ã€‚</span></span><br><span class="line">                <span class="built_in">close</span>(dataCh)</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;            </span><br><span class="line">                dataCh &lt;- value</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ¥æ”¶è€…</span></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; NumReceivers; i++ &#123;</span><br><span class="line">        <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">            <span class="keyword">defer</span> wgReceivers.Done()</span><br><span class="line"></span><br><span class="line">            <span class="comment">// æ¥æ”¶æ•°æ®ç›´åˆ° dataCh è¢«å…³é—­æˆ–è€…</span></span><br><span class="line">            <span class="comment">// dataCh çš„æ•°æ®ç¼“å­˜é˜Ÿåˆ—æ˜¯ç©ºçš„ã€‚</span></span><br><span class="line">            <span class="keyword">for</span> value := <span class="keyword">range</span> dataCh &#123;</span><br><span class="line">                log.Println(value)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    wgReceivers.Wait()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-å¤šä¸ªå‘é€è€…ï¼Œä¸€ä¸ªæ¥æ”¶è€…ã€‚"><a href="#2-å¤šä¸ªå‘é€è€…ï¼Œä¸€ä¸ªæ¥æ”¶è€…ã€‚" class="headerlink" title="2).å¤šä¸ªå‘é€è€…ï¼Œä¸€ä¸ªæ¥æ”¶è€…ã€‚"></a>2).å¤šä¸ªå‘é€è€…ï¼Œä¸€ä¸ªæ¥æ”¶è€…ã€‚</h3><p>æ¥æ”¶è€…é€šè¿‡å…³é—­ä¸€ä¸ªchannelï¼Œå‘Šè¯‰å‘é€è€…ä¸è¦å†å‘äº†ã€‚</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;time&quot;</span></span><br><span class="line">    <span class="string">&quot;math/rand&quot;</span></span><br><span class="line">    <span class="string">&quot;sync&quot;</span></span><br><span class="line">    <span class="string">&quot;log&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    rand.Seed(time.Now().UnixNano())</span><br><span class="line">    log.SetFlags(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">const</span> MaxRandomNumber = <span class="number">100000</span></span><br><span class="line">    <span class="keyword">const</span> NumSenders = <span class="number">1000</span></span><br><span class="line"></span><br><span class="line">    wgReceivers := sync.WaitGroup&#123;&#125;</span><br><span class="line">    wgReceivers.Add(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    dataCh := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>, <span class="number">100</span>)</span><br><span class="line">    stopCh := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">struct</span>&#123;&#125;)</span><br><span class="line">        <span class="comment">// stopCh æ˜¯ä¸€ä¸ªä¿¡å·é€šé“ã€‚</span></span><br><span class="line">        <span class="comment">// å®ƒçš„å‘é€è€…æ˜¯ dataCh çš„æ¥æ”¶è€…ã€‚</span></span><br><span class="line">        <span class="comment">// å®ƒçš„æ¥æ”¶è€…æ˜¯ dataCh çš„å‘é€è€…ã€‚</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// å‘é€è€…</span></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; NumSenders; i++ &#123;</span><br><span class="line">        <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">            <span class="keyword">for</span> &#123;</span><br><span class="line">                <span class="keyword">select</span> &#123;</span><br><span class="line">                <span class="keyword">case</span> &lt;- stopCh:</span><br><span class="line">                    <span class="keyword">return</span></span><br><span class="line">                <span class="keyword">case</span> dataCh &lt;- rand.Intn(MaxRandomNumber):</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ¥æ”¶è€…</span></span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">defer</span> wgReceivers.Done()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> value := <span class="keyword">range</span> dataCh &#123;</span><br><span class="line">            <span class="keyword">if</span> value == MaxRandomNumber<span class="number">-1</span> &#123;</span><br><span class="line">                <span class="comment">// dataCh é€šé“çš„æ¥æ”¶è€…ä¹Ÿæ˜¯ stopCh é€šé“çš„å‘é€è€…ã€‚</span></span><br><span class="line">                <span class="comment">// åœ¨è¿™é‡Œå…³é—­åœæ­¢é€šé“æ˜¯å®‰å…¨çš„ã€‚.</span></span><br><span class="line">                <span class="built_in">close</span>(stopCh)</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            log.Println(value)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    wgReceivers.Wait()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-å¤šä¸ªå‘é€è€…ï¼Œå¤šä¸ªæ¥æ”¶è€…ã€‚"><a href="#3-å¤šä¸ªå‘é€è€…ï¼Œå¤šä¸ªæ¥æ”¶è€…ã€‚" class="headerlink" title="3).å¤šä¸ªå‘é€è€…ï¼Œå¤šä¸ªæ¥æ”¶è€…ã€‚"></a>3).å¤šä¸ªå‘é€è€…ï¼Œå¤šä¸ªæ¥æ”¶è€…ã€‚</h3><p>å½“å‘é€è€…å’Œæ¥æ”¶è€…éƒ½æ˜¯å¤šä¸ªçš„æ—¶å€™ï¼Œæ²¡åŠæ³•é€šè¿‡ä»»ä½•ä¸€æ–¹å»ç»ˆæ­¢è¿™åœºæ¸¸æˆã€‚å› æ­¤éœ€è¦å¢åŠ ä¸€ä¸ªä¸­é—´äººçš„è§’è‰²æ¥å¤„ç†ã€‚</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;time&quot;</span></span><br><span class="line">    <span class="string">&quot;math/rand&quot;</span></span><br><span class="line">    <span class="string">&quot;sync&quot;</span></span><br><span class="line">    <span class="string">&quot;log&quot;</span></span><br><span class="line">    <span class="string">&quot;strconv&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    rand.Seed(time.Now().UnixNano())</span><br><span class="line">    log.SetFlags(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">const</span> MaxRandomNumber = <span class="number">100000</span></span><br><span class="line">    <span class="keyword">const</span> NumReceivers = <span class="number">100</span></span><br><span class="line">    <span class="keyword">const</span> NumSenders = <span class="number">1000</span></span><br><span class="line"></span><br><span class="line">    wgReceivers := sync.WaitGroup&#123;&#125;</span><br><span class="line">    wgReceivers.Add(NumReceivers)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    dataCh := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>, <span class="number">100</span>)</span><br><span class="line">    stopCh := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">struct</span>&#123;&#125;)</span><br><span class="line">        <span class="comment">// stopCh æ˜¯ä¸€ä¸ªä¿¡å·é€šé“ã€‚</span></span><br><span class="line">        <span class="comment">// å®ƒçš„å‘é€è€…æ˜¯ä¸‹é¢çš„ä¸»æŒäºº goroutineã€‚</span></span><br><span class="line">        <span class="comment">// å®ƒçš„æ¥æ”¶è€…æ˜¯ dataChçš„æ‰€æœ‰å‘é€è€…å’Œæ¥æ”¶è€…ã€‚</span></span><br><span class="line">    toStop := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">string</span>, <span class="number">1</span>)</span><br><span class="line">        <span class="comment">// toStop é€šé“é€šå¸¸ç”¨æ¥é€šçŸ¥ä¸»æŒäººå»å…³é—­ä¿¡å·é€šé“( stopCh )ã€‚</span></span><br><span class="line">        <span class="comment">// å®ƒçš„å‘é€è€…æ˜¯ dataChçš„ä»»æ„å‘é€è€…å’Œæ¥æ”¶è€…ã€‚</span></span><br><span class="line">        <span class="comment">// å®ƒçš„æ¥æ”¶è€…æ˜¯ä¸‹é¢çš„ä¸»æŒäºº goroutine</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> stoppedBy <span class="keyword">string</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¸»æŒäºº</span></span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        stoppedBy = &lt;-toStop</span><br><span class="line">        <span class="built_in">close</span>(stopCh)</span><br><span class="line">    &#125;()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å‘é€è€…</span></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; NumSenders; i++ &#123;</span><br><span class="line">        <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">(id <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">            <span class="keyword">for</span> &#123;</span><br><span class="line">                value := rand.Intn(MaxRandomNumber)</span><br><span class="line">                <span class="keyword">if</span> value == <span class="number">0</span> &#123;</span><br><span class="line">                    <span class="comment">// ç”¨äºé€šçŸ¥ä¸»æŒäººå…³é—­ä¿¡å·é€šé“ã€‚</span></span><br><span class="line">                    <span class="keyword">select</span> &#123;</span><br><span class="line">                    <span class="keyword">case</span> toStop &lt;- <span class="string">&quot;sender#&quot;</span> + id:</span><br><span class="line">                    <span class="keyword">default</span>:</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">return</span></span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">select</span> &#123;</span><br><span class="line">                <span class="keyword">case</span> &lt;- stopCh:</span><br><span class="line">                    <span class="keyword">return</span></span><br><span class="line">                <span class="keyword">case</span> dataCh &lt;- value:</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;(strconv.Itoa(i))</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ¥æ”¶è€…</span></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; NumReceivers; i++ &#123;</span><br><span class="line">        <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">(id <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">            <span class="keyword">defer</span> wgReceivers.Done()</span><br><span class="line">            <span class="keyword">for</span> &#123;</span><br><span class="line">                <span class="keyword">select</span> &#123;</span><br><span class="line">                <span class="keyword">case</span> &lt;- stopCh:</span><br><span class="line">                    <span class="keyword">return</span></span><br><span class="line">                <span class="keyword">case</span> value := &lt;-dataCh:</span><br><span class="line">                    <span class="keyword">if</span> value == MaxRandomNumber<span class="number">-1</span> &#123;</span><br><span class="line">                        <span class="comment">// åŒæ ·ç”¨äºé€šçŸ¥ä¸»æŒäººå»å…³é—­ä¿¡å·é€šé“ã€‚</span></span><br><span class="line">                        <span class="keyword">select</span> &#123;</span><br><span class="line">                        <span class="keyword">case</span> toStop &lt;- <span class="string">&quot;receiver#&quot;</span> + id:</span><br><span class="line">                        <span class="keyword">default</span>:</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">return</span></span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    log.Println(value)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;(strconv.Itoa(i))</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    wgReceivers.Wait()</span><br><span class="line">    log.Println(<span class="string">&quot;stopped by&quot;</span>, stoppedBy)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶<code>toStop</code>é€šé“çš„ç¼“å­˜å¤§å°æ˜¯1ã€‚ä¸ä½¿ç”¨éç¼“å†²å‹channelæ˜¯ä¸ºäº†é¿å…ç¬¬ä¸€ä¸ªå…³é—­ä¿¡å·åœ¨ä¸»æŒäººå‡†å¤‡å¥½ä»<code>toStop</code>æ¥æ”¶æ•°æ®ä¹‹å‰å‘é€ï¼Œé€ æˆä¸¢å¤±ã€‚</p><p>ä¹Ÿå¯ä»¥è®¾ç½®<code>toStop</code>é€šé“çš„bufä¸ºå‘é€è€…å’Œæ¥æ”¶è€…æ•°é‡ä¹‹å’Œã€‚toStopçš„å®¹é‡è¶³å¤Ÿçš„æ—¶å€™ï¼Œå°±ä¸ç”¨æ‹…å¿ƒé˜»å¡äº†ã€‚ä¹Ÿå°±ä¸éœ€è¦å€ŸåŠ©selectè¯­å¥äº†ã€‚</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line">...</span><br><span class="line">toStop := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">string</span>, NumReceivers + NumSenders)</span><br><span class="line">...</span><br><span class="line">            value := rand.Intn(MaxRandomNumber)</span><br><span class="line">            <span class="keyword">if</span> value == <span class="number">0</span> &#123;</span><br><span class="line">                toStop &lt;- <span class="string">&quot;sender#&quot;</span> + id</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            &#125;</span><br><span class="line">...</span><br><span class="line">                <span class="keyword">if</span> value == MaxRandomNumber<span class="number">-1</span> &#123;</span><br><span class="line">                    toStop &lt;- <span class="string">&quot;receiver#&quot;</span> + id</span><br><span class="line">                    <span class="keyword">return</span></span><br><span class="line">                &#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p><font color = green>Q&amp;A: å…³é—­çš„channelè¿˜èƒ½è¯»å—ï¼Ÿ</font></p><blockquote><p>å¯ä»¥ã€‚ä»ä¸€ä¸ªå¸¦ç¼“å†²çš„chané‡Œè¯»å–æ•°æ®æ—¶ï¼Œå½“channelè¢«å…³é—­ï¼Œæ˜¯å¯ä»¥è¯»åˆ°æœ‰æ•ˆå€¼çš„ã€‚å¯ä»¥æ˜¯comma-okçš„æ–¹å¼è¯»å–chanæ•°æ®ï¼Œå½“okå€¼ä¸ºfalseæ—¶ï¼Œè¯´æ˜channelå·²ç»å…³é—­ä¸”é€šé“æ— æ•°æ®ï¼Œè¯»å‡ºçš„æ•°æ®å¼€å§‹æ— æ•ˆã€‚</p></blockquote><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">ch := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>, <span class="number">3</span>)</span><br><span class="line">ch &lt;- <span class="number">0</span></span><br><span class="line">ch &lt;- <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">close</span>(ch)</span><br><span class="line">x, ok := &lt;-ch</span><br><span class="line"><span class="keyword">if</span> ok &#123;</span><br><span class="line">fmt.Println(<span class="string">&quot;received: &quot;</span>, x)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">y, ok := &lt;-ch</span><br><span class="line"><span class="keyword">if</span> ok &#123;</span><br><span class="line">fmt.Println(<span class="string">&quot;received: &quot;</span>, y)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">z, ok := &lt;-ch</span><br><span class="line"><span class="keyword">if</span> !ok &#123;</span><br><span class="line">fmt.Println(<span class="string">&quot;received false &quot;</span>, z)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>è¿è¡Œç»“æœï¼š<br>received:  0<br>received:  1<br>received false:  0</p></blockquote>]]></content>
    
    
    <summary type="html">&lt;p&gt;channelçš„å…³é—­æ˜¯æ¯”è¾ƒå¤´ç–¼çš„ï¼Œæä¸å¥½å°±panicã€‚ç›´æ¥panic-recoverè¦è¢«å–·è½å¤«ï¼Œä¸ä¼˜é›…ã€‚æ‰€ä»¥æ‰¾äº†å¾ˆå¤šèµ„æ–™ï¼Œæ€»ç»“ä¸€ä¸‹channelçš„å…³é—­è¿‡ç¨‹ï¼Œå¸¸è§çš„å…³é—­æ–¹å¼å’Œä¼˜é›…çš„å…³é—­æ–¹å¼ï¼ˆ&lt;strong&gt;æ²¡æœ‰äººä¼šæ¯”ç¦æ°ä¸€å®¶è¿˜è¦ä¼˜é›…&lt;/strong&gt;ï¼‰&lt;/p&gt;</summary>
    
    
    
    <category term="Golang" scheme="https://blog.eganx.cn/categories/Golang/"/>
    
    
    <category term="go" scheme="https://blog.eganx.cn/tags/go/"/>
    
    <category term="channel" scheme="https://blog.eganx.cn/tags/channel/"/>
    
  </entry>
  
  <entry>
    <title>Go Channelæ•°æ®ç»“æ„å’Œåˆ›å»º</title>
    <link href="https://blog.eganx.cn/2022/11/01/Go_Channel_DS/"/>
    <id>https://blog.eganx.cn/2022/11/01/Go_Channel_DS/</id>
    <published>2022-11-01T13:09:13.000Z</published>
    <updated>2022-11-24T06:59:34.802Z</updated>
    
    <content type="html"><![CDATA[<p>Goè¯­è¨€çš„å¹¶å‘æ˜¯æœ€å¥½ç”¨çš„ï¼Œè€Œchannelä¹Ÿç®—æ˜¯Goè¯­è¨€å¹¶å‘æœºåˆ¶çš„åŠå£æ±Ÿå±±äº†ã€‚</p><span id="more"></span><h2 id="0x0-CSP"><a href="#0x0-CSP" class="headerlink" title="0x0.CSP"></a>0x0.CSP</h2><p>CSPå…¨ç§°â€œCommunicating Sequential Processesâ€ï¼Œä¸­æ–‡å¯ä»¥å«åšé€šä¿¡é¡ºåºè¿›ç¨‹ã€‚goçš„å¹¶å‘æ˜¯åŸºäºchannelå®ç°ï¼Œä¾èµ–çš„å°±æ˜¯CSPæ¨¡å‹ã€‚CSPæè¿°äº†å¹¶å‘ç³»ç»Ÿä¸­çš„äº’åŠ¨æ¨¡å¼ï¼Œå®é™…ä¸ŠGoåªæ˜¯ç”¨åˆ°äº†CSPç†è®ºä¸­ä¸€éƒ¨åˆ†ï¼Œå³ç†è®ºä¸­çš„Process/Channelï¼Œåœ¨Goä¸­å¯¹åº”goroutine/channelã€‚è¿™ä¸¤ä¸ªå¹¶å‘åŸè¯­ä¹‹é—´æ²¡æœ‰ä»å±å…³ç³»ï¼Œ Process å¯ä»¥è®¢é˜…ä»»æ„ä¸ª Channelï¼ŒChannel ä¹Ÿå¹¶ä¸å…³å¿ƒæ˜¯å“ªä¸ª Process åœ¨åˆ©ç”¨å®ƒè¿›è¡Œé€šä¿¡ï¼›Process å›´ç»• Channel è¿›è¡Œè¯»å†™ï¼Œå½¢æˆä¸€å¥—æœ‰åºé˜»å¡å’Œå¯é¢„æµ‹çš„å¹¶å‘æ¨¡å‹ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚             â”‚     â”‚             â”‚      â”‚             â”‚</span><br><span class="line">â”‚  Goroutine  â”œâ”€â”€â”€â”€â–ºâ”‚   Channel   â”œâ”€â”€â”€â”€â”€â–ºâ”‚  Goroutine  â”‚</span><br><span class="line">â”‚             â”‚     â”‚             â”‚      â”‚             â”‚</span><br><span class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br></pre></td></tr></table></figure><p>Goroutine + channelæ”¯æ’‘èµ·äº†Goè¯­è¨€çš„å¹¶å‘æœºåˆ¶ã€‚</p><h2 id="0x1-channelæ•°æ®ç»“æ„"><a href="#0x1-channelæ•°æ®ç»“æ„" class="headerlink" title="0x1.channelæ•°æ®ç»“æ„"></a>0x1.channelæ•°æ®ç»“æ„</h2><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> hchan <span class="keyword">struct</span> &#123;</span><br><span class="line">qcount   <span class="keyword">uint</span>           <span class="comment">// total data in the queue //å¾ªç¯é˜Ÿåˆ—å…ƒç´ ä¸ªæ•°</span></span><br><span class="line">dataqsiz <span class="keyword">uint</span>           <span class="comment">// size of the circular queue //å¾ªç¯é˜Ÿåˆ—å¤§å°</span></span><br><span class="line">buf      unsafe.Pointer <span class="comment">// points to an array of dataqsiz elements //å¾ªç¯é˜Ÿåˆ—æŒ‡é’ˆ</span></span><br><span class="line">elemsize <span class="keyword">uint16</span> <span class="comment">//chanå…ƒç´ å¤§å°</span></span><br><span class="line">closed   <span class="keyword">uint32</span> <span class="comment">//æ˜¯å¦å·²ç»å…³é—­</span></span><br><span class="line">elemtype *_type <span class="comment">// element type //chanå…ƒç´ ç±»å‹</span></span><br><span class="line">sendx    <span class="keyword">uint</span>   <span class="comment">// send index //chanå‘é€æ“ä½œå¤„ç†åˆ°çš„ä½ç½®</span></span><br><span class="line">recvx    <span class="keyword">uint</span>   <span class="comment">// receive index //chanæ¥æ”¶æ“ä½œå¤„ç†åˆ°çš„ä½ç½®</span></span><br><span class="line">recvq    waitq  <span class="comment">// list of recv waiters //ç­‰å¾…æ¥æ”¶æ•°æ®çš„goroutineåˆ—è¡¨</span></span><br><span class="line">sendq    waitq  <span class="comment">// list of send waiters //ç­‰å¾…å‘é€æ•°æ®çš„goroutineåˆ—è¡¨</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// lock protects all fields in hchan, as well as several</span></span><br><span class="line"><span class="comment">// fields in sudogs blocked on this channel.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Do not change another G&#x27;s status while holding this lock</span></span><br><span class="line"><span class="comment">// (in particular, do not ready a G), as this can deadlock</span></span><br><span class="line"><span class="comment">// with stack shrinking.</span></span><br><span class="line">lock mutex</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­<code>buf</code>å­—æ®µåªæœ‰åœ¨ç¼“å†²å‹çš„channelæ‰æœ‰ï¼ŒæŒ‡å‘åº•å±‚çš„å¾ªç¯æ•°ç»„ã€‚</p><p><code>sendx</code>å’Œ<code>recvx</code>åˆ†åˆ«è¡¨ç¤ºå·²å‘é€å’Œå·²æ¥æ”¶çš„å…ƒç´ åœ¨å¾ªç¯æ•°ç»„ä¸­çš„ç´¢å¼•ã€‚</p><p><code>sendq</code>å’Œ<code>recvq</code>åˆ†åˆ«è¡¨ç¤ºç­‰å¾…æ¥æ”¶å’Œç­‰å¾…å‘é€çš„goroutineé˜Ÿåˆ—ã€‚è¿™äº›goroutineç”±äºå°è¯•è¯»å–channelæˆ–è€…å‘channelå‘é€æ•°æ®è€Œè¢«é˜»å¡ã€‚</p><p><code>lock</code>ç”¨æ¥ä¿æŠ¤hchanä¸­æ‰€æœ‰çš„å­—æ®µã€‚ä¿è¯æ¯ä¸ªchannelçš„è¯»å†™éƒ½æ˜¯åŸå­çš„ã€‚</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// sudog åŒå‘åˆ—è¡¨ï¼Œsudogå®é™…ä¸Šæ˜¯å¯¹goroutineçš„ä¸€ä¸ªå°è£…ã€‚</span></span><br><span class="line"><span class="keyword">type</span> waitq <span class="keyword">struct</span> &#123;</span><br><span class="line">first *sudog</span><br><span class="line">last  *sudog</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"> â”Œâ”€â”€â”€â”€â”€â”</span><br><span class="line"> â”‚hchanâ”‚</span><br><span class="line"> â”œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">5â”‚   qcount uint    â”‚</span><br><span class="line"> â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br><span class="line">8â”‚  dataqsiz uint   â”‚                 0   1   2   3   4   5   6   7</span><br><span class="line"> â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤               â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”</span><br><span class="line"> â”‚buf unsafe.Pointerâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ a â”‚ b â”‚ c â”‚ d â”‚ e â”‚   â”‚   â”‚   â”‚</span><br><span class="line"> â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤               â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜</span><br><span class="line"> â”‚ elemsize uint16  â”‚                 â–²                   â–²</span><br><span class="line"> â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                 â”‚                   â”‚</span><br><span class="line"> â”‚  closed uint32   â”‚                 â”‚                   â”‚</span><br><span class="line"> â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                 â”‚                   â”‚</span><br><span class="line"> â”‚  elemtype *_type â”‚                 â”‚                   â”‚</span><br><span class="line"> â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                 â”‚                   â”‚</span><br><span class="line">0â”‚    sendx uint    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚</span><br><span class="line"> â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                     â”‚</span><br><span class="line">5â”‚    recvx uint    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br><span class="line"> â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br><span class="line"> â”‚    recvq waitq   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line"> â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”‚                                           â”‚</span><br><span class="line"> â”‚    sendq waitq   â”œâ”€â”€â”€â”€â”€â”   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”   â”‚</span><br><span class="line"> â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”‚   â””â”€â”€â–ºâ”‚ sudog â”‚â—„â”€â”€â”€â–ºâ”‚ sudog â”‚â—„â”€â”€â”€â–ºâ”‚ sudog â”‚â—„â”€â”€â”˜</span><br><span class="line"> â”‚    lock mutex    â”‚     â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”˜</span><br><span class="line"> â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚</span><br><span class="line">                          â”‚</span><br><span class="line">                          â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">                          â”‚   â”Œâ”€â”€â–ºâ”‚ sudog â”‚â—„â”€â”€â”€â–ºâ”‚ sudog â”‚â—„â”€â”€â”€â–ºâ”‚ sudog â”‚â—„â”€â”€â”</span><br><span class="line">                          â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚</span><br><span class="line">                          â”‚   â”‚                                           â”‚</span><br><span class="line">                          â””â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br></pre></td></tr></table></figure><h2 id="0x2-åˆ›å»ºchannel"><a href="#0x2-åˆ›å»ºchannel" class="headerlink" title="0x2.åˆ›å»ºchannel"></a>0x2.åˆ›å»ºchannel</h2><p>åˆ›å»º<code>chan</code>ä¸€èˆ¬ä½¿ç”¨<code>make</code>å…³é”®å­—ã€‚å…¶ä¸­<code>chan</code>çš„ç±»å‹åˆ†ä¸ºæœ‰æ— ç¼“å†²ä¸¤ç§æ¨¡å¼ã€‚</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line">ch := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>) <span class="comment">//æ— ç¼“å†²</span></span><br><span class="line">ch := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>, <span class="number">2</span>) <span class="comment">//æœ‰ç¼“å†²</span></span><br></pre></td></tr></table></figure><p>ç¿»ç¿»æºç ï¼Œæœ‰äº›çœ‹ä¸å¤ªæ˜ç™½ï¼Œåªèƒ½æ˜¯èƒ½çœ‹å¤šå°‘çœ‹å¤šå°‘äº†ğŸ˜­ã€‚åœ¨runtime/chan.goä¸­éƒ½æ˜¯ä½¿ç”¨<code>makechan</code>æ¥åˆ›å»º<code>chan</code>ã€‚ä¸­æ–‡æ˜¯ä¸ªäººæ³¨é‡Šï¼Œè‹±æ–‡æ˜¯å®˜æ–¹æ³¨é‡Šã€‚</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> (</span><br><span class="line">maxAlign  = <span class="number">8</span></span><br><span class="line">hchanSize = unsafe.Sizeof(hchan&#123;&#125;) + <span class="keyword">uintptr</span>(-<span class="keyword">int</span>(unsafe.Sizeof(hchan&#123;&#125;))&amp;(maxAlign<span class="number">-1</span>)) <span class="comment">//hchanç»“æ„ä½“å¤§å°</span></span><br><span class="line">debugChan = <span class="literal">false</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">makechan64</span><span class="params">(t *chantype, size <span class="keyword">int64</span>)</span> *<span class="title">hchan</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">int64</span>(<span class="keyword">int</span>(size)) != size &#123;</span><br><span class="line"><span class="built_in">panic</span>(plainError(<span class="string">&quot;makechan: size out of range&quot;</span>))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> makechan(t, <span class="keyword">int</span>(size))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">makechan</span><span class="params">(t *chantype, size <span class="keyword">int</span>)</span> *<span class="title">hchan</span></span> &#123;</span><br><span class="line">elem := t.elem</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ£€æŸ¥channel sizeå’Œalign</span></span><br><span class="line"><span class="comment">// compiler checks this but be safe.</span></span><br><span class="line"><span class="keyword">if</span> elem.size &gt;= <span class="number">1</span>&lt;&lt;<span class="number">16</span> &#123;</span><br><span class="line">throw(<span class="string">&quot;makechan: invalid channel element type&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> hchanSize%maxAlign != <span class="number">0</span> || elem.align &gt; maxAlign &#123;</span><br><span class="line">throw(<span class="string">&quot;makechan: bad alignment&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å…ƒç´ å¤§å°*ä¸ªæ•°ï¼Œè®¡ç®—buféœ€è¦çš„å†…å­˜å¤§å°</span></span><br><span class="line">mem, overflow := math.MulUintptr(elem.size, <span class="keyword">uintptr</span>(size))</span><br><span class="line"><span class="keyword">if</span> overflow || mem &gt; maxAlloc-hchanSize || size &lt; <span class="number">0</span> &#123;</span><br><span class="line"><span class="built_in">panic</span>(plainError(<span class="string">&quot;makechan: size out of range&quot;</span>))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Hchan does not contain pointers interesting for GC when elements stored in buf do not contain pointers.</span></span><br><span class="line"><span class="comment">// buf points into the same allocation, elemtype is persistent.</span></span><br><span class="line"><span class="comment">// SudoG&#x27;s are referenced from their owning thread so they can&#x27;t be collected.</span></span><br><span class="line"><span class="comment">// TODO(dvyukov,rlh): Rethink when collector can move allocated objects.</span></span><br><span class="line"><span class="keyword">var</span> c *hchan</span><br><span class="line"><span class="keyword">switch</span> &#123;</span><br><span class="line">  <span class="comment">// è¡¨ç¤ºå…ƒç´ å¤§å°ä¸ºé›¶æˆ–è€…ç¼“å†²åŒºå¤§å°ä¸º0ï¼ˆæ— ç¼“å†²ç±»å‹ï¼‰ï¼Œä¸éœ€è¦åˆ›å»ºbufã€‚åªè¿›è¡Œä¸€æ¬¡å†…å­˜åˆ†é…ã€‚åˆ†é…å†…å­˜çš„å¤§å°å°±æ˜¯hchanç»“æ„ä½“å¤§å°ã€‚</span></span><br><span class="line"><span class="keyword">case</span> mem == <span class="number">0</span>:</span><br><span class="line"><span class="comment">// Queue or element size is zero.</span></span><br><span class="line">c = (*hchan)(mallocgc(hchanSize, <span class="literal">nil</span>, <span class="literal">true</span>))</span><br><span class="line"><span class="comment">// Race detector uses this location for synchronization.</span></span><br><span class="line">c.buf = c.raceaddr()</span><br><span class="line">    </span><br><span class="line">  <span class="comment">// å…ƒç´ ç±»å‹ä¸å«æŒ‡é’ˆï¼Œè¿›è¡Œä¸€æ¬¡å†…å­˜åˆ†é…ï¼Œåˆ†é…ä¸€å—è¿ç»­çš„å†…å­˜ï¼Œå¤§å°æ˜¯â€œhchanç»“æ„ä½“å¤§å°+ä¸ªæ•°*å…ƒç´ å¤§å°â€ã€‚</span></span><br><span class="line">  <span class="comment">// åŒæ—¶å…ƒç´ å¤§å°ä¸ç­‰äº0ä¸”æ˜¯ç¼“å†²åŒºå¤§å°ä¸ä¸º0</span></span><br><span class="line"><span class="keyword">case</span> elem.ptrdata == <span class="number">0</span>:</span><br><span class="line"><span class="comment">// Elements do not contain pointers.</span></span><br><span class="line"><span class="comment">// Allocate hchan and buf in one call.</span></span><br><span class="line">c = (*hchan)(mallocgc(hchanSize+mem, <span class="literal">nil</span>, <span class="literal">true</span>))</span><br><span class="line">c.buf = add(unsafe.Pointer(c), hchanSize)</span><br><span class="line">    </span><br><span class="line">  <span class="comment">// å…ƒç´ åŒ…å«æŒ‡é’ˆï¼Œç¼“å†²åŒºå¤§å°ä¸ä¸º0ï¼Œè¿›è¡Œä¸¤æ¬¡å†…å­˜åˆ†é…ï¼Œå•ç‹¬ä¸ºhchanå’Œbufåˆ†é…å†…å­˜ã€‚</span></span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line"><span class="comment">// Elements contain pointers.</span></span><br><span class="line">c = <span class="built_in">new</span>(hchan)</span><br><span class="line">c.buf = mallocgc(mem, elem, <span class="literal">true</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">c.elemsize = <span class="keyword">uint16</span>(elem.size)</span><br><span class="line">c.elemtype = elem</span><br><span class="line">c.dataqsiz = <span class="keyword">uint</span>(size)</span><br><span class="line">lockInit(&amp;c.lock, lockRankHchan)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> debugChan &#123;</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;makechan: chan=&quot;</span>, c, <span class="string">&quot;; elemsize=&quot;</span>, elem.size, <span class="string">&quot;; dataqsiz=&quot;</span>, size, <span class="string">&quot;\n&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> c</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ ¹æ®channelä¸­æ”¶å‘çš„å…ƒç´ ç±»å‹å’Œç¼“å†²åŒºçš„å¤§å°ï¼Œåˆå§‹åŒ–hchanæ—¶æœ‰ä»¥ä¸‹ä¸‰ç§æƒ…å†µï¼š</p><ul><li>å…ƒç´ å¤§å°ä¸ºé›¶æˆ–è€…ç¼“å†²åŒºå¤§å°ä¸º0ï¼ˆæ— ç¼“å†²ç±»å‹ï¼‰ï¼Œä¸éœ€è¦åˆ›å»ºbufã€‚è¿›è¡Œä¸€æ¬¡å†…å­˜åˆ†é…ã€‚åˆ†é…å†…å­˜çš„å¤§å°å°±æ˜¯hchanç»“æ„ä½“å¤§å°ã€‚</li><li>å…ƒç´ å¤§å°å’Œç¼“å†²åŒºå¤§å°å‡ä¸ä¸º0ï¼Œä¸”å…ƒç´ ç±»å‹ä¸å«æŒ‡é’ˆã€‚è¿›è¡Œä¸€æ¬¡å†…å­˜åˆ†é…ï¼Œåˆ†é…ä¸€å—è¿ç»­çš„å†…å­˜ï¼Œå¤§å°æ˜¯â€œhchanç»“æ„ä½“å¤§å°+ä¸ªæ•°*å…ƒç´ å¤§å°â€ã€‚</li><li>å…ƒç´ åŒ…å«æŒ‡é’ˆï¼Œç¼“å†²åŒºå¤§å°ä¸ä¸º0ã€‚è¿›è¡Œä¸¤æ¬¡å†…å­˜åˆ†é…ï¼Œå•ç‹¬ä¸ºhchanå’Œbufåˆ†é…å†…å­˜ã€‚</li></ul><h2 id="0x3-channelçš„åŸºæœ¬åº”ç”¨"><a href="#0x3-channelçš„åŸºæœ¬åº”ç”¨" class="headerlink" title="0x3.channelçš„åŸºæœ¬åº”ç”¨"></a>0x3.channelçš„åŸºæœ¬åº”ç”¨</h2><h3 id="1-è¶…æ—¶å¤„ç†"><a href="#1-è¶…æ—¶å¤„ç†" class="headerlink" title="1).è¶…æ—¶å¤„ç†"></a>1).è¶…æ—¶å¤„ç†</h3><p><code>res := &lt;- c1</code> ç­‰å¾…ç»“æœï¼Œ<code>&lt;-time.After</code> ç­‰å¾…è¶…æ—¶ï¼ˆ1ç§’é’Ÿï¼‰ä»¥åå‘é€çš„å€¼ã€‚ ç”±äº <code>select</code> é»˜è®¤å¤„ç†ç¬¬ä¸€ä¸ªå·²å‡†å¤‡å¥½çš„æ¥æ”¶æ“ä½œï¼Œ å› æ­¤å¦‚æœæ“ä½œè€—æ—¶è¶…è¿‡äº†å…è®¸çš„ 1 ç§’çš„è¯ï¼Œå°†ä¼šæ‰§è¡Œè¶…æ—¶ <code>case</code>ã€‚</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">    c1 := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">string</span>, <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        time.Sleep(<span class="number">2</span> * time.Second)</span><br><span class="line">        c1 &lt;- <span class="string">&quot;result 1&quot;</span></span><br><span class="line">    &#125;()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">select</span> &#123;</span><br><span class="line">    <span class="keyword">case</span> res := &lt;-c1:</span><br><span class="line">        fmt.Println(res)</span><br><span class="line">    <span class="keyword">case</span> &lt;-time.After(<span class="number">1</span> * time.Second):</span><br><span class="line">        fmt.Println(<span class="string">&quot;timeout 1&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    c2 := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">string</span>, <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        time.Sleep(<span class="number">2</span> * time.Second)</span><br><span class="line">        c2 &lt;- <span class="string">&quot;result 2&quot;</span></span><br><span class="line">    &#125;()</span><br><span class="line">    <span class="keyword">select</span> &#123;</span><br><span class="line">    <span class="keyword">case</span> res := &lt;-c2:</span><br><span class="line">        fmt.Println(res)</span><br><span class="line">    <span class="keyword">case</span> &lt;-time.After(<span class="number">3</span> * time.Second):</span><br><span class="line">        fmt.Println(<span class="string">&quot;timeout 2&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œç»“æœï¼š</p><blockquote><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">timeout 1</span><br><span class="line">result 2</span><br></pre></td></tr></table></figure></blockquote><h3 id="2-æ§åˆ¶å¹¶å‘"><a href="#2-æ§åˆ¶å¹¶å‘" class="headerlink" title="2).æ§åˆ¶å¹¶å‘"></a>2).æ§åˆ¶å¹¶å‘</h3><p>æ„å»ºä¸€ä¸ªç¼“å†²å‹çš„ channelï¼Œå®¹é‡ä¸º 3ã€‚æ¥ç€éå†ä»»åŠ¡åˆ—è¡¨ï¼Œæ¯ä¸ªä»»åŠ¡å¯åŠ¨ä¸€ä¸ª goroutine å»å®Œæˆã€‚çœŸæ­£æ‰§è¡Œä»»åŠ¡ï¼Œè®¿é—®ç¬¬ä¸‰æ–¹çš„åŠ¨ä½œåœ¨ w() ä¸­å®Œæˆï¼Œåœ¨æ‰§è¡Œ w() ä¹‹å‰ï¼Œå…ˆè¦ä» limit ä¸­æ‹¿â€œè®¸å¯è¯â€ï¼Œæ‹¿åˆ°è®¸å¯è¯ä¹‹åï¼Œæ‰èƒ½æ‰§è¡Œ w()ï¼Œå¹¶ä¸”åœ¨æ‰§è¡Œå®Œä»»åŠ¡ï¼Œè¦å°†â€œè®¸å¯è¯â€å½’è¿˜ã€‚è¿™æ ·å°±å¯ä»¥æ§åˆ¶åŒæ—¶è¿è¡Œçš„ goroutine æ•°ã€‚å¦‚æœ w() å‘ç”Ÿ panicï¼Œé‚£â€œè®¸å¯è¯â€å¯èƒ½å°±è¿˜ä¸å›å»äº†ï¼Œå› æ­¤éœ€è¦ä½¿ç”¨ defer æ¥ä¿è¯ã€‚</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> limit = <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>, <span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   <span class="comment">// ......</span></span><br><span class="line">    <span class="keyword">for</span> _, w := <span class="keyword">range</span> work &#123;</span><br><span class="line">        <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">            limit &lt;- <span class="number">1</span></span><br><span class="line">            w()</span><br><span class="line">            &lt;-limit</span><br><span class="line">        &#125;()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ......</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹"><a href="#3-ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹" class="headerlink" title="3).ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹"></a>3).ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹</h3><p>å¹¶å‘ç¼–ç¨‹ä¸­æœ€å¸¸è§çš„ä¾‹å­å°±æ˜¯ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å¼ï¼Œè¯¥æ¨¡å¼ä¸»è¦é€šè¿‡å¹³è¡¡ç”Ÿäº§çº¿ç¨‹å’Œæ¶ˆè´¹çº¿ç¨‹çš„å·¥ä½œèƒ½åŠ›æ¥æé«˜ç¨‹åºçš„æ•´ä½“å¤„ç†æ•°æ®çš„é€Ÿåº¦ã€‚ç®€å•åœ°è¯´ï¼Œå°±æ˜¯ç”Ÿäº§è€…ç”Ÿäº§ä¸€äº›æ•°æ®ï¼Œç„¶åæ”¾åˆ°æˆæœé˜Ÿåˆ—ä¸­ï¼ŒåŒæ—¶æ¶ˆè´¹è€…ä»æˆæœé˜Ÿåˆ—ä¸­æ¥å–è¿™äº›æ•°æ®ã€‚è¿™æ ·å°±è®©ç”Ÿäº§æ¶ˆè´¹å˜æˆäº†å¼‚æ­¥çš„ä¸¤ä¸ªè¿‡ç¨‹ã€‚å½“æˆæœé˜Ÿåˆ—ä¸­æ²¡æœ‰æ•°æ®æ—¶ï¼Œæ¶ˆè´¹è€…å°±è¿›å…¥é¥¥é¥¿çš„ç­‰å¾…ä¸­ï¼›è€Œå½“æˆæœé˜Ÿåˆ—ä¸­æ•°æ®å·²æ»¡æ—¶ï¼Œç”Ÿäº§è€…åˆ™é¢ä¸´å› äº§å“æŒ¤å‹å¯¼è‡´ CPU è¢«å‰¥å¤ºçš„ä¸‹å²—é—®é¢˜ã€‚</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ç”Ÿäº§è€…: ç”Ÿæˆ factor æ•´æ•°å€çš„åºåˆ—</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Producer</span><span class="params">(factor <span class="keyword">int</span>, out <span class="keyword">chan</span>&lt;- <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; ; i++ &#123;</span><br><span class="line">        out &lt;- i*factor</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¶ˆè´¹è€…</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Consumer</span><span class="params">(in &lt;-<span class="keyword">chan</span> <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> v := <span class="keyword">range</span> in &#123;</span><br><span class="line">        fmt.Println(v)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    ch := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>, <span class="number">64</span>) <span class="comment">// æˆæœé˜Ÿåˆ—</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">go</span> Producer(<span class="number">3</span>, ch) <span class="comment">// ç”Ÿæˆ 3 çš„å€æ•°çš„åºåˆ—</span></span><br><span class="line">    <span class="keyword">go</span> Producer(<span class="number">5</span>, ch) <span class="comment">// ç”Ÿæˆ 5 çš„å€æ•°çš„åºåˆ—</span></span><br><span class="line">    <span class="keyword">go</span> Consumer(ch)    <span class="comment">// æ¶ˆè´¹ç”Ÿæˆçš„é˜Ÿåˆ—</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Ctrl+C é€€å‡º</span></span><br><span class="line">    sig := <span class="built_in">make</span>(<span class="keyword">chan</span> os.Signal, <span class="number">1</span>)</span><br><span class="line">    signal.Notify(sig, syscall.SIGINT, syscall.SIGTERM)</span><br><span class="line">    fmt.Printf(<span class="string">&quot;quit (%v)\n&quot;</span>, &lt;-sig)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;Goè¯­è¨€çš„å¹¶å‘æ˜¯æœ€å¥½ç”¨çš„ï¼Œè€Œchannelä¹Ÿç®—æ˜¯Goè¯­è¨€å¹¶å‘æœºåˆ¶çš„åŠå£æ±Ÿå±±äº†ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="Golang" scheme="https://blog.eganx.cn/categories/Golang/"/>
    
    
    <category term="go" scheme="https://blog.eganx.cn/tags/go/"/>
    
    <category term="channel" scheme="https://blog.eganx.cn/tags/channel/"/>
    
  </entry>
  
  <entry>
    <title>Go Interfaceç†è§£(2)</title>
    <link href="https://blog.eganx.cn/2022/10/30/Go_Interface_2/"/>
    <id>https://blog.eganx.cn/2022/10/30/Go_Interface_2/</id>
    <published>2022-10-30T13:45:56.000Z</published>
    <updated>2022-11-22T06:15:48.152Z</updated>
    
    <content type="html"><![CDATA[<p>æ¥å£æœ‰åŠ¨æ€å€¼å’ŒåŠ¨æ€ç±»å‹ï¼Œåªæœ‰å½“ä¸¤è€…éƒ½æ˜¯nilçš„æ—¶å€™ï¼Œæ‰æœ‰<code>æ¥å£å€¼==nil</code>ã€‚è¿™å¾ˆé‡è¦â€¼ï¸ æ¥å£å˜é‡æ—¶å¸¸éœ€è¦è¿›è¡Œç±»å‹æ–­è¨€ï¼Œæ‰¾åˆ°çœŸå®ç±»å‹ã€‚è¿™ä¹Ÿå¾ˆé‡è¦â€¼ï¸</p><span id="more"></span><h2 id="0x0-ç©ºæ¥å£-amp-nil"><a href="#0x0-ç©ºæ¥å£-amp-nil" class="headerlink" title="0x0.ç©ºæ¥å£&amp;nil"></a>0x0.ç©ºæ¥å£&amp;nil</h2><p>ä¸Šæ¥ä¸€ä¸ªç»å…¸é—®é¢˜ï¼šä¸€ä¸ªåŒ…å«nilæŒ‡é’ˆçš„æ¥å£æ˜¯ä¸æ˜¯nilæ¥å£ï¼Ÿè¿™ä¸ªæ˜¯çœŸå‘ï¼Œåœ¨åˆ¤ç©ºçš„æ—¶å€™ï¼Œæœ‰å¯èƒ½å°±ä¸­æ‹›äº†ã€‚</p><p>ç©ºæ¥å£(<code>interface&#123;&#125;</code>)ä¸åŒ…å«ä»»ä½•çš„æ–¹æ³•ï¼Œä½†ä¸æ­¤åŒæ—¶ï¼Œæ‰€æœ‰çš„ç±»å‹éƒ½å®ç°äº†<code>interface&#123;&#125;</code>ã€‚åœ¨å­˜å‚¨ä»»æ„ç±»å‹çš„æ—¶å€™ï¼Œ<code>interface&#123;&#125;</code>ç›¸å½“çš„æœ‰ç”¨ã€‚</p><p>nil ä¸æ˜¯å…³é”®å­—ï¼Œæ˜¯ä¸€ä¸ªé¢„å…ˆå£°æ˜çš„æ ‡è¯†ç¬¦ï¼ŒæŒ‡é’ˆã€é€šé“ã€å‡½æ•°ã€æ¥å£ã€mapã€åˆ‡ç‰‡çš„é›¶å€¼å°±æ˜¯nilï¼Œnil æ˜¯æ²¡æœ‰é»˜è®¤ç±»å‹çš„ï¼Œä»–çš„ç±»å‹å…·æœ‰ä¸ç¡®å®šæ€§ï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨å®ƒæ—¶å¿…é¡»è¦æä¾›è¶³å¤Ÿçš„ä¿¡æ¯èƒ½å¤Ÿè®©ç¼–è¯‘å™¨ æ¨æ–­nilæœŸæœ›çš„ç±»å‹;</p><p>ä¸¤ä¸ªnilä¸èƒ½è¿›è¡Œæ¯”è¾ƒï¼Œå› ä¸ºnilæ˜¯æ— ç±»å‹çš„;</p><blockquote><ol><li>å£°æ˜ä¸€ä¸ªnilçš„mapï¼Œmapå¯ä»¥è¯»æ•°æ®ï¼Œä½†æ˜¯ä¸èƒ½å†™æ•°æ®</li><li>å…³é—­ä¸€ä¸ªnilçš„channelä¼šå¼•å‘panic</li><li>nilåˆ‡ç‰‡ä¸èƒ½è¿›è¡Œç´¢å¼•è®¿é—®ï¼Œä¼šå¼•å‘panic</li><li>æ–¹æ³•æ¥æ”¶è€…ä¸ºnilæ—¶ï¼Œå¦‚æœåœ¨æ–¹æ³•å†…ä½¿ç”¨åˆ°äº†ä¼šå¼•å‘panic </li><li>ç©ºæŒ‡é’ˆä¸€ä¸ªæ²¡æœ‰ä»»ä½•å€¼çš„æŒ‡é’ˆ</li></ol></blockquote><p>æ¥å£çš„åº•å±‚ç»“æ„ä½“æœ‰<code>ifaceã€eface</code>ä¸¤ç§ä¸åŒçš„è¡¨ç¤ºã€‚å‰è€…æ˜¯æœ‰æ–¹æ³•çš„æ¥å£ï¼Œåè€…æ˜¯æ— ä»»ä½•æ–¹æ³•çš„ç©ºæ¥å£ï¼š<code>interface&#123;&#125;</code>ã€‚</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">//src/runtime/runtime2.go</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> iface <span class="keyword">struct</span> &#123;</span><br><span class="line">tab  *itab</span><br><span class="line">data unsafe.Pointer</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> eface <span class="keyword">struct</span> &#123;</span><br><span class="line">_type *_type</span><br><span class="line">data  unsafe.Pointer</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> itab <span class="keyword">struct</span> &#123;</span><br><span class="line">inter *interfacetype</span><br><span class="line">_type *_type</span><br><span class="line">hash  <span class="keyword">uint32</span> <span class="comment">// copy of _type.hash. Used for type switches.</span></span><br><span class="line">_     [<span class="number">4</span>]<span class="keyword">byte</span></span><br><span class="line">fun   [<span class="number">1</span>]<span class="keyword">uintptr</span> <span class="comment">// variable sized. fun[0]==0 means _type does not implement inter.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>iface</code> å†…éƒ¨ç»´æŠ¤ä¸¤ä¸ªæŒ‡é’ˆï¼Œ<code>tab</code> æŒ‡å‘ä¸€ä¸ª <code>itab</code> å®ä½“ï¼Œ å®ƒè¡¨ç¤ºæ¥å£çš„ç±»å‹ä»¥åŠèµ‹ç»™è¿™ä¸ªæ¥å£çš„å®ä½“ç±»å‹ã€‚<code>data</code> åˆ™æŒ‡å‘æ¥å£å…·ä½“çš„å€¼ï¼Œä¸€èˆ¬è€Œè¨€æ˜¯ä¸€ä¸ªæŒ‡å‘å †å†…å­˜çš„æŒ‡é’ˆã€‚<code>tab</code>å’Œ<code>data</code>ä¹Ÿåˆ†åˆ«è¢«ç§°ä¸ºåŠ¨æ€ç±»å‹å’ŒåŠ¨æ€å€¼ï¼Œæ¥å£å€¼åŒ…æ‹¬åŠ¨æ€ç±»å‹å’ŒåŠ¨æ€å€¼ã€‚åªæœ‰å½“æ¥å£çš„åŠ¨æ€ç±»å‹å’ŒåŠ¨æ€å€¼éƒ½ä¸ºnilçš„æ—¶å€™ï¼Œæ‰æœ‰<code>æ¥å£å€¼==nil</code>ã€‚</p><h2 id="0x1-æ¥å£ç±»å‹æ–­è¨€"><a href="#0x1-æ¥å£ç±»å‹æ–­è¨€" class="headerlink" title="0x1.æ¥å£ç±»å‹æ–­è¨€"></a>0x1.æ¥å£ç±»å‹æ–­è¨€</h2><p>éšå£«ç±»å‹è½¬æ¢åœ¨Goä¸­æ˜¯ä¸å…è®¸çš„ï¼Œè¿™ä¸ªæ—¶å€™ç±»å‹å°±éœ€è¦è¿›è¡Œè½¬æ¢æˆå¦ä¸€ä¸ªç±»å‹ã€‚æœ‰ä¸¤ç§æ–¹å¼å®ç°ï¼š<code>ç±»å‹è½¬æ¢</code>ï¼Œ<code>ç±»å‹æ–­è¨€</code>ã€‚ä¸¤è€…çš„ä¸åŒä¹‹å¤„åœ¨äº<font color=lgiblue>ç±»å‹æ–­è¨€æ˜¯é’ˆå¯¹æ¥å£å˜é‡ã€‚</font></p><h3 id="1-ç±»å‹è½¬æ¢"><a href="#1-ç±»å‹è½¬æ¢" class="headerlink" title="1).ç±»å‹è½¬æ¢"></a>1).ç±»å‹è½¬æ¢</h3><p><code>&lt;ç»“æœ&gt; := &lt;ç›®æ ‡ç±»å‹&gt;(&lt;è¡¨è¾¾å¼&gt;)</code></p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line">f = <span class="number">10.101</span></span><br><span class="line">i := <span class="keyword">int</span>(f)</span><br><span class="line">fmt.Printf(<span class="string">&quot;%T, %v\n&quot;</span>, i, i) <span class="comment">//output: int, 10</span></span><br></pre></td></tr></table></figure><p>ç±»å‹è½¬æ¢å‰åçš„ä¸¤ä¸ªç±»å‹éœ€è¦ç›¸äº’å…¼å®¹æ‰å¯ä»¥ï¼Œä¸ç„¶ç¼–è¯‘å™¨ä¼šæŠ¥é”™ã€‚</p><h3 id="2-ç±»å‹æ–­è¨€"><a href="#2-ç±»å‹æ–­è¨€" class="headerlink" title="2).ç±»å‹æ–­è¨€"></a>2).ç±»å‹æ–­è¨€</h3><p>å› ä¸ºç©ºæ¥å£ <code>interface&#123;&#125;</code> æ²¡æœ‰å®šä¹‰ä»»ä½•å‡½æ•°ï¼Œå› æ­¤ Go ä¸­æ‰€æœ‰ç±»å‹éƒ½å®ç°äº†ç©ºæ¥å£ã€‚å½“ä¸€ä¸ªå‡½æ•°çš„å½¢å‚æ˜¯ <code>interface&#123;&#125;</code>ï¼Œé‚£ä¹ˆåœ¨å‡½æ•°ä¸­ï¼Œéœ€è¦å¯¹å½¢å‚è¿›è¡Œæ–­è¨€ï¼Œä»è€Œå¾—åˆ°å®ƒçš„çœŸå®ç±»å‹ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;ç›®æ ‡ç±»å‹çš„å€¼&gt; :&#x3D; &lt;è¡¨è¾¾å¼&gt;.( ç›®æ ‡ç±»å‹ )ã€€ã€€&#x2F;&#x2F;éå®‰å…¨ç±»å‹æ–­è¨€</span><br></pre></td></tr></table></figure><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> Duck <span class="keyword">struct</span> &#123;</span><br><span class="line">age <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> d <span class="keyword">interface</span>&#123;&#125; = <span class="built_in">new</span>(Duck)</span><br><span class="line">s := d.(Duck)</span><br><span class="line">fmt.Println(s)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//run main.go</span></span><br><span class="line"><span class="comment">//panic: &quot;interface conversion: interface &#123;&#125; is *main.Duck, not main.Duck&quot;</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;ç›®æ ‡ç±»å‹çš„å€¼&gt;ï¼Œ&lt;å¸ƒå°”å‚æ•°&gt; :&#x3D; &lt;è¡¨è¾¾å¼&gt;.( ç›®æ ‡ç±»å‹ ) &#x2F;&#x2F; comma-okæ–­è¨€,å®‰å…¨ç±»å‹æ–­è¨€ </span><br></pre></td></tr></table></figure><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> Duck <span class="keyword">struct</span> &#123;</span><br><span class="line">age <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> d <span class="keyword">interface</span>&#123;&#125; = <span class="built_in">new</span>(Duck)</span><br><span class="line">s, ok := d.(Duck)</span><br><span class="line"><span class="keyword">if</span> ok &#123;</span><br><span class="line">fmt.Println(s)</span><br><span class="line">&#125;</span><br><span class="line">fmt.Printf(<span class="string">&quot;d type is %T&quot;</span>, d)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//run main.go</span></span><br><span class="line"><span class="comment">//d type is *main.Duck</span></span><br></pre></td></tr></table></figure><p>å°½é‡ä½¿ç”¨comma-okæ–­è¨€ï¼Œå³ä½¿æ–­è¨€å¤±è´¥ä¹Ÿä¸ä¼španicã€‚</p><p>æ–­è¨€å…¶å®ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>switch</code> è¯­å¥åˆ¤æ–­æ¥å£çš„ç±»å‹ï¼Œæ¯ä¸€ä¸ª <code>case</code> ä¼šè¢«é¡ºåºåœ°è€ƒè™‘ã€‚å½“å‘½ä¸­ä¸€ä¸ª <code>case</code> æ—¶ï¼Œå°±ä¼šæ‰§è¡Œ <code>case</code> ä¸­çš„è¯­å¥ï¼Œå› æ­¤ <code>case</code> è¯­å¥çš„é¡ºåºæ˜¯å¾ˆé‡è¦çš„ï¼Œå› ä¸ºå¾ˆæœ‰å¯èƒ½ä¼šæœ‰å¤šä¸ª <code>case</code> åŒ¹é…çš„æƒ…å†µã€‚</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">switch</span> m := m.(<span class="keyword">type</span>) &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="literal">nil</span>:</span><br><span class="line"><span class="keyword">case</span> Duck:</span><br><span class="line"><span class="keyword">case</span> *Duck:</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;æ¥å£æœ‰åŠ¨æ€å€¼å’ŒåŠ¨æ€ç±»å‹ï¼Œåªæœ‰å½“ä¸¤è€…éƒ½æ˜¯nilçš„æ—¶å€™ï¼Œæ‰æœ‰&lt;code&gt;æ¥å£å€¼==nil&lt;/code&gt;ã€‚è¿™å¾ˆé‡è¦â€¼ï¸ æ¥å£å˜é‡æ—¶å¸¸éœ€è¦è¿›è¡Œç±»å‹æ–­è¨€ï¼Œæ‰¾åˆ°çœŸå®ç±»å‹ã€‚è¿™ä¹Ÿå¾ˆé‡è¦â€¼ï¸&lt;/p&gt;</summary>
    
    
    
    <category term="Golang" scheme="https://blog.eganx.cn/categories/Golang/"/>
    
    
    <category term="go" scheme="https://blog.eganx.cn/tags/go/"/>
    
    <category term="interface" scheme="https://blog.eganx.cn/tags/interface/"/>
    
  </entry>
  
  <entry>
    <title>Go Interfaceç†è§£(1)</title>
    <link href="https://blog.eganx.cn/2022/10/29/Go_Interface_1/"/>
    <id>https://blog.eganx.cn/2022/10/29/Go_Interface_1/</id>
    <published>2022-10-29T11:23:19.000Z</published>
    <updated>2022-11-22T06:10:18.113Z</updated>
    
    <content type="html"><![CDATA[<p>Goè¯­è¨€ä¸­ï¼Œæ¥å£æ˜¯ä¸éœ€è¦åƒä¼ ç»Ÿçš„é™æ€ç¼–ç¨‹è¯­è¨€ä¸€æ ·è¿›è¡Œå£°æ˜åæ‰èƒ½ä½¿ç”¨ã€‚å®ƒå¼•ç”¨äº†åŠ¨æ€è¯­è¨€çš„æ¥å£ä½¿ç”¨æ–¹å¼ï¼Œåªéœ€è¦å®ç°æ¥å£è¦æ±‚çš„ç›¸å…³æ–¹æ³•å°±è¡Œï¼ŒåŒæ—¶è¿˜ä¼šåœ¨ç¼–è¯‘é˜¶æ®µè¿›è¡Œç±»å‹åŒ¹é…ï¼Œä¸ªäººè§‰å¾—éå¸¸å¥½ç”¨ã€‚</p><span id="more"></span><h2 id="0x0-Interface-amp-Duck-Typing"><a href="#0x0-Interface-amp-Duck-Typing" class="headerlink" title="0x0.Interface &amp; Duck Typing"></a>0x0.Interface &amp; Duck Typing</h2><p>æ‰€è°“Goè¯­è¨€å¼çš„æ¥å£ï¼Œå°±æ˜¯ä¸ç”¨æ˜¾ç¤ºå£°æ˜ç±»å‹<code>T</code>å®ç°äº†æ¥å£<code>I</code>ï¼Œåªè¦ç±»å‹<code>T</code>çš„å…¬å¼€æ–¹æ³•å®Œå…¨æ»¡è¶³æ¥å£<code>I</code>çš„è¦æ±‚ï¼Œå°±å¯ä»¥æŠŠç±»å‹<code>T</code>çš„å¯¹è±¡ç”¨åœ¨éœ€è¦æ¥å£<code>I</code>çš„åœ°æ–¹ã€‚è¿™ç§åšæ³•çš„å­¦åå«åš<a href="http://en.wikipedia.org/wiki/Structural_type_system">Structural Typing</a>ï¼Œä¹Ÿæœ‰äººç§°å®ƒä¸ºä¸€ç§é™æ€çš„Duck Typingã€‚</p><p>Duck Typingä¸€èˆ¬å¸¸è§äºåŠ¨æ€è¯­è¨€ä¸­ï¼ˆæ¯”å¦‚pythonï¼‰ï¼Œä½†æ˜¯åŠ¨æ€è¯­è¨€ä¸ä¼šåœ¨ç¼–è¯‘é˜¶æ®µå»è¿›è¡Œç±»å‹åŒ¹é…ï¼Œåªæœ‰åœ¨è¿è¡Œåˆ°å½“å‰è¡Œä»£ç çš„æ—¶å€™æ‰ä¼šæŠ¥é”™ã€‚è€Œä¼ ç»Ÿçš„é™æ€è¯­è¨€ï¼ˆæ¯”å¦‚Javaï¼‰ï¼Œå¿…é¡»æ˜¾ç¤ºåœ°å»å£°æ˜å®ç°äº†æŸä¸ªæ¥å£ï¼Œç„¶åæ‰å¯ä»¥å»ä½¿ç”¨ã€‚è¿™è·ŸåŠ¨æ€è¯­è¨€é™æ€è¯­è¨€çš„è®¨è®ºç±»ä¼¼ï¼Œå¯ä»¥è®¨è®ºä¼˜ç¼ºç‚¹ï¼Œä½†æ˜¯ä¸èƒ½ä»¥å¥½åå»ä¸‹ç»“è®ºã€‚</p><p>Goè¯­è¨€æœ¬èº«ä½œä¸ºä¸€ç§é™æ€è¯­è¨€ï¼Œé™æ€è¯­è¨€çš„ç±»å‹æ£€æŸ¥æ˜¯è‚¯å®šæœ‰çš„ã€‚ä½†æ˜¯åœ¨æ¥å£çš„ä½¿ç”¨ä¸Šï¼Œå¼•ç”¨äº†åŠ¨æ€è¯­è¨€çš„æ¥å£ä½¿ç”¨æ–¹å¼ã€‚å³ä¸è¦æ±‚ç±»å‹æ˜¾ç¤ºåœ°å»å£°æ˜å®ç°äº†æŸä¸ªæ¥å£ï¼Œåªéœ€è¦å®ç°æ¥å£è¦æ±‚çš„ç›¸å…³æ–¹æ³•å°±è¡Œï¼Œç¼–è¯‘é˜¶æ®µä¼šå»è¿›è¡Œç±»å‹æ£€æŸ¥ã€‚å¦‚æœæ²¡æœ‰å®ç°ç›¸å…³æ–¹æ³•ï¼Œç¼–è¯‘æ˜¯ä¼šæŠ¥é”™çš„ã€‚</p><p>ä¸¾ä¸ªğŸŒ°ï¼š</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> IDuck <span class="keyword">interface</span> &#123;</span><br><span class="line">gaga()</span><br><span class="line">swimming()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Duck <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(d Duck)</span> <span class="title">gaga</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Println(<span class="string">&quot;Duck gaga&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(d *Duck)</span> <span class="title">swimming</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Println(<span class="string">&quot;Duck swimming&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> _ IDuck = (*Duck)(<span class="literal">nil</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><font color=red><code>var _ IDuck = (*Duck)(nil) Â //è¿™ä¸ªå¾ˆå®ç”¨ï¼Œç¼–è¯‘å™¨ä¼šç”±æ­¤æ£€æŸ¥ *Duckç±»å‹æ˜¯å¦å®ç°äº† IDuck æ¥å£ã€‚</code></font></p><p>ä»¥ä¸Šçš„ä»£ç ç¼–è¯‘å¯ä»¥é€šè¿‡ï¼Œè¡¨ç¤ºAå®ç°äº†Duckæ¥å£ï¼Œé‚£ä¹ˆAå°±æ˜¯ä¸€åªé¸­å­ğŸ¦†ã€‚</p><p>ä½†æ˜¯å½“æ³¨é‡Šäº†Açš„æ¸¸æ³³æ–¹æ³•æ—¶ï¼Œå°±ä¼šå‡ºç°ç¼–è¯‘å™¨ä¼šç›´æ¥çˆ†å‡ºä»¥ä¸‹é”™è¯¯ï¼Œè¡¨ç¤ºAå¹¶æ²¡æœ‰å®Œå…¨å®ç°Duckæ¥å£ï¼ŒAä¸æ˜¯ä¸€åªé¸­å­ğŸ¦†ã€‚</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// func (d *Duck) swimming() &#123;</span></span><br><span class="line"><span class="comment">// fmt.Println(&quot;Duck swimming&quot;)</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> _ IDuck = (*Duck)(<span class="literal">nil</span>) <span class="comment">//ç¼–è¯‘æŠ¥é”™ï¼šcannot use (*A)(nil) (value of type *A) as Duck value in variable declaration: *A does not implement Duck (missing method swimming) compiler(InvalidIfaceAssign)</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="0x1-æ–¹æ³•"><a href="#0x1-æ–¹æ³•" class="headerlink" title="0x1.æ–¹æ³•"></a>0x1.æ–¹æ³•</h2><p>æ¥å£æ–¹æ³•æ–¹ä¾¿æ¥å£æ·»åŠ æ–°çš„è¡Œä¸ºã€‚æ–¹æ³•æœ‰æ¥æ”¶è€…ï¼Œå½“æ²¡æœ‰äº†æ¥æ”¶è€…ï¼Œæ–¹æ³•å°±å˜æˆäº†å‡½æ•°ã€‚æ¥æ”¶è€…æœ‰ä¸¤ç§ç±»å‹ï¼Œä¸€ç§æ˜¯å€¼æ¥æ”¶è€…ï¼Œå¦ä¸€ç§æ˜¯æŒ‡é’ˆæ¥æ”¶è€…ã€‚</p><p>æ–¹æ³•çš„è°ƒç”¨è€…ä¸å¿…æ»¡è¶³æ¥æ”¶è€…ç±»å‹ã€‚æ¢å¥è¯è¯´ï¼Œæ— è®ºæ–¹æ³•çš„æ¥æ”¶è€…æ˜¯ä»€ä¹ˆç±»å‹ï¼Œè¯¥ç±»å‹çš„å€¼å’ŒæŒ‡é’ˆéƒ½å¯ä»¥è°ƒç”¨ã€‚</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> _ IDuck = (*Duck)(<span class="literal">nil</span>) </span><br><span class="line">  </span><br><span class="line">  d := Duck&#123;&#125; <span class="comment">//d := &amp;Duck&#123;&#125; ä¹Ÿæ˜¯å¯ä»¥çš„</span></span><br><span class="line">d.gaga() </span><br><span class="line">d.swimming()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“æ–¹æ³•çš„æ¥æ”¶è€…æ˜¯å€¼ç±»å‹çš„æ—¶å€™ï¼Œæ— è®ºè°ƒç”¨è€…æ˜¯å€¼ç±»å‹è¿˜æ˜¯æŒ‡é’ˆç±»å‹ï¼Œè¯¥æ–¹æ³•æ“ä½œçš„éƒ½æ˜¯å¯¹åº”æ¥æ”¶è€…çš„å€¼çš„å‰¯æœ¬ã€‚å³ä½¿ä½ ç”¨æŒ‡é’ˆç±»å‹å»è°ƒç”¨ï¼Œæ–¹æ³•å†…éƒ¨æ“ä½œè¿˜æ˜¯å¯¹å‰¯æœ¬çš„æ“ä½œï¼Œè€Œä¸æ˜¯æŒ‡é’ˆæ“ä½œã€‚åŒç†ï¼Œå½“æ¥æ”¶è€…æ˜¯æŒ‡é’ˆæ—¶ï¼Œå³ä½¿ç”¨å€¼ç±»å‹è°ƒç”¨ï¼Œæ–¹æ³•å†…éƒ¨ä¹Ÿæ˜¯å¯¹æŒ‡é’ˆçš„æ“ä½œï¼Œä¿®æ”¹çš„æ˜¯å€¼æŒ‡é’ˆæŒ‡å‘çš„å€¼æœ¬èº«ã€‚</p><h2 id="0x2-æ¥å£å®ç°"><a href="#0x2-æ¥å£å®ç°" class="headerlink" title="0x2.æ¥å£å®ç°"></a>0x2.æ¥å£å®ç°</h2><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> IDuck <span class="keyword">interface</span> &#123;</span><br><span class="line">gaga()</span><br><span class="line">swimming()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Duck <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(d Duck)</span> <span class="title">gaga</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Println(<span class="string">&quot;A gaga&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(d *Duck)</span> <span class="title">swimming</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Println(<span class="string">&quot;A swimming&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">d := &amp;Duck&#123;&#125;</span><br><span class="line">dd := Duck&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> _ IDuck = (*Duck)(d) <span class="comment">//OK</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> _ IDuck = (Duck)(dd) <span class="comment">//ç¼–è¯‘æŠ¥é”™ï¼šcannot use (Duck)(dd) (value of type Duck) as IDuck value in variable declaration: Duck does not implement IDuck (method swimming has pointer receiver)compilerInvalidIfaceAssign</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¼–è¯‘å™¨ä¸è€ƒè™‘æˆ‘ä»¬çš„å€¼æ˜¯å®ç°è¯¥æ¥å£çš„ç±»å‹ï¼Œæ¥å£çš„è°ƒç”¨è§„åˆ™æ˜¯å»ºç«‹åœ¨è¿™äº›æ–¹æ³•çš„æ¥å—è€…å’Œæ¥å£å¦‚ä½•è¢«è°ƒç”¨çš„åŸºç¡€ä¸Šã€‚ä¸‹é¢çš„æ˜¯è¯­è¨€è§„èŒƒé‡Œå®šä¹‰çš„è§„åˆ™ï¼Œè¿™äº›è§„åˆ™ç”¨æ¥è¯´æ˜æ˜¯å¦æˆ‘ä»¬ä¸€ä¸ªç±»å‹çš„å€¼æˆ–è€…æŒ‡é’ˆè¯¥æ¥å£ï¼š</p><ul><li>æ¥æ”¶è€…æ˜¯æŒ‡é’ˆ <code>*T</code> æ—¶ï¼Œæ¥å£çš„å®ä¾‹å¿…é¡»æ˜¯æŒ‡é’ˆ</li><li>æ¥æ”¶è€…æ˜¯å€¼ <code>T</code> æ—¶ï¼Œæ¥å£çš„å®ä¾‹å¯ä»¥æ˜¯æŒ‡é’ˆä¹Ÿå¯ä»¥æ˜¯å€¼</li></ul><blockquote><p> ä¹Ÿå°±æ˜¯è¯´ï¼šå®ç°äº†æ¥æ”¶è€…æ˜¯å€¼ç±»å‹çš„æ–¹æ³•ï¼Œç›¸å½“äºè‡ªåŠ¨å®ç°äº†æ¥æ”¶è€…æ˜¯æŒ‡é’ˆç±»å‹çš„æ–¹æ³•ï¼›è€Œå®ç°äº†æ¥æ”¶è€…æ˜¯æŒ‡é’ˆç±»å‹çš„æ–¹æ³•ï¼Œä¸ä¼šè‡ªåŠ¨ç”Ÿæˆå¯¹åº”æ¥æ”¶è€…æ˜¯å€¼ç±»å‹çš„æ–¹æ³•ã€‚</p></blockquote><p><font color=green>Q&amp;Aï¼šæ—¢ç„¶å®ç°æ¥æ”¶è€…æ˜¯å€¼ç±»å‹çš„æ–¹æ³•æ—¶ï¼Œä¼šè‡ªåŠ¨å®ç°æ¥æ”¶è€…æ˜¯æŒ‡é’ˆç±»å‹çš„æ–¹æ³•ï¼Œé‚£ä¹ˆä¸ºå•¥è¦ç”¨æŒ‡é’ˆç±»å‹å»åšæ¥æ”¶è€…ï¼Ÿä»€ä¹ˆæ—¶å€™ä¼šå»ä½¿ç”¨æŒ‡é’ˆä½œä¸ºæ–¹æ³•çš„æ¥æ”¶è€…ï¼Ÿ</font></p><blockquote><p>æ–¹æ³•çš„æ¥æ”¶è€…æ˜¯å€¼ç±»å‹çš„æ—¶å€™ï¼Œä¿®æ”¹çš„æ°¸è¿œæ˜¯å¯¹è±¡çš„å‰¯æœ¬ï¼Œä¸ä¼šå¯¹è°ƒç”¨è€…æœ‰å½±å“ã€‚ä½†æ˜¯æ¥æ”¶è€…æ˜¯æŒ‡é’ˆçš„æ—¶å€™ï¼Œåœ¨æ–¹æ³•é‡Œä¿®æ”¹ï¼Œå°±æ˜¯ä¿®æ”¹äº†æŒ‡é’ˆæŒ‡å‘çš„å¯¹è±¡æœ¬èº«ã€‚å½“ç±»å‹æ˜¯å¤§å‹çš„ç»“æ„ä½“æˆ–è€…ä¸èƒ½è¢«å®‰å…¨çš„å¤åˆ¶æ—¶ï¼Œå°±å®šä¹‰æŒ‡é’ˆæ¥æ”¶è€…æ–¹æ³•ï¼Œä¾‹å¦‚æ–‡ä»¶ç»“æ„ä½“ï¼ˆstruct Fileï¼‰ã€‚</p></blockquote>]]></content>
    
    
    <summary type="html">&lt;p&gt;Goè¯­è¨€ä¸­ï¼Œæ¥å£æ˜¯ä¸éœ€è¦åƒä¼ ç»Ÿçš„é™æ€ç¼–ç¨‹è¯­è¨€ä¸€æ ·è¿›è¡Œå£°æ˜åæ‰èƒ½ä½¿ç”¨ã€‚å®ƒå¼•ç”¨äº†åŠ¨æ€è¯­è¨€çš„æ¥å£ä½¿ç”¨æ–¹å¼ï¼Œåªéœ€è¦å®ç°æ¥å£è¦æ±‚çš„ç›¸å…³æ–¹æ³•å°±è¡Œï¼ŒåŒæ—¶è¿˜ä¼šåœ¨ç¼–è¯‘é˜¶æ®µè¿›è¡Œç±»å‹åŒ¹é…ï¼Œä¸ªäººè§‰å¾—éå¸¸å¥½ç”¨ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="Golang" scheme="https://blog.eganx.cn/categories/Golang/"/>
    
    
    <category term="go" scheme="https://blog.eganx.cn/tags/go/"/>
    
    <category term="interface" scheme="https://blog.eganx.cn/tags/interface/"/>
    
  </entry>
  
  <entry>
    <title>Go Mapçš„éå†</title>
    <link href="https://blog.eganx.cn/2022/10/26/Go_Map_Range/"/>
    <id>https://blog.eganx.cn/2022/10/26/Go_Map_Range/</id>
    <published>2022-10-26T13:33:01.000Z</published>
    <updated>2022-11-20T04:33:57.713Z</updated>
    
    <content type="html"><![CDATA[<p>Mapçš„éå†è¿‡ç¨‹æ˜¯ä¾¿åˆ©æ‰€æœ‰çš„bucket(ä¸€èˆ¬ç§°ä¹‹ä¸ºæ¡¶)ä»¥åŠæŒ‚è½½çš„overflow bucketï¼Œç„¶åé€ä¸€éå†bucketçš„æ‰€æœ‰cellï¼Œä»æœ‰keyçš„cellä¸­å–å‡ºkeyå’Œvalueï¼Œéå†å®Œæˆã€‚å®é™…åœ¨éå†çš„æ—¶å€™ï¼Œæœ‰å¯èƒ½mapå¤„äºæ‰©å®¹è¿‡ç¨‹ä¸­,è¿™æ—¶å€™mapçš„çŠ¶æ€å°±ç›¸å½“äºæ˜¯å¤„äºä¸€ä¸ªä¸­é—´æ€ï¼Œå³æœ‰äº›bucketå·²ç»è¿ç§»ï¼Œæœ‰äº›bucketè¿˜åœ¨åŸæ¥çš„ä½ç½®ã€‚ä¹Ÿå°±æ˜¯è¯´éå†å¦‚æœå‘ç”Ÿåœ¨æ‰©å®¹çš„è¿‡ç¨‹ä¸­ï¼Œå°±ä¼šæ¶‰åŠåˆ°éå†æ–°è€ bucket çš„è¿‡ç¨‹ï¼Œå°±æ¯”è¾ƒéº»çƒ¦ã€‚</p><span id="more"></span><h2 id="0x0-Mapéå†æ˜¯æ— åºçš„"><a href="#0x0-Mapéå†æ˜¯æ— åºçš„" class="headerlink" title="0x0.Mapéå†æ˜¯æ— åºçš„"></a>0x0.Mapéå†æ˜¯æ— åºçš„</h2><p>åœ¨éå†mapçš„æ—¶å€™ï¼Œå¯ä»¥å‘ç°keyæ˜¯æ— åºçš„ã€‚æ­£å¸¸æ¥è¯´ä»ä¸€ä¸ªå›ºå®šMapçš„ç¬¬ä¸€ä¸ªbucketçš„ç¬¬ä¸€ä¸ªcellé€æ­¥éå†å–å‡ºkeyçš„è¯ï¼Œkeyåº”è¯¥æ˜¯æœ‰åºçš„ã€‚å› ä¸ºæ‰©å®¹ä¼šå¸¦æ¥æŸäº›keyçš„bucketæˆ–è€…cellå‘ç”Ÿå˜åŒ–ï¼ŒGoä¸ºäº†é¿å…æˆ‘ä»¬è¯¯è®¤ä¸ºéå†mapä¼šå¾—åˆ°æœ‰åºkeyï¼Œåœ¨éå†å¼€å§‹çš„æ—¶å€™ï¼Œä¸æ˜¯ä»0å·bucketå¼€å§‹ï¼Œè€Œæ˜¯ä¼šç»™ä¸€ä¸ªéšæœºæ•°ï¼Œä»ä¸€ä¸ªéšæœºçš„bucketå¼€å§‹ï¼Œæ›´ç»çš„æ˜¯åœ¨å¼€å§‹bucketä¸­çš„å¼€å§‹cellä¹Ÿæ˜¯éšæœºé€‰æ‹©çš„ã€‚è¿™æ ·çš„è¯ï¼Œ<font color=red>å°±ç®—æ˜¯ä¸€ä¸ªå†™æ­»çš„mapåœ¨éå†çš„æ—¶å€™ä¾æ—§ä¸ä¼šè¿”å›ä¸€ä¸ªå›ºå®šåºåˆ—çš„keyé›†åˆã€‚</font></p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// decide where to start</span></span><br><span class="line">r := <span class="keyword">uintptr</span>(fastrand())</span><br><span class="line"><span class="keyword">if</span> h.B &gt; <span class="number">31</span>-bucketCntBits &#123;</span><br><span class="line">r += <span class="keyword">uintptr</span>(fastrand()) &lt;&lt; <span class="number">31</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// start bucket</span></span><br><span class="line">it.startBucket = r &amp; bucketMask(h.B)</span><br><span class="line"><span class="comment">// start cell</span></span><br><span class="line">it.offset = <span class="keyword">uint8</span>(r &gt;&gt; h.B &amp; (bucketCnt - <span class="number">1</span>))</span><br></pre></td></tr></table></figure><h2 id="0x1-éå†è¿‡ç¨‹"><a href="#0x1-éå†è¿‡ç¨‹" class="headerlink" title="0x1.éå†è¿‡ç¨‹"></a>0x1.éå†è¿‡ç¨‹</h2><p>å‡å¦‚æœ‰ä¸€ä¸ªèµ·å§‹<code>B=1</code>çš„mapï¼ˆæœ‰0å·å’Œ1å·ä¸¤ä¸ªbucketï¼‰ï¼Œç°åœ¨è§¦å‘æ‰©å®¹ï¼ŒBå˜æˆäº†2ï¼ˆæœ‰0-3å·4ä¸ªbucketï¼‰ã€‚å‡è®¾ç°åœ¨è€0å·bucketå·²ç»è¿ç§»åˆ°æ–°0å·å’Œæ–°2å·bucketä¸­ï¼Œè€1å·ä¸­çš„bucketå°šæœªå¼€å§‹è¿ç§»ã€‚æ­¤æ—¶å¼€å§‹å¯¹mapçš„éå†ï¼Œå‡è®¾<code>startBucket = 2,offset = 4</code>ï¼Œéå†çš„èµ·ç‚¹å°±æ˜¯2å·bucketä¸­ç¬¬4ä¸ªcellã€‚bucketçš„éå†é¡ºåºå°±æ˜¯ï¼š<code>2-&gt;3-&gt;0-&gt;1</code>ã€‚</p><ul><li><p>2å·bucketå¯¹åº”çš„æ˜¯è€0å·bucketï¼Œæ£€æŸ¥è€0å·bucketçš„è¿ç§»çŠ¶æ€ï¼Œå‘ç°å®Œæˆå·²ç»å®Œæˆè¿ç§»ï¼Œä»4å·cellä¾æ¬¡éå†2å·bucketä¸­æ‰€æœ‰cellã€‚å¦‚æœ2å·bucketè¿”å›çš„keyæ˜¯éç©ºçš„ï¼Œå°±ä¼šç»§ç»­éå†2å·bucketçš„overflow bucketã€‚</p></li><li><p>å®Œæˆ2å·bucketçš„éå†åï¼Œå¼€å§‹3å·bucketçš„éå†ï¼Œæ£€æŸ¥åå‘ç°3å·bucketå¯¹åº”çš„è€1å·bucketå¹¶æ²¡æœ‰è¿ç§»ï¼Œè¿™ä¸ªæ—¶å€™å°±ä¼šå»éå†è€1å·bucketã€‚ä½†æ˜¯å¹¶ä¸ä¼šå–å‡ºè€1å·bucketçš„å…¨éƒ¨keyï¼Œåªä¼šå–å‡ºhashå€¼åä¸¤ä½ä¸º<code>11</code>çš„keyï¼Œå› ä¸ºè¿™äº›keyæœ€ç»ˆä¼šè¿ç§»è¿›æ–°3å·bucketã€‚</p></li><li><p>å®Œæˆ3å·bucketçš„éå†ï¼Œç»§ç»­0å·bucketçš„éå†ï¼Œå·²è¿ç§»ï¼Œå–å‡ºæ–°0å·bucketä¸­çš„keyã€‚</p></li><li><p>ç»§ç»­1å·bucketçš„éå†ï¼Œæœªè¿ç§»ï¼Œéå†è€1å·bucketï¼Œå–å‡ºhashå€¼åä¸¤ä½ä¸º<code>01</code>çš„keyã€‚</p></li><li><p>å†æ¬¡åˆ°2å·bucketçš„æ—¶å€™ï¼Œè¡¨ç¤ºæ‰€æœ‰bucketéå†å®Œæˆï¼Œmapçš„éå†ä¹Ÿå°±ç»“æŸäº†ã€‚</p></li></ul>]]></content>
    
    
    <summary type="html">&lt;p&gt;Mapçš„éå†è¿‡ç¨‹æ˜¯ä¾¿åˆ©æ‰€æœ‰çš„bucket(ä¸€èˆ¬ç§°ä¹‹ä¸ºæ¡¶)ä»¥åŠæŒ‚è½½çš„overflow bucketï¼Œç„¶åé€ä¸€éå†bucketçš„æ‰€æœ‰cellï¼Œä»æœ‰keyçš„cellä¸­å–å‡ºkeyå’Œvalueï¼Œéå†å®Œæˆã€‚å®é™…åœ¨éå†çš„æ—¶å€™ï¼Œæœ‰å¯èƒ½mapå¤„äºæ‰©å®¹è¿‡ç¨‹ä¸­,è¿™æ—¶å€™mapçš„çŠ¶æ€å°±ç›¸å½“äºæ˜¯å¤„äºä¸€ä¸ªä¸­é—´æ€ï¼Œå³æœ‰äº›bucketå·²ç»è¿ç§»ï¼Œæœ‰äº›bucketè¿˜åœ¨åŸæ¥çš„ä½ç½®ã€‚ä¹Ÿå°±æ˜¯è¯´éå†å¦‚æœå‘ç”Ÿåœ¨æ‰©å®¹çš„è¿‡ç¨‹ä¸­ï¼Œå°±ä¼šæ¶‰åŠåˆ°éå†æ–°è€ bucket çš„è¿‡ç¨‹ï¼Œå°±æ¯”è¾ƒéº»çƒ¦ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="Golang" scheme="https://blog.eganx.cn/categories/Golang/"/>
    
    
    <category term="go" scheme="https://blog.eganx.cn/tags/go/"/>
    
    <category term="map" scheme="https://blog.eganx.cn/tags/map/"/>
    
  </entry>
  
  <entry>
    <title>Go Mapçš„æ‰©å®¹</title>
    <link href="https://blog.eganx.cn/2022/10/24/Go_Map_Grow/"/>
    <id>https://blog.eganx.cn/2022/10/24/Go_Map_Grow/</id>
    <published>2022-10-24T07:53:19.000Z</published>
    <updated>2022-11-20T04:33:16.832Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨ä½¿ç”¨sliceçš„æ—¶å€™ï¼Œå¦‚æœå‘sliceä¸­è¿½åŠ å…ƒç´ çš„æ—¶å€™ï¼Œå¯¼è‡´å…ƒç´ æ•°é‡å¤§äºcapï¼Œè¿™æ—¶å€™å°±ä¼šå‘ç”Ÿsliceçš„æ‰©å®¹ã€‚é‚£ä¹ˆåœ¨goè¯­è¨€ä¸­ï¼Œä»€ä¹ˆæ—¶å€™mapä¼šå‘ç”Ÿæ‰©å®¹å‘¢ï¼Ÿæ‰©å®¹çš„ç­–ç•¥æœ‰å“ªäº›å‘¢ï¼Ÿæ‰©å®¹çš„è¿‡ç¨‹æ˜¯æ€æ ·çš„å‘¢ï¼Ÿå¾ˆæ˜¯å¥½å¥‡ï¼Œå¿ƒåŠ¨ä¸å¦‚è¡ŒåŠ¨ã€‚å¼€å§‹å­¦ä¹ ï¼Œåˆæ˜¯æ”¶è·æ»¡æ»¡çš„ä¸€å¤©ã€‚</p><span id="more"></span><h2 id="0x0-è§¦å‘æ‰©å®¹çš„æ¡ä»¶"><a href="#0x0-è§¦å‘æ‰©å®¹çš„æ¡ä»¶" class="headerlink" title="0x0.è§¦å‘æ‰©å®¹çš„æ¡ä»¶"></a>0x0.è§¦å‘æ‰©å®¹çš„æ¡ä»¶</h2><p>ä¼—æ‰€å‘¨çŸ¥ï¼Œmapæ˜¯ä½¿ç”¨hashè¡¨çš„ã€‚ä½¿ç”¨hashè¡¨çš„ç›®çš„å°±æ˜¯è¿½æ±‚æ›´åŠ å¿«é€Ÿçš„æ‰¾åˆ°keyï¼Œä½†æ˜¯å½“mapä¸­keyçš„æ•°é‡é€æ¸å¢åŠ ï¼Œé€æ¸ç¦»è°±çš„æ—¶å€™ï¼Œé‚£ä¹ˆç¢°æ’çš„å‡ ç‡å°±è¶Šæ¥è¶Šå¤§ï¼Œæ•ˆç‡ä¹Ÿå°±éšä¹‹ä¸‹é™äº†ã€‚æœ€ç¦»è°±çš„æ—¶å€™å°±æ˜¯æ‰€æœ‰çš„keyéƒ½åœ¨ä¸€ä¸ªbucketé‡Œé¢ (<del>è¿™æ˜¯ç¢³åŸºç”Ÿç‰©èƒ½å¹²å‡ºæ¥çš„äº‹?è¿™å’Œé“¾è¡¨æœ‰ä¸ªé”¤å­çš„åŒºåˆ«å—ï¼Ÿ</del>)ï¼Œæœ€å¥½å°±æ˜¯ä¸€ä¸ªbucketé‡Œé¢å°±ä¸€ä¸ªkeyï¼Œæ‰¾åˆ°äº†bucketå°±æ‰¾åˆ°äº†keyï¼Œæ•ˆç‡è´¼é«˜ï¼Œç›´æ¥æ‹‰åˆ°o(1)ã€‚ä½†æ˜¯ç©ºé—´ä¸å…è®¸å•Šï¼Œä¸ºäº†æ•ˆç‡ç”¨ç©ºé—´æ¢æ—¶é—´ä¸å¯’ç¢œï¼Ÿ(<del>å¾ˆå¯’ç¢œï¼Œè´¼TMå¯’ç¢œ</del>)ã€‚</p><p>æœ€å¥½æœ€åéƒ½å±äºæç«¯ï¼Œå…¶å®éƒ½å¾ˆéš¾é‡åˆ°ï¼Œåªæ˜¯åœ¨ä¸¾ğŸŒ°çš„æ—¶å€™å¤¸å¼ è¡¨è¿°æ‰ä¼šç”¨åˆ°ã€‚åœ¨goè¯­è¨€ä¸­ï¼Œæœ‰ä¸€ä¸ª<code>loadFactor</code>æŒ‡æ ‡æ¥å¯¹ä¸Šé¢çš„ä¸¤ç§æƒ…å†µè¿›è¡Œè¡¡é‡ã€‚åºŸè¯ä¸å¤šè¯´ï¼Œç›´æ¥ä¸Šæºç (/go1.18.2/src/runtime/map.go)</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åˆ¤æ–­æ¡ä»¶åœ¨mapassignå‡½æ•°ä¸­ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// If we hit the max load factor or we have too many overflow buckets,</span></span><br><span class="line"><span class="comment">// and we&#x27;re not already in the middle of growing, start growing.</span></span><br><span class="line"><span class="keyword">if</span> !h.growing() &amp;&amp; (overLoadFactor(h.count+<span class="number">1</span>, h.B) || tooManyOverflowBuckets(h.noverflow, h.B)) &#123;</span><br><span class="line">hashGrow(t, h)</span><br><span class="line"><span class="keyword">goto</span> again <span class="comment">// Growing the table invalidates everything, so try again</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»ä¸Šé¢çš„æ¡ä»¶å¯ä»¥çœ‹å‡ºï¼Œmapæ‰©å®¹ä¸€ä¸ªæ˜¯åœ¨<code>overLoadFactor</code>çš„æ—¶å€™ï¼Œä¸€ä¸ªæ˜¯åœ¨<code>tooManyOverflowBuckets</code>ã€‚ä¸‹é¢æ˜¯è¿™ä¸¤ä¸ªå‡½æ•°æ‰€ç”¨åˆ°çš„å¸¸é‡ä»¥åŠä¸»è¦çš„å¼•ç”¨å‡½æ•°ã€‚</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> (</span><br><span class="line"><span class="comment">// Maximum number of key/elem pairs a bucket can hold.</span></span><br><span class="line">bucketCntBits = <span class="number">3</span></span><br><span class="line">bucketCnt     = <span class="number">1</span> &lt;&lt; bucketCntBits <span class="comment">//8</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Maximum average load of a bucket that triggers growth is 6.5.</span></span><br><span class="line"><span class="comment">// Represent as loadFactorNum/loadFactorDen, to allow integer math.</span></span><br><span class="line">loadFactorNum = <span class="number">13</span></span><br><span class="line">loadFactorDen = <span class="number">2</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// PtrSize is the size of a pointer in bytes - unsafe.Sizeof(uintptr(0)) but as an ideal constant.</span></span><br><span class="line"><span class="comment">// It is also the size of the machine&#x27;s native word size (that is, 4 on 32-bit systems, 8 on 64-bit).</span></span><br><span class="line"><span class="keyword">const</span> PtrSize = <span class="number">4</span> &lt;&lt; (^<span class="keyword">uintptr</span>(<span class="number">0</span>) &gt;&gt; <span class="number">63</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// bucketShift returns 1&lt;&lt;b, optimized for code generation.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">bucketShift</span><span class="params">(b <span class="keyword">uint8</span>)</span> <span class="title">uintptr</span></span> &#123;</span><br><span class="line"><span class="comment">// Masking the shift amount allows overflow checks to be elided.</span></span><br><span class="line"><span class="keyword">return</span> <span class="keyword">uintptr</span>(<span class="number">1</span>) &lt;&lt; (b &amp; (goarch.PtrSize*<span class="number">8</span> - <span class="number">1</span>))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// overLoadFactor reports whether count items placed in 1&lt;&lt;B buckets is over loadFactor.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">overLoadFactor</span><span class="params">(count <span class="keyword">int</span>, B <span class="keyword">uint8</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> count &gt; bucketCnt &amp;&amp; <span class="keyword">uintptr</span>(count) &gt; loadFactorNum*(bucketShift(B)/loadFactorDen)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// tooManyOverflowBuckets reports whether noverflow buckets is too many for a map with 1&lt;&lt;B buckets.</span></span><br><span class="line"><span class="comment">// Note that most of these overflow buckets must be in sparse use;</span></span><br><span class="line"><span class="comment">// if use was dense, then we&#x27;d have already triggered regular map growth.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">tooManyOverflowBuckets</span><span class="params">(noverflow <span class="keyword">uint16</span>, B <span class="keyword">uint8</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line"><span class="comment">// If the threshold is too low, we do extraneous work.</span></span><br><span class="line"><span class="comment">// If the threshold is too high, maps that grow and shrink can hold on to lots of unused memory.</span></span><br><span class="line"><span class="comment">// &quot;too many&quot; means (approximately) as many overflow buckets as regular buckets.</span></span><br><span class="line"><span class="comment">// See incrnoverflow for more details.</span></span><br><span class="line"><span class="keyword">if</span> B &gt; <span class="number">15</span> &#123;</span><br><span class="line">B = <span class="number">15</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// The compiler doesn&#x27;t see here that B &lt; 16; mask B to generate shorter shift code.</span></span><br><span class="line"><span class="keyword">return</span> noverflow &gt;= <span class="keyword">uint16</span>(<span class="number">1</span>)&lt;&lt;(B&amp;<span class="number">15</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1ï¼‰ç¬¬ä¸€ç§æƒ…å†µ"><a href="#1ï¼‰ç¬¬ä¸€ç§æƒ…å†µ" class="headerlink" title="1ï¼‰ç¬¬ä¸€ç§æƒ…å†µ"></a>1ï¼‰ç¬¬ä¸€ç§æƒ…å†µ</h3><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// overLoadFactor reports whether count items placed in 1&lt;&lt;B buckets is over loadFactor.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">overLoadFactor</span><span class="params">(count <span class="keyword">int</span>, B <span class="keyword">uint8</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">  <span class="comment">// æ¢ç®—ä¸€ä¸‹ä¸‹: count &gt; 8 &amp;&amp; count &gt; 13*((2^B)/2)</span></span><br><span class="line">  <span class="comment">// loadFactor = count/(2^B) &gt; 6.5</span></span><br><span class="line"><span class="keyword">return</span> count &gt; bucketCnt &amp;&amp; <span class="keyword">uintptr</span>(count) &gt; loadFactorNum*(bucketShift(B)/loadFactorDen)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­<code>count</code>æ˜¯mapçš„å…ƒç´ ä¸ªæ•°ï¼Œ<code>1&lt;&lt;B</code>è¡¨ç¤ºbucketæ•°ç»„é•¿åº¦ã€‚ä¹Ÿå°±æ˜¯è¯´<font color=red>åœ¨<code>loadFactor := count/(2^B)</code>è¶…è¿‡6.5çš„æ—¶å€™ï¼Œä¼šè§¦å‘mapçš„æ‰©å®¹</font>ã€‚æŒ‰ç…§<code>loadFactor</code>çš„è®¡ç®—æ–¹å¼ï¼Œå½“æ‰€æœ‰bucketéƒ½æ»¡çš„æ—¶å€™æ˜¯8ã€‚è¾¾åˆ°6.5çš„æ—¶å€™ä¹Ÿå°±å·®ä¸å¤šç®—æ˜¯æ»¡äº†å¤§åŠäº†ï¼Œæ— è®ºæŸ¥æ‰¾è¿˜æ˜¯æ’å…¥ï¼Œè¿™ä¸ªæ—¶å€™ç¢°æ’çš„å‡ ç‡å¾ˆé«˜ï¼Œæ•ˆç‡ä¹Ÿä¼šä¸‹é™çš„å‰å®³ï¼Œæ‰€ä»¥è¿™æ˜¯è§¦å‘æ‰©å®¹çš„æ—¶æœºã€‚</p><p>å¦‚æœä¸åœçš„æ’å…¥å…ƒç´ ã€åˆ é™¤å…ƒç´ ï¼Œç„¶ååœ¨æ’å…¥å…ƒç´ ã€‚åˆšå¼€å§‹æ’å…¥å…ƒç´ çš„æ—¶å€™ä¼šåˆ›å»ºå¤§é‡bucketã€‚ä½†æ˜¯åªè¦æ²¡æœ‰è¾¾åˆ°ç¬¬ä¸€ç§æ‰©å®¹æƒ…å†µï¼Œä¹Ÿå°±æ˜¯è¯´loadFactorçš„å€¼ä½äº6.5ã€‚è¿™ä¸ªæ—¶å€™è¿›è¡Œåˆ é™¤å…ƒç´ çš„æ“ä½œï¼Œé™ä½loadFactorçš„åˆ†å­ã€‚ç„¶åé‡å¤æ“ä½œï¼Œå°±ä¼šäº§ç”Ÿå¤§é‡overflow bucketã€‚è¿™ä¸ªæ—¶å€™keyå°±ä¼šè¿‡äºåˆ†æ•£ï¼Œå¯¼è‡´æŸ¥æ‰¾å’Œæ’å…¥çš„æ•ˆç‡è¿‡ä½ã€‚ä¸ºäº†é¿å…è¿™ç§æƒ…å†µçš„å‘ç”Ÿï¼Œå°±æœ‰äº†ä¸‹é¢ç¬¬äºŒç§è§¦å‘æ‰©å®¹çš„æ¡ä»¶ã€‚</p><h3 id="2-ç¬¬äºŒç§æƒ…å†µ"><a href="#2-ç¬¬äºŒç§æƒ…å†µ" class="headerlink" title="2) ç¬¬äºŒç§æƒ…å†µ"></a>2) ç¬¬äºŒç§æƒ…å†µ</h3><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// tooManyOverflowBuckets reports whether noverflow buckets is too many for a map with 1&lt;&lt;B buckets.</span></span><br><span class="line"><span class="comment">// Note that most of these overflow buckets must be in sparse use;</span></span><br><span class="line"><span class="comment">// if use was dense, then we&#x27;d have already triggered regular map growth.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">tooManyOverflowBuckets</span><span class="params">(noverflow <span class="keyword">uint16</span>, B <span class="keyword">uint8</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line"><span class="comment">// If the threshold is too low, we do extraneous work.</span></span><br><span class="line"><span class="comment">// If the threshold is too high, maps that grow and shrink can hold on to lots of unused memory.</span></span><br><span class="line"><span class="comment">// &quot;too many&quot; means (approximately) as many overflow buckets as regular buckets.</span></span><br><span class="line"><span class="comment">// See incrnoverflow for more details.</span></span><br><span class="line"><span class="keyword">if</span> B &gt; <span class="number">15</span> &#123;</span><br><span class="line">B = <span class="number">15</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// The compiler doesn&#x27;t see here that B &lt; 16; mask B to generate shorter shift code.</span></span><br><span class="line"><span class="keyword">return</span> noverflow &gt;= <span class="keyword">uint16</span>(<span class="number">1</span>)&lt;&lt;(B&amp;<span class="number">15</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¿»è¯‘æˆäººè¯ï¼šoverflowçš„bucketæ•°é‡å¤ªå¤šäº†ã€‚<font color=red>å½“<code>B &gt;= 15</code>çš„æ—¶å€™ï¼Œå¦‚æœoverflowçš„bucketæ•°é‡è¶…è¿‡<code>2^15</code>å°±è§¦å‘æ‰©å®¹ï¼›å½“<code>B &lt; 15</code>çš„æ—¶å€™ï¼Œå¦‚æœoverflowçš„bucketæ•°é‡è¶…è¿‡<code>2^B</code>å°±è§¦å‘æ‰©å®¹ã€‚</font>ç¬¬äºŒç§çš„è¿™ä¸ªæƒ…å†µä¸»è¦æ˜¯ä¸ºäº†é¿å…loadFactorçš„åˆ†å­å°çš„æ—¶å€™ï¼Œå´æœ‰å¤§é‡çš„bucket(åŒ…æ‹¬å¤§é‡çš„overflow bucket)ã€‚</p><h2 id="0x1-æ‰©å®¹ç­–ç•¥"><a href="#0x1-æ‰©å®¹ç­–ç•¥" class="headerlink" title="0x1.æ‰©å®¹ç­–ç•¥"></a>0x1.æ‰©å®¹ç­–ç•¥</h2><p>é’ˆå¯¹ä¸¤ç§ä¸åŒçš„è§¦å‘æ‰©å®¹çš„æ¡ä»¶ï¼Œè¿›è¡Œæ‰©å®¹çš„ç­–ç•¥ä¹Ÿæœ‰æ‰€ä¸åŒã€‚</p><p>ç¬¬ä¸€ç§æƒ…å†µæ˜¯ç”±äºå…ƒç´ æ•°é‡è¿‡å¤šï¼Œå¯¼è‡´äº†bucketæ•°ç»„å¿«æ»¡äº†ã€‚è¿™ä¸ªæ—¶å€™é‡‡ç”¨çš„æ‰©å®¹ç­–ç•¥å°±æ˜¯<code>B+1</code>ï¼Œbucketçš„æ•°ç»„é•¿åº¦å˜æˆä¹‹å‰çš„2å€ï¼ˆ<font color=red>2å€æ‰©å®¹</font>ï¼‰</p><p>ç¬¬äºŒç§æƒ…å†µæ˜¯ç”±äºflowbucketçš„è¿‡å¤šé€ æˆï¼Œå…ƒç´ æ²¡æœ‰é‚£ä¹ˆå¤šï¼Œä¸»è¦æ˜¯ä½ç½®åˆ†æ•£ï¼Œé€ æˆæŸ¥æ‰¾å’Œæ’å…¥çš„æ•ˆç‡è¾ƒä½ã€‚é‡‡ç”¨ç¬¬ä¸€ç§çš„æ‰©å®¹ç­–ç•¥è‚¯å®šæ˜¯ä¸è¡Œçš„ï¼Œè§£å†³çš„åŠæ³•æ˜¯é‡‡ç”¨<font color=red>ç­‰é‡æ‰©å®¹</font>ï¼Œåˆ›å»ºä¸€ä¸ªå’Œè€bucketsæ•°ç»„ç›¸åŒé•¿åº¦çš„æ–°bucketsæ•°ç»„ã€‚å°†è€bucketsä¸­å¤„äºåŒä¸€ä¸ªbucketçš„å…ƒç´ è¿›è¡Œç´§å¯†æ’åˆ—ï¼Œå°½å¯èƒ½çš„æ¶ˆé™¤overflow bucketï¼ŒèŠ‚çœç©ºé—´ï¼Œæé«˜æ•ˆç‡ã€‚</p><p>mapçš„æ‰©å®¹ä¸æ˜¯åŸå­æ“ä½œï¼Œä¸ä¼šä¸€æ­¥åˆ°ä½ã€‚æ‰©å®¹éœ€è¦å°†åŸæœ¬çš„é”®å€¼å¯¹è¿ç§»åˆ°æ–°bucketå¾—å†…å­˜åœ°å€ä¸­ï¼Œå¤§é‡é”®å€¼å¯¹åŒæ—¶è¿ç§»ä¼šå½±å“æ€§èƒ½ï¼Œæ‰€ä»¥Go mapçš„æ‰©å®¹æ˜¯é‡‡ç”¨â€œæ¸è¿›å¼â€æ–¹å¼ã€‚æ¯æ¬¡æœ€å¤šåªä¼šè¿ç§»2ä¸ªbucketã€‚</p><h2 id="0x2-è¿ç§»è¿‡ç¨‹"><a href="#0x2-è¿ç§»è¿‡ç¨‹" class="headerlink" title="0x2.è¿ç§»è¿‡ç¨‹"></a>0x2.è¿ç§»è¿‡ç¨‹</h2><p>ç¬¬ä¸€ç§æ‰©å®¹ç­–ç•¥ï¼Œå› ä¸º<code>B+1</code>ä¼šå¯¼è‡´keyçš„hashå€¼éœ€è¦é‡æ–°è®¡ç®—ï¼Œæ‰èƒ½ç¡®å®šå®ƒä¼šè½å…¥é‚£ä¸ªbucketä¸­ï¼Œæ¯•ç«Ÿç¡®å®šbucketä½ç½®çš„æ˜¯æ ¹æ®hashå€¼çš„åBä½ã€‚è¿™æ ·çš„è¯å°±ä¼šå¯¼è‡´æŸäº›keyåœ¨è¿ç§»å‰åçš„bucketåºå·æ˜¯ä¸ä¸€æ ·çš„ã€‚</p><p>ä¸¾ä¸ªğŸŒ°ï¼šåˆå§‹çŠ¶æ€ä¸‹B=2ï¼Œ3å·bucketé‡Œæœ‰ä¸¤ä¸ªkeyçš„hashå€¼å3ä½å€¼<code>011,111</code>ï¼Œç»è¿‡B+1æ‰©å®¹ä¹‹åï¼Œè¿™ä¸¤ä¸ªåŸæœ¬å¤„äº3å·bucketçš„keyä¼šåˆ†åˆ«è½å…¥3å·å’Œ7å·bucketã€‚keyåœ¨è¿ç§»å‰åæ˜¯å¦è¿˜æ˜¯å¤„äºåŸæœ¬çš„bucketå–å†³äºå€’æ•°ç¬¬3ä½æ˜¯0è¿˜æ˜¯1ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">                     â”‚                       â”‚</span><br><span class="line">               â”Œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚</span><br><span class="line">               â”‚     â”‚                 â”‚     â”‚</span><br><span class="line">         â”Œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚     â”‚</span><br><span class="line">         â”‚     â”‚     â”‚           â”‚     â”‚     â”‚</span><br><span class="line">   â”Œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”     â”‚     â”‚     â”‚</span><br><span class="line">   â”‚     â”‚     â”‚     â”‚     â”‚     â”‚     â”‚     â”‚</span><br><span class="line">â”Œâ”€â”€â”´â”€â”€â”¬â”€â”€â”´â”€â”€â”¬â”€â”€â”´â”€â”€â”¬â”€â”€â”´â”€â”€â”  â”‚     â”‚     â”‚     â”‚</span><br><span class="line">â”‚     â”‚     â”‚     â”‚     â”‚  â”‚     â”‚     â”‚     â”‚</span><br><span class="line">â”‚  0  â”‚  1  â”‚  2  â”‚  3  â”‚  â”‚     â”‚     â”‚     â”‚</span><br><span class="line">â”‚     â”‚     â”‚     â”‚     â”‚  â”‚     â”‚     â”‚     â”‚</span><br><span class="line">â””â”€â”€â”¬â”€â”€â”´â”€â”€â”¬â”€â”€â”´â”€â”€â”¬â”€â”€â”´â”€â”€â”¬â”€â”€â”˜  â”‚     â”‚     â”‚     â”‚</span><br><span class="line">   â”‚     â”‚     â”‚     â”‚     â”‚     â”‚     â”‚     â”‚</span><br><span class="line">   â”‚     â”‚     â”‚     â”‚     â”‚     â”‚     â”‚     â”‚</span><br><span class="line">   â”‚     â”‚     â”‚     â”‚     â”‚     â”‚     â”‚     â”‚</span><br><span class="line">   â”‚     â”‚     â”‚     â”‚     â”‚     â”‚     â”‚     â”‚</span><br><span class="line">   â–¼     â–¼     â–¼     â–¼     â–¼     â–¼     â–¼     â–¼</span><br><span class="line">â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚     â”‚     â”‚     â”‚     â”‚     â”‚     â”‚     â”‚     â”‚</span><br><span class="line">â”‚  0  â”‚  1  â”‚  2  â”‚  3  â”‚  4  â”‚  5  â”‚  6  â”‚  7  â”‚</span><br><span class="line">â”‚     â”‚     â”‚     â”‚     â”‚     â”‚     â”‚     â”‚     â”‚</span><br><span class="line">â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”˜</span><br></pre></td></tr></table></figure><p>ç¬¬äºŒç§æ‰©å®¹ç­–ç•¥ï¼Œç­‰é‡æ‰©å®¹å› ä¸ºBæ˜¯ä¸å˜çš„ï¼Œæ‰€ä»¥keyè¿˜æ˜¯åœ¨åŸæ¥çš„bucketã€‚ä¸»è¦æ˜¯ä¸ºäº†æ”¶æ‹¢è¿‡äºåˆ†æ•£çš„key(<font color=linblue>å¤§å¤šæ•°éƒ½åˆ†æ•£åœ¨overflow bucketä¸­</font>)ã€‚ä¸‹é¢çš„å›¾æ˜¯è¿ç§»å®Œæˆçš„æƒ…å†µã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">buckets     B&#x3D;2                         buckets     B&#x3D;2</span><br><span class="line">â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”               â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚     â”‚     â”‚     â”‚     â”‚               â”‚     â”‚     â”‚     â”‚     â”‚</span><br><span class="line">â”‚  0  â”‚  1  â”‚  2  â”‚  3  â”‚               â”‚  0  â”‚  1  â”‚  2  â”‚  3  â”‚</span><br><span class="line">â”‚     â”‚     â”‚     â”‚     â”‚               â”‚     â”‚     â”‚     â”‚     â”‚</span><br><span class="line">â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”¬â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”¬â”€â”€â”˜</span><br><span class="line">                     â”‚                                       â”‚</span><br><span class="line">   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”Œâ”€â”€â”€â”€â”€â”€â”€â”˜</span><br><span class="line">   â”‚                                                 â”‚</span><br><span class="line">   â–¼                                                 â–¼</span><br><span class="line">â”Œâ”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”                     â”Œâ”€â”€â”€â”€â”</span><br><span class="line">â”‚bmapâ”‚   â”Œâ”€â–ºâ”‚bmapâ”‚  â”Œâ”€â–ºâ”‚bmapâ”‚                     â”‚bmapâ”‚</span><br><span class="line">â”œâ”€â”€â”€â”€â”´â”  â”‚  â”œâ”€â”€â”€â”€â”´â” â”‚  â”œâ”€â”€â”€â”€â”´â”                    â”œâ”€â”€â”€â”€â”´â”</span><br><span class="line">â”‚key:aâ”‚  â”‚  â”‚     â”‚ â”‚  â”‚key:fâ”‚                    â”‚key:aâ”‚</span><br><span class="line">â”‚ 111 â”‚  â”‚  â”‚     â”‚ â”‚  â”‚ 111 â”‚                    â”‚ 111 â”‚</span><br><span class="line">â”œâ”€â”€â”€â”€â”€â”¤  â”‚  â”œâ”€â”€â”€â”€â”€â”¤ â”‚  â”œâ”€â”€â”€â”€â”€â”¤                    â”œâ”€â”€â”€â”€â”€â”¤</span><br><span class="line">â”‚key:bâ”‚  â”‚  â”‚     â”‚ â”‚  â”‚     â”‚                    â”‚key:bâ”‚</span><br><span class="line">â”‚ 011 â”‚  â”‚  â”‚     â”‚ â”‚  â”‚     â”‚                    â”‚ 011 â”‚</span><br><span class="line">â”œâ”€â”€â”€â”€â”€â”¤  â”‚  â”œâ”€â”€â”€â”€â”€â”¤ â”‚  â”œâ”€â”€â”€â”€â”€â”¤                    â”œâ”€â”€â”€â”€â”€â”¤</span><br><span class="line">â”‚     â”‚  â”‚  â”‚key:dâ”‚ â”‚  â”‚     â”‚                    â”‚key:câ”‚</span><br><span class="line">â”‚     â”‚  â”‚  â”‚ 111 â”‚ â”‚  â”‚     â”‚                    â”‚ 011 â”‚</span><br><span class="line">â”œâ”€â”€â”€â”€â”€â”¤  â”‚  â”œâ”€â”€â”€â”€â”€â”¤ â”‚  â”œâ”€â”€â”€â”€â”€â”¤                    â”œâ”€â”€â”€â”€â”€â”¤</span><br><span class="line">â”‚     â”‚  â”‚  â”‚     â”‚ â”‚  â”‚     â”‚                    â”‚key:dâ”‚</span><br><span class="line">â”‚     â”‚  â”‚  â”‚     â”‚ â”‚  â”‚     â”‚                    â”‚ 111 â”‚</span><br><span class="line">â”œâ”€â”€â”€â”€â”€â”¤  â”‚  â”œâ”€â”€â”€â”€â”€â”¤ â”‚  â”œâ”€â”€â”€â”€â”€â”¤                    â”œâ”€â”€â”€â”€â”€â”¤</span><br><span class="line">â”‚key:câ”‚  â”‚  â”‚key:eâ”‚ â”‚  â”‚     â”‚                    â”‚key:eâ”‚</span><br><span class="line">â”‚ 011 â”‚  â”‚  â”‚ 111 â”‚ â”‚  â”‚     â”‚                    â”‚ 111 â”‚</span><br><span class="line">â”œâ”€â”€â”€â”€â”€â”¤  â”‚  â”œâ”€â”€â”€â”€â”€â”¤ â”‚  â”œâ”€â”€â”€â”€â”€â”¤                    â”œâ”€â”€â”€â”€â”€â”¤</span><br><span class="line">â”‚     â”‚  â”‚  â”‚     â”‚ â”‚  â”‚key:gâ”‚                    â”‚key:fâ”‚</span><br><span class="line">â”‚     â”‚  â”‚  â”‚     â”‚ â”‚  â”‚ 011 â”‚                    â”‚ 111 â”‚</span><br><span class="line">â”œâ”€â”€â”€â”€â”€â”¤  â”‚  â”œâ”€â”€â”€â”€â”€â”¤ â”‚  â”œâ”€â”€â”€â”€â”€â”¤                    â”œâ”€â”€â”€â”€â”€â”¤</span><br><span class="line">â”‚     â”‚  â”‚  â”‚     â”‚ â”‚  â”‚     â”‚                    â”‚key:gâ”‚</span><br><span class="line">â”‚     â”‚  â”‚  â”‚     â”‚ â”‚  â”‚     â”‚                    â”‚ 011 â”‚</span><br><span class="line">â”œâ”€â”€â”€â”€â”€â”¤  â”‚  â”œâ”€â”€â”€â”€â”€â”¤ â”‚  â”œâ”€â”€â”€â”€â”€â”¤                    â”œâ”€â”€â”€â”€â”€â”¤</span><br><span class="line">â”‚     â”‚  â”‚  â”‚     â”‚ â”‚  â”‚     â”‚                    â”‚     â”‚</span><br><span class="line">â”‚     â”‚  â”‚  â”‚     â”‚ â”‚  â”‚     â”‚                    â”‚     â”‚</span><br><span class="line">â”œâ”€â”€â”€â”€â”€â”¤  â”‚  â”œâ”€â”€â”€â”€â”€â”¤ â”‚  â”œâ”€â”€â”€â”€â”€â”¤                    â”œâ”€â”€â”€â”€â”€â”¤</span><br><span class="line">â”‚*overâ”‚  â”‚  â”‚*overâ”‚ â”‚  â”‚*overâ”‚                    â”‚*overâ”‚</span><br><span class="line">â”‚flow â”œâ”€â”€â”˜  â”‚flow â”œâ”€â”˜  â”‚flow â”‚                    â”‚flow â”‚</span><br><span class="line">â””â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”˜</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;åœ¨ä½¿ç”¨sliceçš„æ—¶å€™ï¼Œå¦‚æœå‘sliceä¸­è¿½åŠ å…ƒç´ çš„æ—¶å€™ï¼Œå¯¼è‡´å…ƒç´ æ•°é‡å¤§äºcapï¼Œè¿™æ—¶å€™å°±ä¼šå‘ç”Ÿsliceçš„æ‰©å®¹ã€‚é‚£ä¹ˆåœ¨goè¯­è¨€ä¸­ï¼Œä»€ä¹ˆæ—¶å€™mapä¼šå‘ç”Ÿæ‰©å®¹å‘¢ï¼Ÿæ‰©å®¹çš„ç­–ç•¥æœ‰å“ªäº›å‘¢ï¼Ÿæ‰©å®¹çš„è¿‡ç¨‹æ˜¯æ€æ ·çš„å‘¢ï¼Ÿå¾ˆæ˜¯å¥½å¥‡ï¼Œå¿ƒåŠ¨ä¸å¦‚è¡ŒåŠ¨ã€‚å¼€å§‹å­¦ä¹ ï¼Œåˆæ˜¯æ”¶è·æ»¡æ»¡çš„ä¸€å¤©ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="Golang" scheme="https://blog.eganx.cn/categories/Golang/"/>
    
    
    <category term="go" scheme="https://blog.eganx.cn/tags/go/"/>
    
    <category term="map" scheme="https://blog.eganx.cn/tags/map/"/>
    
  </entry>
  
  <entry>
    <title>Go Mapçš„åŸºæœ¬ä»‹ç»</title>
    <link href="https://blog.eganx.cn/2022/10/22/Go_Map/"/>
    <id>https://blog.eganx.cn/2022/10/22/Go_Map/</id>
    <published>2022-10-22T06:53:19.000Z</published>
    <updated>2022-11-20T04:33:23.564Z</updated>
    
    <content type="html"><![CDATA[<p>mapç”±key-valueå¯¹ç»„æˆï¼Œå¹¶ä¸”ä¸€ä¸ªkeyåªä¼šå‡ºç°ä¸€æ¬¡ã€‚å¯¹mapå¯ä»¥è¿›è¡Œå¢åˆ æ”¹æŸ¥ä¸€ç³»åˆ—æ“ä½œã€‚åœ¨Goè¯­è¨€ï¼Œmapé‡‡ç”¨çš„æ˜¯å“ˆå¸ŒæŸ¥æ‰¾è¡¨å®ç°ï¼Œè§£å†³å“ˆå¸Œå†²çªçš„æ–¹å¼æ˜¯é“¾è¡¨æ³•ã€‚è®°å½•ä¸€ä¸‹å­¦ä¹ è¿‡ç¨‹ä¸­äº†è§£åˆ°çš„mapåŸºæœ¬ç»“æ„å’Œkeyçš„å®šä½è¿‡ç¨‹ã€‚</p><span id="more"></span><h2 id="0x0-mapçš„åŸºæœ¬ç»“æ„"><a href="#0x0-mapçš„åŸºæœ¬ç»“æ„" class="headerlink" title="0x0.mapçš„åŸºæœ¬ç»“æ„"></a>0x0.mapçš„åŸºæœ¬ç»“æ„</h2><p>é™„ä¸Šæºç (go1.18.2/src/runtime/map.go)</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// A header for a Go map.</span></span><br><span class="line"><span class="keyword">type</span> hmap <span class="keyword">struct</span> &#123;</span><br><span class="line"><span class="comment">// Note: the format of the hmap is also encoded in</span></span><br><span class="line">  <span class="comment">// cmd/compile/internal/reflectdata/reflect.go.</span></span><br><span class="line"><span class="comment">// Make sure this stays in sync with the compiler&#x27;s definition.</span></span><br><span class="line">count     <span class="keyword">int</span> <span class="comment">// # live cells == size of map.  Must be first (used by len() builtin)</span></span><br><span class="line">flags     <span class="keyword">uint8</span></span><br><span class="line">B         <span class="keyword">uint8</span>  <span class="comment">// log_2 of # of buckets (can hold up to loadFactor * 2^B items)</span></span><br><span class="line">noverflow <span class="keyword">uint16</span> <span class="comment">// approximate number of overflow buckets; see incrnoverflow for details</span></span><br><span class="line">hash0     <span class="keyword">uint32</span> <span class="comment">// hash seed</span></span><br><span class="line"></span><br><span class="line">buckets    unsafe.Pointer <span class="comment">// array of 2^B Buckets. may be nil if count==0.</span></span><br><span class="line">oldbuckets unsafe.Pointer <span class="comment">// previous bucket array of half the size, non-nil only when growing</span></span><br><span class="line">nevacuate  <span class="keyword">uintptr</span>        <span class="comment">// progress counter for evacuation (buckets less than this have been evacuated)</span></span><br><span class="line"></span><br><span class="line">extra *mapextra <span class="comment">// optional fields</span></span><br><span class="line">&#125;                                                               </span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚ hmap â”‚</span><br><span class="line">â”œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚          count int         â”‚ â”‚     â”‚</span><br><span class="line">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚     â–¼</span><br><span class="line">â”‚          flags uint8       â”‚ â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚  â”‚[]bmapâ”‚    â”Œâ–ºâ”‚ bmap  â”‚</span><br><span class="line">â”‚           B uint8          â”‚ â”‚  â”œâ”€â”€â”€â”€â”€â”€â”´â”€â”  â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚  â”‚   0    â”œâ”€â”€â”˜ â”‚   tophash [bucketCnt]uint8    â”‚</span><br><span class="line">â”‚       noverflow uint16     â”‚ â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br><span class="line">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚  â”‚   1    â”‚    â”‚ key   â”‚                       â”‚</span><br><span class="line">â”‚        hash0 uint32        â”‚ â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”¬â”€â”€â”€â”¼â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¤</span><br><span class="line">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚  â”‚   2    â”‚    â”‚ 0 â”‚ 1 â”‚ 2 â”‚ 3 â”‚ 4 â”‚ 5 â”‚ 6 â”‚ 7 â”‚</span><br><span class="line">â”‚   buckets unsafe.Pointer   â”œâ”€â”˜  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”´â”€â”€â”€â”¼â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”¤</span><br><span class="line">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚   3    â”‚    â”‚ valuesâ”‚                       â”‚</span><br><span class="line">â”‚  oldbuckets unsafe.Pointer â”‚    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”¬â”€â”€â”€â”¼â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¤</span><br><span class="line">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚  ...   â”‚    â”‚ 0 â”‚ 1 â”‚ 2 â”‚ 3 â”‚ 4 â”‚ 5 â”‚ 6 â”‚ 7 â”‚</span><br><span class="line">â”‚     nevacuates uintptr     â”‚    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”¤</span><br><span class="line">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚   62   â”‚    â”‚        overflow *bmap         â”‚</span><br><span class="line">â”‚       extra *mapextra      â”‚    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¤    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br><span class="line">â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   63   â”œâ”€â”        â”‚</span><br><span class="line">     â”‚                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚        â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">     â–¼                             size&#x3D;2^B  â”‚        â””â”€â”€â”€â”€â”€â–ºâ”‚ bmap  â”‚</span><br><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                 â”‚               â”œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚ mapextra â”‚                                 â”‚               â”‚   tophash [bucketCnt]uint8    â”‚</span><br><span class="line">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚               â”œâ”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br><span class="line">â”‚ overflow *[]*bmap  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â” â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚ key   â”‚                       â”‚</span><br><span class="line">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚ bmap  â”‚                           â”œâ”€â”€â”€â”¬â”€â”€â”€â”¼â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¤</span><br><span class="line">â”‚oldoverflow *[]*bmapâ”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ 0 â”‚ 1 â”‚ 2 â”‚ 3 â”‚ 4 â”‚ 5 â”‚ 6 â”‚ 7 â”‚</span><br><span class="line">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚   tophash [bucketCnt]uint8    â”‚   â”œâ”€â”€â”€â”´â”€â”€â”€â”¼â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”¤</span><br><span class="line">â”‚ nextoverflow *bmap â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚ valuesâ”‚                       â”‚</span><br><span class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ key   â”‚                       â”‚   â”œâ”€â”€â”€â”¬â”€â”€â”€â”¼â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¤</span><br><span class="line">                         â”œâ”€â”€â”€â”¬â”€â”€â”€â”¼â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¤   â”‚ 0 â”‚ 1 â”‚ 2 â”‚ 3 â”‚ 4 â”‚ 5 â”‚ 6 â”‚ 7 â”‚</span><br><span class="line">                         â”‚ 0 â”‚ 1 â”‚ 2 â”‚ 3 â”‚ 4 â”‚ 5 â”‚ 6 â”‚ 7 â”‚   â”œâ”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”¤</span><br><span class="line">                         â”œâ”€â”€â”€â”´â”€â”€â”€â”¼â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”¤   â”‚        overflow *bmap         â”‚</span><br><span class="line">                         â”‚ valuesâ”‚                       â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br><span class="line">                         â”œâ”€â”€â”€â”¬â”€â”€â”€â”¼â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¤</span><br><span class="line">                         â”‚ 0 â”‚ 1 â”‚ 2 â”‚ 3 â”‚ 4 â”‚ 5 â”‚ 6 â”‚ 7 â”‚</span><br><span class="line">                         â”œâ”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”¤       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">                         â”‚        overflow *bmap         â”œâ”€â”€â”€â”€â”€â”€â–ºâ”‚  nil   â”‚</span><br><span class="line">                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br></pre></td></tr></table></figure><p>å…¶ä¸­Bæ˜¯bucketæ•°ç»„é•¿åº¦çš„å¯¹æ•°ï¼Œbucketé‡Œé¢å­˜å‚¨äº†keyå’Œvalueã€‚å¯ä»¥çœ‹è§ä¸€ä¸ªbucketé‡Œé¢æœ€å¤šèƒ½è£…8ä¸ªkeyï¼Œè¿™8ä¸ªkeyåœ¨bucketé‡Œé¢çš„ä½ç½®æ ¹æ®hashå€¼çš„é«˜8ä½å†³å®šã€‚nevacuateè¡¨ç¤ºæ‰©å®¹è¿›åº¦ï¼Œå°äºæ­¤åœ°å€çš„ buckets è¿ç§»å®Œæˆã€‚Asciié£æ ¼çš„mapå†…å­˜æ¨¡å‹å›¾æ˜¯å‚è€ƒæ›¹å¤§githubé‡Œçš„ï¼Œæ›¹å¤§yydsã€‚</p><p>å…¶ä¸­bucketæŒ‡é’ˆæŒ‡å‘çš„ç»“æ„ä½“å¦‚ä¸‹ï¼š</p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// A bucket for a Go map.</span></span><br><span class="line"><span class="keyword">type</span> bmap <span class="keyword">struct</span> &#123;</span><br><span class="line"><span class="comment">// tophash generally contains the top byte of the hash value</span></span><br><span class="line"><span class="comment">// for each key in this bucket. If tophash[0] &lt; minTopHash,</span></span><br><span class="line"><span class="comment">// tophash[0] is a bucket evacuation state instead.</span></span><br><span class="line">tophash [bucketCnt]<span class="keyword">uint8</span></span><br><span class="line"><span class="comment">// Followed by bucketCnt keys and then bucketCnt elems.</span></span><br><span class="line"><span class="comment">// <span class="doctag">NOTE:</span> packing all the keys together and then all the elems together makes the</span></span><br><span class="line"><span class="comment">// code a bit more complicated than alternating key/elem/key/elem/... but it allows</span></span><br><span class="line"><span class="comment">// us to eliminate padding which would be needed for, e.g., map[int64]int8.</span></span><br><span class="line"><span class="comment">// Followed by an overflow pointer.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚ bmap  â”‚</span><br><span class="line">â”œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚   tophash [bucketCnt]uint8    â”‚</span><br><span class="line">â”œâ”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br><span class="line">â”‚ key   â”‚                       â”‚</span><br><span class="line">â”œâ”€â”€â”€â”¬â”€â”€â”€â”¼â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¤</span><br><span class="line">â”‚ 0 â”‚ 1 â”‚ 2 â”‚ 3 â”‚ 4 â”‚ 5 â”‚ 6 â”‚ 7 â”‚</span><br><span class="line">â”œâ”€â”€â”€â”´â”€â”€â”€â”¼â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”¤</span><br><span class="line">â”‚ valuesâ”‚                       â”‚</span><br><span class="line">â”œâ”€â”€â”€â”¬â”€â”€â”€â”¼â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¤</span><br><span class="line">â”‚ 0 â”‚ 1 â”‚ 2 â”‚ 3 â”‚ 4 â”‚ 5 â”‚ 6 â”‚ 7 â”‚</span><br><span class="line">â”œâ”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”¤</span><br><span class="line">â”‚        overflow *bmap         â”‚</span><br><span class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br></pre></td></tr></table></figure><p>å…¶ä¸­keyå’Œvalueæ˜¯å„è‡ªå­˜æ”¾åœ¨ä¸€èµ·çš„ï¼Œä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšå‘¢ï¼Œä»¥ä¸‹æ˜¯åœ¨æ³¨é‡Šä¸­çš„å®˜æ–¹è§£é‡Šã€‚</p><blockquote><pre><code>NOTE: packing all the keys together and then all the elems together makes thecode a bit more complicated than alternating key/elem/key/elem/... but it allowsus to eliminate padding which would be needed for, e.g., map[int64]int8.</code></pre></blockquote><p>ä¸»è¦æ˜¯ä¸ºäº†å‡å°‘å†…å­˜å¯¹é½å¸¦æ¥çš„paddingã€‚æ³¨é‡Šä¸­ç»™äº†ä¸€ä¸ªä¾‹å­<code>map[int64]int8</code>ï¼Œå¦‚æœæ˜¯æŒ‰ç…§<code>key/elem/key/elem/</code>è¿™ç§æ–¹å¼å­˜å‚¨ï¼Œç›¸å½“äºæ¯ä¸€ä¸ª<code>key/elem</code>éƒ½éœ€è¦padding7ä¸ªå­—èŠ‚ã€‚64ä½çš„æœºå™¨ä¸Šï¼Œé»˜è®¤çš„å¯¹é½ç³»æ•°æ˜¯8ï¼ŒåŒæ—¶<code>int8</code>çš„å¯¹é½ç³»æ•°æ˜¯1ï¼Œ<code>int64</code>çš„å¯¹é½ç³»æ•°æ˜¯8ã€‚ä»¥ä¸‹æ˜¯<code>key/elem</code>æ–¹å¼äº§ç”Ÿpaddingçš„è¿‡ç¨‹ï¼š</p><ul><li>ç¬¬ä¸€ä¸ªkeyï¼Œkey1(int64)çš„å¤§å°å’Œå¯¹é½å€¼æ˜¯8ï¼Œå æ®8ä½ã€‚æš‚ä¸”å†™åšï¼škkkkkkkk</li><li>ç¬¬ä¸€ä¸ªvalueï¼Œvalue1(int8)çš„å¤§å°å’Œå¯¹é½å€¼æ˜¯1ï¼Œå æ®1ä½ã€‚å†™åšï¼škkkkkkkkï½œv</li><li>ç¬¬äºŒä¸ªkeyï¼Œkey2(int64)çš„å¤§å°å’Œå¯¹é½å€¼æ˜¯8ï¼Œåç§»é‡å¿…é¡»æ˜¯8çš„å€æ•°ã€‚ä¹Ÿå°±äº§ç”Ÿäº†paddingã€‚ä¸èƒ½ç›´æ¥æ¥ç€value1åé¢å†™äº†ï¼Œå†™ä½œï¼škkkkkkkkï½œvxxxxxxxï½œkkkkkkkkã€‚å…¶ä¸­xè¡¨ç¤ºpaddingã€‚åé¢ä¹Ÿå°±æ˜¯ä¾æ¬¡ç±»æ¨äº†ã€‚</li></ul><p>å¦‚æœæ˜¯æŒ‰ç…§<code>key/key/key/.../key/elem/elem/.../elem</code>æ¥è¿›è¡Œå­˜å‚¨çš„è¯ï¼Œåªéœ€è¦åœ¨æœ€åé¢æ·»åŠ paddingå°±è¡Œã€‚å†…å­˜å¯¹é½ä¸€èˆ¬å¥½åƒä¸æ€ä¹ˆä¼šè€ƒè™‘ï¼Œä½†æ˜¯äº†è§£è¿˜æ˜¯éœ€è¦äº†è§£çš„ï¼ŒTODO Listå†åŠ ä¸€é¡¹ã€‚</p><h2 id="0x1-mapä¸­keyçš„ä½ç½®"><a href="#0x1-mapä¸­keyçš„ä½ç½®" class="headerlink" title="0x1.mapä¸­keyçš„ä½ç½®"></a>0x1.mapä¸­keyçš„ä½ç½®</h2><p>åœ¨64ä½çš„æœºå™¨ä¸Šé¢ï¼Œkeyç»è¿‡hashè®¡ç®—åä¼šå¾—åˆ°ä¸€ä¸ª64bitçš„å“ˆå¸Œå€¼ã€‚åœ¨keyçš„å®šä½è¿‡ç¨‹ä¸­ä¼šç”¨åˆ°å“ˆå¸Œå€¼çš„é«˜8ä½å’ŒåBä½ã€‚Bå°±æ˜¯hmapä¸­çš„Bï¼Œå¦‚æœB=6ï¼Œbucketsæ•°ç»„çš„é•¿åº¦å°±æ˜¯2^6=64ã€‚</p><p>ä¸¾ä¸ªğŸŒ°,ç°åœ¨æœ‰ä¸€ä¸ªkeyçš„å“ˆå¸Œå€¼å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">00000111 | 00001111111011001111111111101010001000000001010000 | 000010</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">                                    key</span><br><span class="line"></span><br><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚ 00000111 | 00001111111011001111111111101010001000000001010000 | 000010 â”‚</span><br><span class="line">â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜</span><br><span class="line">     â”‚                                                              â”‚</span><br><span class="line">     â”‚                                                              â–¼</span><br><span class="line">     â”‚                                     B&#x3D;6          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">     â”‚                              bucketMask&#x3D;111111   â”‚ 000010&amp;111111  â”‚</span><br><span class="line">     â”‚                                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”˜</span><br><span class="line">     â”‚ tophash                                                       â”‚</span><br><span class="line">     â”‚                                                               â–¼</span><br><span class="line">     â”‚                                                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">     â”‚                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤000010&#x3D;2â”‚</span><br><span class="line">     â–¼                                    â”‚                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 buckets    â–¼</span><br><span class="line">â”‚ 00000111&#x3D;7 â”‚                  â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”</span><br><span class="line">â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                  â”‚ 0 â”‚ 1 â”‚ 2 â”‚ 3 â”‚    ...   â”‚ 61 â”‚ 62 â”‚ 63 â”‚</span><br><span class="line">      â”‚                         â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”¬â”€â”´â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”˜</span><br><span class="line">      â”‚                                   â”‚</span><br><span class="line">      â”‚                                   â”‚</span><br><span class="line">      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚</span><br><span class="line">                                    â”‚     â–¼</span><br><span class="line">           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">           â”‚                        â”‚            â”‚bucketâ”‚</span><br><span class="line">           â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”             â”‚            â”œâ”€â”€â”€â”€â”€â”€â”˜</span><br><span class="line">           â”‚  â”‚ bmap  â”‚             â–¼            â”‚</span><br><span class="line">           â”‚  â”œâ”€â”€â”€â”¬â”€â”€â”€â”¼â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”  â”‚</span><br><span class="line">           â”‚  â”‚111â”‚ 9 â”‚ 3 â”‚ 5 â”‚ 6 â”‚ 7 â”‚ 0 â”‚ 0 â”‚  â”‚</span><br><span class="line">           â”‚  â”œâ”€â”€â”€â”´â”€â”€â”€â”¼â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”¤  â”‚</span><br><span class="line">           â”‚  â”‚ key   â”‚                       â”‚  â”‚</span><br><span class="line">           â”‚  â”œâ”€â”€â”€â”¬â”€â”€â”€â”¼â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¤  â”‚</span><br><span class="line">           â”‚  â”‚ 5 â”‚ 2 â”‚ 1 â”‚ 4 â”‚ 3 â”‚ 9 â”‚ 0 â”‚ 0 â”‚  â”‚</span><br><span class="line">           â”‚  â”œâ”€â”€â”€â”´â”€â”€â”€â”¼â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”¤  â”‚</span><br><span class="line">           â”‚  â”‚ valuesâ”‚                       â”‚  â”‚</span><br><span class="line">           â”‚  â”œâ”€â”€â”€â”¬â”€â”€â”€â”¼â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¤  â”‚</span><br><span class="line">           â”‚  â”‚ 3 â”‚ 5 â”‚ 4 â”‚ 7 â”‚ 9 â”‚ 6 â”‚ 0 â”‚ 0 â”‚  â”‚</span><br><span class="line">           â”‚  â”œâ”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”¤  â”‚</span><br><span class="line">           â”‚  â”‚        overflow *bmap         â”‚  â”‚</span><br><span class="line">           â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚</span><br><span class="line">           â”‚                                     â”‚</span><br><span class="line">           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br></pre></td></tr></table></figure><p>å¦‚æœåœ¨ bucket ä¸­æ²¡æ‰¾åˆ°ï¼Œå¹¶ä¸” overflow ä¸ä¸ºç©ºï¼Œè¿˜è¦ç»§ç»­å» overflow bucket ä¸­å¯»æ‰¾ï¼Œç›´åˆ°æ‰¾åˆ°æˆ–æ˜¯æ‰€æœ‰çš„ key æ§½ä½éƒ½æ‰¾éäº†ï¼ŒåŒ…æ‹¬æ‰€æœ‰çš„ overflow bucketã€‚</p><p>å®ç°ä¸Šæœ‰ mapaccess1ï¼Œmapaccess2ï¼ŒmapaccessK å‡ ä¸ªæ–¹æ³•ï¼Œä¸»è¦åŒºåˆ«æ˜¯åœ¨è¿”å›å†…å®¹ä¸Šã€‚å½“è¦æŸ¥è¯¢çš„ key ä¸åœ¨ map é‡Œï¼Œmapaccess2çš„ç”¨æ³•ä¼šè¿”å›ä¸€ä¸ª bool å‹å˜é‡æç¤º key æ˜¯å¦åœ¨ map ä¸­ï¼›è€Œmapaccess1 çš„è¯­å¥åˆ™ä¼šè¿”å›ä¸€ä¸ª key å¯¹åº” value ç±»å‹çš„é›¶å€¼ã€‚å¦‚æœ value æ˜¯ int å‹å°±ä¼šè¿”å› 0ï¼Œå¦‚æœ value æ˜¯ string ç±»å‹ï¼Œå°±ä¼šè¿”å›ç©ºå­—ç¬¦ä¸²ã€‚mapaccess2å°±æ˜¯æ—¥å¸¸ä»£ç ä¸­<code>v, ok := map[k]</code>çš„åº•å±‚å‡½æ•°ã€‚</p><h2 id="0x2-Go-Mapæ˜¯çº¿ç¨‹å®‰å…¨çš„å—ï¼Ÿ"><a href="#0x2-Go-Mapæ˜¯çº¿ç¨‹å®‰å…¨çš„å—ï¼Ÿ" class="headerlink" title="0x2.Go Mapæ˜¯çº¿ç¨‹å®‰å…¨çš„å—ï¼Ÿ"></a>0x2.Go Mapæ˜¯çº¿ç¨‹å®‰å…¨çš„å—ï¼Ÿ</h2><p>mapä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚åœ¨å¯¹mapè¿›è¡Œè¯»å†™æ“ä½œçš„æ—¶å€™éƒ½ä¼šå…ˆæ£€æµ‹å†™æ ‡å¿—ï¼Œå‘ç°å†™æ ‡å¿—ä½ç½®1ï¼Œä¼španicã€‚æ‰€ä»¥ä¸èƒ½ä¸€è¾¹å†™å…¥ä¸€è¾¹éå†ã€‚</p><p>ä¸€ä¸ªåç¨‹å†…ä¸€è¾¹åˆ é™¤ä¸€è¾¹éå†çš„æ“ä½œæ˜¯å…è®¸çš„ï¼Œä½†æ˜¯çœŸçš„è¿™ä¹ˆå¹²äº†ï¼Œå¤§æ¦‚ç‡ä¼šè¢«æ‰“ã€‚æ¯•ç«Ÿéå†å‡ºæ¥çš„ç»“æœæœ‰å¯èƒ½ä¼šåŒ…å«å·²ç»åˆ é™¤çš„å…ƒç´ ã€‚</p><p>ä¸Šé¢çš„ä¸¤ç§æƒ…å†µçœ‹çœ‹å°±è¡Œï¼ŒçœŸè¦å†™çš„æ—¶å€™ä¸€èˆ¬éƒ½ä¼šåŠ è¯»å†™é”ï¼š<code>sync.RWMutex</code>ã€‚</p><blockquote><p>mapä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä½†æ˜¯sync.Mapæ˜¯çº¿ç¨‹å®‰å…¨ã€‚</p></blockquote><h2 id="0x3-å¦‚ä½•åˆ¤æ–­ä¸¤ä¸ªmapæ˜¯å¦ç›¸ç­‰"><a href="#0x3-å¦‚ä½•åˆ¤æ–­ä¸¤ä¸ªmapæ˜¯å¦ç›¸ç­‰" class="headerlink" title="0x3.å¦‚ä½•åˆ¤æ–­ä¸¤ä¸ªmapæ˜¯å¦ç›¸ç­‰"></a>0x3.å¦‚ä½•åˆ¤æ–­ä¸¤ä¸ªmapæ˜¯å¦ç›¸ç­‰</h2><p>ä¸¤ä¸ªmapæ˜¯å¦ç›¸ç­‰ä¸èƒ½ç›´æ¥é€šè¿‡<code>==</code>åˆ¤æ–­ï¼Œç¼–è¯‘æŠ¥é”™ã€‚</p><p>å¼•ç”¨ä¹¦é‡Œçš„mapæ·±åº¦ç›¸ç­‰çš„æ¡ä»¶ï¼š</p><blockquote><p>1ã€éƒ½ä¸ºnil</p><p>2ã€éç©ºï¼Œé•¿åº¦ç›¸ç­‰ï¼ŒæŒ‡å‘åŒä¸€ä¸ªmapå®ä½“</p><p>3ã€ç›¸åŒçš„keyæŒ‡å‘çš„valueâ€œæ·±åº¦â€ç›¸ç­‰</p></blockquote><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> m <span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">int</span></span><br><span class="line"><span class="keyword">var</span> n <span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">int</span></span><br><span class="line"></span><br><span class="line">fmt.Println(m == <span class="literal">nil</span>) <span class="comment">//OK</span></span><br><span class="line">fmt.Println(n == <span class="literal">nil</span>) <span class="comment">//OK</span></span><br><span class="line">fmt.Println(m == n) <span class="comment">//ç¼–è¯‘æŠ¥é”™</span></span><br></pre></td></tr></table></figure><p>å› æ­¤åªèƒ½æ˜¯éå†map çš„æ¯ä¸ªå…ƒç´ ï¼Œæ¯”è¾ƒå…ƒç´ æ˜¯å¦éƒ½æ˜¯æ·±åº¦ç›¸ç­‰ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;mapç”±key-valueå¯¹ç»„æˆï¼Œå¹¶ä¸”ä¸€ä¸ªkeyåªä¼šå‡ºç°ä¸€æ¬¡ã€‚å¯¹mapå¯ä»¥è¿›è¡Œå¢åˆ æ”¹æŸ¥ä¸€ç³»åˆ—æ“ä½œã€‚åœ¨Goè¯­è¨€ï¼Œmapé‡‡ç”¨çš„æ˜¯å“ˆå¸ŒæŸ¥æ‰¾è¡¨å®ç°ï¼Œè§£å†³å“ˆå¸Œå†²çªçš„æ–¹å¼æ˜¯é“¾è¡¨æ³•ã€‚è®°å½•ä¸€ä¸‹å­¦ä¹ è¿‡ç¨‹ä¸­äº†è§£åˆ°çš„mapåŸºæœ¬ç»“æ„å’Œkeyçš„å®šä½è¿‡ç¨‹ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="Golang" scheme="https://blog.eganx.cn/categories/Golang/"/>
    
    
    <category term="go" scheme="https://blog.eganx.cn/tags/go/"/>
    
    <category term="map" scheme="https://blog.eganx.cn/tags/map/"/>
    
  </entry>
  
  <entry>
    <title>Go Sliceçš„æ‰©å®¹ç­–ç•¥</title>
    <link href="https://blog.eganx.cn/2022/10/15/Go_Slice_growup/"/>
    <id>https://blog.eganx.cn/2022/10/15/Go_Slice_growup/</id>
    <published>2022-10-15T04:56:11.000Z</published>
    <updated>2022-11-20T04:33:01.426Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨å†™Goçš„æ—¶å€™ï¼Œå¯¹Sliceçš„æ“ä½œå°±å¾ˆå±é™©ï¼Œç‰¹åˆ«æ˜¯å‡½æ•°å‚æ•°ä¼ çš„æ˜¯SliceæŒ‡é’ˆï¼Œä¸€ä¸å°å¿ƒå°±æ”¹äº†ã€‚åˆ‡ç‰‡æ”¯æŒå­åˆ‡ç‰‡  å’ŒåŸæœ¬åˆ‡ç‰‡å…±äº«åº•å±‚æ•°ç»„ï¼Œé‚£å­åˆ‡ç‰‡å’Œåˆ‡ç‰‡ç©¶ç«Ÿä¼šä¸ä¼šç›¸äº’å½±å“ï¼Ÿ å°±çœ‹ä»–ä»¬æ˜¯ä¸æ˜¯è¿˜å…±äº«åº•å±‚æ•°ç»„ã€‚å¦‚æœä»–ä»¬çš„ç»“æ„æ²¡æœ‰å˜åŒ–ï¼Œè‚¯å®šæ˜¯å…±äº«çš„ã€‚ç»“æ„å‘ç”Ÿå˜åŒ–(æ‰©å®¹)ï¼Œå°±å¯èƒ½ä¸å…±äº«äº†ã€‚</p><p>å¯¹å­åˆ‡ç‰‡çš„ä½¿ç”¨å»ºè®®ï¼šåªè¯»ä¸æ”¹</p><span id="more"></span><h2 id="0x0-Sliceå’ŒArrayçš„è”ç³»"><a href="#0x0-Sliceå’ŒArrayçš„è”ç³»" class="headerlink" title="0x0.Sliceå’ŒArrayçš„è”ç³»"></a>0x0.Sliceå’ŒArrayçš„è”ç³»</h2><p>slice çš„åº•å±‚æ•°æ®æ˜¯æ•°ç»„ï¼Œslice æ˜¯å¯¹æ•°ç»„çš„å°è£…ã€‚ä¸¤è€…éƒ½å¯ä»¥é€šè¿‡ä¸‹æ ‡æ¥è®¿é—®å•ä¸ªå…ƒç´ ã€‚</p><p>æ•°ç»„å°±æ˜¯ä¸€ç‰‡è¿ç»­çš„å†…å­˜ï¼Œæ˜¯å®šé•¿çš„ï¼Œå…¶é•¿åº¦æ˜¯ç±»å‹çš„ä¸€éƒ¨åˆ†ï¼Œæ¯”å¦‚ [3]int å’Œ [4]int å°±æ˜¯ä¸åŒçš„ç±»å‹ã€‚</p><p>sliceå¯ä»¥åŠ¨æ€åœ°æ‰©å®¹ï¼Œåˆ‡ç‰‡çš„ç±»å‹å’Œé•¿åº¦æ— å…³ã€‚</p><p>slice æ˜¯ä¸€ä¸ªç»“æ„ä½“ï¼ŒåŒ…å«ä¸‰ä¸ªå­—æ®µï¼šé•¿åº¦ã€å®¹é‡ã€åº•å±‚æ•°ç»„ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">type slice struct &#123;</span><br><span class="line">array unsafe.Pointer &#x2F;&#x2F; å…ƒç´ æŒ‡é’ˆ</span><br><span class="line">len   int &#x2F;&#x2F; é•¿åº¦ </span><br><span class="line">cap   int &#x2F;&#x2F; å®¹é‡</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸æ˜¯æ¯ä¸€ä¸ªSliceéƒ½æœ‰è‡ªå·±ä¸“å±çš„åº•å±‚æ•°ç»„ï¼Œåº•å±‚æ•°ç»„æ˜¯å¯ä»¥è¢«å¤šä¸ªSliceåŒæ—¶æŒ‡å‘çš„ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨ä¿®æ”¹SliceAçš„æ•°æ®æ—¶ï¼Œæœ‰å¯èƒ½SliceBçš„æ•°æ®ä¹Ÿä¼šå‘ç”Ÿæ”¹å˜ã€‚</p><h2 id="0x1-Sliceæ‰©å®¹ç­–ç•¥"><a href="#0x1-Sliceæ‰©å®¹ç­–ç•¥" class="headerlink" title="0x1.Sliceæ‰©å®¹ç­–ç•¥"></a>0x1.Sliceæ‰©å®¹ç­–ç•¥</h2><p>åœ¨golang1.18ç‰ˆæœ¬ä¹‹å‰ï¼ŒSliceçš„æ‰©å®¹ç­–ç•¥æ˜¯å½“åŸ slice å®¹é‡å°äº <code>1024</code> çš„æ—¶å€™ï¼Œæ–° slice å®¹é‡å˜æˆåŸæ¥çš„ <code>2</code> å€ï¼›åŸ slice å®¹é‡è¶…è¿‡ <code>1024</code>ï¼Œæ–° slice å®¹é‡å˜æˆåŸæ¥çš„<code>1.25</code>å€ã€‚</p><p>åœ¨golang1.18ç‰ˆæœ¬ä¹‹åï¼Œæ–°çš„Sliceæ‰©å®¹ç­–ç•¥æ˜¯å½“åŸsliceå®¹é‡(oldcap)å°äº<code>256</code>çš„æ—¶å€™ï¼Œæ–°slice(newcap)å®¹é‡ä¸ºåŸæ¥çš„<code>2</code>å€ï¼›åŸsliceå®¹é‡è¶…è¿‡<code>256</code>ï¼Œæ–°sliceå®¹é‡<code>newcap = oldcap+(oldcap+3*256)/4</code></p><blockquote><p>åœ¨å®é™…çš„æ‰©å®¹è¿‡ç¨‹ä¸­ï¼Œè¿˜éœ€è¦è€ƒè™‘å†…å­˜å¯¹é½äº§ç”Ÿçš„å½±å“ï¼Œè¿™ä¸ªå’Œå†…å­˜åˆ†é…ç­–ç•¥ç›¸å…³ã€‚è¿›è¡Œå†…å­˜å¯¹é½ä¹‹åï¼Œæ–° slice çš„å®¹é‡æ˜¯è¦ <code>å¤§äºç­‰äº</code> ç†è®ºçš„æ‰©å®¹é‡ã€‚</p></blockquote><p>ç»å…¸ä¾‹é¢˜ï¼Œæ¥è‡ª<a href="https://jodezer.github.io/2017/05/golangSlice%E7%9A%84%E6%89%A9%E5%AE%B9%E8%A7%84%E5%88%99">golang Sliceçš„æ‰©å®¹è§„åˆ™</a></p><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">s := []<span class="keyword">int</span>&#123;<span class="number">1</span>,<span class="number">2</span>&#125;</span><br><span class="line">s = <span class="built_in">append</span>(s,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>)</span><br><span class="line">fmt.Printf(<span class="string">&quot;len=%d, cap=%d&quot;</span>,<span class="built_in">len</span>(s),<span class="built_in">cap</span>(s))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>è¿è¡Œç»“æœï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">len&#x3D;5, cap&#x3D;6</span><br></pre></td></tr></table></figure></blockquote>]]></content>
    
    
    <summary type="html">&lt;p&gt;åœ¨å†™Goçš„æ—¶å€™ï¼Œå¯¹Sliceçš„æ“ä½œå°±å¾ˆå±é™©ï¼Œç‰¹åˆ«æ˜¯å‡½æ•°å‚æ•°ä¼ çš„æ˜¯SliceæŒ‡é’ˆï¼Œä¸€ä¸å°å¿ƒå°±æ”¹äº†ã€‚åˆ‡ç‰‡æ”¯æŒå­åˆ‡ç‰‡  å’ŒåŸæœ¬åˆ‡ç‰‡å…±äº«åº•å±‚æ•°ç»„ï¼Œé‚£å­åˆ‡ç‰‡å’Œåˆ‡ç‰‡ç©¶ç«Ÿä¼šä¸ä¼šç›¸äº’å½±å“ï¼Ÿ å°±çœ‹ä»–ä»¬æ˜¯ä¸æ˜¯è¿˜å…±äº«åº•å±‚æ•°ç»„ã€‚å¦‚æœä»–ä»¬çš„ç»“æ„æ²¡æœ‰å˜åŒ–ï¼Œè‚¯å®šæ˜¯å…±äº«çš„ã€‚ç»“æ„å‘ç”Ÿå˜åŒ–(æ‰©å®¹)ï¼Œå°±å¯èƒ½ä¸å…±äº«äº†ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹å­åˆ‡ç‰‡çš„ä½¿ç”¨å»ºè®®ï¼šåªè¯»ä¸æ”¹&lt;/p&gt;</summary>
    
    
    
    <category term="Golang" scheme="https://blog.eganx.cn/categories/Golang/"/>
    
    
    <category term="go" scheme="https://blog.eganx.cn/tags/go/"/>
    
    <category term="slice" scheme="https://blog.eganx.cn/tags/slice/"/>
    
  </entry>
  
  <entry>
    <title>C# GCæœºåˆ¶(Garbage Collector)</title>
    <link href="https://blog.eganx.cn/2022/02/08/CSharp_GC_mechanism/"/>
    <id>https://blog.eganx.cn/2022/02/08/CSharp_GC_mechanism/</id>
    <published>2022-02-08T13:31:19.000Z</published>
    <updated>2022-11-20T02:42:11.675Z</updated>
    
    <content type="html"><![CDATA[<p>è®°å½•ä¸€ä¸‹C#ä¸­GCçš„ç›¸å…³çŸ¥è¯†ã€‚ä¸è®°ä¸‹æ¥ï¼Œä¸‹æ¬¡åˆæ‰¾ä¸åˆ°ï¼Œå°±å¾ˆçƒ¦ã€‚</p><p>ä¸»è¦é’ˆå¯¹çš„æ˜¯C#ä¸­å¦‚ä½•åˆ¤å®šGarbageå’ŒGCçš„è¿ä½œæ–¹å¼ã€‚</p><span id="more"></span><h2 id="0x0-èµ„æºæ¦‚å¿µ"><a href="#0x0-èµ„æºæ¦‚å¿µ" class="headerlink" title="0x0.èµ„æºæ¦‚å¿µ"></a>0x0.èµ„æºæ¦‚å¿µ</h2><p>æ‰€è°“çš„èµ„æºå…¶å®å°±æ˜¯ç¨‹åºä¸­å¯ä»¥åˆ©ç”¨çš„æ•°æ®ã€‚æ¯”å¦‚å­—ç¬¦ä¸²ã€å›¾ç‰‡å’Œä»»ä½•çš„äºŒè¿›åˆ¶æ•°æ®ã€‚</p><p>æ‰˜ç®¡èµ„æºï¼Œéæ‰˜ç®¡èµ„æºï¼šæ‰˜ç®¡èµ„æºæ˜¯ç”±CLRå…¨æƒè´Ÿè´£çš„èµ„æºï¼ŒCLRä¸è´Ÿè´£çš„èµ„æºä½éæ‰˜ç®¡èµ„æºã€‚<br><strong>å¯¹äºæ‰˜ç®¡èµ„æºé€šè¿‡GCè‡ªåŠ¨æ¸…ç†å›æ”¶ã€‚å¯¹äºéæ‰˜ç®¡çš„èµ„æºï¼Œä¸€èˆ¬å°±æ˜¯Streamï¼Œæ•°æ®åº“çš„è¿æ¥ï¼Œç½‘ç»œè¿æ¥ï¼ŒGDI+çš„ç›¸å…³å¯¹è±¡ï¼Œè¿˜æœ‰Comå¯¹è±¡ç­‰ç­‰è¿™äº›æ“ä½œç³»ç»Ÿèµ„æºï¼Œéœ€è¦æˆ‘ä»¬æ‰‹åŠ¨å»é‡Šæ”¾ï¼Œå†ç”±GCå›æ”¶ã€‚</strong>  </p><h2 id="0x1-Garbageçš„åˆ¤å®š"><a href="#0x1-Garbageçš„åˆ¤å®š" class="headerlink" title="0x1.Garbageçš„åˆ¤å®š"></a>0x1.Garbageçš„åˆ¤å®š</h2><p>.Netç±»å‹åˆ†ä¸ºä¸¤å¤§ç±»ï¼Œ<strong>ä¸€ä¸ªå°±æ˜¯å€¼ç±»å‹ï¼Œå¦ä¸€ä¸ªå°±æ˜¯å¼•ç”¨ç±»å‹ã€‚å‰è€…æ˜¯åœ¨å †æ ˆä¸­åˆ†é…å†…å­˜ï¼Œå®ƒä»¬æœ‰è‡ªèº«çš„ç”Ÿå‘½å‘¨æœŸï¼Œæ‰€ä»¥ä¸ç”¨å¯¹å®ƒä»¬è¿›è¡Œç®¡ç†ï¼Œä¼šè‡ªåŠ¨åˆ†é…å’Œé‡Šæ”¾ã€‚åè€…æ˜¯åœ¨å †ä¸­åˆ†é…å†…å­˜çš„ã€‚æ‰€ä»¥å®ƒçš„åˆ†é…å’Œé‡Šæ”¾å°±éœ€è¦åƒå›æ”¶æœºåˆ¶æ¥ç®¡ç†ã€‚</strong></p><p>GCçš„å…¨ç§°ä¸ºâ€œGarbage Collectorâ€,é¡¾åæ€ä¹‰å°±æ˜¯åƒåœ¾å›æ”¶å™¨ï¼Œé‚£ä¹ˆåªæœ‰è¢«ç§°ä¸ºåƒåœ¾çš„å¯¹è±¡æ‰èƒ½è¢«GCå›æ”¶ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ ä¸€ä¸ªå¼•ç”¨ç±»å‹å¯¹è±¡æ‰€å ç”¨çš„å†…å­˜éœ€è¦è¢«GCå›æ”¶ï¼Œéœ€è¦å…ˆæˆä¸ºåƒåœ¾ã€‚ <strong>.Netåˆ¤å®šä¸€ä¸ªå¼•ç”¨ç±»å‹å¯¹è±¡æ˜¯åƒåœ¾ï¼Œåªéœ€è¦åˆ¤å®šæ­¤å¯¹è±¡æˆ–è€…å…¶åŒ…å«çš„å­å¯¹è±¡æ²¡æœ‰ä»»ä½•å¼•ç”¨æ˜¯æœ‰æ•ˆçš„ï¼Œé‚£ä¹ˆç³»ç»Ÿå°±è®¤ä¸ºå®ƒæ˜¯åƒåœ¾ã€‚</strong></p><h2 id="0x2-éæ‰˜ç®¡èµ„æºçš„é‡Šæ”¾æ–¹å¼"><a href="#0x2-éæ‰˜ç®¡èµ„æºçš„é‡Šæ”¾æ–¹å¼" class="headerlink" title="0x2.éæ‰˜ç®¡èµ„æºçš„é‡Šæ”¾æ–¹å¼"></a>0x2.éæ‰˜ç®¡èµ„æºçš„é‡Šæ”¾æ–¹å¼</h2><h3 id="1-Close"><a href="#1-Close" class="headerlink" title="1).Close()"></a>1).Close()</h3><p>å…³é—­å¯¹è±¡èµ„æºï¼Œåœ¨æ˜¾ç¤ºè°ƒç”¨æ—¶è¢«è°ƒç”¨ã€‚</p><h3 id="2-Dispose"><a href="#2-Dispose" class="headerlink" title="2).Dispose()"></a>2).Dispose()</h3><p>ç»§æ‰¿IDisposableæ¥å£ï¼Œå®ç°Disposeæ–¹æ³•ï¼›<br>ä»‹ç»ï¼šè°ƒç”¨Disposeæ–¹æ³•ï¼Œé”€æ¯å¯¹è±¡ï¼Œéœ€è¦æ˜¾ç¤ºè°ƒç”¨æˆ–è€…é€šè¿‡usingè¯­å¥ï¼Œåœ¨æ˜¾ç¤ºè°ƒç”¨æˆ–è€…ç¦»å¼€usingç¨‹åºå—æ—¶è¢«è°ƒç”¨ã€‚<br>Disposeæ–¹æ³•ç”¨äºæ¸…ç†å¯¹è±¡å°è£…çš„éæ‰˜ç®¡èµ„æºï¼Œè€Œä¸æ˜¯é‡Šæ”¾å¯¹è±¡çš„å†…å­˜ï¼Œå¯¹è±¡çš„å†…å­˜ä¾ç„¶ç”±åƒåœ¾å›æ”¶å™¨æ§åˆ¶ã€‚<br>Disposeæ–¹æ³•è°ƒç”¨ï¼Œä¸ä½†é‡Šæ”¾è¯¥ç±»çš„éæ‰˜ç®¡èµ„æºï¼Œè¿˜é‡Šæ”¾äº†å¼•ç”¨çš„ç±»çš„éæ‰˜ç®¡èµ„æºã€‚<br>Disposeæ¨¡å¼å°±æ˜¯ä¸€ç§å¼ºåˆ¶èµ„æºæ¸…ç†æ‰€è¦éµå®ˆçš„çº¦å®šï¼›Disposeæ¨¡å¼å®ç°IDisposableæ¥å£ï¼Œä»è€Œä½¿å¾—è¯¥ç±»å‹æä¾›ä¸€ä¸ªå…¬æœ‰çš„Disposeæ–¹æ³•ã€‚</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">è€ŒCloseä¸Disposeè¿™ä¸¤ç§æ–¹æ³•çš„åŒºåˆ«åœ¨äºï¼Œè°ƒç”¨å®Œäº†å¯¹è±¡çš„Closeæ–¹æ³•åï¼Œæ­¤å¯¹è±¡æœ‰å¯èƒ½è¢«é‡æ–°è¿›</span><br><span class="line">è¡Œä½¿ç”¨ï¼›è€ŒDisposeæ–¹æ³•æ¥è¯´ï¼Œæ­¤å¯¹è±¡æ‰€å æœ‰çš„èµ„æºéœ€è¦è¢«æ ‡è®°ä¸ºæ— ç”¨äº†ï¼Œä¹Ÿå°±æ˜¯æ­¤å¯¹è±¡è¢«é”€æ¯äº†ï¼Œ</span><br><span class="line">ä¸èƒ½å†è¢«ä½¿ç”¨ã€‚</span><br></pre></td></tr></table></figure><h3 id="3-ææ„å‡½æ•°-Finalize"><a href="#3-ææ„å‡½æ•°-Finalize" class="headerlink" title="3).ææ„å‡½æ•°/Finalize()"></a>3).ææ„å‡½æ•°/Finalize()</h3><p>å¸¦æœ‰ææ„å‡½æ•°çš„ç±»ï¼Œç”Ÿå‘½å‘¨æœŸä¼šå˜é•¿ã€‚å†…å­˜ç©ºé—´éœ€è¦ä¸¤æ¬¡åƒåœ¾å›æ”¶æ‰ä¼šè¢«é‡Šæ”¾ï¼Œå¯¼è‡´æ€§èƒ½ä¸‹é™ã€‚</p><p>ä¸€ä¸ªæ­£å¸¸æƒ…å†µçš„ç±»æ˜¯ä¸ä¼šå†™ææ„å‡½æ•°çš„ï¼Œè€Œä¸€æ—¦ä¸€ä¸ªç±»å†™äº†ææ„å‡½æ•°ï¼Œå°±æ„å‘³ç€GCä¼šåœ¨ä¸ç¡®å®šçš„æ—¶é—´è°ƒç”¨è¯¥ç±»çš„ææ„å‡½æ•°ï¼Œåˆ¤æ–­è¯¥ç±»çš„èµ„æºæ˜¯å¦éœ€è¦é‡Šæ”¾ï¼Œç„¶åè°ƒç”¨Finalizeæ–¹æ³•ï¼Œå¦‚æœé‡å†™äº†Finalizeæ–¹æ³•åˆ™è°ƒç”¨é‡å†™çš„Finalizeæ–¹æ³•ã€‚<br>Finalizeæ–¹æ³•çš„ä½œç”¨æ˜¯ä¿è¯.NETå¯¹è±¡èƒ½åœ¨åƒåœ¾å›æ”¶æ—¶æ¸…é™¤éæ‰˜ç®¡èµ„æºã€‚<br>åœ¨.NETä¸­ï¼ŒObject.Finalize()æ–¹æ³•æ˜¯æ— æ³•é‡è½½çš„ï¼Œç¼–è¯‘å™¨æ˜¯æ ¹æ®ç±»çš„ææ„å‡½æ•°æ¥è‡ªåŠ¨ç”ŸæˆObject.Finalize()æ–¹æ³•çš„<br>Finalizeç”±åƒåœ¾å›æ”¶å™¨è°ƒç”¨ï¼›disposeç”±å¯¹è±¡è°ƒç”¨ã€‚<br>Finalizeæ— éœ€æ‹…å¿ƒå› ä¸ºæ²¡æœ‰è°ƒç”¨Finalizeè€Œä½¿éæ‰˜ç®¡èµ„æºå¾—ä¸åˆ°é‡Šæ”¾ï¼Œå› ä¸ºGCä¼šåœ¨ä¸ç¡®å®šæ—¶é—´è°ƒç”¨ï¼Œå½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥æ‰‹åŠ¨è°ƒç”¨Finalizeæ–¹æ³•ï¼Œè€Œdisposeå¿…é¡»æ‰‹åŠ¨è°ƒç”¨ã€‚<br>Finalizeè™½ç„¶æ— éœ€æ‹…å¿ƒå› ä¸ºæ²¡æœ‰è°ƒç”¨Finalizeè€Œä½¿éæ‰˜ç®¡èµ„æºå¾—ä¸åˆ°é‡Šæ”¾ï¼Œä½†å› ä¸ºç”±åƒåœ¾å›æ”¶å™¨ç®¡ç†ï¼Œä¸èƒ½ä¿è¯ç«‹å³é‡Šæ”¾éæ‰˜ç®¡èµ„æºï¼›è€Œdisposeä¸€è°ƒç”¨ä¾¿é‡Šæ”¾éæ‰˜ç®¡èµ„æºã€‚<br>åªæœ‰ç±»ç±»å‹æ‰èƒ½é‡å†™Finalizeï¼Œè€Œç»“æ„ä¸èƒ½ï¼›ç±»å’Œç»“æ„éƒ½èƒ½å®ç°IDispose</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">é‡Šæ”¾æ¨¡å¼ï¼šæ˜¯ä¸€ç§å¾®è½¯å»ºè®®çš„å†™æ³•ï¼Œå…ˆæ‰‹åŠ¨æ˜¾ç¤ºå»é‡Šæ”¾èµ„æºï¼Œå¦‚æœå¿˜è®°äº†ï¼Œå†è®©finalizeé‡Šæ”¾èµ„æºã€‚</span><br><span class="line">æ‰€ä»¥å¦‚æœå·²ç»å®Œæˆäº†ææ„å‡½æ•°è¯¥å¹²çš„äº‹æƒ…(ä¾‹å¦‚é‡Šæ”¾éæ‰˜ç®¡èµ„æº)ï¼Œå°±åº”å½“ä½¿ç”¨SuppressFinalize</span><br><span class="line">æ–¹æ³•å‘Šè¯‰GCä¸éœ€è¦å†æ‰§è¡ŒæŸä¸ªå¯¹è±¡çš„ææ„å‡½æ•°ã€‚</span><br></pre></td></tr></table></figure><h2 id="0x3-GCçš„è¿ä½œæ–¹å¼"><a href="#0x3-GCçš„è¿ä½œæ–¹å¼" class="headerlink" title="0x3.GCçš„è¿ä½œæ–¹å¼"></a>0x3.GCçš„è¿ä½œæ–¹å¼</h2><p>å†…å­˜çš„é‡Šæ”¾å’Œå›æ”¶éœ€è¦ä¼´éšç€ç¨‹åºçš„è¿è¡Œï¼Œå› æ­¤ç³»ç»Ÿä¸ºGCå®‰æ’äº†ç‹¬ç«‹çš„çº¿ç¨‹ã€‚é‚£ä¹ˆGCçš„å·¥ä½œå¤§è‡´æ˜¯ï¼ŒæŸ¥è¯¢å†…å­˜ä¸­å¯¹è±¡æ˜¯å¦æˆä¸ºåƒåœ¾ï¼Œç„¶åå¯¹åƒåœ¾è¿›è¡Œé‡Šæ”¾å’Œå›æ”¶ã€‚é‚£ä¹ˆå¯¹äºGCå¯¹äºå†…å­˜å›æ”¶é‡‡å–äº†ä¸€å®šçš„ä¼˜å…ˆç®—æ³•è¿›è¡Œè½®å¾ªå›æ”¶å†…å­˜èµ„æºã€‚</p><p>å…¶æ¬¡ï¼Œ<strong>å¯¹äºå†…å­˜ä¸­çš„åƒåœ¾åˆ†ä¸ºä¸¤ç§ï¼Œä¸€ç§æ˜¯éœ€è¦è°ƒç”¨å¯¹è±¡çš„ææ„å‡½æ•°ï¼Œå¦ä¸€ç§æ˜¯ä¸éœ€è¦è°ƒç”¨çš„ã€‚GCå¯¹äºå‰è€…çš„å›æ”¶éœ€è¦é€šè¿‡ä¸¤æ­¥å®Œæˆï¼Œç¬¬ä¸€æ­¥æ˜¯è°ƒç”¨å¯¹è±¡çš„ææ„å‡½æ•°ï¼Œç¬¬äºŒæ­¥æ˜¯å›æ”¶å†…å­˜ï¼Œä½†æ˜¯è¦æ³¨æ„è¿™ä¸¤æ­¥ä¸æ˜¯åœ¨GCä¸€æ¬¡è½®å¾ªå®Œæˆï¼Œå³éœ€è¦ä¸¤æ¬¡è½®å¾ªï¼›ç›¸å¯¹äºåè€…ï¼Œåˆ™åªæ˜¯å›æ”¶å†…å­˜è€Œå·²ã€‚</strong></p><p>C#ä¸­çš„GCä½¿ç”¨äº†Generationçš„æ¦‚å¿µï¼Œå®ƒå°†åˆ†é…çš„å¯¹è±¡åˆ†ä¸º3ä»£(å¯ç”¨GC.GetGenerationæ–¹æ³•è¿”å›ä»»æ„ä½œä¸ºå‚æ•°çš„å¯¹è±¡å½“å‰æ‰€å¤„çš„ä»£)ã€‚</p><p>æœ€è¿‘è¢«åˆ†é…å†…å­˜çš„å¯¹è±¡è¢«æ”¾ç½®äºç¬¬0ä»£ï¼Œå› ä¸ºç¬¬0ä»£å¾ˆå°ï¼Œå°åˆ°è¶³ä»¥æ”¾è¿›å¤„ç†å™¨çš„äºŒçº§ï¼ˆL2)ç¼“å­˜ï¼Œæ‰€ä»¥å®ƒèƒ½å¤Ÿæä¾›å¯¹å¯¹è±¡çš„å¿«é€Ÿå­˜å–ã€‚ç»è¿‡ä¸€è½®åƒåœ¾å›æ”¶åï¼Œä»ç„¶ä¿ç•™åœ¨ç¬¬0ä»£ä¸­çš„å¯¹è±¡è¢«ç§»è¿›ç¬¬1ä»£ä¸­ï¼Œå†ç»è¿‡ä¸€è½®åƒåœ¾å†…å­˜å›æ”¶åï¼Œä»ç„¶ä¿ç•™åœ¨ç¬¬1ä»£ä¸­çš„å¯¹è±¡åˆ™è¢«ç§»è¿›ç¬¬2ä»£ä¸­ï¼Œç¬¬2ä»£ä¸­åŒ…å«äº†ç”Ÿå­˜æœŸè¾ƒé•¿çš„å¯¹è±¡ã€‚ å½“ç¬¬0ä»£ä¸­æ²¡æœ‰å¯ä»¥åˆ†é…çš„æœ‰æ•ˆå†…å­˜æ—¶ï¼Œå°±è§¦å‘äº†ç¬¬0ä»£ä¸­çš„ä¸€è½®åƒåœ¾å›æ”¶ï¼Œå®ƒå°†åˆ é™¤é‚£äº›ä¸å†è¢«å¼•ç”¨çš„å¯¹è±¡ï¼Œå¹¶å°†å½“å‰æ­£åœ¨ä½¿ç”¨çš„å¯¹è±¡ç§»è‡³ç¬¬1ä»£ã€‚è€Œå½“ç¬¬0ä»£åƒåœ¾å›æ”¶åä¾ç„¶ä¸èƒ½è¯·æ±‚åˆ°å……è¶³çš„å†…å­˜æ—¶ï¼Œå°±å¯åŠ¨ç¬¬1ä»£åƒåœ¾å›æ”¶ã€‚å¦‚æœå¯¹å„ä»£éƒ½è¿›è¡Œäº†åƒåœ¾å›æ”¶åä»æ²¡æœ‰å¯ç”¨çš„å†…å­˜å°±ä¼šå¼•å‘ä¸€ä¸ªOutOfMemoryExceptionå¼‚å¸¸ã€‚</p><table><thead><tr><th align="center"></th><th align="center">Close</th><th align="center">Dispose</th><th align="center">ææ„å‡½æ•°</th></tr></thead><tbody><tr><td align="center"></td><td align="center">å…³é—­å¯¹è±¡èµ„æº</td><td align="center">é”€æ¯å¯¹è±¡</td><td align="center">é”€æ¯å¯¹è±¡</td></tr><tr><td align="center">è°ƒç”¨æ–¹å¼</td><td align="center">éœ€è¦æ˜¾ç¤ºè°ƒç”¨</td><td align="center">éœ€è¦æ˜¾ç¤ºè°ƒç”¨æˆ–è€…é€šè¿‡usingè¯­å¥</td><td align="center">ä¸èƒ½è¢«æ˜¾ç¤ºè°ƒç”¨ï¼Œä¼šè¢«GCè°ƒç”¨</td></tr><tr><td align="center">è°ƒç”¨æ—¶æœº</td><td align="center">åœ¨æ˜¾ç¤ºè°ƒç”¨æ—¶</td><td align="center">åœ¨æ˜¾ç¤ºè°ƒç”¨æˆ–è€…ç¦»å¼€usingç¨‹åºå—</td><td align="center">ä¸ç¡®å®š</td></tr></tbody></table>]]></content>
    
    
    <summary type="html">&lt;p&gt;è®°å½•ä¸€ä¸‹C#ä¸­GCçš„ç›¸å…³çŸ¥è¯†ã€‚ä¸è®°ä¸‹æ¥ï¼Œä¸‹æ¬¡åˆæ‰¾ä¸åˆ°ï¼Œå°±å¾ˆçƒ¦ã€‚&lt;/p&gt;
&lt;p&gt;ä¸»è¦é’ˆå¯¹çš„æ˜¯C#ä¸­å¦‚ä½•åˆ¤å®šGarbageå’ŒGCçš„è¿ä½œæ–¹å¼ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="Work" scheme="https://blog.eganx.cn/categories/Work/"/>
    
    <category term="C#" scheme="https://blog.eganx.cn/categories/Work/C/"/>
    
    
    <category term="C#" scheme="https://blog.eganx.cn/tags/C/"/>
    
    <category term="GC" scheme="https://blog.eganx.cn/tags/GC/"/>
    
  </entry>
  
  <entry>
    <title>Goç‰ˆæœ¬åˆ‡æ¢</title>
    <link href="https://blog.eganx.cn/2022/01/05/Go_Version_switching/"/>
    <id>https://blog.eganx.cn/2022/01/05/Go_Version_switching/</id>
    <published>2022-01-05T13:06:11.000Z</published>
    <updated>2022-11-15T09:02:25.162Z</updated>
    
    <content type="html"><![CDATA[<p>çº¿ä¸Šçš„ç¨‹åºç”¨çš„æ˜¯è€ç‰ˆæœ¬çš„Go(æ¯•ç«Ÿæ¯”è¾ƒç¨³)ï¼Œè‡ªå·±åˆæƒ³å°è¯•æ–°çš„ç‰ˆæœ¬ç‰¹æ€§ã€‚ä¹…è€Œä¹…ä¹‹ï¼Œç”µè„‘é‡Œé¢SDKçš„ç‰ˆæœ¬å°±è¶Šæ¥è¶Šå¤šäº†ï¼Œæ¯æ¬¡åˆ‡æ¢èµ·æ¥å°±å¾ˆéº»çƒ¦ã€‚æ‰€ä»¥ç‰¹æ­¤è®°å½•ä¸€ä¸‹ã€‚</p><span id="more"></span><h2 id="0x0-æ‰‹åŠ¨ç®¡ç†-ç›®å‰ä½¿ç”¨çš„åˆ‡æ¢æ–¹å¼"><a href="#0x0-æ‰‹åŠ¨ç®¡ç†-ç›®å‰ä½¿ç”¨çš„åˆ‡æ¢æ–¹å¼" class="headerlink" title="0x0.æ‰‹åŠ¨ç®¡ç†(ç›®å‰ä½¿ç”¨çš„åˆ‡æ¢æ–¹å¼)"></a>0x0.æ‰‹åŠ¨ç®¡ç†(ç›®å‰ä½¿ç”¨çš„åˆ‡æ¢æ–¹å¼)</h2><p>å®˜ç½‘ä¸‹è½½æœ€æ–°ç‰ˆArchiveæ–‡ä»¶go1.18beta1.darwin-amd64.tar.gz</p><p>è§£å‹ç¼©é‡å‘½ågo1.18.beta1,æ‹·è´ä¸€ä»½æ”¾åˆ°é»˜è®¤å®‰è£…è·¯å¾„<code>/usr/local/go1.18beta1</code></p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo cp -R /User/egan/Sdks/go1.18beta1 /usr/local/go1.18beta1</span><br></pre></td></tr></table></figure><p>è¿›å…¥é»˜è®¤å®‰è£…è·¯å¾„ï¼Œåˆ›å»ºè½¯é“¾</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd /usr/local/</span><br><span class="line">sudo ln -s go1.18beta1 go</span><br></pre></td></tr></table></figure><h2 id="0x1-ç‰ˆæœ¬åˆ‡æ¢å·¥å…·"><a href="#0x1-ç‰ˆæœ¬åˆ‡æ¢å·¥å…·" class="headerlink" title="0x1.ç‰ˆæœ¬åˆ‡æ¢å·¥å…·"></a>0x1.ç‰ˆæœ¬åˆ‡æ¢å·¥å…·</h2><h3 id="1-g"><a href="#1-g" class="headerlink" title="1).g"></a>1).g</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">GitHub:https:&#x2F;&#x2F;github.com&#x2F;voidint&#x2F;g</span><br></pre></td></tr></table></figure><h3 id="2-goup"><a href="#2-goup" class="headerlink" title="2).goup"></a>2).goup</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Github:https:&#x2F;&#x2F;github.com&#x2F;owenthereal&#x2F;goup</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;çº¿ä¸Šçš„ç¨‹åºç”¨çš„æ˜¯è€ç‰ˆæœ¬çš„Go(æ¯•ç«Ÿæ¯”è¾ƒç¨³)ï¼Œè‡ªå·±åˆæƒ³å°è¯•æ–°çš„ç‰ˆæœ¬ç‰¹æ€§ã€‚ä¹…è€Œä¹…ä¹‹ï¼Œç”µè„‘é‡Œé¢SDKçš„ç‰ˆæœ¬å°±è¶Šæ¥è¶Šå¤šäº†ï¼Œæ¯æ¬¡åˆ‡æ¢èµ·æ¥å°±å¾ˆéº»çƒ¦ã€‚æ‰€ä»¥ç‰¹æ­¤è®°å½•ä¸€ä¸‹ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="Golang" scheme="https://blog.eganx.cn/categories/Golang/"/>
    
    
    <category term="go" scheme="https://blog.eganx.cn/tags/go/"/>
    
    <category term="ç‰ˆæœ¬åˆ‡æ¢" scheme="https://blog.eganx.cn/tags/%E7%89%88%E6%9C%AC%E5%88%87%E6%8D%A2/"/>
    
  </entry>
  
  <entry>
    <title>C#å†…å­˜æ³„éœ²</title>
    <link href="https://blog.eganx.cn/2022/01/03/CSharp_OOM/"/>
    <id>https://blog.eganx.cn/2022/01/03/CSharp_OOM/</id>
    <published>2022-01-03T04:31:19.000Z</published>
    <updated>2022-11-20T02:42:25.089Z</updated>
    
    <content type="html"><![CDATA[<p>è®°å½•è‡ªå·±å¹²çš„è ¢äº‹ï¼Œè¿™ä¹Ÿæ˜¯è‡ªå·±ç¬¬ä¸€æ¬¡åœ¨å·¥ä½œä¸­å†™å‡ºæ¥å†…å­˜æ³„æ¼ã€‚å¹¸äºç¨‹åºæ²¡æœ‰ç›´æ¥ä¸Šçº¿ï¼Œä»¥åè¿˜æ˜¯è¦å¤šæµ‹è¯•æµ‹è¯•è‡ªå·±çš„ä»£ç ã€‚</p><span id="more"></span><h2 id="0x0-é—®é¢˜äº§ç”ŸåŸå› "><a href="#0x0-é—®é¢˜äº§ç”ŸåŸå› " class="headerlink" title="0x0.é—®é¢˜äº§ç”ŸåŸå› "></a>0x0.é—®é¢˜äº§ç”ŸåŸå› </h2><p>åœ¨<code>button1.Click += Button1_Click</code>ä¸­ï¼Œ(+=) æ¥ä¸ºäº‹ä»¶é™„åŠ äº‹ä»¶å¤„ç†ç¨‹åº</p><figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Form1</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    InitializeComponent();</span><br><span class="line">    button1.Click += Button1_Click;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Button1_Click</span>(<span class="params"><span class="built_in">object</span> sender, EventArgs e</span>)</span></span><br><span class="line"><span class="function"></span> &#123;</span><br><span class="line"> Â Â Â Â System.Diagnostics.Debug.Print(<span class="string">&quot;x&quot;</span>);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">event</span> EventHandler Click;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="built_in">delegate</span> <span class="keyword">void</span> <span class="title">EventHandler</span>(<span class="params"><span class="built_in">object</span> sender, EventArgs e</span>)</span>;</span><br></pre></td></tr></table></figure><p>ç»™button1_Clickçš„é™„åŠ äº‹ä»¶å¤„ç†ç¨‹åºæ”¾åœ¨äº†å¿ƒè·³é‡Œé¢ï¼›</p><p>æ­¤æ¬¡æº¢å‡ºæ˜¯å› ä¸ºæ¯æ¬¡å¿ƒè·³ï¼Œåˆè¿›è¡Œäº†ä¸€æ¬¡äº‹ä»¶å¤„ç†ç¨‹åºçš„é™„åŠ ï¼Œé€ æˆä¸æ–­é™„ä»¶äº‹ä»¶å¤„ç†ç¨‹åºã€‚</p><p>ç›´è‡³æœ€åï¼Œç‚¹å‡»ä¸€æ¬¡ï¼Œè¦è¿è¡Œ2K+æ¬¡çš„äº‹ä»¶å¤„ç†ç¨‹åºã€‚</p><p>è€Œäº‹ä»¶å¤„ç†ç¨‹åºçš„ä»£ç é‡Œé¢ä¼šä½¿ç”¨åˆ›å»ºæ–°çš„çº¿ç¨‹ï¼Œè¿è¡Œä¸€æ¬¡ï¼Œåˆ›å»ºå¤§é‡çš„æ–°çº¿ç¨‹ï¼Œçº¿ç¨‹æ•°ç›´æ¥é£™å‡ï¼Œå†…å­˜å´©æ‰ã€‚</p><h2 id="0x1-å®šä½å†…å­˜æ³„éœ²å‘ç”Ÿçš„åœ°æ–¹ï¼š"><a href="#0x1-å®šä½å†…å­˜æ³„éœ²å‘ç”Ÿçš„åœ°æ–¹ï¼š" class="headerlink" title="0x1.å®šä½å†…å­˜æ³„éœ²å‘ç”Ÿçš„åœ°æ–¹ï¼š"></a>0x1.å®šä½å†…å­˜æ³„éœ²å‘ç”Ÿçš„åœ°æ–¹ï¼š</h2><p>C#çš„ä»£ç å¯ä»¥ä½¿ç”¨å†…å­˜åˆ†æå·¥å…·dotMemoryã€‚dotMemoryå…è®¸ä½ åˆ†æå„ç§.NETå’Œ.NET Coreåº”ç”¨ç¨‹åºçš„å†…å­˜ä½¿ç”¨æƒ…å†µï¼›æ¯”å¦‚æ¡Œé¢åº”ç”¨ç¨‹åºã€WindowsæœåŠ¡ã€ASP.NET Webåº”ç”¨ç¨‹åºã€IISã€IIS Expressã€ä»»æ„.NETè¿›ç¨‹ç­‰ã€‚ä¸è¿‡ä¸´æ—¶ç”¨ä¸€ä¸‹å¯ä»¥ï¼Œæœ‰30å¤©çš„è¯•ç”¨æœŸï¼Œè¿˜æ˜¯æ¯”è¾ƒå¥½ç”¨çš„ã€‚</p><p>æº¢å‡ºç‰ˆæœ¬æºç ç¤ºä¾‹:</p><figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">WindowsFormsApp1</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">partial</span> <span class="keyword">class</span> <span class="title">Form1</span> : <span class="title">Form</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="built_in">int</span> i = <span class="number">0</span>;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Form1</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            InitializeComponent();</span><br><span class="line">            button1.Click += Button1_Click;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Cycle</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            button1.Click += Button1_Click;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Button1_Click</span>(<span class="params"><span class="built_in">object</span> sender, EventArgs e</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            i += <span class="number">1</span>;</span><br><span class="line">            System.Diagnostics.Debug.Print(<span class="string">&quot;x:&#123;0&#125;&quot;</span>,i);</span><br><span class="line">            Cycle();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­£å¸¸ç‰ˆæœ¬æºç ç¤ºä¾‹ï¼š</p><figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">WindowsFormsApp1</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">partial</span> <span class="keyword">class</span> <span class="title">Form1</span> : <span class="title">Form</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="built_in">int</span> i = <span class="number">0</span>;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Form1</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            InitializeComponent();</span><br><span class="line">            button1.Click += Button1_Click;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Button1_Click</span>(<span class="params"><span class="built_in">object</span> sender, EventArgs e</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            i += <span class="number">1</span>;</span><br><span class="line">            System.Diagnostics.Debug.Print(<span class="string">&quot;x:&#123;0&#125;&quot;</span>,i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;è®°å½•è‡ªå·±å¹²çš„è ¢äº‹ï¼Œè¿™ä¹Ÿæ˜¯è‡ªå·±ç¬¬ä¸€æ¬¡åœ¨å·¥ä½œä¸­å†™å‡ºæ¥å†…å­˜æ³„æ¼ã€‚å¹¸äºç¨‹åºæ²¡æœ‰ç›´æ¥ä¸Šçº¿ï¼Œä»¥åè¿˜æ˜¯è¦å¤šæµ‹è¯•æµ‹è¯•è‡ªå·±çš„ä»£ç ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="Work" scheme="https://blog.eganx.cn/categories/Work/"/>
    
    <category term="C#" scheme="https://blog.eganx.cn/categories/Work/C/"/>
    
    
    <category term="C#" scheme="https://blog.eganx.cn/tags/C/"/>
    
    <category term="OOM" scheme="https://blog.eganx.cn/tags/OOM/"/>
    
  </entry>
  
  <entry>
    <title>C#ä¸²å£è¯»å†™è¿ç»­æ€§é—®é¢˜</title>
    <link href="https://blog.eganx.cn/2022/01/01/CSharp_Serial_port_readwrite_continuity_problem/"/>
    <id>https://blog.eganx.cn/2022/01/01/CSharp_Serial_port_readwrite_continuity_problem/</id>
    <published>2022-01-01T03:31:19.000Z</published>
    <updated>2022-11-20T02:42:29.078Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨ä½¿ç”¨ä¸²å£åè®®è¿›è¡Œè‡ªå®šä¹‰åè®®è¯»å†™çš„æ—¶å€™ï¼Œä¸€èˆ¬ä½¿ç”¨Asciiç¼–ç ã€‚ä½†æ˜¯ä¸²å£ä¸­è¯»å–åˆ°çš„æ•°æ®å¹¶ä¸èƒ½ä¿è¯å…¶å®Œæ•´æ€§ã€‚ä¸€æ¡æŒ‡ä»¤æœ‰å¯èƒ½ä¼šè¢«æ‹†åˆ†æˆå¤šæ¡æ•°æ®å‘é€ï¼Œè¯»å–åˆ°çš„å­—ç¬¦ä¸²æœ‰å¯èƒ½åªæ˜¯å…¶ä¸­çš„ä¸€éƒ¨åˆ†ã€‚ä¸€èˆ¬ä¸€æ¡æŒ‡ä»¤çš„æœ«å°¾éƒ½ä¼šåŠ ä¸Š\n\rä½œä¸ºç»“æŸç¬¦ã€‚</p><span id="more"></span><h2 id="0x0-åˆ›å»ºè¿æ¥"><a href="#0x0-åˆ›å»ºè¿æ¥" class="headerlink" title="0x0.åˆ›å»ºè¿æ¥"></a>0x0.åˆ›å»ºè¿æ¥</h2><p>ä¸²å£ä½¿ç”¨System.IO.Ports.SerialPortæ¥åˆ›å»ºè¿æ¥</p><figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// æ‘˜è¦:</span></span><br><span class="line"><span class="comment">//     ä½¿ç”¨æŒ‡å®šçš„ç«¯å£åã€æ³¢ç‰¹ç‡ã€å¥‡å¶æ ¡éªŒä½ã€æ•°æ®ä½å’Œåœæ­¢ä½åˆå§‹åŒ– System.IO.Ports.SerialPort ç±»çš„æ–°å®ä¾‹ã€‚</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// å‚æ•°:</span></span><br><span class="line"><span class="comment">//   portName:</span></span><br><span class="line"><span class="comment">//     è¦ä½¿ç”¨çš„ç«¯å£ï¼ˆä¾‹å¦‚ COM1ï¼‰ã€‚</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//   baudRate:</span></span><br><span class="line"><span class="comment">//     æ³¢ç‰¹ç‡ã€‚</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//   parity:</span></span><br><span class="line"><span class="comment">//     System.IO.Ports.SerialPort.Parity å€¼ä¹‹ä¸€ã€‚</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//   dataBits:</span></span><br><span class="line"><span class="comment">//     æ•°æ®ä½å€¼ã€‚</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//   stopBits:</span></span><br><span class="line"><span class="comment">//     System.IO.Ports.SerialPort.StopBits å€¼ä¹‹ä¸€ã€‚</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// å¼‚å¸¸:</span></span><br><span class="line"><span class="comment">//   T:System.IO.IOException:</span></span><br><span class="line"><span class="comment">//     æœªèƒ½æ‰¾åˆ°æˆ–æ‰“å¼€æŒ‡å®šçš„ç«¯å£ã€‚</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">SerialPort</span>(<span class="params"><span class="built_in">string</span> portName, <span class="built_in">int</span> baudRate, Parity parity, <span class="built_in">int</span> dataBits, StopBits stopBits</span>)</span>;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­Parityå’ŒStopBitsçš„æšä¸¾åˆ†åˆ«ä¸ºï¼š</p><figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// æ‘˜è¦:</span></span><br><span class="line"><span class="comment">// æŒ‡å®š System.IO.Ports.SerialPort å¯¹è±¡çš„å¥‡å¶æ ¡éªŒä½ã€‚</span></span><br><span class="line"><span class="keyword">public</span> <span class="built_in">enum</span> Parity</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">// æ‘˜è¦:</span></span><br><span class="line">    <span class="comment">// ä¸å‘ç”Ÿå¥‡å¶æ ¡éªŒæ£€æŸ¥ã€‚</span></span><br><span class="line">    None = <span class="number">0</span>,</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">// æ‘˜è¦:</span></span><br><span class="line">    <span class="comment">// è®¾ç½®å¥‡å¶æ ¡éªŒä½ï¼Œä½¿ä½æ•°ç­‰äºå¥‡æ•°ã€‚</span></span><br><span class="line">    Odd = <span class="number">1</span>,</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">// æ‘˜è¦:</span></span><br><span class="line">    <span class="comment">// è®¾ç½®å¥‡å¶æ ¡éªŒä½ï¼Œä½¿ä½æ•°ç­‰äºå¶æ•°ã€‚</span></span><br><span class="line">    Even = <span class="number">2</span>,</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">// æ‘˜è¦:</span></span><br><span class="line">    <span class="comment">// å°†å¥‡å¶æ ¡éªŒä½ä¿ç•™ä¸º 1ã€‚</span></span><br><span class="line">    Mark = <span class="number">3</span>,</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">// æ‘˜è¦:</span></span><br><span class="line">    <span class="comment">// å°†å¥‡å¶æ ¡éªŒä½ä¿ç•™ä¸º 0ã€‚</span></span><br><span class="line">    Space = <span class="number">4</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// æ‘˜è¦:</span></span><br><span class="line"><span class="comment">// æŒ‡å®šåœ¨ System.IO.Ports.SerialPort å¯¹è±¡ä¸Šä½¿ç”¨çš„åœæ­¢ä½çš„æ•°ç›®ã€‚</span></span><br><span class="line"><span class="keyword">public</span> <span class="built_in">enum</span> StopBits</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">// æ‘˜è¦:</span></span><br><span class="line">    <span class="comment">// ä¸ä½¿ç”¨åœæ­¢ä½ã€‚ System.IO.Ports.SerialPort.StopBits å±æ€§ä¸æ”¯æŒæ­¤å€¼ã€‚</span></span><br><span class="line">    None = <span class="number">0</span>,</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">// æ‘˜è¦:</span></span><br><span class="line">    <span class="comment">// ä½¿ç”¨ä¸€ä¸ªåœæ­¢ä½ã€‚</span></span><br><span class="line">    One = <span class="number">1</span>,</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">// æ‘˜è¦:</span></span><br><span class="line">    <span class="comment">// ä½¿ç”¨ä¸¤ä¸ªåœæ­¢ä½ã€‚</span></span><br><span class="line">    Two = <span class="number">2</span>,</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">// æ‘˜è¦:</span></span><br><span class="line">    <span class="comment">// ä½¿ç”¨ 1.5 ä¸ªåœæ­¢ä½ã€‚</span></span><br><span class="line">    OnePointFive = <span class="number">3</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿æ¥å®Œæˆåéœ€è¦ä¿è¯ç«¯å£çš„å¼€å¯ï¼Œå¯ä½¿ç”¨IsOpenå‚æ•°è¿›è¡Œåˆ¤å®šã€‚</p><figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (!Conn.IsOpen)</span><br><span class="line">&#123;</span><br><span class="line">    Conn.Open();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="0x1-æ•°æ®çš„è¯»å†™éƒ¨åˆ†"><a href="#0x1-æ•°æ®çš„è¯»å†™éƒ¨åˆ†" class="headerlink" title="0x1.æ•°æ®çš„è¯»å†™éƒ¨åˆ†"></a>0x1.æ•°æ®çš„è¯»å†™éƒ¨åˆ†</h2><p>ä½•æ—¶åœæ­¢è¯»å†™ï¼Œå¯ä»¥æ ¹æ®NewLineçš„å€¼è¿›è¡Œåˆ¤å®šã€‚NewLineçš„é»˜è®¤å€¼æ˜¯â€\nâ€æ¢è¡Œç¬¦ï¼Œå¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚è¿›è¡Œæ›´æ”¹ã€‚â€\r\nâ€ä¹Ÿæ˜¯æ¯”è¾ƒå¸¸ç”¨çš„NewLineã€‚</p><figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// æ‘˜è¦:</span></span><br><span class="line"><span class="comment">//     è·å–æˆ–è®¾ç½®ç”¨äºè§£é‡Š System.IO.Ports.SerialPort.ReadLine å’Œ System.IO.Ports.SerialPort.WriteLine(System.String)</span></span><br><span class="line"><span class="comment">//     æ–¹æ³•è°ƒç”¨ç»“æŸçš„å€¼ã€‚</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// è¿”å›ç»“æœ:</span></span><br><span class="line"><span class="comment">//     è¡¨ç¤ºè¡Œå°¾çš„å€¼ã€‚ é»˜è®¤å€¼ä¸ºæ¢è¡Œç¬¦ï¼ŒSystem.Environment.NewLineã€‚</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// å¼‚å¸¸:</span></span><br><span class="line"><span class="comment">//   T:System.ArgumentException:</span></span><br><span class="line"><span class="comment">//     å±æ€§å€¼ä¸ºç©ºã€‚</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//   T:System.ArgumentNullException:</span></span><br><span class="line"><span class="comment">//     å±æ€§å€¼ä¸º nullã€‚</span></span><br><span class="line">[<span class="meta">Browsable(false)</span>]</span><br><span class="line">[<span class="meta">DefaultValue(<span class="meta-string">&quot;\n&quot;</span>)</span>]</span><br><span class="line">[<span class="meta">MonitoringDescription(<span class="meta-string">&quot;NewLine&quot;</span>)</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="built_in">string</span> NewLine &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœä¸æƒ³ç›´æ¥è®¾ç½®NewLineï¼Œä¹Ÿå¯ä»¥åœ¨è¯»å–ä¸²å£æ•°æ®æ—¶ï¼Œæ ¹æ®è‡ªå®šä¹‰å­—ç¬¦è¿›è¡Œè¯»å–åˆ’åˆ†ã€‚</p><figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// æ‘˜è¦:</span></span><br><span class="line"><span class="comment">//     ä¸€ç›´è¯»å–åˆ°è¾“å…¥ç¼“å†²åŒºä¸­çš„æŒ‡å®š value çš„å­—ç¬¦ä¸²ã€‚</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// å‚æ•°:</span></span><br><span class="line"><span class="comment">//   value:</span></span><br><span class="line"><span class="comment">//     æŒ‡ç¤ºè¯»å–æ“ä½œåœæ­¢ä½ç½®çš„å€¼ã€‚</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// è¿”å›ç»“æœ:</span></span><br><span class="line"><span class="comment">//     è¾“å…¥ç¼“å†²åŒºä¸­ç›´åˆ°æŒ‡å®š value çš„å†…å®¹ã€‚</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// å¼‚å¸¸:</span></span><br><span class="line"><span class="comment">//   T:System.ArgumentException:</span></span><br><span class="line"><span class="comment">//     value å‚æ•°çš„é•¿åº¦ä¸º 0ã€‚</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//   T:System.ArgumentNullException:</span></span><br><span class="line"><span class="comment">//     value å‚æ•°ä¸º nullã€‚</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//   T:System.InvalidOperationException:</span></span><br><span class="line"><span class="comment">//     æŒ‡å®šçš„ç«¯å£æœªæ‰“å¼€ã€‚</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//   T:System.TimeoutException:</span></span><br><span class="line"><span class="comment">//     è¯¥æ“ä½œæœªåœ¨è¶…æ—¶æ—¶é—´åˆ°æœŸä¹‹å‰å®Œæˆã€‚</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="built_in">string</span> <span class="title">ReadTo</span>(<span class="params"><span class="built_in">string</span> <span class="keyword">value</span></span>)</span>;</span><br></pre></td></tr></table></figure><figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="built_in">string</span> reqStr = Conn.ReadTo(<span class="string">&quot;\r\n&quot;</span>);</span><br></pre></td></tr></table></figure><p>è¿™æ ·è¯»å–å‡ºæ¥çš„æ•°æ®å°±å¯ä»¥æ—¶ä¸€æ¡æ¡å®Œæ•´çš„æŒ‡ä»¤ï¼Œè€Œä¸ä¼šå‡ºç°è¢«åˆ†éš”çš„æŒ‡ä»¤ç‰‡æ®µã€‚</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;åœ¨ä½¿ç”¨ä¸²å£åè®®è¿›è¡Œè‡ªå®šä¹‰åè®®è¯»å†™çš„æ—¶å€™ï¼Œä¸€èˆ¬ä½¿ç”¨Asciiç¼–ç ã€‚ä½†æ˜¯ä¸²å£ä¸­è¯»å–åˆ°çš„æ•°æ®å¹¶ä¸èƒ½ä¿è¯å…¶å®Œæ•´æ€§ã€‚ä¸€æ¡æŒ‡ä»¤æœ‰å¯èƒ½ä¼šè¢«æ‹†åˆ†æˆå¤šæ¡æ•°æ®å‘é€ï¼Œè¯»å–åˆ°çš„å­—ç¬¦ä¸²æœ‰å¯èƒ½åªæ˜¯å…¶ä¸­çš„ä¸€éƒ¨åˆ†ã€‚ä¸€èˆ¬ä¸€æ¡æŒ‡ä»¤çš„æœ«å°¾éƒ½ä¼šåŠ ä¸Š\n\rä½œä¸ºç»“æŸç¬¦ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="Work" scheme="https://blog.eganx.cn/categories/Work/"/>
    
    <category term="C#" scheme="https://blog.eganx.cn/categories/Work/C/"/>
    
    
    <category term="C#" scheme="https://blog.eganx.cn/tags/C/"/>
    
    <category term="Serial" scheme="https://blog.eganx.cn/tags/Serial/"/>
    
  </entry>
  
  <entry>
    <title>åä¸ºODç¬”è¯•</title>
    <link href="https://blog.eganx.cn/2021/03/09/Huawei_OD_exam/"/>
    <id>https://blog.eganx.cn/2021/03/09/Huawei_OD_exam/</id>
    <published>2021-03-09T03:30:12.000Z</published>
    <updated>2022-11-20T02:40:46.138Z</updated>
    
    <content type="html"><![CDATA[<p>ç¬¬ä¸€æ¬¡å‚åŠ åä¸ºODçš„ç¬”è¯•ï¼Œä½œä¸ºå‚åŠ è¿‡<del>ç²¾è‹±</del>ç¬”è¯•çš„ä¼˜ç§€é’å¹´ã€‚æˆ‘è¿˜æ˜¯æƒ³è®°å½•ä¸€ä¸‹çš„ã€‚è¯´å®è¯é¢˜ç›®è¿˜è¡Œï¼Œä½†æ˜¯è£¸è€ƒè¿˜æ˜¯æœ‰ç‚¹éš¾åº¦çš„(ä¸ªäººè§‚ç‚¹ï¼Œæˆ–è®¸æ˜¯æˆ‘èœçš„è¿‡åˆ†äº†)ã€‚</p><span id="more"></span><h2 id="0x0-ç¬¬ä¸€é¢˜"><a href="#0x0-ç¬¬ä¸€é¢˜" class="headerlink" title="0x0.ç¬¬ä¸€é¢˜"></a>0x0.ç¬¬ä¸€é¢˜</h2><p>ç”¨ä¸€ä¸ªæ•°ç»„Aï¼Œä»£è¡¨ç¨‹åºå‘˜çš„å·¥ä½œèƒ½åŠ›ã€‚å…¬å¸æƒ³é€šè¿‡ç»“å¯¹ç¼–ç¨‹çš„æ¨¡å¼æ¥æé«˜å‘˜å·¥çš„å·¥ä½œèƒ½åŠ›ï¼Œå‡è®¾æˆå¯¹åçš„èƒ½åŠ›æ˜¯ä¸¤ä¸ªå‘˜å·¥çš„èƒ½åŠ›ä¹‹å’Œï¼Œæ±‚ä¸€å…±æœ‰å¤šå°‘ç§ç»“å¯¹æ–¹å¼ï¼Œä½¿ç»“å¯¹åçš„èƒ½åŠ›ä¸ºNã€‚</p><p><strong>æç¤ºï¼š</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1. ç¬¬ä¸€è¡Œä»£è¡¨å‘˜å·¥ä¸ªæ•°</span><br><span class="line">2. ç¬¬äºŒè¡Œä»£è¡¨å„ä¸ªå‘˜å·¥çš„èƒ½åŠ›å€¼</span><br><span class="line">3. ç¬¬ä¸‰è¡Œä»£è¡¨ç»“å¯¹åçš„èƒ½åŠ›å€¼N</span><br><span class="line">4. è¾“å‡ºä¸ºç»“å¯¹çš„ç»„åˆæ–¹å¼çš„å€¼</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼š</span><br><span class="line">5</span><br><span class="line">1 2 2 2 3</span><br><span class="line">4</span><br><span class="line">è¾“å‡ºï¼š</span><br><span class="line">4</span><br></pre></td></tr></table></figure><h3 id="1-è§£é¢˜æ€è·¯"><a href="#1-è§£é¢˜æ€è·¯" class="headerlink" title="1).è§£é¢˜æ€è·¯"></a>1).è§£é¢˜æ€è·¯</h3><p>è¯´å®è¯è¿™é¢˜æ”¾åœ¨åä¸ºODçš„ç¬”è¯•é‡Œé¢ï¼Œåº”è¯¥æ˜¯å±äºé€åˆ†é¢˜ï¼Œä¸€ä¸ªè¾“å…¥æ•°ç»„åŠ ä¸¤å±‚forå¾ªç¯ç›´æ¥è§£å°±è¡Œï¼Œç›´æ¥é™„ä¸Šä»£ç å°±ç®—äº†ã€‚</p><h3 id="2-ä»£ç å®ç°"><a href="#2-ä»£ç å®ç°" class="headerlink" title="2).ä»£ç å®ç°"></a>2).ä»£ç å®ç°</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  main.cpp</span></span><br><span class="line"><span class="comment">//  Demo</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  Created by Egan.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;numeric&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cctype&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n,N;</span><br><span class="line">    <span class="keyword">int</span> arr[<span class="number">1001</span>];</span><br><span class="line">    <span class="keyword">int</span> count =<span class="number">0</span>;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)&#123;</span><br><span class="line">        <span class="built_in">cin</span> &gt;&gt; arr[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; N;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> x =<span class="number">0</span>; x &lt; n; x++ )&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> y= x+<span class="number">1</span>; y &lt;n; y++ )&#123;</span><br><span class="line">            <span class="keyword">if</span>(arr[x]+arr[y] == N)</span><br><span class="line">                count += <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; count &lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="0x1-é”™è¯¯çš„é‡Œç¨‹è¡¨"><a href="#0x1-é”™è¯¯çš„é‡Œç¨‹è¡¨" class="headerlink" title="0x1.é”™è¯¯çš„é‡Œç¨‹è¡¨"></a>0x1.é”™è¯¯çš„é‡Œç¨‹è¡¨</h2><p>ä¸€ä¸ªæ±½è½¦é‡Œç¨‹è¡¨ï¼Œå®ƒä»¥æ•´æ•°å½¢å¼æ˜¾ç¤ºè¡Œé©¶çš„è‹±é‡Œæ•°ã€‚ç„¶è€Œï¼Œé‡Œç¨‹è¡¨æœ‰ä¸€ä¸ªç¼ºé™·:å®ƒä»æ•°å­—3è½¬åˆ°æ•°å­—5ï¼Œæ€»æ˜¯è·³è¿‡æ•°å­—4ã€‚è¿™ä¸ªç¼ºé™·å‡ºç°åœ¨æ‰€æœ‰çš„ä½ç½®(1,10,100ï¼Œç­‰ç­‰)ã€‚ä¾‹å¦‚ï¼Œå¦‚æœé‡Œç¨‹è¡¨æ˜¾ç¤ºä¸º15339ï¼Œè€Œæ±½è½¦è¡Œé©¶äº†1è‹±é‡Œï¼Œé‡Œç¨‹è¡¨çš„è¯»æ•°å°†æ›´æ”¹ä¸º15350(è€Œä¸æ˜¯15340)ã€‚</p><p><strong>æç¤ºï¼š</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1. è¾“å…¥ä¸ºé‡Œç¨‹è¡¨ä¸Šçš„æ•°å€¼</span><br><span class="line">2. è¾“å‡ºä¸ºå®é™…è½¦å­è¡Œé©¶çš„æ•°å€¼</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥1ï¼š5</span><br><span class="line">è¾“å‡º1ï¼š3</span><br><span class="line">è¾“å…¥2ï¼š17</span><br><span class="line">è¾“å‡º2ï¼š15</span><br><span class="line">è¾“å…¥3ï¼š100</span><br><span class="line">è¾“å‡º3ï¼š81</span><br></pre></td></tr></table></figure><h3 id="1-è§£é¢˜æ€è·¯-1"><a href="#1-è§£é¢˜æ€è·¯-1" class="headerlink" title="1).è§£é¢˜æ€è·¯"></a>1).è§£é¢˜æ€è·¯</h3><p>é‡åˆ°4åˆ™ç›´æ¥ä»3è¿›ä½åˆ°5ï¼Œæ‰€ä»¥è¿™æ˜¯ä¸€é“å…¸å‹çš„è¿›åˆ¶è½¬åŒ–é—®é¢˜ï¼Œéå†è¯¥æ•°å­—çš„æ¯ä¸€ä½ï¼ˆå¦‚æœè¿™ä¸€ä½çš„æ•°å­—æ¯”4å¤§ï¼Œå°±è¦å‡å»1ï¼Œå› ä¸ºè¿™ä¸ªä½è·³è¿‡äº†ä¸€ä¸ª4ï¼‰ï¼Œç„¶åå†éå†è¯¥æ•°å­—çš„æ¯ä¸€ä½ï¼Œå°†å…¶è½¬åŒ–ä¸º10è¿›åˆ¶ã€‚</p><h3 id="2-ä»£ç å®ç°-1"><a href="#2-ä»£ç å®ç°-1" class="headerlink" title="2).ä»£ç å®ç°"></a>2).ä»£ç å®ç°</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  main.cpp</span></span><br><span class="line"><span class="comment">//  Demo</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  Created by Egan.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">string</span> n;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>;; i++) &#123;</span><br><span class="line">        <span class="built_in">cin</span> &gt;&gt; n;</span><br><span class="line">        <span class="keyword">if</span>(n[<span class="number">0</span>] == <span class="string">&#x27;0&#x27;</span>)&#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> j = n.size;</span><br><span class="line">        <span class="keyword">long</span> <span class="keyword">long</span> num = <span class="number">0</span>; ans = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> m = j<span class="number">-1</span>; m &gt;= <span class="number">0</span>; m--) &#123;</span><br><span class="line">            <span class="keyword">if</span>((n[m]-<span class="string">&#x27;0&#x27;</span>)&gt;<span class="number">4</span>)&#123;</span><br><span class="line">                num += ((n[m]-<span class="string">&#x27;0&#x27;</span>)<span class="number">-1</span>) * ans;</span><br><span class="line">            &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">                num += (n[m]-<span class="string">&#x27;0&#x27;</span>) * ans;</span><br><span class="line">            &#125;</span><br><span class="line">            ans = ans * <span class="number">9</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; n &lt;&lt; <span class="string">&quot;:&quot;</span>&lt;&lt;num&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="0x2-è´ªåƒè›‡ç®—æ³•"><a href="#0x2-è´ªåƒè›‡ç®—æ³•" class="headerlink" title="0x2.è´ªåƒè›‡ç®—æ³•"></a>0x2.è´ªåƒè›‡ç®—æ³•</h2><p>é¢˜ç›®å¤ªé•¿ï¼Œå…·ä½“çš„è®°ä¸æ¸…æ¥šäº†ï¼Œåªèƒ½å¤§è‡´çš„æè¿°ä¸€ä¸‹ã€‚ã€‚ã€‚ã€‚</p><p>è¾“å…¥ä¸€ä¸ªå­—ç¬¦çŸ©é˜µï¼Œå…¶ä¸­å­—ç¬¦Eæ˜¯é£Ÿç‰©(è›‡åƒäº†é•¿åº¦+1çš„é‚£ç§)ï¼ŒFæ˜¯ç©ºç™½ï¼ŒHæ˜¯è›‡çš„ä½ç½®(åˆå§‹åªå ä¸€ä¸ªä½ç½®)</p><p>ç§»åŠ¨æŒ‡ä»¤æœ‰5ç§ï¼Œåˆ†åˆ«è®©è´ªåƒè›‡ç§»åŠ¨ä»¥åŠè½¬å‘ï¼šGå‰è¿›ã€Uå¾€ä¸Šè½¬ã€Då¾€ä¸‹è½¬ã€Lå¾€å·¦è½¬ã€Rå¾€å³è½¬ï¼ˆåˆå§‹æ–¹å‘ä¸ºå·¦ï¼‰</p><p>ç»“æŸæ¡ä»¶æ˜¯ç¢°å£æˆ–è€…ç¢°åˆ°è‡ªå·±å°±ç®—æ­»äº†ã€‚ </p><p>æ±‚æŒ‰è¾“å…¥çš„æŒ‡ä»¤æ‰§è¡Œä¹‹åçš„è›‡çš„é•¿åº¦ã€‚</p><p><strong>è¾“å…¥è¾“å‡ºç¤ºä¾‹ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼š</span><br><span class="line">D G G</span><br><span class="line">3</span><br><span class="line">F E F</span><br><span class="line">E E H</span><br><span class="line">F F F</span><br><span class="line">è¾“å‡ºï¼š</span><br><span class="line">1</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;ç¬¬ä¸€æ¬¡å‚åŠ åä¸ºODçš„ç¬”è¯•ï¼Œä½œä¸ºå‚åŠ è¿‡&lt;del&gt;ç²¾è‹±&lt;/del&gt;ç¬”è¯•çš„ä¼˜ç§€é’å¹´ã€‚æˆ‘è¿˜æ˜¯æƒ³è®°å½•ä¸€ä¸‹çš„ã€‚è¯´å®è¯é¢˜ç›®è¿˜è¡Œï¼Œä½†æ˜¯è£¸è€ƒè¿˜æ˜¯æœ‰ç‚¹éš¾åº¦çš„(ä¸ªäººè§‚ç‚¹ï¼Œæˆ–è®¸æ˜¯æˆ‘èœçš„è¿‡åˆ†äº†)ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="Work" scheme="https://blog.eganx.cn/categories/Work/"/>
    
    
    <category term="C++" scheme="https://blog.eganx.cn/tags/C/"/>
    
    <category term="åä¸ºOD" scheme="https://blog.eganx.cn/tags/%E5%8D%8E%E4%B8%BAOD/"/>
    
    <category term="ç¬”è¯•" scheme="https://blog.eganx.cn/tags/%E7%AC%94%E8%AF%95/"/>
    
  </entry>
  
  <entry>
    <title>åŸºç¡€è®¡ç®—å™¨II (Basic calculator II)</title>
    <link href="https://blog.eganx.cn/2021/03/02/Basic_calculator_II/"/>
    <id>https://blog.eganx.cn/2021/03/02/Basic_calculator_II/</id>
    <published>2021-03-02T02:22:11.000Z</published>
    <updated>2022-11-20T02:41:25.456Z</updated>
    
    <content type="html"><![CDATA[<p>æ ˆçš„ç»å…¸åº”ç”¨ï¼š</p><p>ç»™ä¸€ä¸ªå­—ç¬¦ä¸²è¡¨è¾¾å¼ <code>s</code> ï¼Œå®ç°ä¸€ä¸ªåŸºæœ¬è®¡ç®—å™¨æ¥è®¡ç®—å¹¶è¿”å›å®ƒçš„å€¼ã€‚(æ•´æ•°é™¤æ³•ä»…ä¿ç•™æ•´æ•°éƒ¨åˆ†)</p><span id="more"></span><p><strong>æç¤ºï¼š</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1. 1 &lt;&#x3D; s.length &lt;&#x3D; 3 * 10^5</span><br><span class="line">2. s ç”±æ•´æ•°å’Œç®—ç¬¦(&#39;+&#39;, &#39;-&#39;, &#39;*&#39;, &#39;&#x2F;&#39;)ç»„æˆ,ä¸­é—´ç”±ä¸€äº›ç©ºæ ¼éš”å¼€</span><br><span class="line">3. s è¡¨ç¤ºä¸€ä¸ªæœ‰æ•ˆè¡¨è¾¾å¼</span><br><span class="line">4. è¡¨è¾¾å¼ä¸­çš„æ‰€æœ‰æ•´æ•°éƒ½æ˜¯éè´Ÿæ•´æ•°,ä¸”åœ¨èŒƒå›´[0, 231 - 1]å†…</span><br><span class="line">5. é¢˜ç›®æ•°æ®ä¿è¯ç­”æ¡ˆæ˜¯ä¸€ä¸ª32-bitæ•´æ•°</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šs &#x3D; &quot;3+2*2&quot;</span><br><span class="line">è¾“å‡ºï¼š7</span><br></pre></td></tr></table></figure><h2 id="0x0-è§£é¢˜æ€è·¯"><a href="#0x0-è§£é¢˜æ€è·¯" class="headerlink" title="0x0.è§£é¢˜æ€è·¯"></a>0x0.è§£é¢˜æ€è·¯</h2><p>æ ˆçš„ç»å…¸åº”ç”¨ï¼Œæ­¤é¢˜æ²¡æœ‰æ‹¬å·ï¼Œä¸éœ€è¦è¿›è¡Œæ‹¬å·åŒ¹é…ï¼Œç›¸å¯¹æ¥è¯´ç®€å•ä¸€ç‚¹ï¼Œå¯ä»¥ç›´æ¥è¿›è¡Œæš´åŠ›æ±‚è§£ã€‚</p><ol><li><p>éœ€è¦è€ƒè™‘è¿ç®—ç¬¦çš„ä¼˜å…ˆçº§é—®é¢˜ã€‚ä¹˜é™¤çš„ä¼˜å…ˆçº§å¤§äºåŠ å‡ï¼Œå¯ä»¥å…ˆè¿›è¡Œä¹˜é™¤è¿ç®—ï¼Œç”¨ä¸€ä¸ªæ ˆï¼Œä¿å­˜è¿›è¡Œä¹˜é™¤è¿ç®—åçš„æ•´æ•°çš„å€¼ã€‚å¯¹äºåŠ å‡å·åçš„æ•°å­—ï¼Œå°†å…¶ç›´æ¥å‹å…¥æ ˆä¸­ï¼›å¯¹äºä¹˜é™¤å·åçš„æ•°å­—ï¼Œç›´æ¥ä¸æ ˆé¡¶å…ƒç´ è®¡ç®—ï¼Œå¹¶æ›¿æ¢æ ˆé¡¶å…ƒç´ ä¸ºè®¡ç®—åçš„ç»“æœã€‚</p></li><li><p>éå†å­—ç¬¦ä¸² sï¼Œå¹¶ç”¨å˜é‡preSignè®°å½•æ¯ä¸ªæ•°å­—ä¹‹å‰çš„è¿ç®—ç¬¦ï¼Œå¯¹äºç¬¬ä¸€ä¸ªæ•°å­—ï¼Œå…¶ä¹‹å‰çš„è¿ç®—ç¬¦è§†ä¸ºåŠ å·ã€‚éå†åˆ°è¿ç®—ç¬¦æˆ–è€…å­—ç¬¦ä¸²æœ€åä¸€ä½æ—¶ï¼Œæ ¹æ®preSignæ¥å†³å®šè®¡ç®—æ–¹å¼:</p><ul><li><p>åŠ å·ï¼šæ•°å­—ç›´æ¥å…¥æ ˆï¼›</p></li><li><p>å‡å·ï¼šnumå˜(-num)å…¥æ ˆï¼›</p></li><li><p>ä¹˜é™¤ï¼šnum ( * or / ) stack.back()ï¼Œå¹¶å°†æ ˆé¡¶å…ƒç´ æ›¿æ¢ä¸ºè¿ç®—ç»“æœã€‚</p></li></ul></li></ol><h2 id="0x1-å¤æ‚åº¦åˆ†æ"><a href="#0x1-å¤æ‚åº¦åˆ†æ" class="headerlink" title="0x1.å¤æ‚åº¦åˆ†æ"></a>0x1.å¤æ‚åº¦åˆ†æ</h2><ul><li><p>æ—¶é—´å¤æ‚åº¦ï¼šO(n)ï¼Œå…¶ä¸­nä¸ºå­—ç¬¦ä¸²sçš„é•¿åº¦ã€‚éœ€è¦éå†å­—ç¬¦ä¸²sä¸€æ¬¡ï¼Œè®¡ç®—è¡¨è¾¾å¼çš„å€¼ã€‚</p></li><li><p>ç©ºé—´å¤æ‚åº¦ï¼šO(n)ï¼Œå…¶ä¸­nä¸ºå­—ç¬¦ä¸²sçš„é•¿åº¦ã€‚ç©ºé—´å¤æ‚åº¦ä¸»è¦å–å†³äºæ ˆçš„ç©ºé—´ï¼Œæ ˆçš„å…ƒç´ ä¸ªæ•°ä¸è¶…è¿‡nã€‚</p></li></ul><p>éœ€è¦æ³¨æ„çš„æ˜¯</p><ul><li>åœ¨è¿ç®—çš„æ—¶å€™ï¼Œåˆ¤æ–­å­—ç¬¦æ˜¯æ•°å­—è¿˜æ˜¯è¿ç®—ç¬¦çš„æ—¶å€™ï¼Œéœ€è¦ä½¿ç”¨<code>isdigit()</code>å‡½æ•°ï¼Œæ­¤å‡½æ•°åŒ…å«åœ¨å¤´æ–‡ä»¶<code>#include &lt;cctype&gt;</code>ä¸­ã€‚</li><li>è¿ç®—çš„æ—¶å€™ï¼Œå¦‚æœé‡åˆ°çš„æ•°æ˜¯å¤§æ•°(ä¸¤ä½æ•°åŠä»¥ä¸Šçš„)ï¼Œéœ€è¦è¿›è¡Œå¤„ç†ã€‚å¤§æ•°åœ¨å­—ç¬¦ä¸²ä¸­æ˜¯ä¸¤ä¸ªå­—ç¬¦ï¼Œéœ€è¦åœ¨éå†å­—ç¬¦ä¸²æ—¶ï¼Œä½¿ç”¨<code>num = num * 10 + int (s[i] - &#39;0&#39;);</code>å¯¹å¤§æ•°è¿›è¡Œå¤„ç†ã€‚</li><li>åœ¨ä¹˜é™¤è¿ç®—çš„ç»“æœéƒ½æ¨¡æ‹Ÿå…¥æ ˆä¹‹åï¼Œä½¿ç”¨ç´¯åŠ å‡½æ•°<code>accumulate(st.begin(), st.end(), 0);</code>å¯¹æ•°ç»„è¿›è¡Œç´¯åŠ å¤„ç†ï¼Œ<code>accumulate()</code>å‡½æ•°åŒ…å«åœ¨å¤´æ–‡ä»¶<code>#include &lt;numeric&gt;</code>ä¸­ï¼Œç´¯åŠ è¿‡ç¨‹ä¸­ï¼Œæ­£è´Ÿæ•°éƒ½å¯ä»¥å¤„ç†ã€‚</li></ul><h2 id="0x2-ä»£ç å®ç°"><a href="#0x2-ä»£ç å®ç°" class="headerlink" title="0x2.ä»£ç å®ç°"></a>0x2.ä»£ç å®ç°</h2><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  main.cpp</span></span><br><span class="line"><span class="comment">//  Demo</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  Created by Egan.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;numeric&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cctype&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">calculate</span><span class="params">(<span class="built_in">string</span> s)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; st; <span class="comment">//digits</span></span><br><span class="line">        <span class="keyword">char</span> ps = <span class="string">&#x27;+&#x27;</span>; <span class="comment">//presign</span></span><br><span class="line">        <span class="keyword">int</span> num = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; s.length(); i++)&#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">isdigit</span>(s[i]))&#123; <span class="comment">//#include &lt;cctype&gt;</span></span><br><span class="line">                num = num * <span class="number">10</span> + <span class="keyword">int</span> (s[i] - <span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (!<span class="built_in">isdigit</span>(s[i]) &amp;&amp; s[i] != <span class="string">&#x27; &#x27;</span> || i == s.length()<span class="number">-1</span>)&#123;</span><br><span class="line">                <span class="keyword">switch</span>(ps)&#123;</span><br><span class="line">                    <span class="keyword">case</span> <span class="string">&#x27;+&#x27;</span> :</span><br><span class="line">                        st.push_back(num);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> <span class="string">&#x27;-&#x27;</span> :</span><br><span class="line">                        st.push_back(-num);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> <span class="string">&#x27;*&#x27;</span> :</span><br><span class="line">                        st.back() *= num;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> <span class="string">&#x27;/&#x27;</span> :</span><br><span class="line">                        st.back() /= num;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                ps = s[i];</span><br><span class="line">                num = <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> accumulate(st.begin(), st.end(), <span class="number">0</span>); <span class="comment">//#include&lt;numeric&gt;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;æ ˆçš„ç»å…¸åº”ç”¨ï¼š&lt;/p&gt;
&lt;p&gt;ç»™ä¸€ä¸ªå­—ç¬¦ä¸²è¡¨è¾¾å¼ &lt;code&gt;s&lt;/code&gt; ï¼Œå®ç°ä¸€ä¸ªåŸºæœ¬è®¡ç®—å™¨æ¥è®¡ç®—å¹¶è¿”å›å®ƒçš„å€¼ã€‚(æ•´æ•°é™¤æ³•ä»…ä¿ç•™æ•´æ•°éƒ¨åˆ†)&lt;/p&gt;</summary>
    
    
    
    <category term="Leetcode" scheme="https://blog.eganx.cn/categories/Leetcode/"/>
    
    
    <category term="C++" scheme="https://blog.eganx.cn/tags/C/"/>
    
    <category term="æ ˆ" scheme="https://blog.eganx.cn/tags/%E6%A0%88/"/>
    
  </entry>
  
  <entry>
    <title>é€†æ³¢å…°è¡¨ç¤ºæ³•(Reverse Polish notation)</title>
    <link href="https://blog.eganx.cn/2021/03/01/Reverse%20Polish%20notation/"/>
    <id>https://blog.eganx.cn/2021/03/01/Reverse%20Polish%20notation/</id>
    <published>2021-03-01T08:12:14.000Z</published>
    <updated>2022-11-20T02:41:34.945Z</updated>
    
    <content type="html"><![CDATA[<p>æ ¹æ®é€†æ³¢å…°è¡¨ç¤ºæ³•ï¼Œæ±‚è¡¨è¾¾å¼çš„å€¼ã€‚</p><p>æœ‰æ•ˆçš„è¿ç®—ç¬¦åŒ…æ‹¬ <code>+</code>, <code>-</code>, <code>*</code>, <code>/</code> ã€‚æ¯ä¸ªè¿ç®—å¯¹è±¡å¯ä»¥æ˜¯æ•´æ•°ï¼Œä¹Ÿå¯ä»¥æ˜¯å¦ä¸€ä¸ªé€†æ³¢å…°è¡¨è¾¾å¼ã€‚</p><span id="more"></span><h2 id="0x0-è§£é¢˜æ€è·¯"><a href="#0x0-è§£é¢˜æ€è·¯" class="headerlink" title="0x0.è§£é¢˜æ€è·¯"></a>0x0.è§£é¢˜æ€è·¯</h2><p>é€†æ³¢å…°è¡¨è¾¾å¼æ˜¯ä¸€ç§åç¼€è¡¨è¾¾å¼ï¼Œæ‰€è°“åç¼€å°±æ˜¯æŒ‡ç®—ç¬¦å†™åœ¨åé¢ã€‚</p><p>é€†æ³¢å…°è¡¨è¾¾å¼ä¸»è¦æœ‰ä»¥ä¸‹ä¸¤ä¸ªä¼˜ç‚¹ï¼š</p><ul><li><p>å»æ‰æ‹¬å·åè¡¨è¾¾å¼æ— æ­§ä¹‰ï¼Œ<code>( 1 + 2 ) * ( 3 + 4 )</code>å³ä¾¿å†™æˆ <code>1 2 + 3 4 + * </code>ä¹Ÿå¯ä»¥ä¾æ®æ¬¡åºè®¡ç®—å‡ºæ­£ç¡®ç»“æœã€‚</p></li><li><p>é€‚åˆç”¨æ ˆæ“ä½œè¿ç®—</p></li></ul><p>é€†æ³¢å…°è¡¨è¾¾å¼çš„æ±‚è§£æ˜¯æ ˆçš„ç»å…¸åº”ç”¨ã€‚æ‰€ä»¥æ­¤é¢˜é‡‡ç”¨æ ˆæ¥è§£å†³ï¼Œé‡åˆ°æ•°å­—åˆ™å…¥æ ˆï¼Œé‡åˆ°è¿ç®—ç¬¦åˆ™å–å‡º<strong>æ ˆé¡¶ä¸¤ä¸ªæ•°å­—</strong>è¿›è¡Œè¿ç®—ï¼Œ<strong>å¹¶å°†ç»“æœå‹å…¥æ ˆä¸­</strong>ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯</p><ul><li><p>åœ¨è¿ç®—çš„æ—¶å€™ï¼Œéœ€è¦åå–å‡ºçš„æ•°å­—åœ¨å‰ï¼Œå…ˆå–å‡ºçš„æ•°å­—åœ¨åï¼Œå³num2åœ¨å‰ã€‚</p></li><li><p><code>stoi</code>è¡¨ç¤º<code>string to int</code>ï¼Œå³å­—ç¬¦ä¸²è½¬æ•´æ•°</p></li></ul><h2 id="0x1-ä»£ç å®ç°"><a href="#0x1-ä»£ç å®ç°" class="headerlink" title="0x1.ä»£ç å®ç°"></a>0x1.ä»£ç å®ç°</h2><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  main.cpp</span></span><br><span class="line"><span class="comment">//  Demo</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  Created by Egan.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="keyword">int</span> <span class="title">evalRPN</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt;&amp; tokens)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">stack</span>&lt;<span class="keyword">int</span>&gt; s;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;tokens.size(); i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(tokens[i] == <span class="string">&quot;+&quot;</span>||tokens[i] == <span class="string">&quot;-&quot;</span>||tokens[i] == <span class="string">&quot;*&quot;</span>||tokens[i] == <span class="string">&quot;/&quot;</span>)&#123;</span><br><span class="line">                <span class="keyword">int</span> num1 = s.top();</span><br><span class="line">                s.pop();</span><br><span class="line">                <span class="keyword">int</span> num2 = s.top();</span><br><span class="line">                s.pop();</span><br><span class="line">                <span class="keyword">if</span>(tokens[i] == <span class="string">&quot;+&quot;</span>) s.push(num2 + num1);</span><br><span class="line">                <span class="keyword">if</span>(tokens[i] == <span class="string">&quot;-&quot;</span>) s.push(num2 - num1);</span><br><span class="line">                <span class="keyword">if</span>(tokens[i] == <span class="string">&quot;*&quot;</span>) s.push(num2 * num1);</span><br><span class="line">                <span class="keyword">if</span>(tokens[i] == <span class="string">&quot;/&quot;</span>) s.push(num2 / num1);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                s.push(stoi(tokens[i]));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> result = s.top();</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;æ ¹æ®é€†æ³¢å…°è¡¨ç¤ºæ³•ï¼Œæ±‚è¡¨è¾¾å¼çš„å€¼ã€‚&lt;/p&gt;
&lt;p&gt;æœ‰æ•ˆçš„è¿ç®—ç¬¦åŒ…æ‹¬ &lt;code&gt;+&lt;/code&gt;, &lt;code&gt;-&lt;/code&gt;, &lt;code&gt;*&lt;/code&gt;, &lt;code&gt;/&lt;/code&gt; ã€‚æ¯ä¸ªè¿ç®—å¯¹è±¡å¯ä»¥æ˜¯æ•´æ•°ï¼Œä¹Ÿå¯ä»¥æ˜¯å¦ä¸€ä¸ªé€†æ³¢å…°è¡¨è¾¾å¼ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="Leetcode" scheme="https://blog.eganx.cn/categories/Leetcode/"/>
    
    
    <category term="C++" scheme="https://blog.eganx.cn/tags/C/"/>
    
    <category term="æ ˆ" scheme="https://blog.eganx.cn/tags/%E6%A0%88/"/>
    
  </entry>
  
</feed>
